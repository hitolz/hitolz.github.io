<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  计算机网络--运输层 - 非著名Java程序员
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="非著名Java程序员" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
 
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:blog.hitol.top ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_self" href="about1.html">About</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 非著名Java程序员</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        
        <li><a target="_self" href="about1.html">About</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="redis.html">redis</a></li>
        
            <li><a href="dubbo.html">dubbo</a></li>
        
            <li><a href="RocketMQ.html">RocketMQ</a></li>
        
            <li><a href="kubernetes.html">kubernetes</a></li>
        
            <li><a href="Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF.html">Java并发编程的艺术</a></li>
        
            <li><a href="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.html">网络协议</a></li>
        
            <li><a href="JVM.html">JVM</a></li>
        
            <li><a href="Java.html">Java</a></li>
        
            <li><a href="MySQL.html">MySQL</a></li>
        
            <li><a href="Docker.html">Docker</a></li>
        
            <li><a href="Spring.html">Spring</a></li>
        
            <li><a href="GO.html">GO</a></li>
        
            <li><a href="rust.html">rust</a></li>
        
            <li><a href="AI.html">AI</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>计算机网络--运输层</h1>
     
        <div class="read-more clearfix">
          <span class="date">2020/10/28 10:23 上午</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.html'>网络协议</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <div class="mweb_toc"><ul>
<li><a href="#%E8%BF%90%E8%BE%93%E5%B1%82">运输层</a>
<ul>
<li><a href="#1%E3%80%81%E8%BF%90%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0">1、运输层协议概述</a>
<ul>
<li><a href="#1-1%E8%BF%9B%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1">1.1 进程之间的通信</a>
<ul>
<li><a href="#%E5%A4%8D%E7%94%A8">复用</a></li>
<li><a href="#%E5%88%86%E7%94%A8">分用</a></li>
</ul>
</li>
<li><a href="#1-2%E8%BF%90%E8%BE%93%E5%B1%82%E4%B8%A4%E4%B8%AA%E4%B8%BB%E8%A6%81%E5%8D%8F%E8%AE%AE">1.2 运输层两个主要协议</a></li>
</ul>
</li>
<li><a href="#2%E3%80%81-udp">2、 UDP</a>
<ul>
<li><a href="#2-1-udp%E7%89%B9%E7%82%B9">2.1 UDP特点</a></li>
<li><a href="#2-2-udp%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F">2.2 UDP的首部格式</a></li>
</ul>
</li>
<li><a href="#3%E3%80%81tcp">3、TCP</a>
<ul>
<li><a href="#3-1-tcp%E7%89%B9%E7%82%B9">3.1 TCP特点</a></li>
<li><a href="#3-2-tcp%E7%9A%84%E8%BF%9E%E6%8E%A5">3.2 TCP的连接</a></li>
</ul>
</li>
<li><a href="#4%E3%80%81%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">4、可靠传输的工作原理</a>
<ul>
<li><a href="#4-1%E5%81%9C%E6%AD%A2%E7%AD%89%E5%BE%85%E5%8D%8F%E8%AE%AE">4.1 停止等待协议</a>
<ul>
<li><a href="#%E6%97%A0%E5%B7%AE%E9%94%99%E6%83%85%E5%86%B5">无差错情况</a></li>
<li><a href="#%E5%87%BA%E7%8E%B0%E5%B7%AE%E9%94%99">出现差错</a></li>
<li><a href="#%E7%A1%AE%E8%AE%A4%E4%B8%A2%E5%A4%B1%E5%92%8C%E7%A1%AE%E8%AE%A4%E8%BF%9F%E5%88%B0">确认丢失和确认迟到</a></li>
<li><a href="#%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%87">信道利用率</a></li>
</ul>
</li>
<li><a href="#4-2%E8%BF%9E%E7%BB%AD-arq%E5%8D%8F%E8%AE%AE">4.2 连续ARQ协议</a></li>
</ul>
</li>
<li><a href="#5%E3%80%81tcp%E6%8A%A5%E6%96%87%E6%AE%B5%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F">5、TCP报文段的首部格式</a></li>
<li><a href="#6%E3%80%81tcp%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84%E5%AE%9E%E7%8E%B0">6、TCP可靠传输的实现</a>
<ul>
<li><a href="#6-1%E4%BB%A5%E5%AD%97%E8%8A%82%E4%B8%BA%E5%8D%95%E4%BD%8D%E7%9A%84%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3">6.1 以字节为单位的滑动窗口</a></li>
<li><a href="#6-2%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%97%B6%E9%97%B4%E7%9A%84%E9%80%89%E6%8B%A9">6.2 超时重传时间的选择</a></li>
<li><a href="#6-3%E9%80%89%E6%8B%A9%E7%A1%AE%E8%AE%A4-ack">6.3 选择确认ACK</a></li>
</ul>
</li>
<li><a href="#7%E3%80%81tcp%E7%9A%84%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">7、TCP的流量控制</a>
<ul>
<li><a href="#7-1%E5%88%A9%E7%94%A8%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%AE%9E%E7%8E%B0%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">7.1 利用滑动窗口实现流量控制</a></li>
<li><a href="#7-2-tcp%E7%9A%84%E4%BC%A0%E8%BE%93%E6%95%88%E7%8E%87">7.2 TCP的传输效率</a></li>
</ul>
</li>
<li><a href="#8%E3%80%81tcp%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6">8、TCP的拥塞控制</a>
<ul>
<li><a href="#8-1%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%9A%84%E4%B8%80%E8%88%AC%E5%8E%9F%E7%90%86">8.1 拥塞控制的一般原理</a></li>
<li><a href="#8-2-tcp%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E6%96%B9%E6%B3%95">8.2 TCP的拥塞控制方法</a>
<ul>
<li><a href="#%E6%85%A2%E5%BC%80%E5%A7%8B">慢开始</a></li>
<li><a href="#%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D">拥塞避免</a></li>
<li><a href="#%E5%BF%AB%E9%87%8D%E4%BC%A0">快重传</a></li>
<li><a href="#%E5%BF%AB%E6%81%A2%E5%A4%8D">快恢复</a></li>
</ul>
</li>
<li><a href="#8-3%E4%B8%BB%E5%8A%A8%E9%98%9F%E5%88%97%E7%AE%A1%E7%90%86-aqm">8.3 主动队列管理AQM</a></li>
</ul>
</li>
<li><a href="#9%E3%80%81tcp%E7%9A%84%E8%BF%90%E8%BE%93%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86">9、TCP的运输连接管理</a>
<ul>
<li><a href="#9-1-tcp%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B">9.1 TCP连接的建立</a></li>
<li><a href="#9-2-tcp%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%87%8A%E6%94%BE">9.2 TCP连接的释放</a></li>
<li><a href="#9-3-tcp%E7%9A%84%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA">9.3 TCP的有限状态机</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p><img src="http://hitol.blog.cdn.updev.cn/16038522760929.jpg" alt="" /></p>
<h1><a id="%E8%BF%90%E8%BE%93%E5%B1%82" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>运输层</h1>
<p>运输层向上面的应用层提供通信服务，属于面向通信部分的最高层。</p>
<ol>
<li>运输层为相互通信的应用进程提供逻辑通信</li>
<li>端口和套接字的意义</li>
<li>无连接的UDP的特点</li>
<li>面向连接的TCP的特点</li>
<li>在不可靠的网络上实现可靠传输的工作原理，停止等待协议和ARQ协议</li>
<li>TCP的华东窗口、流量控制、拥塞控制和连接管理</li>
</ol>
<h2><a id="1%E3%80%81%E8%BF%90%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>1、运输层协议概述</h2>
<h3><a id="1-1%E8%BF%9B%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.1 进程之间的通信</h3>
<p>运输层向它上面的应用层提供通信服务，属于面向通信部分的最高层，同时也是用户功能中的最底层。</p>
<p>两台主机进行通信就是两台主机中的应用进程互相通信。<br />
通信的真正端点并不是主机而是主机中的进程。也就是说端到端的通信时应用进程之间的通信。</p>
<h4><a id="%E5%A4%8D%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>复用</h4>
<p>指在发送方不同的应用进程都可以使用同一个运输层协议传送数据。需要加上适当的首部</p>
<h4><a id="%E5%88%86%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>分用</h4>
<p>指接收方的运输层在剥去报文的首部后能够把这些数据正确交付目的应用进程。</p>
<h3><a id="1-2%E8%BF%90%E8%BE%93%E5%B1%82%E4%B8%A4%E4%B8%AA%E4%B8%BB%E8%A6%81%E5%8D%8F%E8%AE%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.2 运输层两个主要协议</h3>
<ol>
<li>用户数据报协议UDP，User Datagram Protocol</li>
<li>传输控制TCP，Transmission Control Protocol</li>
</ol>
<p>通信时传送的数据单位叫做运输协议数据单元TPDU，TCP称为TCP报文段，UDP称为UDP用户数据报。</p>
<p>UDP在传送数据之前不需要先建立连接。在收到UDP报文后，不需要给出任何确认。</p>
<p>TCP则提供面向连接件的服务。在传送数据之前必须先建立连接，数据传送结束后要释放连接。</p>
<h2><a id="2%E3%80%81-udp" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2、 UDP</h2>
<p>UDP只在IP的数据报服务至上增加了很少一点的功能，这就是复用和分用的功能以及差错检测的功能。</p>
<h3><a id="2-1-udp%E7%89%B9%E7%82%B9" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.1 UDP特点</h3>
<ul>
<li>无连接的。即发送数据之前不需要建立连接，发送数据结束时也没有连接可释放，减少了开销和发送数据之前的时延。</li>
<li>使用尽最大努力交付。即不保证可靠交付。</li>
<li>面向报文的。发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付IP层。UDP对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。在接收方的UDP，对IP层交上来的UDP数据报，在去除首部后原封不动的交付上层的应用进程，</li>
<li>UDP没有拥塞控制，因此网络出现的拥塞不会使源主机的发送速率降低。允许在网络发生拥塞时丢失一些数据</li>
<li>UDP支持一对一、一对多、多对一和多对多的交互通信。</li>
<li>UDP首部开销小，只有8字节，比TCP的20字节首部要短。</li>
</ul>
<h3><a id="2-2-udp%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2 UDP的首部格式</h3>
<p><img src="http://hitol.blog.cdn.updev.cn/16038736077265.jpg" alt="" /></p>
<p>用户数据报UDP有两个字段：数据字段和首部字段。首部字段由4个字段、8个字节，每个字段长度都是两个字节。</p>
<ul>
<li>
<p>源端口<br />
源端口号，在需要对方回信时选用，不需要时可用全0。</p>
</li>
<li>
<p>目的端口<br />
目的端口号，这在终点交付报文时必须使用。</p>
</li>
<li>
<p>长度<br />
UDP用户数据报的长度，其最小值是8（仅有首部）。</p>
</li>
<li>
<p>检验和<br />
检测UDP用户数据报在传输中是否有错，有错就丢弃。</p>
</li>
</ul>
<hr />
<p>当运输层收到UDP数据报时，根据首部中的目的端口，把UDP数据报通过相应的端口，上交应用进程。</p>
<p><img src="http://hitol.blog.cdn.updev.cn/16038740882125.jpg" alt="" /></p>
<h2><a id="3%E3%80%81tcp" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3、TCP</h2>
<h3><a id="3-1-tcp%E7%89%B9%E7%82%B9" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3.1 TCP特点</h3>
<ul>
<li>
<p>面向连接<br />
在使用TCP协议之前，必须先建立TCP连接。在传送数据完毕后，必须释放已经建立的TCP连接。</p>
</li>
<li>
<p>每一条TCP连接只能有两个端点，每一条TCP连接都是点对点的</p>
</li>
<li>
<p>提供可靠交付的服务<br />
无差错、不丢失、不重复，按序到达</p>
</li>
<li>
<p>提供全双工通信<br />
TCP允许通信双方的应用进程在任何时候都能发送数据。TCP连接的两端都设有发送缓存和接收缓存，用来临时存放双向通信的数据。发送时，应用程序把数据传送给TCP的缓存后，就可以做自己的事，而TCP在合适的时候把数据发送出去。在接收时，TCP把收到的数据放入缓存，上层的应用进程在合适的时候会读取缓存中的数据。</p>
</li>
<li>
<p>面向字节流<br />
流，指的是流入到进程或从进程流出的字节序列。<del>“面向字节流”的含义是：虽然应用程序和TCP的交互式一次一个数据块，但TCP把应用程序交下来的数据仅仅看成是一连串的<strong>无结构的字节流</strong>。</del></p>
</li>
</ul>
<h3><a id="3-2-tcp%E7%9A%84%E8%BF%9E%E6%8E%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3.2 TCP的连接</h3>
<p>每一条TCP连接有两个端点。端点叫做套接字或插口，</p>
<p>RFC793定义：端口号拼接到IP地址即构成了套接字。</p>
<h2><a id="4%E3%80%81%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>4、可靠传输的工作原理</h2>
<p>TCP下面的网络所提供的是不可靠的传输。因此，TCP必须采用适当的措施才能使得两个运输层之间的通信变得可靠。</p>
<h3><a id="4-1%E5%81%9C%E6%AD%A2%E7%AD%89%E5%BE%85%E5%8D%8F%E8%AE%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>4.1 停止等待协议</h3>
<p>停止等待，就是每发送完一个分组就停止发送，等待对方确认，在收到确认后再发送下一个分组。</p>
<h4><a id="%E6%97%A0%E5%B7%AE%E9%94%99%E6%83%85%E5%86%B5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>无差错情况</h4>
<p><img src="http://hitol.blog.cdn.updev.cn/16038880279747.jpg" alt="" /><br />
发送一个，确认完一个，然后在发下一个。</p>
<h4><a id="%E5%87%BA%E7%8E%B0%E5%B7%AE%E9%94%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>出现差错</h4>
<p><img src="http://hitol.blog.cdn.updev.cn/16038880365080.jpg" alt="" /><br />
当出现差错，接收方丢掉收到的报文，发送发收不到确认消息，超时后重传。</p>
<h4><a id="%E7%A1%AE%E8%AE%A4%E4%B8%A2%E5%A4%B1%E5%92%8C%E7%A1%AE%E8%AE%A4%E8%BF%9F%E5%88%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>确认丢失和确认迟到</h4>
<p><img src="http://hitol.blog.cdn.updev.cn/16038886686296.jpg" alt="" /><br />
发送方收到报文，发送方没有收到确认消息，发送方超时重传，接收方收到上次已经接收到的报文，丢弃重复的报文并发送确认消息。</p>
<h4><a id="%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>信道利用率</h4>
<p><img src="http://hitol.blog.cdn.updev.cn/16038888143833.jpg" alt="" /><br />
<img src="http://hitol.blog.cdn.updev.cn/16038888219637.jpg" alt="" /></p>
<h3><a id="4-2%E8%BF%9E%E7%BB%AD-arq%E5%8D%8F%E8%AE%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>4.2 连续ARQ协议</h3>
<p>滑动窗口是TCP协议的精髓。<br />
连续ARQ协议规定，发送发每收到一个确认，就把发送窗口向前滑动一个分组的位置。<br />
接收方一般都是采用累积确认的方式。接收方不必对收到的分组逐个发送确认，而是在收到几个分组后，对按序到达的最后一个分组发送确认，就表示到这个分组为止的所有分组都已经正确收到了。</p>
<h2><a id="5%E3%80%81tcp%E6%8A%A5%E6%96%87%E6%AE%B5%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>5、TCP报文段的首部格式</h2>
<p>TCP是面向字节流的，但TCP传送的数据单元确实报文段。</p>
<p>TCP报文段分为首部和数据两部分，TCP的全部功能都体现在它首部中各字段的作用。<br />
<img src="http://hitol.blog.cdn.updev.cn/16038518220336.jpg" alt="" /></p>
<ol>
<li>
<p>源端口和目的端口<br />
TCP的分用功能</p>
</li>
<li>
<p>序号，也称作报文段序号<br />
4字节，范围是[0，2^32 - 1],TCP中传送的字节流中的每一个字节都是按顺序编号。在建立连接的时候设置。首部中的序号字段值指的是本报文段所发送的数据的第一个字节的序号。</p>
</li>
<li>
<p>确认号<br />
4字节，是期望收到对方下一个报文段的第一个数据字节的序号。确认号=N，表示序号N-1为止的所有数据都已正确收到。</p>
</li>
<li>
<p>数据偏移<br />
4位。TCP报文段的数据起始处距离TCP报文段的起始处有多远，实际上是指出TCP报文段的首部长度。</p>
</li>
<li>
<p>保留</p>
</li>
<li>
<p>紧急URG<br />
URG = 1 时表示紧急指针字段有效，应当尽快传送，而不需要按照原来的排队顺序传送。</p>
</li>
<li>
<p>确认ACK<br />
仅当 ACK = 1 时有效。在建立连接后所有传送的报文段都必须把 ACK 设置为1.</p>
</li>
<li>
<p>推送PUSH<br />
两个进程进行交互式的通信时，有时在一段的应用进程希望在键入一个命令后立即就能够收到对方的响应，这种情况下使用PUSH操作。<br />
这时，发送方 TCP 把 PSUH 设置为1，并立即创建一个报文段发送出去。接收方收到后尽快交付给应用进程，而不用等到整个缓存都满了之后在向上交付。</p>
</li>
<li>
<p>复位RST<br />
当 RST = 1 时，表明TCP连接中出现严重差错，必须释放连接，然后在重新建立连接。</p>
</li>
<li>
<p>同步SYN<br />
在建立连接时用来同步序号。当SYN = 1 而 ACK = 0 时，表明这是一个连接请求报文段。对方若同意建立连接，则在响应的报文段中使 SYN = 1 和 ACK = 1。</p>
</li>
<li>
<p>终止FIN<br />
用来释放一个连接。当 FIN = 1 时，表明此报文段的发送方的数据已经发送完毕，并要求释放运输连接。</p>
</li>
<li>
<p>窗口</p>
</li>
<li>
<p>检验和<br />
范围包括首部和数据两部分。在计算检验和时要在TCP报文段的前面加上12字节的伪首部。</p>
</li>
<li>
<p>紧急指针</p>
</li>
<li>
<p>选项</p>
</li>
</ol>
<h2><a id="6%E3%80%81tcp%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84%E5%AE%9E%E7%8E%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>6、TCP可靠传输的实现</h2>
<h3><a id="6-1%E4%BB%A5%E5%AD%97%E8%8A%82%E4%B8%BA%E5%8D%95%E4%BD%8D%E7%9A%84%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.1 以字节为单位的滑动窗口</h3>
<p>TCP的滑动窗口是以字节为单位的。</p>
<p><img src="http://hitol.blog.cdn.updev.cn/16047342570775.jpg" alt="" /></p>
<p>发送窗口，在没有收到确认的情况下，可以连续把窗口内的数据都发送出去，凡是已经发送过的数据，在未收到确认之前都必须暂时保留，以便在超时重传时使用。</p>
<p>发送窗口里面的序号表示允许发送的序号，窗口越大，发送方就可以在收到对方确认之前连续发送更多的数据，因而能获得更高的传输效率。</p>
<p>发送窗口的位置由前沿和后沿的位置共同确定。发送窗口后沿的变化情况有两种可能，即不动（没有收到新的确认）和前移（收到了新的确认）。不可能向后移动，因为不能撤销已收到的确认。</p>
<p>后沿后面的部分表示已经发送并且收到了确认。</p>
<p>发送窗口前沿有可能向后收缩。但是TCP的标准强烈不赞成这样做。</p>
<h3><a id="6-2%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%97%B6%E9%97%B4%E7%9A%84%E9%80%89%E6%8B%A9" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.2 超时重传时间的选择</h3>
<p>重传时间的选择是TCP最复杂的问题之一。<br />
TCP采用了一种自适应算法，记录一个报文段发出的时间，以及收到相应的确认的时间。这两个时间之差就是报文段的往返时间RTT。TCP保留了RTT的一个加权平均往返时间RTTs（这又称为平滑的往返时间）。</p>
<p>在计算加权平均RTTS时，只要报文段重传了，就不采用其往返时间样本，这样得出的加权平均RTTS和RTO就较准确。</p>
<h3><a id="6-3%E9%80%89%E6%8B%A9%E7%A1%AE%E8%AE%A4-ack" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.3 选择确认ACK</h3>
<p>假设TCP的接收方在接收对方发送过来的数据字节流的序号不连续，结果就形成了一些不连续的字节块。如果这些字节的序号都在接收窗口之内，那么接收方就先收下这些数据，但要把这些信息准确告诉发送方，使发送方不要再重复发送这些已收到的数据。</p>
<h2><a id="7%E3%80%81tcp%E7%9A%84%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>7、TCP的流量控制</h2>
<p>所谓流量控制就是让发送方的发送速率不要太快，要让接收方来得及接收。</p>
<h3><a id="7-1%E5%88%A9%E7%94%A8%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%AE%9E%E7%8E%B0%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>7.1 利用滑动窗口实现流量控制</h3>
<p>发送方的发送窗口不能超过接收方给出的接收窗口的数值。</p>
<p><img src="http://hitol.blog.cdn.updev.cn/16052568753111.jpg" alt="" /></p>
<p>大写ACK表示TCP首部确认位，小写ack表示确认字段的值。</p>
<h3><a id="7-2-tcp%E7%9A%84%E4%BC%A0%E8%BE%93%E6%95%88%E7%8E%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>7.2 TCP的传输效率</h3>
<h2><a id="8%E3%80%81tcp%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>8、TCP的拥塞控制</h2>
<h3><a id="8-1%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%9A%84%E4%B8%80%E8%88%AC%E5%8E%9F%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>8.1 拥塞控制的一般原理</h3>
<p>在某段时间，若对网络中国呢某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏，这种情况就叫做拥塞。  供不应求的情况。供大于求</p>
<p>拥塞控制就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。</p>
<p>发送方如何知道网络发生拥塞？<br />
出现超时</p>
<h3><a id="8-2-tcp%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E6%96%B9%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>8.2 TCP的拥塞控制方法</h3>
<h4><a id="%E6%85%A2%E5%BC%80%E5%A7%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>慢开始</h4>
<p>发送方在发送之前先探测一下，由小到大逐渐增大发送窗口，由小到大逐渐增大拥塞窗口的数值。</p>
<p>发送方的最大报文段：SMSS（Sender Maximum Segment Size）。</p>
<p>旧的规定：在刚刚开始发送报文段时，先把初始拥塞窗口 cwnd 设置为 1 至 2 个发送方的最大报文段的数值，但新的 RFC 5681 把初始 拥塞窗口 cwnd 设置为不超过 2 至 4 个 SMSS值。</p>
<p>慢开始规定，在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值。</p>
<p><img src="http://hitol.blog.cdn.updev.cn/16052577650549.jpg" alt="" /></p>
<p>一开始发送方 cwnd = 1，发送第一个报文段 M1，接收方收到后确认M1，发送方收到确认后，把 cwnd 增大到 2，于是发送方可以发送 M2 和 M3 两个报文段。<br />
接收方收到后发回对 M2 、M3的确认，发送方 cwnd + 2</p>
<p>发送方每收到一个对新报文段的确认就使发送窗口增加1。</p>
<p>每经过一个传输轮次，拥塞窗口 cwnd 就加倍。</p>
<h4><a id="%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>拥塞避免</h4>
<p>为了防止拥塞窗口 cwnd 增长过大引起网络拥塞，还需要设置一个慢开始门限 ssthresh 状态变量。<br />
当 cwnd &lt; ssthresh，使用慢开始算法。<br />
当 cwnd &gt; ssthresh，停止使用慢开始算法而改用使用拥塞避免算法。<br />
当 cwnd = ssthresh，既可以使用慢开始算法，也可以使用拥塞避免算法。</p>
<p>拥塞避免算法的思路是让拥塞窗口 cwnd 缓慢地增大，即每经过一个往返时间 RTT 就把发送方的 拥塞窗口 cwnd 加 1，而不是像慢开始阶段那样加倍增长。<br />
把拥塞窗口控制为按线性规律增长，使网络比较不容易出现拥塞。</p>
<p><img src="http://hitol.blog.cdn.updev.cn/16052583857555.jpg" alt="" /></p>
<h4><a id="%E5%BF%AB%E9%87%8D%E4%BC%A0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>快重传</h4>
<p>快重传算法可以让发送方尽早知道发生了个别报文的丢失。<br />
要求接收方立即发送确认，即使收到了失序的报文段也要立即发出对已收到的报文段的重复确认。</p>
<h4><a id="%E5%BF%AB%E6%81%A2%E5%A4%8D" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>快恢复</h4>
<p>在上图的点 4，发送方知道现在只是丢失了个别额的报文段，于是不启动慢开始，而是执行 快恢复 算法。这时，调整发送方门限值 ssthresh = cwnd / 2，同时设置拥塞窗口 cwnd = ssthresh ，并开始执行拥塞避免算法。</p>
<h3><a id="8-3%E4%B8%BB%E5%8A%A8%E9%98%9F%E5%88%97%E7%AE%A1%E7%90%86-aqm" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>8.3 主动队列管理AQM</h3>
<h2><a id="9%E3%80%81tcp%E7%9A%84%E8%BF%90%E8%BE%93%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>9、TCP的运输连接管理</h2>
<p>TCP是面向连接的协议。运输连接是用来传送TCP报文的。TCP运输连接的建立和释放是每一次面向连接的通信中必不可少的过程。</p>
<p>连接建立的过程中要解决三个问题：</p>
<ol>
<li>要使每一方都能够确知对方的存在</li>
<li>要允许双方协商一些参数（最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量）</li>
<li>能够对运输实体资源进行分配（缓存大小、连接表中的项目）</li>
</ol>
<h3><a id="9-1-tcp%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>9.1 TCP连接的建立</h3>
<p><img src="http://hitol.blog.cdn.updev.cn/16052595057866.jpg" alt="" /></p>
<ol>
<li>客户端 A 先发送 SYN = 1，表示要与服务端 B 建立连接</li>
<li>B收到后，发送确认。 ACK = 1，表示 A可以建立连接，SYN = 1 表示 B 要与 A 建立连接， A --&gt; B 方向已建立连接。</li>
<li>A收到B的确认后，在给一个确认 ACK = 1 ,B --&gt; A 方向已建立连接。</li>
</ol>
<h3><a id="9-2-tcp%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%87%8A%E6%94%BE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>9.2 TCP连接的释放</h3>
<p><img src="http://hitol.blog.cdn.updev.cn/16052601324288.jpg" alt="" /></p>
<ol>
<li>客户端 A 先提出要断开连接，发送 FIN = 1 表示要断开连接，</li>
<li>B 收到后给出确认 ACK = 1，A -&gt; B 方向连接已经断开，A 不能再发送数据给 B，但是 B 可以发送数据给 A，</li>
<li>等数据传送完成后，B 要跟 A 断开连接， B 发送 FIN = 1，</li>
<li>A 收到后确认 ACK = 1，双方连接都已经断开。</li>
</ol>
<h3><a id="9-3-tcp%E7%9A%84%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>9.3 TCP的有限状态机</h3>
<p><img src="http://hitol.blog.cdn.updev.cn/16054411396657.jpg" alt="" style="width:633px;" /></p>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="16054964627964.html" 
          title="Previous Post: 计算机网络--物理层">&laquo; 计算机网络--物理层</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="16032826948500.html" 
          title="Next Post: Docker 安装 MySQL数据库 实现主从复制">Docker 安装 MySQL数据库 实现主从复制 &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <h1>非著名Java程序员</h1>
                <div class="site-des"></div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/hitolz/hitolz.github.io" title="GitHub">GitHub</a>

  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="redis.html"><strong>redis</strong></a>
        
            <a href="dubbo.html"><strong>dubbo</strong></a>
        
            <a href="RocketMQ.html"><strong>RocketMQ</strong></a>
        
            <a href="kubernetes.html"><strong>kubernetes</strong></a>
        
            <a href="Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF.html"><strong>Java并发编程的艺术</strong></a>
        
            <a href="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.html"><strong>网络协议</strong></a>
        
            <a href="JVM.html"><strong>JVM</strong></a>
        
            <a href="Java.html"><strong>Java</strong></a>
        
            <a href="MySQL.html"><strong>MySQL</strong></a>
        
            <a href="Docker.html"><strong>Docker</strong></a>
        
            <a href="Spring.html"><strong>Spring</strong></a>
        
            <a href="GO.html"><strong>GO</strong></a>
        
            <a href="rust.html"><strong>rust</strong></a>
        
            <a href="AI.html"><strong>AI</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="16849954851968.html">向量数据库 Vector Database</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16761949639234.html">使用 ChatGPT 学习 Javassist</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16748079623338.html">rust 快速入门指南</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16727524082529.html">rust 包管理与工作空间</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16669473309292.html">rust actix-diesel-mysql demo</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>



  














<style type="text/css">
figure{margin: 0;padding: 0;}
figcaption{text-align:center;}

/* PrismJS 1.14.0
 http://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript */
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
    color: black;
    background: none;
    text-shadow: 0 1px white;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
    
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
    
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
    text-shadow: none;
    background:#b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
    text-shadow: none;
    background: #b3d4fc;
}

@media print {
    code[class*="language-"],
    pre[class*="language-"] {
        text-shadow: none;
    }
}

/* Code blocks */
pre[class*="language-"] {
    padding: 1em;
    margin: .5em 0;
    overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
    background: #F7F7F7;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
    padding: .1em;
    border-radius: .3em;
    white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
    color: slategray;
}

.token.punctuation {
    color: #999;
}

.namespace {
    opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
    color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
    color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
    color: #9a6e3a;
    background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
    color: #07a;
}

.token.function,
.token.class-name {
    color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
    color: #e90;
}

.token.important,
.token.bold {
    font-weight: bold;
}
.token.italic {
    font-style: italic;
}

.token.entity {
    cursor: help;
}


pre[class*="language-"].line-numbers {
    position: relative;
    padding-left: 3.8em;
    counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
    position: relative;
    white-space: inherit;
}

.line-numbers .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em; /* works for line-numbers below 1000 lines */
    letter-spacing: -1px;
    border-right: 1px solid #999;

    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

}

    .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }

</style>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>



  </body>
</html>
