<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[éè‘—åJavaç¨‹åºå‘˜]]></title>
  <link href="http://blog.hitol.top/atom.xml" rel="self"/>
  <link href="http://blog.hitol.top/"/>
  <updated>2023-11-20T17:20:40+08:00</updated>
  <id>http://blog.hitol.top/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im/">MWeb</generator>
  
  <entry>
    <title type="html"><![CDATA[rust web å¼€å‘-2. æ•°æ®åº“/orm]]></title>
    <link href="http://blog.hitol.top/17002146115226.html"/>
    <updated>2023-11-17T17:50:11+08:00</updated>
    <id>http://blog.hitol.top/17002146115226.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#sqlx">sqlx</a></li>
<li><a href="#orm">orm</a>
<ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%88%9D%E5%A7%8B%E5%8C%96">æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–</a></li>
</ul>
</li>
</ul>
</div>
<p>æœ¬ç³»åˆ—æ–‡ç« ä»ä»¥ä¸‹ 9 ä¸ªæ–¹é¢å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Rust è¿›è¡Œ web å¼€å‘ã€‚</p>
<ol>
<li>web æ¡†æ¶</li>
<li>æ•°æ®åº“/orm</li>
<li>config</li>
<li>log</li>
<li>çº¿ç¨‹æ± </li>
<li>kafka</li>
<li>redis</li>
<li>æ‰“åŒ…æˆ docker é•œåƒ</li>
<li>gracefully shutdown</li>
</ol>
<hr />
<p>æœ¬æ–‡ä»‹ç»ç¬¬äºŒéƒ¨åˆ†ï¼Œæ•°æ®åº“åŠ ormã€‚<br />
ä¸»è¦ä»‹ç» Rust å¦‚ä½•ä½¿ç”¨ sqlx è¿æ¥ MySQLï¼Œorm é€‰ç”¨äº† rbatisã€‚</p>
<p>å‡†å¤‡ MySQL æ•°æ®åº“ï¼Œç®€å•çš„ä¸€ä¸ªè¡¨ç»“æ„</p>
<pre class="line-numbers"><code class="language-sql">CREATE TABLE `user` (
	`id` bigint NOT NULL AUTO_INCREMENT,
	`user_name` varchar(32) DEFAULT NULL,
	`password` varchar(64) DEFAULT NULL,
	PRIMARY KEY (`id`)
);
</code></pre>
<p>æ¥ä¸‹æ¥åˆ†åˆ«ä½¿ç”¨ sqlx å’Œ rbatis è¿›è¡Œ  CRUD æ“ä½œã€‚</p>
<h2><a id="sqlx" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>sqlx</h2>
<p>æ·»åŠ ä¾èµ–</p>
<pre class="line-numbers"><code class="language-plain_text">sqlx = { version = &quot;0.7.2&quot;, features = [
    &quot;runtime-async-std-native-tls&quot;,
    &quot;mysql&quot;,
    &quot;chrono&quot;,
] }
</code></pre>
<p>sqlx è¿æ¥æ•°æ®åº“çš„é“¾æ¥æ ¼å¼ï¼š<code>mysql://{user}:{password}@{IP}:{port}/{database name}</code><br />
ä¾‹å¦‚æˆ‘æœ¬åœ°çš„æ•°æ®åº“åœ°å€ï¼š<code>mysql://root:12345678@localhost:3306/rust_web</code></p>
<p>è¿æ¥ MySQL</p>
<pre class="line-numbers"><code class="language-rust">use sqlx::{mysql::MySqlPoolOptions, MySql, Pool};

pub async fn get_mysql_pool() -&gt; Pool&lt;MySql&gt; {
    let database_url = &quot;mysql://root:12345678@localhost:3306/rust_web&quot;;
    MySqlPoolOptions::new().connect(database_url).await.unwrap()
}
</code></pre>
<p>api</p>
<pre class="line-numbers"><code class="language-rust">use actix_web::{get, post, web, HttpResponse, Scope};
use serde::{Deserialize, Serialize};

use crate::{db::get_mysql_pool, success};

// å®šä¹‰è·¯ç”±ï¼Œå¯¹å¤–æš´éœ²çš„æ¥å£
pub fn routes() -&gt; Scope {
    web::scope(&quot;/users&quot;)
        .service(add_user)
        .service(query_user)
        .service(update_user)
        .service(delete_user)
}

// å®šä¹‰å®ä½“
#[derive(Debug, Deserialize, Clone, Serialize, Default,sqlx::FromRow)]
#[serde(rename_all = &quot;camelCase&quot;)]
pub struct User {
    pub id: Option&lt;i64&gt;,
    pub user_name: Option&lt;String&gt;,
    pub password: Option&lt;String&gt;,
}

#[post(&quot;/add&quot;)]
pub async fn add_user(user: web::Json&lt;User&gt;) -&gt; HttpResponse {
    let user = user.to_owned();
    let id = save_user(user).await.unwrap();
    success(Some(id))
}
// insert
async fn save_user(user: User) -&gt; Result&lt;u64, sqlx::Error&gt; {
    // è·å–æ•°æ®åº“è¿æ¥æ± 
    let pool = get_mysql_pool().await;
    let sql = &quot;insert into user(user_name, password) values (?,?)&quot;;
    let result = sqlx::query(sql)
        .bind(user.user_name)
        .bind(user.password)
        .execute(&amp;pool)
        .await?;
    let id = result.last_insert_id();
    Ok(id)
}

// update
#[post(&quot;/update/{id}&quot;)]
pub async fn update_user(id: web::Path&lt;i64&gt;, user: web::Json&lt;User&gt;) -&gt; HttpResponse {
    let user = user.to_owned();

    let sql = &quot;update user set user_name =?, password =? where id = ?&quot;;
    sqlx::query(sql)
        .bind(user.user_name)
        .bind(user.password)
        .bind(id.into_inner())
        .execute(&amp;get_mysql_pool().await)
        .await.unwrap();
    success(Some(1))
}

// select
#[get(&quot;/query/{id}&quot;)]
pub async fn query_user(id:web::Path&lt;i64&gt;) -&gt; HttpResponse {
    let sql = &quot;select * from user where id = ?&quot;;
    let result = sqlx::query_as::&lt;_,User&gt;(sql).bind(id.into_inner()).fetch_optional(&amp;get_mysql_pool().await).await.unwrap();
    success(result)
}

// delete
#[post(&quot;/delete/{id}&quot;)]
pub async fn delete_user(id:web::Path&lt;i64&gt;) -&gt; HttpResponse {
    let sql = &quot;delete from user where id = ?&quot;;
    sqlx::query(sql).bind(id.into_inner()).execute(&amp;get_mysql_pool().await).await.unwrap();
    success(Some(1))
}
</code></pre>
<p>æœåŠ¡å¯åŠ¨ä¹‹åæµ‹è¯•ï¼š<br />
æ–°å¢ userï¼š</p>
<pre class="line-numbers"><code class="language-bash">curl -X &quot;POST&quot; &quot;http://localhost:8099/users/add&quot; \
     -H 'token: 1' \
     -H 'Content-Type: application/json; charset=utf-8' \
     -d $'{
  &quot;password&quot;: &quot;3456789&quot;,
  &quot;userName&quot;: &quot;å¼ ä¸‰&quot;
}'
</code></pre>
<p>æŸ¥è¯¢ userï¼š</p>
<pre class="line-numbers"><code class="language-bash">curl &quot;http://localhost:8099/users/query/1&quot; \
     -H 'token: 1'
</code></pre>
<p>ä¿®æ”¹ userï¼š</p>
<pre class="line-numbers"><code class="language-bash">curl -X &quot;POST&quot; &quot;http://localhost:8099/users/update/1&quot; \
     -H 'token: 1' \
     -H 'Content-Type: application/json; charset=utf-8' \
     -d $'{
  &quot;password&quot;: &quot;987654&quot;,
  &quot;userName&quot;: &quot;lisi&quot;
}'
</code></pre>
<p>åˆ é™¤ userï¼š</p>
<pre class="line-numbers"><code class="language-bash">curl -X &quot;POST&quot; &quot;http://localhost:8099/users/delete/2&quot; \
     -H 'token: 1'
</code></pre>
<h2><a id="orm" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>orm</h2>
<p>orm ç›®å‰æˆ‘ä½¿ç”¨è¿‡çš„æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ Dieselï¼Œä¸€ä¸ªæ˜¯ rbatisã€‚</p>
<p>Diesel å¯ä»¥çœ‹ä»¥å‰å†™è¿‡çš„ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="https://blog.hitol.top/16669473309292.html">https://blog.hitol.top/16669473309292.html</a><br />
æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä¸€ä¸‹ rbatisã€‚</p>
<p>æ·»åŠ ä¾èµ–</p>
<pre class="line-numbers"><code class="language-plain_text"># rbatis
rbs = { version = &quot;4.3&quot; }
rbatis = { version = &quot;4.3&quot; }
rbdc-mysql = { version = &quot;4.3&quot; }
</code></pre>
<p>åˆ›å»º rbatis</p>
<pre class="line-numbers"><code class="language-rust">use rbatis::RBatis;
use rbdc_mysql::MysqlDriver;

pub async fn get_rb() -&gt; RBatis {
    let database_url = &quot;mysql://root:12345678@localhost:3306/rust_web&quot;;
    let rb = RBatis::new();
    rb.init(MysqlDriver {}, database_url).unwrap();
    rb
}
</code></pre>
<p>åœ¨ User å®ä½“å®šä¹‰çš„æ–‡ä»¶ä¸­è°ƒç”¨ <code>crud!</code> å®ã€‚</p>
<blockquote>
<p>crud!(User {});//crud = insert+select_by_column+update_by_column+delete_by_column</p>
</blockquote>
<p>å®è°ƒç”¨ä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ User::insertã€User::updateã€User::selectã€User::deleteã€‚</p>
<pre class="line-numbers"><code class="language-rust">#[derive(Debug, Deserialize, Clone, Serialize, Default, sqlx::FromRow)]
#[serde(rename_all = &quot;camelCase&quot;)]
pub struct User {
    pub id: Option&lt;i64&gt;,
    pub user_name: Option&lt;String&gt;,
    pub password: Option&lt;String&gt;,
}

crud!(User {}); // crud

#[post(&quot;/add&quot;)]
pub async fn add_user(user: web::Json&lt;User&gt;) -&gt; HttpResponse {
    let user = user.to_owned();
    // let id = save_user(user).await.unwrap();
    let id = save_user_rb(user).await;
    success(Some(id))
}

async fn save_user_rb(user: User) -&gt; i64 {
    let rbatis = get_rb().await;
    let x = User::insert(&amp;rbatis, &amp;user).await;
    let x = x.unwrap();
    i64::from(x.last_insert_id)
}

//update: User::update_by_column(&amp;get_rb().await, &amp;user, &quot;id&quot;).await;
//select: User::select_by_column(&amp;get_rb().await, &quot;id&quot;,id.into_inner()).await.unwrap();
//delete: User::delete_by_column(&amp;get_rb().await, &quot;id&quot;, id.into_inner()).await;
</code></pre>
<h3><a id="%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%88%9D%E5%A7%8B%E5%8C%96" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–</h3>
<p>éœ€è¦æ³¨æ„ç‚¹æ˜¯æ•°æ®åº“è¿æ¥æ± ç°åœ¨æ˜¯æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆå§‹åŒ–ï¼Œä¸ºäº†æ¼”ç¤ºè¿æ¥æ•°æ®åº“ã€‚è¦æ”¹ä¸ºåªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨lazy_staticå®æ¥å»¶è¿Ÿåˆå§‹åŒ–é™æ€å˜é‡ã€‚lazy_staticå®å…è®¸åœ¨é¦–æ¬¡è®¿é—®å˜é‡æ—¶æ‰§è¡Œåˆå§‹åŒ–ä»£ç ã€‚</p>
<pre class="line-numbers"><code class="language-rust">use lazy_static::*;
use rbatis::RBatis;
use rbdc_mysql::MysqlDriver;
use sqlx::{mysql::MySqlPoolOptions, MySql, Pool};
use std::{sync::Mutex, time::Duration};

lazy_static! {
    static ref MYSQL_POOL: Mutex&lt;Vec&lt;Pool&lt;MySql&gt;&gt;&gt; = Mutex::new(vec![]);
}

lazy_static! {
    static ref RB: Mutex&lt;RBatis&gt; = Mutex::new(RBatis::new());
}

pub async fn init_db(database_url: String) {
    let pool = MySqlPoolOptions::new()
        .max_connections(20)
        .min_connections(5)
        .idle_timeout(Some(Duration::from_secs(30)))
        .connect(&amp;database_url)
        .await
        .unwrap();

    let mut pools = MYSQL_POOL.lock().unwrap();
    (*pools).push(pool);

    let rbatis = RBatis::new();
    rbatis.init(MysqlDriver {}, &amp;database_url).unwrap();
    let mut rb = RB.lock().unwrap();
    *rb = rbatis;

}

pub async fn get_mysql_pool() -&gt; Pool&lt;MySql&gt; {
    let pools = MYSQL_POOL.lock().unwrap();
    unsafe { (*pools).get_unchecked(0).to_owned() }
}

pub async fn get_rb() -&gt; RBatis {
    RB.lock().unwrap().clone()
}
</code></pre>
<p>æœ¬ç¯‡æ–‡ç« ä»£ç åœ¨ <a href="https://github.com/hitolz/rust-web/tree/db_orm">github</a></p>
<p>æˆ‘åœ¨é¡¹ç›®ä¸­ç”¨çš„è¯ä¸€èˆ¬æ˜¯ sqlx + rbatis ä¸€èµ·ä½¿ç”¨ï¼Œç®€å•çš„ sql ç”¨ rbatis è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¤æ‚ä¸€äº›çš„ sql å°±ä½¿ç”¨ sqlx è‡ªå·±æ‰‹å†™â€¦â€¦</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rust web å¼€å‘-1.web æ¡†æ¶]]></title>
    <link href="http://blog.hitol.top/17002145985395.html"/>
    <updated>2023-11-17T17:49:58+08:00</updated>
    <id>http://blog.hitol.top/17002145985395.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#actix-web">actix-web</a>
<ul>
<li><a href="#httpserver">HttpServer</a></li>
<li><a href="#scope">scope</a></li>
<li><a href="#shared-mutable-state">Shared Mutable State</a></li>
<li><a href="#%E8%BF%94%E5%9B%9Ejson">è¿”å› json</a></li>
<li><a href="#%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0">æ¥æ”¶è¯·æ±‚å‚æ•°</a>
<ul>
<li><a href="#path">Path</a></li>
<li><a href="#get%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0">get è¯·æ±‚ï¼Œæ¥æ”¶å‚æ•°</a></li>
<li><a href="#post%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%8E%A5%E6%94%B6-json">post è¯·æ±‚ï¼Œæ¥æ”¶ json</a></li>
</ul>
</li>
<li><a href="#middleware">middleware</a></li>
</ul>
</li>
<li><a href="#%E5%B0%8F%E7%BB%93">å°ç»“</a></li>
</ul>
</div>
<p>æœ¬ç³»åˆ—æ–‡ç« ä»ä»¥ä¸‹ 9 ä¸ªæ–¹é¢å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Rust è¿›è¡Œ web å¼€å‘ã€‚</p>
<ol>
<li>web æ¡†æ¶</li>
<li>æ•°æ®åº“/orm</li>
<li>config</li>
<li>log</li>
<li>çº¿ç¨‹æ± </li>
<li>kafka</li>
<li>redis</li>
<li>æ‰“åŒ…æˆ docker é•œåƒ</li>
<li>gracefully shutdown</li>
</ol>
<hr />
<p>æœ¬æ–‡ä»‹ç»ç¬¬ä¸€éƒ¨åˆ†ï¼Œweb æ¡†æ¶ã€‚<br />
ç›®å‰æ¯”è¾ƒå‡ºåçš„ web æ¡†æ¶æœ‰</p>
<ol>
<li><a href="https://github.com/tokio-rs/axum">axum</a></li>
<li><a href="https://github.com/SergioBenitez/Rocket">Rocket</a></li>
<li><a href="https://github.com/actix/actix-web">actix-web</a></li>
<li><a href="https://github.com/hyperium/hyper">Hyper</a></li>
<li><a href="https://github.com/http-rs/tide">Tide</a></li>
<li><a href="https://github.com/seanmonstar/warp">Warp</a></li>
</ol>
<p>æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»ä¸€ä¸‹ actix-webï¼Œå…¶ä»–æ¡†æ¶å¾…åé¢æœ‰æ—¶é—´å†ä»‹ç»ã€‚</p>
<h2><a id="actix-web" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>actix-web</h2>
<p>actix-web æœåŠ¡ç«¯çš„é€»è¾‘éƒ½æ˜¯å»ºç«‹åœ¨ App å®ä¾‹ä¸Šçš„ï¼Œé€šè¿‡ App å®ä¾‹ä¸ºæ‰€æœ‰èµ„æºå’Œä¸­é—´ä»¶æ³¨å†Œè·¯ç”±ï¼Œå­˜å‚¨åŒä¸€èŒƒå›´å†…æ‰€æœ‰çº¿ç¨‹å…±äº«çš„çŠ¶æ€ã€‚<br />
æ¥ä¸‹æ¥ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ª actix-web ç¤ºä¾‹ã€‚</p>
<ol>
<li>åˆ›å»ºrust å·¥ç¨‹</li>
</ol>
<pre class="line-numbers"><code class="language-rust">cargo new hello-world
</code></pre>
<ol start="2">
<li>Cargo.toml æ·»åŠ ä¾èµ–</li>
</ol>
<pre class="line-numbers"><code class="language-rust">[dependencies]
actix-web=&quot;4&quot;
</code></pre>
<ol start="3">
<li>ä½¿ç”¨ actix-web<br />
åœ¨ src/main.rs ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç </li>
</ol>
<pre class="line-numbers"><code class="language-rust">use actix_web::{get, post, web, App, HttpResponse, HttpServer, Responder};

#[get(&quot;/&quot;)]
async fn hello() -&gt; impl Responder {
    HttpResponse::Ok().body(&quot;Hello world!&quot;)
}

#[post(&quot;/echo&quot;)]
async fn echo(req_body: String) -&gt; impl Responder {
    HttpResponse::Ok().body(req_body)
}

async fn manual_hello() -&gt; impl Responder {
    HttpResponse::Ok().body(&quot;Hey there!&quot;)
}


#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new( || {
        App::new()
            .service(hello)
            .service(echo)
            .route(&quot;/hey&quot;, web::get().to(manual_hello))
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p>HttpServer ç»‘å®šåˆ° ipã€ç«¯å£ï¼ŒåŒæ—¶ï¼Œæä¾›äº†ä¸¤ä¸ª get æ–¹æ³•(/,/hey)ï¼Œä¸€ä¸ª post æ–¹æ³•(/echo)ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® localhost:8099 å³å¯è®¿é—®ã€‚<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/2022-11-20-13.36.34.png" alt="2022-11-20-13.36.34" /></p>
<h3><a id="httpserver" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>HttpServer</h3>
<p>HttpServer æ¥å—çš„å‚æ•°ç±»å‹æ˜¯ application factoryï¼Œå®ç°äº† Send + Syncã€‚</p>
<p>bindï¼Œä¸º server ç»‘å®š ip å’Œç«¯å£ã€‚<br />
bind æˆåŠŸåï¼Œ<code>HttpServer::run()</code> è¿”å›ä¸€ä¸ª server å®ä¾‹ã€‚<br />
server å¿…é¡»ä½¿ç”¨ await æˆ–è€…åœ¨å¤šçº¿ç¨‹ä¸­æ‰èƒ½å¯åŠ¨ http æœåŠ¡å™¨ã€‚<br />
server é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°ä¸ CPU ä¸ªæ•°ç›¸ç­‰ï¼Œå¯ä»¥é€šè¿‡ <code>HttpServer::workers()</code> æ”¹å˜çº¿ç¨‹æ•°ã€‚</p>
<h3><a id="scope" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>scope</h3>
<p>scope ç›¸å½“äºè¯·æ±‚è·¯å¾„çš„å‰ç¼€</p>
<pre class="line-numbers"><code class="language-rust">#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| {
        App::new().service(
            web::scope(&quot;/app&quot;)
                .route(&quot;/hey&quot;, web::get().to(manual_hello)),
        )
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p>è¿™æ ·çš„è¯åœ¨è¯·æ±‚ localhost:8099/hey å°±è¯·æ±‚ä¸åˆ°äº†ï¼Œè¿™æ ·è¦è¯·æ±‚çš„è·¯å¾„æ˜¯ localhost:8099/app/hey</p>
<h3><a id="shared-mutable-state" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Shared Mutable State</h3>
<p>ç›¸å½“äºå…¨å±€å˜é‡ã€å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«çš„ã€‚</p>
<p><code>web::Data&lt;T&gt;</code>,T æ˜¯ Arc ç±»å‹ã€‚<br />
Arc å’Œ Mutex ç»“åˆä½¿ç”¨ï¼Œå®ç°åœ¨å¤šçº¿ç¨‹é—´å…±äº«æ•°æ®ã€‚</p>
<pre class="line-numbers"><code class="language-rust">use std::sync::Mutex;

use actix_web::{App, HttpServer, web};

struct AppStateWithCounter {
    counter: Mutex&lt;i32&gt;, // &lt;- Mutex is necessary to mutate safely across threads
}

async fn index(data: web::Data&lt;AppStateWithCounter&gt;) -&gt; String {
    let mut counter = data.counter.lock().unwrap(); // &lt;- get counter's MutexGuard
    *counter += 1; // &lt;- access counter inside MutexGuard

    format!(&quot;Request number: {counter}&quot;) // &lt;- response with count
}

#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    // Note: web::Data created _outside_ HttpServer::new closure
    let counter = web::Data::new(AppStateWithCounter {
        counter: Mutex::new(0),
    });

    HttpServer::new(move || {
        // move counter into the closure
        App::new()
            .app_data(counter.clone()) // &lt;- register the created data
            .route(&quot;/&quot;, web::get().to(index))
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p>æµè§ˆå™¨è¯·æ±‚ localhost:8099,æ¯æ¬¡åˆ·æ–° counter+1ï¼›</p>
<h3><a id="%E8%BF%94%E5%9B%9Ejson" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è¿”å› json</h3>
<p>ä¸€èˆ¬ web åº”ç”¨æœåŠ¡ç«¯æ¥å£è¿”å›çš„æ•°æ®éƒ½æ˜¯ json æ ¼å¼ï¼Œ<br />
actix-web ä¸­å¦‚ä½•å®ç°è¿”å› jsonæ ¼å¼çš„æ•°æ®:</p>
<p>cargo.tomlæ·»åŠ ä¾èµ–</p>
<pre class="line-numbers"><code class="language-rust">serde = { version = &quot;1.0&quot;, features = [&quot;derive&quot;] }
serde_json = { version = &quot;1.0.2&quot;, optional = true }
</code></pre>
<p>main.rs</p>
<pre class="line-numbers"><code class="language-rust">use actix_web::{App, get, HttpResponse, HttpServer, post, Responder, web};
use actix_web::web::Json;
use serde::{ser, Serialize};

#[derive(Serialize)]
pub struct JsonSuccess&lt;T: ser::Serialize&gt; {
    pub code: u32,
    pub data: Option&lt;T&gt;,
    pub error: Option&lt;String&gt;,
}

#[derive(Serialize)]
pub struct JsonError {
    pub code: u32,
    pub data: Option&lt;String&gt;,
    pub error: Option&lt;String&gt;,
}

pub fn success&lt;T: ser::Serialize&gt;(r: Option&lt;T&gt;) -&gt; HttpResponse {
    HttpResponse::Ok().json(JsonSuccess {
        code: 0,
        data: r,
        error: None,
    })
}

pub fn error(err: Option&lt;String&gt;) -&gt; HttpResponse {
    HttpResponse::Ok().json(JsonError {
        code: 1,
        data: None,
        error: err,
    })
}


#[get(&quot;/&quot;)]
async fn hello() -&gt; HttpResponse {
    success(Option::from(&quot;Hello&quot;))
}


#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| {
        App::new()
            .service(hello)
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}

</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/2022-11-20-14.58.01.png" alt="2022-11-20-14.58.01" /></p>
<h3><a id="%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ¥æ”¶è¯·æ±‚å‚æ•°</h3>
<h4><a id="path" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Path</h4>
<pre class="line-numbers"><code class="language-rust">use actix_web::{App, get, HttpResponse, HttpServer, post, Responder, web,Result};
use actix_web::web::Json;
use serde::{ser, Serialize};

/// extract path info from &quot;/users/{user_id}/{friend}&quot; url
/// {user_id} - deserializes to a u32
/// {friend} - deserializes to a String
#[get(&quot;/users/{user_id}/{friend}&quot;)] // &lt;- define path parameters
async fn index(path: web::Path&lt;(u32, String)&gt;) -&gt; HttpResponse {
    let (user_id, friend) = path.into_inner();
    success(Some(format!(&quot;Welcome {}, user_id {}!&quot;, friend, user_id)))
}

#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| App::new().service(index))
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/17002319375457.jpg" alt="" /></p>
<p>web::Path&lt;(u32,String)&gt; æ¥æ”¶è¿™ä¸ª get(&quot;/users/{user_id}/{friend}&quot;) è¯·æ±‚çš„ä¸¤ä¸ªå‚æ•°</p>
<p>å°†è¿™ä¸¤ä¸ªå‚æ•°å®šä¹‰ä¸º struct ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<pre class="line-numbers"><code class="language-rust">#[derive(Deserialize)]
struct Info {
    user_id: u32,
    friend: String,
}

/// extract path info using serde
#[get(&quot;/users/{user_id}/{friend}&quot;)] // &lt;- define path parameters
async fn index(path: web::Path&lt;(u32, String)&gt;) -&gt; HttpResponse {
    let (user_id, friend) = path.into_inner();
    success(Some(format!(&quot;Welcome {}, user_id {}!&quot;, friend, user_id)))
}
</code></pre>
<h4><a id="get%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>get è¯·æ±‚ï¼Œæ¥æ”¶å‚æ•°</h4>
<pre class="line-numbers"><code class="language-rust">#[derive(Deserialize)]
struct Info {
    username: String,
    age:i32
}

#[get(&quot;/&quot;)]
async fn index(info: web::Query&lt;Info&gt;) -&gt; HttpResponse {
    success(Some(format!(&quot;Welcome {}!,age = {}&quot;, info.username,info.age)))
}
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/17002323120371.jpg" alt="" /></p>
<h4><a id="post%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%8E%A5%E6%94%B6-json" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>post è¯·æ±‚ï¼Œæ¥æ”¶ json</h4>
<pre class="line-numbers"><code class="language-rust">#[derive(Deserialize)]
struct Info {
    username: String,
    age:i32
}

#[post(&quot;/&quot;)]
async fn index(info: web::Json&lt;Info&gt;) -&gt; HttpResponse {
    success(Some(format!(&quot;Welcome {}!,age = {}&quot;, info.username,info.age)))
}
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/17002325332089.jpg" alt="" /></p>
<h3><a id="middleware" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>middleware</h3>
<p>middleware ç³»ç»Ÿå¯ä»¥è®©æˆ‘ä»¬é’ˆå¯¹è¯·æ±‚æˆ–è€…å“åº”æ·»åŠ è‡ªå®šä¹‰æ“ä½œã€‚</p>
<ol>
<li>Pre-process the Requestï¼šå¯ä»¥åœ¨è¯·æ±‚æ—¶åšå‰ç½®å¤„ç†</li>
<li>Post-process a Responseï¼šåœ¨å“åº”æ—¶åšåç½®å¤„ç†</li>
<li>Modify application stateï¼šä¿®æ”¹ state</li>
<li>Access external services (redis, logging, sessions)ï¼šè®¿é—®å¤–éƒ¨æœåŠ¡</li>
</ol>
<blockquote>
<p>å¦‚æœæœ‰å¤šä¸ªä¸­é—´ä»¶ï¼Œåæ·»åŠ çš„ä¼šå…ˆæ‰§è¡Œã€‚</p>
</blockquote>
<p>ç±»ä¼¼ Java ä¸­çš„ AOPï¼Œåªä¸è¿‡è¿™ä¸ªä¸­é—´ä»¶åªæ˜¯é’ˆå¯¹ Controller çš„ã€‚</p>
<p>è‡ªå®šä¹‰ middleware è¦å®ç° Serviceå’Œ Transform ä¸¤ä¸ª traitã€‚<br />
å…ˆç”¨ wrap_fn åšä¸€ä¸ªç®€å•çš„ middlewareï¼š</p>
<p>cargo.tomlæ·»åŠ ä¾èµ–</p>
<pre class="line-numbers"><code class="language-plain_text">futures-util = &quot;0.3&quot;
</code></pre>
<p>main.rs</p>
<pre class="line-numbers"><code class="language-rust">#[get(&quot;/{name}&quot;)]
async fn hello(path:web::Path&lt;String&gt;) -&gt; HttpResponse {
    let name = path.to_owned();
    success(Option::from(format!(&quot;Hello {}&quot;,name)))
}

#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| {
        App::new()
            .wrap_fn(|req, srv| {
                // Pre-process the Request
                println!(&quot;Hi from start. You requested: {}&quot;, req.path());
                srv.call(req).map(|res| {
                    // Post-process a Response
                    println!(&quot;Hi from response&quot;);
                    res
                })
            })
            .service(hello)
    })
    .bind((&quot;127.0.0.1&quot;, 8099))?
    .run()
    .await
}
</code></pre>
<p>è¯·æ±‚ <a href="http://localhost:8099/tom">http://localhost:8099/tom</a><br />
æ§åˆ¶å°ä¼šæ‰“å°å‡º<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/17002343077452.jpg" alt="" /></p>
<p>æ¥ä¸‹æ¥ï¼Œåšä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ä¸­é—´ä»¶--é‰´æƒä¸­é—´ä»¶ã€‚</p>
<pre class="line-numbers"><code class="language-rust">impl&lt;S, B&gt; Service&lt;ServiceRequest&gt; for AuthMiddleWare&lt;S&gt;
where
    S: Service&lt;ServiceRequest, Response = ServiceResponse&lt;B&gt;, Error = Error&gt;,
    S::Future: 'static,
    B: 'static,
{
    type Response = ServiceResponse&lt;B&gt;;
    type Error = Error;
    type Future = LocalBoxFuture&lt;'static, Result&lt;Self::Response, Self::Error&gt;&gt;;

    forward_ready!(service);

    fn call(&amp;self, req: ServiceRequest) -&gt; Self::Future {
        let value = HeaderValue::from_str(&quot;&quot;).unwrap();
        let token: &amp;HeaderValue = req.headers().get(&quot;token&quot;).unwrap_or(&amp;value);
        if token.len() &gt; 0 || req.path().to_string() == &quot;/login&quot; {
            let fut: &lt;S as Service&lt;ServiceRequest&gt;&gt;::Future = self.service.call(req);
            Box::pin(async move {
                let res = fut.await;
                res
            })
        } else {
            Box::pin(async move { Err(ErrorUnauthorized(&quot;PLEASE LOGIN&quot;)) })
        }
    }
}


#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| {
        App::new()
            .wrap(middleware::timed::Timed)
            .wrap(middleware::auth::Auth)
            .service(hello1)
            .service(hello2)
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p>è¿™é‡Œæ˜¯å†™äº†ä¸¤ä¸ª middlewareï¼Œä¸€ä¸ªæ‰“å°æ¥å£è€—æ—¶ï¼Œä¸€ä¸ªé‰´æƒï¼Œä»£ç ç¯‡å¹…è¾ƒå¤šï¼Œæ”¾åœ¨äº† <a href="https://github.com/hitolz/rust-web/tree/actix_web">github</a>ã€‚</p>
<p>æµè§ˆå™¨è®¿é—® hello1ï¼Œç”±äºæ²¡æœ‰ tokenï¼Œæ‰€ä»¥é‰´æƒä¸é€šè¿‡ï¼Œè€Œé€šè¿‡ postman è®¿é—® hello2ï¼Œheader ä¸ŠåŠ ä¸Š tokenï¼Œå°±å¯ä»¥è¯·æ±‚é€šè¿‡ã€‚<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/17003662230269.jpg" alt="" /></p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/17003658655736.jpg" alt="" /></p>
<h2><a id="%E5%B0%8F%E7%BB%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å°ç»“</h2>
<p>ç¬¬ä¸€éƒ¨åˆ†å…³äº web æ¡†æ¶å°±ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œä¸»è¦ä»‹ç»äº† actix-web çš„ä½¿ç”¨ï¼šå¦‚ä½•å†™ä¸€ä¸ªæ¥å£ã€å¦‚ä½•æ¥æ”¶å‚æ•°ã€å¦‚ä½•è¿”å› json ã€å¦‚ä½•é€šè¿‡ä¸­é—´ä»¶é‰´æƒã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[wasm åˆä½“éªŒ]]></title>
    <link href="http://blog.hitol.top/16892187258215.html"/>
    <updated>2023-07-13T11:25:25+08:00</updated>
    <id>http://blog.hitol.top/16892187258215.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#hello-world">Hello World</a>
<ul>
<li><a href="#1%E5%AE%89%E8%A3%85">1. å®‰è£…</a></li>
<li><a href="#2%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE">2. åˆå§‹åŒ–é¡¹ç›®</a></li>
<li><a href="#3%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE">3. æ„å»ºé¡¹ç›®</a></li>
<li><a href="#4%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2">4. ç”Ÿæˆé¡µé¢</a></li>
<li><a href="#5%E9%A1%B5%E9%9D%A2%E4%BD%BF%E7%94%A8%E6%88%91%E4%BB%AC%E7%9A%84%E4%BB%A3%E7%A0%81">5. é¡µé¢ä½¿ç”¨æˆ‘ä»¬çš„ä»£ç </a></li>
<li><a href="#6%E5%90%AF%E5%8A%A8">6. å¯åŠ¨</a></li>
</ul>
</li>
<li><a href="#rust-to-wasm">Rust to wasm</a>
<ul>
<li><a href="#1-install-rust">1. install Rust</a></li>
<li><a href="#2-cargo-install-wasm-pack">2. <code>cargo install wasm-pack</code></a></li>
<li><a href="#3-cargo-new-lib-hello-wasm">3. <code>cargo new --lib hello-wasm</code></a></li>
<li><a href="#4-lib-rs%E4%B8%AD%E7%BC%96%E5%86%99-wasm%E4%BB%A3%E7%A0%81">4. lib.rs ä¸­ç¼–å†™ wasm ä»£ç </a></li>
<li><a href="#5-build">5. build</a></li>
<li><a href="#6-using-the-package-on-the-web">6. Using the package on the web</a>
<ul>
<li><a href="#%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAhtml%E9%A1%B5%E9%9D%A2%EF%BC%8C%E4%BD%BF%E7%94%A8-hello-wasm-js">ç¼–å†™ä¸€ä¸ª html é¡µé¢ï¼Œä½¿ç”¨ hello_wasm.js</a></li>
<li><a href="#%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAserver%E6%9C%8D%E5%8A%A1">å¯åŠ¨ä¸€ä¸ª server æœåŠ¡</a></li>
</ul>
</li>
<li><a href="#7-making-our-package-available-to-npm">7. Making our package available to npm</a>
<ul>
<li><a href="#%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91">é‡æ–°ç¼–è¯‘</a></li>
<li><a href="#npm-link">npm link</a></li>
<li><a href="#using-the-npm-package-on-the-web">Using the npm package on the web</a>
<ul>
<li><a href="#package-json">package.json</a></li>
<li><a href="#webpack-config-js">webpack.config.js</a></li>
<li><a href="#index-js">index.js</a></li>
<li><a href="#index-html">index.html</a></li>
<li><a href="#site%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">site çš„ç›®å½•ç»“æ„</a></li>
<li><a href="#%E5%9C%A8site%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">åœ¨ site æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œå‘½ä»¤</a></li>
<li><a href="#%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98">å‡ºç°çš„é—®é¢˜</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%A1%A5%E5%85%85">è¡¥å……</a></li>
</ul>
</li>
</ul>
</div>
<p>WASM ä¸æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ğŸ™‚ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ç§å°†ç”¨ä¸€ç§ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å¯ç†è§£çš„æœºå™¨ä»£ç ï¼ˆJavaScriptï¼‰çš„æŠ€æœ¯ã€‚</p>
<p>WASM (WebAssembly çš„ç¼©å†™)è¢«è®¾è®¡ä¸ºå…¶ä»–è¯­è¨€çš„ç¼–è¯‘ç›®æ ‡ï¼Œå…è®¸æœåŠ¡å™¨ç«¯ä»£ç (å¦‚ C æˆ– C++ä»£ç )è¢«ç¼–è¯‘æˆ WASM å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œã€‚</p>
<p>ä¹Ÿè¢«ç§°ä½œ  web æ±‡ç¼–ã€‚</p>
<h2><a id="hello-world" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hello World</h2>
<h3><a id="1%E5%AE%89%E8%A3%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. å®‰è£…</h3>
<pre class="line-numbers"><code class="language-plain_text">cargo install cargo-generate

cargo install wasm-pack

npm install npm@latest -g

</code></pre>
<h3><a id="2%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. åˆå§‹åŒ–é¡¹ç›®</h3>
<pre class="line-numbers"><code class="language-plain_text">cargo generate --git https://github.com/rustwasm/wasm-pack-template
</code></pre>
<p>é¡¹ç›®å‘½åä¸º first-wasm</p>
<h3><a id="3%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. æ„å»ºé¡¹ç›®</h3>
<p>é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ</p>
<pre class="line-numbers"><code class="language-plain_text">wasm-pack build
</code></pre>
<p>æ„å»ºå®Œæˆåä¼šç”Ÿæˆ pkg ç›®å½•ã€‚</p>
<h3><a id="4%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. ç”Ÿæˆé¡µé¢</h3>
<p>node åˆå§‹åŒ–ä¸€ä¸ªå‰ç«¯é¡¹ç›®ï¼Œåœ¨æ ¹ç›®å½•æ‰§è¡Œã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">npm init wasm-app www
</code></pre>
<p>é¡¹ç›®ä¸­ä¼šå‡ºç°ä¸€ä¸ª www ç›®å½•ï¼Œ<br />
è¿›å…¥åˆ° www ä¸­ï¼Œå®‰è£… node ä¾èµ–</p>
<pre class="line-numbers"><code class="language-plain_text">npm install
</code></pre>
<h3><a id="5%E9%A1%B5%E9%9D%A2%E4%BD%BF%E7%94%A8%E6%88%91%E4%BB%AC%E7%9A%84%E4%BB%A3%E7%A0%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. é¡µé¢ä½¿ç”¨æˆ‘ä»¬çš„ä»£ç </h3>
<ol>
<li>åœ¨ pkg ç›®å½•ä¸‹æ‰§è¡Œ</li>
</ol>
<pre class="line-numbers"><code class="language-plain_text">npm link
</code></pre>
<p>pkg æ–‡ä»¶å¤¹ä¸­ä¼šå‡ºç° package.json æ–‡ä»¶</p>
<ol start="2">
<li>åœ¨ www ä¸­æ‰§è¡Œ</li>
</ol>
<pre class="line-numbers"><code class="language-plain_text">npm link first-wasm
</code></pre>
<ol start="3">
<li>ä¿®æ”¹ /www/index.js</li>
</ol>
<pre class="line-numbers"><code class="language-plain_text">import * as wasm from 'first-wasm';

</code></pre>
<h3><a id="6%E5%90%AF%E5%8A%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>6. å¯åŠ¨</h3>
<pre class="line-numbers"><code class="language-plain_text">npm run start
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16919824092381.jpg" alt="" /></p>
<p>å¦‚æœè¦ä¿®æ”¹ alert æ˜¾ç¤ºçš„å†…å®¹ï¼Œä¿®æ”¹ rust ä»£ç  lib.rs ä¸­çš„ greet æ–¹æ³•ã€‚</p>
<h1><a id="rust-to-wasm" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rust to wasm</h1>
<p>ä¸Šé¢çš„ä¾‹å­æ˜¯ä½¿ç”¨çš„ cargo generate  ç›´æ¥ç”Ÿæˆçš„æ¨¡æ¿ï¼Œ<br />
æŒ‰ç…§ <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Rust_to_wasm">https://developer.mozilla.org/en-US/docs/WebAssembly/Rust_to_wasm</a> é‡Œçš„æ­¥éª¤<br />
å¯ä»¥è‡ªå·±ä¸€æ­¥ä¸€æ­¥å®ç° rust ç¼–è¯‘ä¸º wasmã€‚</p>
<h2><a id="1-install-rust" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. install Rust</h2>
<h2><a id="2-cargo-install-wasm-pack" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. <code>cargo install wasm-pack</code></h2>
<h2><a id="3-cargo-new-lib-hello-wasm" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. <code>cargo new --lib hello-wasm</code></h2>
<h2><a id="4-lib-rs%E4%B8%AD%E7%BC%96%E5%86%99-wasm%E4%BB%A3%E7%A0%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. lib.rs ä¸­ç¼–å†™ wasm ä»£ç </h2>
<pre class="line-numbers"><code class="language-rust">use wasm_bindgen::prelude::*;

#[wasm_bindgen]
extern {
    pub fn alert(s: &amp;str);
}
    
#[wasm_bindgen]
pub fn greet(name: &amp;str) {
    alert(&amp;format!(&quot;Hello, {}!&quot;, name));
}
</code></pre>
<p>æ·»åŠ ä¾èµ–</p>
<pre class="line-numbers"><code class="language-plain_text">[lib]
crate-type = [&quot;cdylib&quot;, &quot;rlib&quot;]
    
[dependencies]
wasm-bindgen=&quot;0.2&quot;
</code></pre>
<h2><a id="5-build" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. build</h2>
<pre class="line-numbers"><code class="language-plain_text">wasm-pack build --target web
</code></pre>
<p>ç°åœ¨çš„ç›®å½•ç»“æ„</p>
<pre class="line-numbers"><code class="language-plain_text">â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ index.html
â”œâ”€â”€ pkg
â”‚   â”œâ”€â”€ hello_wasm.d.ts
â”‚   â”œâ”€â”€ hello_wasm.js
â”‚   â”œâ”€â”€ hello_wasm_bg.wasm
â”‚   â”œâ”€â”€ hello_wasm_bg.wasm.d.ts
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ src
â”‚   â””â”€â”€ lib.rs
â””â”€â”€ target
    â”œâ”€â”€ CACHEDIR.TAG
    â”œâ”€â”€ release
    â””â”€â”€ wasm32-unknown-unknown
</code></pre>
<h2><a id="6-using-the-package-on-the-web" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>6. Using the package on the web</h2>
<h3><a id="%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAhtml%E9%A1%B5%E9%9D%A2%EF%BC%8C%E4%BD%BF%E7%94%A8-hello-wasm-js" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç¼–å†™ä¸€ä¸ª html é¡µé¢ï¼Œä½¿ç”¨ hello_wasm.js</h3>
<pre class="line-numbers"><code class="language-html">&lt;!doctype html&gt;
&lt;html lang=&quot;en-US&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;title&gt;hello-wasm example&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script type=&quot;module&quot;&gt;
      import init, { greet } from &quot;./pkg/hello_wasm.js&quot;;
      init().then(() =&gt; {
        greet(&quot;WebAssembly&quot;);
      });
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3><a id="%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAserver%E6%9C%8D%E5%8A%A1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¯åŠ¨ä¸€ä¸ª server æœåŠ¡</h3>
<pre class="line-numbers"><code class="language-plain_text">python3 -m http.server
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16919806550698.jpg" alt="" /></p>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„ wasm å°±è¿è¡Œèµ·æ¥äº†ã€‚</p>
<h2><a id="7-making-our-package-available-to-npm" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>7. Making our package available to npm</h2>
<h3><a id="%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é‡æ–°ç¼–è¯‘</h3>
<p>å¦‚æœæƒ³è¦åœ¨ node ä¸­ä½¿ç”¨ wasmï¼Œé‡æ–°ç¼–è¯‘ä»£ç ï¼Œä½¿ç”¨ bundler æ¨¡å¼</p>
<pre class="line-numbers"><code class="language-plain_text">wasm-pack build --target bundler
</code></pre>
<h3><a id="npm-link" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>npm link</h3>
<blockquote>
<p>Next, let's use npm link to make this package available to other JavaScript packages installed</p>
</blockquote>
<pre class="line-numbers"><code class="language-plain_text">cd pkg
npm link
</code></pre>
<blockquote>
<p>We now have an npm package, written in Rust, but compiled to WebAssembly. It's ready for use from JavaScript, and doesn't require the user to have Rust installed; the code included was the WebAssembly code, not the Rust source.</p>
</blockquote>
<h3><a id="using-the-npm-package-on-the-web" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the npm package on the web</h3>
<p>æ ¹ç›®å½•ä¸­åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹ï¼Œsite</p>
<pre class="line-numbers"><code class="language-plain_text">mkdir site
cd site
npm link hello-wasm
</code></pre>
<p>site æ–‡ä»¶å¤¹ä¸­åˆ›å»º package.jsonã€webpack.config.jsã€index.jsã€index.html</p>
<h4><a id="package-json" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>package.json</h4>
<pre class="line-numbers"><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;serve&quot;: &quot;webpack-dev-server&quot;
  },
  &quot;dependencies&quot;: {
    &quot;hello-wasm&quot;: &quot;^0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;webpack&quot;: &quot;^4.25.1&quot;,
    &quot;webpack-cli&quot;: &quot;^3.1.2&quot;,
    &quot;webpack-dev-server&quot;: &quot;^3.1.10&quot;
  }
}
</code></pre>
<h4><a id="webpack-config-js" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>webpack.config.js</h4>
<pre class="line-numbers"><code class="language-js">const path = require(&quot;path&quot;);
module.exports = {
  entry: &quot;./index.js&quot;,
  output: {
    path: path.resolve(__dirname, &quot;dist&quot;),
    filename: &quot;index.js&quot;,
  },
  mode: &quot;development&quot;,
};
</code></pre>
<h4><a id="index-js" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>index.js</h4>
<pre class="line-numbers"><code class="language-js">import(&quot;./node_modules/hello-wasm/hello_wasm.js&quot;).then((js) =&gt; {
  js.greet(&quot;WebAssembly with npm&quot;);
});
</code></pre>
<h4><a id="index-html" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>index.html</h4>
<pre class="line-numbers"><code class="language-html">&lt;!doctype html&gt;
&lt;html lang=&quot;en-US&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;title&gt;hello-wasm example&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;script src=&quot;./index.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h4><a id="site%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>site çš„ç›®å½•ç»“æ„</h4>
<pre class="line-numbers"><code class="language-plain_text">â”œâ”€â”€ index.html
â”œâ”€â”€ index.js
â”œâ”€â”€ node_modules
â”‚   â””â”€â”€ hello-wasm -&gt; ../../pkg
â”œâ”€â”€ package.json
â””â”€â”€ webpack.config.js
</code></pre>
<h4><a id="%E5%9C%A8site%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>åœ¨ site æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œå‘½ä»¤</h4>
<pre class="line-numbers"><code class="language-plain_text">npm install
npm run serve
</code></pre>
<h4><a id="%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‡ºç°çš„é—®é¢˜</h4>
<pre class="line-numbers"><code class="language-plain_text">opensslErrorStack: [ 'error:03000086:digital envelope routines::initialization error' ],
library: 'digital envelope routines',
reason: 'unsupported',
code: 'ERR_OSSL_EVP_UNSUPPORTED'
</code></pre>
<p>å…ˆæ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼Œç„¶ååœ¨è¿è¡Œ</p>
<pre class="line-numbers"><code class="language-plain_text">export NODE_OPTIONS=--openssl-legacy-provider
</code></pre>
<p>ä»¥ä¸Šå°±æ˜¯ Rust ç¼–è¯‘ä¸º wasm çš„è¿‡ç¨‹ã€‚</p>
<hr />
<h2><a id="%E8%A1%A5%E5%85%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è¡¥å……</h2>
<pre class="line-numbers"><code class="language-plain_text">ç¼–è¯‘ä¸º web
wasm-pack build --target web

ç¼–è¯‘ä¸º bundler
wasm-pack build --target bundler
</code></pre>
<p>ç¼–è¯‘ä¸º webï¼Œå¯ä»¥åœ¨ html ä¸­ç›´æ¥å¼•ç”¨ã€‚<br />
ç¼–è¯‘ä¸º bundlerã€nodejsï¼Œå¯ä»¥åœ¨ nodejs ä¸­ä½¿ç”¨ã€‚</p>
<p><a href="https://rustwasm.github.io/docs/wasm-pack/commands/build.html">https://rustwasm.github.io/docs/wasm-pack/commands/build.html</a><br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/16904715130997.jpg" alt="" /></p>
<hr />
<p><a href="https://xie.infoq.cn/article/0bb5ff2fa5d5d9db492c88a4c">https://xie.infoq.cn/article/0bb5ff2fa5d5d9db492c88a4c</a></p>
<p><a href="https://llever.com/rustwasm-book/game-of-life/hello-world.zh.html">https://llever.com/rustwasm-book/game-of-life/hello-world.zh.html</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Rust_to_wasm">https://developer.mozilla.org/en-US/docs/WebAssembly/Rust_to_wasm</a></p>
<p><a href="https://rustwasm.github.io/docs/wasm-pack/introduction.html">https://rustwasm.github.io/docs/wasm-pack/introduction.html</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å‘é‡æ•°æ®åº“ Vector Database]]></title>
    <link href="http://blog.hitol.top/16849954851968.html"/>
    <updated>2023-05-25T14:18:05+08:00</updated>
    <id>http://blog.hitol.top/16849954851968.html</id>
    <content type="html"><![CDATA[
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<div class="mweb_toc"><ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93">ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®åº“</a></li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%90%91%E9%87%8F">ä»€ä¹ˆæ˜¯å‘é‡</a>
<ul>
<li><a href="#%E5%90%91%E9%87%8F%E7%9A%84%E5%AE%9E%E9%99%85%E5%90%AB%E4%B9%89">å‘é‡çš„å®é™…å«ä¹‰</a></li>
</ul>
</li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE">ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®</a>
<ul>
<li><a href="#%E5%90%91%E9%87%8F%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E5%9B%BE%E7%89%87%E7%9A%84%E7%89%B9%E5%BE%81">å‘é‡å¦‚ä½•è¡¨ç¤ºå›¾ç‰‡çš„ç‰¹å¾</a></li>
<li><a href="#%E5%90%91%E9%87%8F%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E9%9F%B3%E9%A2%91">å‘é‡å¦‚ä½•è¡¨ç¤ºéŸ³é¢‘</a></li>
<li><a href="#%E5%90%91%E9%87%8F%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E6%96%87%E6%9C%AC">å‘é‡å¦‚ä½•è¡¨ç¤ºæ–‡æœ¬</a></li>
</ul>
</li>
<li><a href="#%E4%B8%8E%E4%BC%A0%E7%BB%9F%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8C%BA%E5%88%AB">ä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„åŒºåˆ«</a></li>
<li><a href="#%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E5%90%8D%E8%AF%8D">å‘é‡æ•°æ®åº“ä¸­çš„åè¯</a></li>
<li><a href="#%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">å‘é‡æ•°æ®åº“çš„åº”ç”¨åœºæ™¯</a>
<ul>
<li><a href="#ai%E7%9A%84%E9%95%BF%E6%9C%9F%E8%AE%B0%E5%BF%86">AI çš„é•¿æœŸè®°å¿†</a></li>
</ul>
</li>
<li><a href="#%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%A7%E5%93%81">å‘é‡æ•°æ®åº“ äº§å“</a></li>
<li><a href="#%E5%B8%82%E5%9C%BA%E7%A9%BA%E9%97%B4%E5%B7%A8%E5%A4%A7%EF%BC%8C%E8%A1%8C%E4%B8%9A%E5%A4%84%E4%BA%8E%E4%BB%8E0-1%E9%98%B6%E6%AE%B5">å¸‚åœºç©ºé—´å·¨å¤§ï¼Œè¡Œä¸šå¤„äºä»0-1é˜¶æ®µ</a></li>
<li><a href="#milvus%E9%83%A8%E7%BD%B2%EF%BC%9A">milvus éƒ¨ç½²ï¼š</a></li>
<li><a href="#qdrant">Qdrant</a></li>
<li><a href="#%E9%9F%B3%E9%A2%91%E6%96%87%E4%BB%B6%E6%8F%90%E5%8F%96%E5%90%91%E9%87%8F%E7%89%B9%E5%BE%81">éŸ³é¢‘æ–‡ä»¶æå–å‘é‡ç‰¹å¾</a>
<ul>
<li><a href="#mfcc">MFCC</a></li>
<li><a href="#sftf">SFTF</a></li>
<li><a href="#cqt">CQT</a></li>
<li><a href="#python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">python ä»£ç å®ç°</a>
<ul>
<li><a href="#mfcc">mfcc</a></li>
<li><a href="#stft">stft</a></li>
<li><a href="#panns-inference">panns-inference</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chat-with-your-docs">Chat With Your Docs</a></li>
</ul>
</div>
<p>è¿‘æœŸï¼Œéšç€ AI ç›¸å…³è¯é¢˜çƒ­åº¦æå‡ï¼Œå‘é‡æ•°æ®åº“ä¹Ÿå‡ºç°åœ¨äº†æ›´å¤šäººçš„è§†é‡ä¸­ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ï¼Œè®©ä½ å¯¹å‘é‡æ•°æ®åº“æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚</p>
<h2><a id="%E4%BB%80%E4%B9%88%E6%98%AF%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®åº“</h2>
<p>å‘é‡æ•°æ®åº“æ˜¯ä¸“é—¨ç”¨æ¥å­˜å‚¨å’ŒæŸ¥è¯¢å‘é‡çš„æ•°æ®åº“ï¼Œå…¶å­˜å‚¨çš„å‘é‡æ¥è‡ªäºå¯¹æ–‡æœ¬ã€è¯­éŸ³ã€å›¾åƒã€è§†é¢‘ç­‰çš„å‘é‡åŒ–æ•°æ®ã€‚</p>
<p>å…¶ä¸»è¦ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†åŒ…å«å¤§é‡å‘é‡çš„æ•°æ®é›†ï¼Œå¹¶æ”¯æŒå¿«é€Ÿçš„ç›¸ä¼¼åº¦æœç´¢ã€‚<br />
ä¸ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸åŒï¼Œå‘é‡æ•°æ®åº“æ›´é€‚åˆå¤„ç†é«˜ç»´ç¨ å¯†å‘é‡æ•°æ®ï¼Œå¹¿æ³›åº”ç”¨äºå›¾åƒã€éŸ³é¢‘ã€æ–‡æœ¬ç­‰é¢†åŸŸçš„äººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ ä»»åŠ¡ä¸­ã€‚<br />
åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªå‘é‡éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¤šç»´ç©ºé—´ä¸­çš„ç‚¹ï¼Œè€Œç›¸ä¼¼åº¦æœç´¢åˆ™æ˜¯é€šè¿‡æµ‹é‡å‘é‡ä¹‹é—´çš„è·ç¦»æˆ–è§’åº¦æ¥å®ç°çš„ã€‚å‘é‡æ•°æ®åº“çš„å‘å±•å¾—ç›Šäºç¡¬ä»¶æŠ€æœ¯çš„ä¸æ–­æå‡å’Œæœºå™¨å­¦ä¹ é¢†åŸŸçš„è¿…é€Ÿå‘å±•ï¼Œå…·æœ‰è‰¯å¥½çš„åº”ç”¨å‰æ™¯ã€‚</p>
<h2><a id="%E4%BB%80%E4%B9%88%E6%98%AF%E5%90%91%E9%87%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä»€ä¹ˆæ˜¯å‘é‡</h2>
<p>åœ¨æ•°å­¦ä¸­ï¼Œå‘é‡ï¼ˆvectorï¼‰æ˜¯æŒ‡å…·æœ‰å¤§å°ï¼ˆmagnitudeï¼‰å’Œæ–¹å‘ï¼ˆdirectionï¼‰çš„é‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‘é‡å¯ä»¥åœ¨ä¸€ä¸ªæŒ‡å®šçš„åæ ‡ç³»ä¸­è¢«è¡¨ç¤ºä¸ºä¸€ç»„æœ‰åºæ•°ï¼ˆæœ‰é™ä¸ªå®æ•°ï¼‰ï¼Œè¿™äº›å®æ•°ç§°ä¸ºå‘é‡çš„åˆ†é‡ï¼ˆcomponentï¼‰ã€‚å¸¸ç”¨çš„è¡¨ç¤ºæ–¹å¼æ˜¯å°†å‘é‡å†™æˆä¸€ä¸ªåˆ—å‘é‡æˆ–è¡Œå‘é‡çš„å½¢å¼ï¼Œä¾‹å¦‚ï¼š</p>
<p>åˆ—å‘é‡ï¼š\(\mathbf{v} = \begin{bmatrix} v_1 \\ v_2 \\ \vdots \\ v_n \end{bmatrix}\)</p>
<p>è¡Œå‘é‡ï¼š\(\mathbf{v} = [v_1,v_2,\cdots,v_n]\)</p>
<p>å…¶ä¸­ï¼Œ\(v_1, v_2, \cdots, v_n\) æ˜¯å‘é‡çš„\(n\)ä¸ªåˆ†é‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„å‘é‡ï¼Œå¦‚é›¶å‘é‡ã€å•ä½å‘é‡ç­‰ã€‚</p>
<p>åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸï¼Œå‘é‡å¸¸å¸¸è¢«ç”¨æ¥è¡¨ç¤ºå¯¹è±¡çš„ç‰¹å¾ï¼Œä¾‹å¦‚å›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘ç­‰ã€‚å°†å¯¹è±¡è½¬æ¢æˆå‘é‡å½¢å¼ä¾¿äºè¿›è¡Œç›¸ä¼¼åº¦æœç´¢ã€èšç±»ç­‰æ“ä½œã€‚å‘é‡åŒ–çš„æ–¹å¼å¯ä»¥é€šè¿‡ç‰¹å¾æå–ã€æ–‡æœ¬å»ºæ¨¡ã€æ·±åº¦å­¦ä¹ ç­‰æ–¹æ³•æ¥å®ç°ã€‚</p>
<p>å¤„ç†å‘é‡æ•°æ®æˆä¸ºäº†è®¸å¤šåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œäººä»¬è®¾è®¡äº†å„ç§å‘é‡æ•°æ®åº“å’Œå‘é‡ç´¢å¼•æŠ€æœ¯ï¼Œä»¥æä¾›é«˜æ•ˆçš„ç›¸ä¼¼åº¦æœç´¢å’Œè¿‘é‚»æŸ¥è¯¢åŠŸèƒ½ã€‚</p>
<h3><a id="%E5%90%91%E9%87%8F%E7%9A%84%E5%AE%9E%E9%99%85%E5%90%AB%E4%B9%89" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‘é‡çš„å®é™…å«ä¹‰</h3>
<p>å‘é‡A [0.8,0.3]ï¼Œè¡¨ç¤ºæœ‰ä¸€ä¸ªäººï¼Œè¿™ä¸ªäººå–œæ¬¢ 0.8 å¼ºåº¦çš„å–œå‰§ç‰‡ï¼Œå–œæ¬¢ 0.3 å¼ºåº¦çš„åŠ¨ä½œ</p>
<p>å‘é‡B [0.4,0.6]ï¼Œè¡¨ç¤ºä¸€éƒ¨ç”µå½±ï¼Œè¿™éƒ¨ç”µå½±æ˜¯ 0.4 å¼ºåº¦çš„å–œå‰§ï¼Œ0.6 å¼ºåº¦çš„åŠ¨ä½œç‰‡</p>
<p>è¿™ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—è¿‡ç¨‹ï¼š<br />
å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦å¯ä»¥è¡¨ç¤ºä¸ºï¼š\(cos\theta = \frac{\mathbf{a} \cdot \mathbf{b}}{\|\mathbf{a}\|\|\mathbf{b}\|}\)</p>
<p>å…¶ä¸­ï¼Œa å’Œ b åˆ†åˆ«è¡¨ç¤ºè¦è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦çš„ä¸¤ä¸ªå‘é‡ï¼Œ \(\mathbf{a} \cdot \mathbf{b}\) è¡¨ç¤ºå®ƒä»¬çš„ç‚¹ç§¯ï¼Œ$|\mathbf{a}|$ å’Œ $|\mathbf{b}|$ åˆ†åˆ«è¡¨ç¤ºå®ƒä»¬çš„æ¨¡é•¿ã€‚</p>
<p>å°† a = [0.8, 0.3], b = [0.4, 0.6] ä»£å…¥å…¬å¼è®¡ç®—ï¼Œæœ‰ï¼š\(\mathbf{a} \cdot \mathbf{b} = 0.8 \times 0.4 + 0.3 \times 0.6 = 0.32 + 0.18 = 0.5\)</p>
<p>\(\begin{aligned} \|\mathbf{a}\| &amp;= \sqrt{0.8^2 + 0.3^2} \approx 0.854 \\ \|\mathbf{b}\| &amp;= \sqrt{0.4^2 + 0.6^2} \approx 0.721 \end{aligned}\)</p>
<p>å°†ä¸Šè¿°è®¡ç®—ç»“æœä»£å…¥ä½™å¼¦ç›¸ä¼¼åº¦å…¬å¼ä¸­ï¼Œå¯å¾—è¿™ä¸¤ä¸ªå‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦ä¸ºï¼š\(cos\theta \approx \frac{0.5}{0.854 \times 0.721} \approx 0.852\)</p>
<p>ç®—å‡ºæ¥çš„è¿™ä¸ªå€¼å¯ä»¥è¡¨ç¤ºä¸º è¿™ä¸ªäººå–œæ¬¢è¿™éƒ¨ç”µå½±çš„ç¨‹åº¦</p>
<p>ä½™å¼¦ç›¸ä¼¼åº¦çš„å–å€¼èŒƒå›´ä¸º[-1, 1]ï¼Œå€¼è¶Šå¤§ï¼Œä»£è¡¨ç›¸ä¼¼åº¦è¶Šé«˜ã€‚</p>
<p>é™¤äº†ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œè¿˜æœ‰ä¸€äº›å¯ç”¨äºè¯„ä¼°å‘é‡ç›¸ä¼¼åº¦çš„åº¦é‡æ–¹æ³•ï¼š</p>
<ol>
<li>
<p>æ¬§æ°è·ç¦»ï¼ˆEuclidean distanceï¼‰ï¼šå®ƒè¡¡é‡ä¸¤ä¸ªç‚¹ä¹‹é—´çš„ç›´çº¿è·ç¦»ï¼Œä¹Ÿè¢«ç§°ä¸º L2 èŒƒæ•°ã€‚å®ƒåœ¨è®¡ç®—ä¸Šéå¸¸ç®€å•ï¼Œä½†æœ‰æ—¶æœ‰å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
</li>
<li>
<p>æ›¼å“ˆé¡¿è·ç¦»ï¼ˆManhattan distanceï¼‰ï¼šå®ƒè¡¡é‡ä¸¤ä¸ªç‚¹ä¹‹é—´çš„åŸå¸‚è¡—åŒºè·ç¦»ï¼Œä¹Ÿè¢«ç§°ä¸º L1 èŒƒæ•°ã€‚å®ƒç±»ä¼¼äºæ¬§æ°è·ç¦»ï¼Œä½†å®ƒæ›´é€‚åˆäºæŸäº›ç‰¹å®šçš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚åœ¨è®¡ç®—è·¨è¶ŠåŸå¸‚è¡—åŒºçš„é©¾é©¶è·¯çº¿æ—¶ã€‚</p>
</li>
<li>
<p>é—µå¯å¤«æ–¯åŸºè·ç¦»ï¼ˆMinkowski distanceï¼‰ï¼šå®ƒæ˜¯æ¬§æ°è·ç¦»å’Œæ›¼å“ˆé¡¿è·ç¦»çš„æ³›åŒ–å½¢å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå‚æ•°è¢«å¼•å…¥ï¼Œè¯¥å‚æ•°æ§åˆ¶æ¬§æ°è·ç¦»å’Œæ›¼å“ˆé¡¿è·ç¦»ä¹‹é—´å–å€¼çš„å€¾å‘æ€§ã€‚</p>
</li>
<li>
<p>çŸ¢é‡ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆVector cosine similarityï¼‰ï¼šè¿™ç§åº¦é‡æ–¹å¼ä¸ä½™å¼¦ç›¸ä¼¼åº¦éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯è¿™é‡Œè¦æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå‘é‡çš„å•ä½åŒ–ç‰ˆæœ¬ã€‚</p>
</li>
</ol>
<p>åœ¨å®è·µä¸­ï¼Œé€šå¸¸ä½¿ç”¨å‘é‡ä½™å¼¦ç›¸ä¼¼åº¦æ¥è¡¡é‡å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œä»¥å‡å°‘å‘é‡å¤§å°å¯¹ç›¸ä¼¼åº¦çš„å½±å“ã€‚</p>
<h2><a id="%E4%BB%80%E4%B9%88%E6%98%AF%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®</h2>
<p>å‘é‡æ•°æ®æ˜¯ç”±å¤šä¸ªæ•°å€¼ç»„æˆçš„ä¸€ç»´æ•°ç»„ï¼Œå¸¸ç”¨äºè¡¨ç¤ºæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰éç»“æ„åŒ–æ•°æ®ã€‚åœ¨å‘é‡ä¸­ï¼Œæ¯ä¸ªæ•°å€¼ä»£è¡¨äº†è¯¥å‘é‡åœ¨æŸä¸ªæ–¹å‘ä¸Šçš„åˆ†é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨äºŒç»´å¹³é¢ä¸Šï¼Œä¸€ä¸ªç‚¹çš„ä½ç½®å¯ä»¥ç”¨ä¸€ä¸ªäºŒç»´å‘é‡è¡¨ç¤ºï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ•°å€¼ä»£è¡¨äº†è¯¥ç‚¹åœ¨xè½´ä¸Šçš„ä½ç½®ï¼Œç¬¬äºŒä¸ªæ•°å€¼ä»£è¡¨äº†è¯¥ç‚¹åœ¨yè½´ä¸Šçš„ä½ç½®ã€‚</p>
<p>åœ¨ç°ä»£æ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ ä¸­ï¼Œå‘é‡æ•°æ®è¢«å¹¿æ³›åº”ç”¨äºå„ç§ä»»åŠ¡ï¼Œå¦‚ç›¸ä¼¼åº¦åŒ¹é…ã€èšç±»ã€åˆ†ç±»å’Œå›å½’ã€‚è¿™äº›ä»»åŠ¡é€šå¸¸éœ€è¦è®¡ç®—å‘é‡ä¹‹é—´çš„è·ç¦»æˆ–ç›¸ä¼¼åº¦ï¼Œå¹¶ä¸”éœ€è¦å¯¹å‘é‡è¿›è¡Œæ£€ç´¢å’Œæ’åºã€‚å› æ­¤ï¼Œé«˜æ•ˆå¤„ç†å‘é‡æ•°æ®æ˜¯è®¸å¤šæ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œäººä»¬å¼€å‘äº†è®¸å¤šå‘é‡æ•°æ®åº“å’Œå‘é‡ç´¢å¼•æŠ€æœ¯ï¼Œä»¥æä¾›é«˜æ•ˆçš„ç›¸ä¼¼åº¦æœç´¢å’Œè¿‘é‚»æŸ¥è¯¢åŠŸèƒ½ã€‚</p>
<h3><a id="%E5%90%91%E9%87%8F%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E5%9B%BE%E7%89%87%E7%9A%84%E7%89%B9%E5%BE%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‘é‡å¦‚ä½•è¡¨ç¤ºå›¾ç‰‡çš„ç‰¹å¾</h3>
<p>åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­ï¼Œå‘é‡é€šå¸¸è¢«ç”¨æ¥è¡¨ç¤ºå›¾ç‰‡çš„ç‰¹å¾ã€‚è¿™äº›ç‰¹å¾å‘é‡å¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•è·å¾—ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Networkï¼Œç®€ç§°CNNï¼‰ã€‚CNN æ˜¯ä¸€ç±»æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå®ƒé€šè¿‡å·ç§¯ã€æ± åŒ–ç­‰æ“ä½œå¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆè¾“å‡ºä¸€ä¸ªå›ºå®šå¤§å°çš„å‘é‡ä½œä¸ºè¯¥å›¾ç‰‡çš„ç‰¹å¾è¡¨ç¤ºã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼ŒCNN é€šè¿‡ä¸€ç³»åˆ—çš„å·ç§¯å±‚å’Œæ± åŒ–å±‚å¯¹è¾“å…¥å›¾ç‰‡è¿›è¡Œç‰¹å¾æå–ï¼Œå¹¶é€æ¸å‡å°ç‰¹å¾å›¾çš„å°ºå¯¸å’Œæ•°é‡ã€‚åœ¨æœ€åä¸€å±‚å·ç§¯å±‚ä¹‹åï¼Œé€šå¸¸ä¼šæ·»åŠ è‹¥å¹²å…¨è¿æ¥å±‚ï¼Œå°†å·ç§¯å±‚è¾“å‡ºçš„é«˜ç»´ç‰¹å¾è½¬æ¢ä¸ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ã€‚è¿™ä¸ªå‘é‡è¢«è®¤ä¸ºæ˜¯è¯¥å›¾ç‰‡çš„â€œç‰¹å¾è¡¨ç¤ºâ€ï¼Œå®ƒèƒ½å¤Ÿåæ˜ å‡ºå›¾ç‰‡çš„è¯­ä¹‰ä¿¡æ¯ï¼Œä¾‹å¦‚ç‰©ä½“ç±»åˆ«ã€é¢œè‰²ã€çº¹ç†ç­‰ç‰¹å¾ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‘é‡è·ç¦»çš„æ¦‚å¿µæ¥åº¦é‡ä¸åŒå›¾ç‰‡ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œä»è€Œæ”¯æŒåŸºäºå†…å®¹çš„å›¾ç‰‡æ£€ç´¢ã€èšç±»ç­‰åº”ç”¨ã€‚</p>
<h3><a id="%E5%90%91%E9%87%8F%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E9%9F%B3%E9%A2%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‘é‡å¦‚ä½•è¡¨ç¤ºéŸ³é¢‘</h3>
<p>åœ¨éŸ³é¢‘å¤„ç†ä¸­ï¼Œå‘é‡ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºéŸ³é¢‘çš„ç‰¹å¾ã€‚å…¶ä¸­æœ€å¸¸è§çš„æ˜¯ä½¿ç”¨ æ¢…å°”é¢‘ç‡å€’è°±ç³»æ•°ï¼ˆMel-Frequency Cepstral Coefficientsï¼Œç®€ç§°MFCCï¼‰æ¥æå–éŸ³é¢‘çš„ç‰¹å¾å‘é‡ã€‚</p>
<p>MFCC æ˜¯ä¸€ç§åŸºäºäººè€³æ„ŸçŸ¥ç‰¹æ€§çš„å£°å­¦ç‰¹å¾ï¼Œå®ƒæ¨¡æ‹Ÿäº†äººè€³å¯¹ä¸åŒé¢‘ç‡å£°éŸ³çš„æ„Ÿå—ï¼Œå…·æœ‰å¾ˆå¥½çš„åŒºåˆ†èƒ½åŠ›ã€‚MFCC æå–è¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>
<p>é¢„åŠ é‡ï¼šå¯¹åŸå§‹éŸ³é¢‘ä¿¡å·è¿›è¡Œé«˜é€šæ»¤æ³¢ï¼Œå¢å¼ºé«˜é¢‘éƒ¨åˆ†çš„èƒ½é‡ã€‚</p>
</li>
<li>
<p>åˆ†å¸§ï¼šå°†éŸ³é¢‘ä¿¡å·åˆ†å‰²æˆè‹¥å¹²ä¸ªé•¿åº¦ç›¸ç­‰çš„å¸§ã€‚</p>
</li>
<li>
<p>åŠ çª—ï¼šå¯¹æ¯ä¸€å¸§åº”ç”¨æ±‰æ˜çª—ç­‰çª—å‡½æ•°ï¼Œå‡å°‘é¢‘è°±æ³„æ¼ã€‚</p>
</li>
<li>
<p>å‚…é‡Œå¶å˜æ¢ï¼šå¯¹æ¯ä¸€å¸§çš„ä¿¡å·è¿›è¡Œç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼ˆDFTï¼‰ï¼Œå¾—åˆ°å…¶é¢‘åŸŸè¡¨è¾¾ã€‚</p>
</li>
<li>
<p>æ¢…å°”æ»¤æ³¢å™¨ç»„ï¼šå°†é¢‘åŸŸä¿¡å·é€šè¿‡ä¸€ç»„æ¢…å°”æ»¤æ³¢å™¨ï¼Œå°†å…¶è½¬æ¢ä¸ºæ¢…å°”é¢‘ç‡åŸŸçš„ä¿¡å·ã€‚</p>
</li>
<li>
<p>å¯¹æ•°å‹ç¼©ï¼šå¯¹æ¯ä¸ªæ»¤æ³¢å™¨ç»„è¾“å‡ºå€¼å–å¯¹æ•°ï¼Œä»¥ä¾¿æ›´å¥½åœ°è¡¨ç¤ºäººè€³å¯¹éŸ³é‡çš„æ„ŸçŸ¥ã€‚</p>
</li>
<li>
<p>ç¦»æ•£ä½™å¼¦å˜æ¢ï¼šå¯¹æ¯ä¸ªæ»¤æ³¢å™¨ç»„è¾“å‡ºå€¼è¿›è¡Œç¦»æ•£ä½™å¼¦å˜æ¢ï¼ˆDCTï¼‰ï¼Œå¾—åˆ°å…¶MFCCç³»æ•°ã€‚</p>
</li>
</ol>
<p>æœ€ç»ˆï¼ŒMFCC ç³»æ•°è¢«ç»„åˆæˆä¸€ä¸ªå‘é‡ä½œä¸ºéŸ³é¢‘çš„ç‰¹å¾è¡¨ç¤ºã€‚è¿™ä¸ªå‘é‡é€šå¸¸åŒ…å«20-40ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªMFCCç³»æ•°ï¼Œåæ˜ äº†éŸ³é¢‘ä¸­ä¸åŒé¢‘ç‡çš„èƒ½é‡åˆ†å¸ƒæƒ…å†µã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‘é‡è·ç¦»çš„æ¦‚å¿µæ¥åº¦é‡ä¸åŒéŸ³é¢‘ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œä»è€Œæ”¯æŒåŸºäºå†…å®¹çš„éŸ³é¢‘æ£€ç´¢ã€åˆ†ç±»ç­‰åº”ç”¨ã€‚</p>
<h3><a id="%E5%90%91%E9%87%8F%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E6%96%87%E6%9C%AC" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‘é‡å¦‚ä½•è¡¨ç¤ºæ–‡æœ¬</h3>
<p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­ï¼Œå‘é‡ä¹Ÿå¸¸è¢«ç”¨æ¥è¡¨ç¤ºæ–‡æœ¬çš„ç‰¹å¾ã€‚ä¸€ä¸ªå¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨è¯è¢‹æ¨¡å‹ï¼ˆBag-of-Words Modelï¼‰ä»¥åŠè¯å‘é‡ï¼ˆWord Embeddingï¼‰ã€‚</p>
<p>è¯è¢‹æ¨¡å‹æ˜¯ä¸€ç§åŸºäºé¢‘æ¬¡çš„æ–‡æœ¬è¡¨ç¤ºæ–¹æ³•ï¼Œå®ƒå°†æ–‡æœ¬è¡¨ç¤ºä¸ºä¸€ä¸ªç”±æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°æ‰€ç»„æˆçš„å‘é‡ã€‚å…·ä½“è€Œè¨€ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å« \(N\) ä¸ªæ–‡æ¡£çš„æ–‡æœ¬é›†åˆï¼Œå…¶ä¸­æ¯ä¸ªæ–‡æ¡£ç”±è‹¥å¹²ä¸ªå•è¯ç»„æˆã€‚é‚£ä¹ˆè¯è¢‹æ¨¡å‹å°†è¯¥æ–‡æœ¬é›†åˆè¡¨ç¤ºä¸º \(N\) ä¸ª \(M\) ç»´å‘é‡çš„çŸ©é˜µï¼Œå…¶ä¸­ç¬¬ \(i\) ä¸ªå‘é‡è¡¨ç¤ºç¬¬ \(i\) ä¸ªæ–‡æ¡£ä¸­æ¯ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‘é‡è·ç¦»çš„æ¦‚å¿µæ¥åº¦é‡ä¸åŒæ–‡æ¡£ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œä»è€Œæ”¯æŒåŸºäºå†…å®¹çš„æ–‡æœ¬åˆ†ç±»ã€èšç±»ç­‰åº”ç”¨ã€‚</p>
<p>è¯å‘é‡æ˜¯ä¸€ç§æ›´åŠ é«˜çº§çš„æ–‡æœ¬è¡¨ç¤ºæ–¹æ³•ï¼Œå®ƒå°†æ¯ä¸ªå•è¯æ˜ å°„åˆ°ä¸€ä¸ªè¿ç»­çš„å‘é‡ç©ºé—´ä¸­ï¼Œå¹¶ä¸”ä½¿å¾—è¯­ä¹‰ä¸Šç›¸ä¼¼çš„å•è¯åœ¨å‘é‡ç©ºé—´ä¸­å½¼æ­¤æ¥è¿‘ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„è¯å‘é‡æ¨¡å‹æ˜¯ Word2Vecï¼Œå®ƒé€šè¿‡è®­ç»ƒç¥ç»ç½‘ç»œæ¥å­¦ä¹ å•è¯çš„å‘é‡è¡¨ç¤ºã€‚ä¸è¯è¢‹æ¨¡å‹ä¸åŒï¼Œè¯å‘é‡ä¸ä»…è€ƒè™‘äº†å•è¯å‡ºç°çš„é¢‘ç‡ï¼Œè¿˜å­¦ä¹ äº†å•è¯ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ï¼Œå› æ­¤èƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰æ–‡æœ¬çš„è¯­ä¹‰ä¿¡æ¯ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦çš„æ¦‚å¿µæ¥è¿›è¡Œæ–‡æœ¬åŒ¹é…ã€æƒ…æ„Ÿåˆ†æç­‰<br />
ä»»åŠ¡ã€‚</p>
<h2><a id="%E4%B8%8E%E4%BC%A0%E7%BB%9F%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8C%BA%E5%88%AB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„åŒºåˆ«</h2>
<p>ä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ç›¸æ¯”ï¼Œå‘é‡æ•°æ®åº“å…·æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«ï¼š</p>
<ol>
<li>
<p>æ•°æ®æ¨¡å‹ä¸åŒï¼šä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“é‡‡ç”¨è¡¨æ ¼æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œè€Œå‘é‡æ•°æ®åº“åˆ™é‡‡ç”¨å‘é‡æ–¹å¼å­˜å‚¨æ•°æ®ã€‚å‘é‡æ•°æ®åº“ä¸­æ¯ä¸ªè®°å½•éƒ½æ˜¯ä¸€ä¸ªå‘é‡ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿæ•°æ®åº“ä¸­çš„è¡Œã€‚</p>
</li>
<li>
<p>æŸ¥è¯¢æ–¹å¼ä¸åŒï¼šä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“é€šå¸¸ä½¿ç”¨SQLè¯­è¨€è¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œå‘é‡æ•°æ®åº“åˆ™æ”¯æŒåŸºäºå‘é‡ç›¸ä¼¼åº¦çš„æŸ¥è¯¢ã€‚è¿™ç§æŸ¥è¯¢æ–¹å¼èƒ½å¤Ÿå¿«é€Ÿåœ°æ‰¾åˆ°ç›¸ä¼¼çš„å‘é‡æ•°æ®ï¼Œé€‚ç”¨äºäººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ é¢†åŸŸçš„ä¸€äº›ä»»åŠ¡ï¼Œå¦‚æ¨èç³»ç»Ÿã€å›¾åƒæœç´¢å’Œè‡ªç„¶è¯­è¨€å¤„ç†ç­‰ã€‚</p>
</li>
<li>
<p>å­˜å‚¨å’Œç´¢å¼•æŠ€æœ¯ä¸åŒï¼šå‘é‡æ•°æ®åº“é‡‡ç”¨å‘é‡åŒ–å­˜å‚¨å’Œç´¢å¼•æŠ€æœ¯ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†åŒ…å«å¤§é‡å‘é‡çš„æ•°æ®é›†ï¼Œè€Œä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“åˆ™é‡‡ç”¨Bæ ‘ç­‰ç´¢å¼•ç»“æ„ã€‚åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªå‘é‡éƒ½å¯ä»¥çœ‹ä½œæ˜¯å¤šç»´ç©ºé—´ä¸­çš„ç‚¹ï¼Œè€Œç´¢å¼•åˆ™æ˜¯é€šè¿‡æµ‹é‡å‘é‡ä¹‹é—´çš„è·ç¦»æˆ–è§’åº¦æ¥å®ç°çš„ã€‚</p>
</li>
<li>
<p>åº”ç”¨åœºæ™¯ä¸åŒï¼šä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“é€‚ç”¨äºä¸šåŠ¡ç®¡ç†å’Œæ•°æ®åˆ†æç­‰åœºæ™¯ï¼Œè€Œå‘é‡æ•°æ®åº“åˆ™æ›´é€‚åˆå¤„ç†é«˜ç»´ç¨ å¯†å‘é‡æ•°æ®ï¼Œå¹¶å¹¿æ³›åº”ç”¨äºå›¾åƒã€éŸ³é¢‘ã€æ–‡æœ¬ç­‰é¢†åŸŸçš„äººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ ä»»åŠ¡ä¸­ã€‚</p>
</li>
</ol>
<p>å‘é‡æ•°æ®åº“ä¹Ÿæ”¯æŒ CRUDã€‚å¯¹å‘é‡æ›´å¿«çš„ç›¸ä¼¼æ€§æœç´¢ã€‚</p>
<h2><a id="%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E5%90%8D%E8%AF%8D" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‘é‡æ•°æ®åº“ä¸­çš„åè¯</h2>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16885411749228.jpg" alt="" /></p>
<h2><a id="%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‘é‡æ•°æ®åº“çš„åº”ç”¨åœºæ™¯</h2>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16885411749244.jpg" alt="" /></p>
<p>å‘é‡æ•°æ®åº“åœ¨äººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ é¢†åŸŸä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>
<p>äººè„¸è¯†åˆ«ï¼šå‘é‡æ•°æ®åº“å¯ä»¥å­˜å‚¨å¤§é‡äººè„¸ç‰¹å¾å‘é‡ï¼Œå¹¶èƒ½å¤Ÿå¿«é€Ÿåœ°æ£€ç´¢ç›¸ä¼¼çš„äººè„¸ï¼Œä»è€Œå®ç°é«˜æ•ˆå‡†ç¡®çš„äººè„¸è¯†åˆ«ã€‚</p>
</li>
<li>
<p>å›¾åƒæœç´¢ï¼šå‘é‡æ•°æ®åº“å¯ä»¥å°†å›¾åƒè½¬åŒ–ä¸ºé«˜ç»´ç‰¹å¾å‘é‡ï¼Œå¹¶æ ¹æ®ç›¸ä¼¼åº¦è¿›è¡Œæ£€ç´¢ã€‚è¿™ç§æŠ€æœ¯è¢«å¹¿æ³›åº”ç”¨äºå›¾åƒæœç´¢å¼•æ“ã€å•†å“æ¨èç­‰é¢†åŸŸã€‚</p>
</li>
<li>
<p>æ¨èç³»ç»Ÿï¼šå‘é‡æ•°æ®åº“å¯ä»¥é€šè¿‡å­˜å‚¨ç”¨æˆ·å†å²è¡Œä¸ºæ•°æ®ï¼Œå¹¶åˆ©ç”¨ç›¸ä¼¼åº¦è®¡ç®—æ¥äº§ç”Ÿä¸ªæ€§åŒ–æ¨èç»“æœã€‚è¿™ç§æŠ€æœ¯è¢«å¹¿æ³›åº”ç”¨äºç”µå•†ã€ç¤¾äº¤ç½‘ç»œç­‰é¢†åŸŸã€‚</p>
</li>
<li>
<p>è‡ªç„¶è¯­è¨€å¤„ç†ï¼šå‘é‡æ•°æ®åº“å¯ä»¥å­˜å‚¨å•è¯æˆ–æ–‡æœ¬ç‰‡æ®µçš„å‘é‡è¡¨ç¤ºï¼Œå¹¶é€šè¿‡ç›¸ä¼¼åº¦è®¡ç®—æ¥è¿›è¡Œæ–‡æœ¬åˆ†ç±»ã€æƒ…æ„Ÿåˆ†æç­‰ä»»åŠ¡ã€‚</p>
</li>
<li>
<p>è§†é¢‘ç›‘æ§ï¼šå‘é‡æ•°æ®åº“å¯ä»¥å­˜å‚¨è§†é¢‘ç‰¹å¾å‘é‡ï¼Œä»¥å®ç°æ›´åŠ é«˜æ•ˆå‡†ç¡®çš„è§†é¢‘æ£€ç´¢å’Œç›®æ ‡è·Ÿè¸ªã€‚</p>
</li>
<li>
<p>AI é•¿æœŸè®°å¿†ï¼šChatGPTç­‰ AI äº§å“çš„åº•å±‚æ•°æ®åº“å¤§æ¦‚ç‡å°±æ˜¯å‘é‡æ•°æ®åº“ã€‚</p>
</li>
</ol>
<!--å½“æˆ‘ä»¬åœ¨ä½¿ç”¨ ChatGPT è¾“å…¥ä¸€ä¸ªæŸ¥è¯¢æ—¶ï¼ŒChatGPT ä¼šå°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå‘é‡è¡¨ç¤ºï¼Œå¹¶ä½¿ç”¨é¢„è®­ç»ƒå’Œå¾®è°ƒå¥½çš„æ¨¡å‹å¯¹å…¶è¿›è¡Œå¤„ç†å¹¶ç”Ÿæˆå“åº”ã€‚-->
<h3><a id="ai%E7%9A%84%E9%95%BF%E6%9C%9F%E8%AE%B0%E5%BF%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>AI çš„é•¿æœŸè®°å¿†</h3>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œç›®å‰çš„å¤§æ¨¡å‹ï¼ˆæ— è®ºæ˜¯ NLP é¢†åŸŸçš„ GPT ç³»åˆ—è¿˜æ˜¯ CV é¢†åŸŸçš„ ResNET ç³»åˆ—ï¼‰éƒ½æ˜¯é¢„å…ˆè®­ç»ƒ Pretrain çš„å¤§æ¨¡å‹ï¼Œæœ‰ç€éå¸¸æ˜æ™°çš„è®­ç»ƒæˆªæ­¢æ—¥ Cut-off Dateï¼Œè¿™å¯¼è‡´è¿™äº›æ¨¡å‹å¯¹äºè®­ç»ƒæˆªæ­¢æ—¥ä¹‹åå‘ç”Ÿçš„äº‹æƒ…ä¸€æ— æ‰€çŸ¥ã€‚</p>
<p>è€Œéšç€å‘é‡æ•°æ®åº“çš„å¼•å…¥ï¼Œå…¶å†…éƒ¨å­˜å‚¨çš„æœ€æ–°çš„ä¿¡æ¯å‘é‡èƒ½å¤Ÿæå¤§åœ°æ‹“å±•å¤§æ¨¡å‹çš„åº”ç”¨è¾¹ç•Œï¼Œå‘é‡æ•°æ®åº“å¯ä»¥ä½¿å¾—å¤§æ¨¡å‹ä¿æŒå‡†å®æ—¶æ€§ï¼Œæé«˜å¤§æ¨¡å‹çš„é€‚ç”¨æ€§ï¼Œå¹¶ä½¿å¾—å¤§æ¨¡å‹èƒ½å¤ŸåŠ¨æ€è°ƒæ•´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘é‡æ•°æ®åº“ä½¿å¾—å¤§æ¨¡å‹çš„é•¿æœŸè®°å¿†å¾—åˆ°äº†å¯èƒ½ã€‚</p>
<p>AutoGPT ç­‰äº ChatGPT åŠ ä¸Šå‘é‡æ•°æ®åº“ã€‚é€šè¿‡å‘é‡æ•°æ®åº“è®© AutoGPT å…·å¤‡äº†é•¿æœŸè®°å¿†èƒ½åŠ›ï¼Œå®ƒçŸ¥é“ä¹‹å‰æœçš„æ˜¯ä»€ä¹ˆï¼ŒæŠŠå†å²å…¨éƒ¨è®°è¿›å»äº†ï¼Œä¸ç„¶æ¯æ¬¡æŸ¥è¯¢æ˜¯æ²¡æœ‰ä¸Šä¸‹æ–‡çš„ã€‚</p>
<p>å¦‚æœå°†å‘é‡æ•°æ®åº“éƒ¨ç½²åœ¨å…¬å¸å†…éƒ¨ï¼Œèƒ½å¤ŸååŠ©è§£å†³ç›®å‰ä¼ä¸šç•Œæœ€æ‹…å¿§çš„å¤§æ¨¡å‹æ³„éœ²éšç§çš„é—®é¢˜ã€‚</p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16885411749264.jpg" alt="" /></p>
<h2><a id="%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%A7%E5%93%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‘é‡æ•°æ®åº“ äº§å“</h2>
<p>Milvusï¼šä¸–ç•Œä¸Šæœ€å¿«çš„å‘é‡æ•°æ®åº“<br />
Pineconeï¼Œè¿™ä¸ªæä¾› Google Cloud æˆ– AWS çš„æ‰˜ç®¡æœåŠ¡ï¼ŒRust é‡å†™<br />
Qdrantï¼Œå¼€æºç‰ˆåŠå•†ä¸šç‰ˆéƒ½æœ‰<br />
pgvectorï¼ŒPostgreSQL çš„æ‰©å±•</p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16885411749284.jpg" alt="" /><br />
4æœˆ28æ—¥ï¼Œå‘é‡æ•°æ®åº“å¹³å°Pineconeå®£å¸ƒè·å¾—1äº¿ç¾å…ƒï¼ˆçº¦7äº¿å…ƒï¼‰Bè½®èèµ„ï¼Œç”±Andreessen Horowitzé¢†æŠ•ï¼ŒICONIQ Growthç­‰è·ŸæŠ•ã€‚</p>
<p>4æœˆ22æ—¥ï¼Œå‘é‡æ•°æ®åº“å¹³å°Weaviateå®£å¸ƒè·å¾—5000ä¸‡ç¾å…ƒï¼ˆçº¦3.5äº¿å…ƒï¼‰Bè½®èèµ„ï¼Œç”±Index Venturesé¢†æŠ•ï¼ŒBattery Venturesç­‰è·ŸæŠ•ã€‚</p>
<p>æ­¤å¤–ï¼Œ4æœˆ6æ—¥Chromaè·1800ä¸‡ç¾å…ƒç§å­è½®èèµ„ï¼Œ4æœˆ19æ—¥Qdrantè·750ä¸‡ç¾å…ƒç§å­è½®èèµ„ã€‚</p>
<p>Pinecone: <a href="https://www.pinecone.io">https://www.pinecone.io</a><br />
Weaviate: <a href="https://weaviate.io">https://weaviate.io</a><br />
Chroma: <a href="https://www.trychroma.com/">https://www.trychroma.com/</a><br />
Zilliz: <a href="https://zilliz.com">https://zilliz.com</a><br />
Vespa: <a href="https://vespa.ai">https://vespa.ai</a></p>
<h2><a id="%E5%B8%82%E5%9C%BA%E7%A9%BA%E9%97%B4%E5%B7%A8%E5%A4%A7%EF%BC%8C%E8%A1%8C%E4%B8%9A%E5%A4%84%E4%BA%8E%E4%BB%8E0-1%E9%98%B6%E6%AE%B5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¸‚åœºç©ºé—´å·¨å¤§ï¼Œè¡Œä¸šå¤„äºä»0-1é˜¶æ®µ</h2>
<p>å‘é‡æ•°æ®åº“æ˜¯ AI æ—¶ä»£çš„ Killer Appã€‚AIæ—¶ä»£ä¸€åˆ‡AIåŒ–ï¼Œè€ŒAIåŒ–çš„æœ¬è´¨åˆ™æ˜¯å‘é‡åŒ–ï¼Œå‘é‡åŒ–è®¡ç®—æˆæœ¬é«˜æ˜‚ï¼Œæµ·é‡çš„é«˜ç»´å‘é‡åŠ¿å¿…éœ€è¦ä¸“é—¨çš„æ•°æ®åº“è¿›è¡Œå­˜å‚¨å’Œå¤„ç†ï¼Œå‘é‡æ•°æ®åº“åº”è¿è€Œç”Ÿï¼Œå‘é‡æ•°æ®åº“åœ¨æ‹“å±•AIå…¨æ–°åº”ç”¨åœºæ™¯çš„åŒæ—¶ï¼Œä¹Ÿå°†å¯¹ä¼ ç»Ÿæ•°æ®åº“äº§å“å½¢æˆæ›¿ä»£ï¼Œè¿›è€Œæˆä¸ºAIæ—¶ä»£çš„Killer Appã€‚</p>
<h2><a id="milvus%E9%83%A8%E7%BD%B2%EF%BC%9A" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>milvus éƒ¨ç½²ï¼š</h2>
<p><a href="https://github.com/milvus-io/bootcamp/tree/master/solutions/audio/audio_similarity_search/quick_deploy">https://github.com/milvus-io/bootcamp/tree/master/solutions/audio/audio_similarity_search/quick_deploy</a></p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16885411749307.jpg" alt="" /></p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16885411749332.jpg" alt="" /></p>
<h2><a id="qdrant" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Qdrant</h2>
<p><a href="https://qdrant.tech/documentation/overview/">https://qdrant.tech/documentation/overview/</a></p>
<p>docker å¯åŠ¨</p>
<pre class="line-numbers"><code class="language-plain_text">docker run -p 6333:6333 \
    -v $(pwd)/qdrant_storage:/qdrant/storage \
    qdrant/qdrant
</code></pre>
<p>ä½¿ç”¨ä¸‹æ¥ï¼Œæ„Ÿè§‰ Qdrant æ¯” millvus å¥½ç”¨ã€‚</p>
<hr />
<h2><a id="%E9%9F%B3%E9%A2%91%E6%96%87%E4%BB%B6%E6%8F%90%E5%8F%96%E5%90%91%E9%87%8F%E7%89%B9%E5%BE%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>éŸ³é¢‘æ–‡ä»¶æå–å‘é‡ç‰¹å¾</h2>
<p>æå–éŸ³é¢‘æ–‡ä»¶çš„å‘é‡ç‰¹å¾æ˜¯è¯­éŸ³å¤„ç†ä¸­çš„ä¸€ä¸ªé‡è¦ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æŠ€æœ¯ï¼š</p>
<ol>
<li>
<p>MFCCï¼ˆMelé¢‘ç‡å€’è°±ç³»æ•°ï¼‰ï¼šMFCC æ˜¯ä¸€ç§å¸¸è§çš„éŸ³é¢‘ç‰¹å¾æå–æ–¹æ³•ï¼Œå®ƒæ¨¡æ‹Ÿäº†äººè€³çš„æ„ŸçŸ¥æ–¹å¼ã€‚å®ƒé¦–å…ˆå°†éŸ³é¢‘ä¿¡å·è½¬æ¢ä¸ºé¢‘è°±å›¾ï¼Œç„¶åå°†é¢‘ç‡è½´ä¸Šçš„é¢‘ç‡åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ª Mel é¢‘ç‡å¸¦ï¼Œæœ€åè®¡ç®—æ¯ä¸ªé¢‘ç‡å¸¦çš„åŠŸç‡è°±ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå€’è°±ç³»æ•°ã€‚MFCC èƒ½å¤Ÿæ•æ‰éŸ³é¢‘ä¿¡å·çš„é¢‘ç‡å’Œæ—¶åŸŸä¿¡æ¯ï¼Œå¸¸ç”¨äºè¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³åˆæˆç­‰ä»»åŠ¡ã€‚</p>
</li>
<li>
<p>çŸ­æ—¶å‚…é‡Œå¶å˜æ¢ï¼ˆSTFTï¼‰ï¼šSTFT æ˜¯å¦ä¸€ç§å¸¸è§çš„éŸ³é¢‘ç‰¹å¾æå–æ–¹æ³•ï¼Œå®ƒå°†éŸ³é¢‘ä¿¡å·åˆ†æˆè‹¥å¹²ä¸ªçŸ­æ—¶çª—å£ï¼Œå¹¶å¯¹æ¯ä¸ªçª—å£è¿›è¡Œå‚…é‡Œå¶å˜æ¢ã€‚è¿™æ ·å¯ä»¥å¾—åˆ°æ¯ä¸ªçª—å£çš„é¢‘è°±ä¿¡æ¯ï¼Œä»è€Œæ•æ‰éŸ³é¢‘ä¿¡å·çš„é¢‘ç‡å’Œæ—¶åŸŸä¿¡æ¯ã€‚STFT é€šå¸¸ç”¨äºéŸ³é¢‘ä¿¡å·å¤„ç†å’ŒéŸ³ä¹ä¿¡æ¯æ£€ç´¢ç­‰ä»»åŠ¡ã€‚</p>
</li>
<li>
<p>CQTï¼ˆç¦»æ•£ä½™å¼¦å˜æ¢ï¼‰ï¼šCQT æ˜¯ä¸€ç§ç±»ä¼¼äº STFT çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨ä¸€ç»„ä¸åŒçš„é¢‘ç‡å¸¦å®½æ¥æ•æ‰éŸ³é¢‘ä¿¡å·çš„é¢‘ç‡ä¿¡æ¯ã€‚ä¸ STFT ä¸åŒï¼ŒCQT å¯ä»¥åœ¨é¢‘ç‡è½´ä¸Šå¯¹æ•°åˆ»åº¦ï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†ä½é¢‘ä¿¡å·ã€‚CQT é€šå¸¸ç”¨äºéŸ³ä¹ä¿¡æ¯æ£€ç´¢å’ŒéŸ³é¢‘åˆ†ç±»ç­‰ä»»åŠ¡ã€‚</p>
</li>
</ol>
<h3><a id="mfcc" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>MFCC</h3>
<p>MFCCï¼ˆMel-frequency cepstral coefficientsï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„éŸ³é¢‘ä¿¡å·å¤„ç†æŠ€æœ¯ï¼Œç”¨äºæå–éŸ³é¢‘çš„ç‰¹å¾å‘é‡ã€‚å…¶ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>é¢„åŠ é‡ï¼šå¯¹éŸ³é¢‘ä¿¡å·è¿›è¡Œé«˜é€šæ»¤æ³¢ï¼Œä»¥å¢å¼ºé«˜é¢‘éƒ¨åˆ†çš„èƒ½é‡ï¼Œå‡å°‘ä½é¢‘éƒ¨åˆ†çš„èƒ½é‡æŸå¤±ã€‚</p>
</li>
<li>
<p>åˆ†å¸§ï¼šå°†éŸ³é¢‘ä¿¡å·åˆ†æˆè‹¥å¹²å¸§ï¼Œé€šå¸¸æ¯å¸§çš„é•¿åº¦ä¸º20~40æ¯«ç§’ï¼Œç›¸é‚»å¸§ä¹‹é—´æœ‰é‡å ã€‚</p>
</li>
<li>
<p>åŠ çª—ï¼šå¯¹æ¯å¸§ä¿¡å·è¿›è¡ŒåŠ çª—å¤„ç†ï¼Œä»¥å‡å°‘å¸§è¾¹ç¼˜çš„çªå˜ï¼Œå¸¸ç”¨çš„çª—å‡½æ•°æœ‰æ±‰å®çª—ã€æ±‰æ˜çª—ç­‰ã€‚</p>
</li>
<li>
<p>å‚…é‡Œå¶å˜æ¢ï¼šå¯¹æ¯å¸§ä¿¡å·è¿›è¡Œå¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFFTï¼‰ï¼Œå¾—åˆ°æ¯å¸§çš„é¢‘è°±ã€‚</p>
</li>
<li>
<p>æ¢…å°”æ»¤æ³¢å™¨ç»„ï¼šå°†é¢‘è°±æ˜ å°„åˆ°æ¢…å°”é¢‘ç‡ä¸Šï¼Œæ¢…å°”é¢‘ç‡æ˜¯ä¸€ç§äººè€³æ„ŸçŸ¥çš„é¢‘ç‡ï¼Œæ¢…å°”æ»¤æ³¢å™¨ç»„é€šå¸¸ç”±20~40ä¸ªæ»¤æ³¢å™¨ç»„æˆï¼Œæ¯ä¸ªæ»¤æ³¢å™¨çš„å¸¦å®½å’Œä¸­å¿ƒé¢‘ç‡ä¸åŒã€‚</p>
</li>
<li>
<p>å–å¯¹æ•°ï¼šå¯¹æ¯ä¸ªæ»¤æ³¢å™¨çš„è¾“å‡ºå–å¯¹æ•°ï¼Œå¾—åˆ°æ¯å¸§ä¿¡å·çš„æ¢…å°”é¢‘ç‡å€’è°±ç³»æ•°ï¼ˆMel-frequency cepstral coefficientsï¼ŒMFCCï¼‰ã€‚</p>
</li>
<li>
<p>DCTå˜æ¢ï¼šå¯¹æ¯å¸§MFCCç³»æ•°è¿›è¡Œç¦»æ•£ä½™å¼¦å˜æ¢ï¼ˆDCTï¼‰ï¼Œå¾—åˆ°æ¯å¸§çš„MFCCç‰¹å¾å‘é‡ã€‚</p>
</li>
</ol>
<h3><a id="sftf" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>SFTF</h3>
<p>STFTï¼ˆShort-time Fourier transformï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„éŸ³é¢‘ä¿¡å·å¤„ç†æŠ€æœ¯ï¼Œç”¨äºå°†éŸ³é¢‘ä¿¡å·ä»æ—¶åŸŸï¼ˆtime domainï¼‰è½¬æ¢åˆ°é¢‘åŸŸï¼ˆfrequency domainï¼‰ã€‚å…¶ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>å°†éŸ³é¢‘ä¿¡å·åˆ†æˆå¤šä¸ªçŸ­æ—¶çª—å£ï¼Œæ¯ä¸ªçª—å£é•¿åº¦ä¸º N ä¸ªé‡‡æ ·ç‚¹ï¼Œé€šå¸¸ä½¿ç”¨æ±‰å®çª—ï¼ˆHanning windowï¼‰ç­‰çª—å‡½æ•°è¿›è¡ŒåŠ çª—å¤„ç†ï¼Œä»¥å‡å°‘é¢‘è°±æ³„æ¼ï¼ˆspectral leakageï¼‰ã€‚</p>
</li>
<li>
<p>å¯¹äºæ¯ä¸ªçª—å£ï¼Œè¿›è¡Œå‚…é‡Œå¶å˜æ¢ï¼ˆFourier transformï¼‰å¾—åˆ°å…¶é¢‘è°±ï¼ˆspectrumï¼‰ï¼Œå³å°†æ—¶åŸŸä¿¡å·è½¬æ¢ä¸ºé¢‘åŸŸä¿¡å·ã€‚å¯ä»¥ä½¿ç”¨å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFast Fourier Transformï¼ŒFFTï¼‰ç®—æ³•åŠ é€Ÿè®¡ç®—ã€‚</p>
</li>
<li>
<p>å¯¹äºæ¯ä¸ªçª—å£çš„é¢‘è°±ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€æœ¯è¿›è¡Œåå¤„ç†ï¼Œå¦‚ä½¿ç”¨å¯¹æ•°å¹…åº¦è°±ï¼ˆlogarithmic amplitude spectrumï¼‰ä»£æ›¿çº¿æ€§å¹…åº¦è°±ï¼ˆlinear amplitude spectrumï¼‰ï¼Œä»¥æ›´å¥½åœ°æ¨¡æ‹Ÿäººè€³å¯¹å£°éŸ³çš„æ„ŸçŸ¥ã€‚</p>
</li>
<li>
<p>å°†æ‰€æœ‰çª—å£çš„é¢‘è°±æ‹¼æ¥èµ·æ¥ï¼Œå¾—åˆ°æ•´ä¸ªéŸ³é¢‘ä¿¡å·çš„é¢‘è°±è¡¨ç¤ºã€‚è¿™ä¸ªé¢‘è°±é€šå¸¸æ˜¯ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œå…¶ä¸­æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªé¢‘ç‡ï¼Œæ¯ä¸€åˆ—è¡¨ç¤ºä¸€ä¸ªæ—¶é—´çª—å£ã€‚</p>
</li>
</ol>
<h3><a id="cqt" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>CQT</h3>
<p>CQTï¼ˆConstant-Q transformï¼‰æ˜¯ä¸€ç§å°†éŸ³é¢‘ä¿¡å·ä»æ—¶åŸŸï¼ˆtime domainï¼‰è½¬æ¢åˆ°é¢‘åŸŸï¼ˆfrequency domainï¼‰çš„æŠ€æœ¯ï¼Œå…¶ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>å°†éŸ³é¢‘ä¿¡å·åˆ†æˆå¤šä¸ªçŸ­æ—¶æ®µï¼Œæ¯ä¸ªæ—¶æ®µçš„é•¿åº¦é€šå¸¸ä¸º20~40æ¯«ç§’ã€‚</p>
</li>
<li>
<p>å¯¹æ¯ä¸ªæ—¶æ®µçš„ä¿¡å·è¿›è¡ŒåŠ çª—å¤„ç†ï¼Œä»¥é¿å…é¢‘è°±æ³„éœ²ï¼ˆspectral leakageï¼‰çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p>å¯¹åŠ çª—åçš„ä¿¡å·è¿›è¡Œå‚…é‡Œå¶å˜æ¢ï¼ˆFourier transformï¼‰å¾—åˆ°é¢‘åŸŸä¿¡å·ã€‚</p>
</li>
<li>
<p>å¯¹é¢‘åŸŸä¿¡å·è¿›è¡Œæ»¤æ³¢ï¼Œä»¥æå–æ„Ÿå…´è¶£çš„é¢‘ç‡èŒƒå›´ã€‚</p>
</li>
<li>
<p>å¯¹æ»¤æ³¢åçš„é¢‘åŸŸä¿¡å·è¿›è¡Œä¸‹é‡‡æ ·ï¼ˆdownsamplingï¼‰ï¼Œä»¥å‡å°‘è®¡ç®—é‡ã€‚</p>
</li>
<li>
<p>é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°å¤„ç†å®Œæ•´ä¸ªéŸ³é¢‘ä¿¡å·ï¼Œå¾—åˆ°éŸ³é¢‘çš„é¢‘è°±è¡¨ç¤ºã€‚</p>
</li>
</ol>
<h3><a id="python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>python ä»£ç å®ç°</h3>
<h4><a id="mfcc" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>mfcc</h4>
<pre class="line-numbers"><code class="language-python">import librosa
import numpy as np

# åŠ è½½éŸ³é¢‘æ–‡ä»¶
audio_file = '/data/2.wav'
y, sr = librosa.load(audio_file)

# è®¡ç®— MFCC ç‰¹å¾
mfccs = librosa.feature.mfcc(y=y, sr=sr, n_mfcc=13)

# å°† MFCC ç‰¹å¾è½¬æ¢ä¸ºä¸€ç»´å‘é‡
mfccs_vector = np.mean(mfccs.T, axis=0)

print(mfccs_vector)
</code></pre>
<p>è¾“å‡ºç»“æœ</p>
<pre class="line-numbers"><code class="language-plain_text">[-3.7972183e+02  1.0088512e+02 -3.5129642e+00 -1.9051785e+01
 -2.3919962e+01 -2.5029432e+01 -1.4385112e+01 -1.0009483e+01
 -1.8019070e+01  2.9479107e-01  3.8208574e-02 -5.6408200e+00
 -2.3487382e+00]
</code></pre>
<h4><a id="stft" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>stft</h4>
<pre class="line-numbers"><code class="language-python">import librosa
import numpy as np

# åŠ è½½éŸ³é¢‘æ–‡ä»¶
audio_file = '/data/2.wav'
y, sr = librosa.load(audio_file)

# è®¡ç®— STFT ç‰¹å¾
stft = np.abs(librosa.stft(y))

# å°† STFT ç‰¹å¾è½¬æ¢ä¸ºä¸€ç»´å‘é‡
stft_vector = np.mean(stft.T, axis=0)
print(stft_vector)

</code></pre>
<pre class="line-numbers"><code class="language-plain_text">[6.4813397e-03 8.3055627e-03 1.2067630e-02 ... 3.4121547e-07 3.3004611e-07
 3.2894093e-07]
</code></pre>
<h4><a id="panns-inference" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>panns-inference</h4>
<p>PANNs Inference æ¨¡å‹ä½¿ç”¨çš„æ˜¯ STFTï¼ˆçŸ­æ—¶å‚…é‡Œå¶å˜æ¢ï¼‰æ¥ç”ŸæˆéŸ³é¢‘çš„ç‰¹å¾å‘é‡ã€‚<!--STFT å¯ä»¥å°†ä¿¡å·åˆ†è§£æˆä¸€ç³»åˆ—çŸ­æ—¶çª—å£çš„é¢‘è°±ï¼Œå¹¶å°†é¢‘è°±è½¬æ¢ä¸ºèƒ½é‡è°±ï¼Œä»è€Œæå–å‡ºéŸ³é¢‘çš„é¢‘ç‡å’Œå¼ºåº¦ä¿¡æ¯ã€‚-->ä¸ MFCC å’Œ CQT ç›¸æ¯”ï¼ŒSTFT åœ¨éŸ³é¢‘ä¿¡å·å¤„ç†ä¸­æ›´å¸¸ç”¨ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿæä¾›æ›´è¯¦ç»†çš„é¢‘ç‡å’Œæ—¶é—´ä¿¡æ¯ã€‚</p>
<pre class="line-numbers"><code class="language-python">def get_audio_embedding(path):
    # Use panns_inference model to generate feature vector of audio
    try:
        RESAMPLE_RATE=32000
        audio, _ = librosa.core.load(path, sr=RESAMPLE_RATE, mono=True)
        if audio.size &lt; RESAMPLE_RATE:
            audio = np.pad(audio, (0, RESAMPLE_RATE-audio.size), 'constant', constant_values=(0, 0))
        audio = audio[None, :]
        at = AudioTagging(checkpoint_path=None, device='cuda')
        _, embedding = at.inference(audio)
        embedding = embedding/np.linalg.norm(embedding)
        embedding = embedding.tolist()[0]
        return embedding
    except Exception as e:
        print(f&quot;Error with embedding:{e}&quot;)
        return None
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16885411749356.jpg" alt="" /></p>
<p>Cnn14_mAP=0.431.pth æ˜¯ PANNs Inference æ¨¡å‹çš„é¢„è®­ç»ƒæƒé‡æ–‡ä»¶ï¼Œç”¨äºåŠ è½½è®­ç»ƒå¥½çš„ç¥ç»ç½‘ç»œæ¨¡å‹å‚æ•°ã€‚è¿™ä¸ªæ¨¡å‹æ˜¯åœ¨éŸ³é¢‘åˆ†ç±»ä»»åŠ¡ä¸Šè¿›è¡Œè®­ç»ƒçš„ï¼Œå¯ä»¥è¯†åˆ«å‡ºä¸åŒçš„éŸ³é¢‘ç±»åˆ«ï¼Œæ¯”å¦‚è¯´ä¹å™¨ã€å£°éŸ³æ•ˆæœã€äººå£°ç­‰ç­‰ã€‚å®ƒæ˜¯åŸºäºå·ç§¯ç¥ç»ç½‘ç»œ (CNN) çš„æ¶æ„ï¼Œä½¿ç”¨äº† STFT ç‰¹å¾æå–æ–¹æ³•ï¼Œè¾“å…¥çš„éŸ³é¢‘ä¿¡å·ç»è¿‡ä¸€ç³»åˆ—å·ç§¯ã€æ± åŒ–ã€å½’ä¸€åŒ–ç­‰æ“ä½œåï¼Œæœ€ç»ˆè¾“å‡ºä¸€ä¸ªåŒ…å«å„ä¸ªéŸ³é¢‘ç±»åˆ«æ¦‚ç‡çš„å‘é‡ã€‚åœ¨ä½¿ç”¨ PANNs Inference æ¨¡å‹è¿›è¡ŒéŸ³é¢‘åˆ†ç±»æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªé¢„è®­ç»ƒæƒé‡æ–‡ä»¶æ¥åŠ è½½æ¨¡å‹å‚æ•°ï¼Œä»è€Œè¿›è¡Œé¢„æµ‹ã€‚</p>
<h2><a id="chat-with-your-docs" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Chat With Your Docs</h2>
<p><a href="https://github.com/mayooear/gpt4-pdf-chatbot-langchain">https://github.com/mayooear/gpt4-pdf-chatbot-langchain</a><br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/16885411749387.png" alt="gpt-langchain-pdf" /></p>
<hr />
<p><a href="https://wallstreetcn.com/articles/3688270">https://wallstreetcn.com/articles/3688270</a><br />
<a href="https://wallstreetcn.com/articles/3688423">https://wallstreetcn.com/articles/3688423</a></p>
<p><a href="https://www.youtube.com/watch?v=dN0lsF2cvm4">https://www.youtube.com/watch?v=dN0lsF2cvm4</a><br />
<a href="https://www.youtube.com/watch?v=u03AZlmZF_8">https://www.youtube.com/watch?v=u03AZlmZF_8</a></p>
<p><a href="https://www.bilibili.com/video/BV1414y1c78514y1c785">https://www.bilibili.com/video/BV1414y1c78514y1c785</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä½¿ç”¨ ChatGPT å­¦ä¹  Javassist]]></title>
    <link href="http://blog.hitol.top/16761949639234.html"/>
    <updated>2023-02-12T17:42:43+08:00</updated>
    <id>http://blog.hitol.top/16761949639234.html</id>
    <content type="html"><![CDATA[
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16885411825540.jpg" alt="" /></p>
<h2><a id="q-javassist%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Q:Javassist æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<h2><a id="a" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>A:</h2>
<p>Javassistæ˜¯ä¸€ä¸ªå¼€æºçš„Javaå­—èŠ‚ç æ“ä½œåº“ï¼Œå®ƒå…è®¸å¼€å‘äººå‘˜åœ¨è¿è¡Œæ—¶ç¼–è¾‘å’Œåˆ›å»ºJavaç±»ã€‚ä½¿ç”¨Javassistï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ä¿®æ”¹ç°æœ‰ç±»çš„å­—èŠ‚ç æ¥åŠ¨æ€åœ°æ”¹å˜å®ƒä»¬çš„è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Javassistçš„APIæ¥åˆ›å»ºå…¨æ–°çš„Javaç±»ã€‚Javassistæä¾›äº†ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„APIï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨ä¸éœ€è¦äº†è§£å¤æ‚çš„å­—èŠ‚ç ç»“æ„çš„æƒ…å†µä¸‹è½»æ¾åœ°åˆ›å»ºå’Œç¼–è¾‘Javaç±»ã€‚Javassistè¿˜æä¾›äº†ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå¦‚åŠ¨æ€ä»£ç†ã€AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰å’ŒJavaå­—èŠ‚ç çš„è½¬æ¢ã€‚ç”±äºå®ƒçš„çµæ´»æ€§å’Œæ˜“ç”¨æ€§ï¼ŒJavassistè¢«å¹¿æ³›ç”¨äºJavaåº”ç”¨ç¨‹åºçš„åŠ¨æ€ç¼–ç¨‹å’Œå¢å¼ºã€‚</p>
<h2><a id="q-javassist%E5%85%A5%E9%97%A8%E7%A4%BA%E4%BE%8B%EF%BC%9F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Q:Javassist å…¥é—¨ç¤ºä¾‹ï¼Ÿ</h2>
<h2><a id="a" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>A:</h2>
<pre class="line-numbers"><code class="language-java">import javassist.*;

public class JavassistExample {
    public static void main(String[] args) throws Exception {
        ClassPool pool = ClassPool.getDefault();
        CtClass cc = pool.makeClass(&quot;MyClass&quot;);

        // æ·»åŠ å±æ€§
        CtField field = new CtField(CtClass.intType, &quot;myField&quot;, cc);
        cc.addField(field);

        // æ·»åŠ æ–¹æ³•
        CtMethod method = CtNewMethod.make(&quot;public void setMyField(int value) { this.myField = value; }&quot;, cc);
        cc.addMethod(method);

        // è¾“å‡ºç±»çš„å­—èŠ‚ç 
        cc.writeFile(&quot;output&quot;);
    }
}

</code></pre>
<p>è¿™ä¸ªç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ªåä¸º&quot;MyClass&quot;çš„æ–°ç±»ï¼Œæ·»åŠ äº†ä¸€ä¸ªåä¸º&quot;myField&quot;çš„intç±»å‹å±æ€§å’Œä¸€ä¸ªåä¸º&quot;setMyField&quot;çš„å…¬å…±voidç±»å‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è®¾ç½®myFieldå±æ€§çš„å€¼ã€‚æœ€åï¼Œå°†è¯¥ç±»çš„å­—èŠ‚ç å†™å…¥åä¸º&quot;output&quot;çš„æ–‡ä»¶å¤¹ä¸­ã€‚</p>
<p>é€šè¿‡è¿è¡Œè¯¥ç¤ºä¾‹ï¼Œå°†åœ¨outputæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸€ä¸ªMyClass.classæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä¸Šè¿°å®šä¹‰çš„ç±»çš„å­—èŠ‚ç ã€‚è¿™ä¸ªç¤ºä¾‹åªæ˜¯Javassistçš„å…¥é—¨ç¤ºä¾‹ï¼ŒJavassistè¿˜æä¾›äº†è®¸å¤šå…¶ä»–åŠŸèƒ½ï¼Œå¦‚ä¿®æ”¹ç°æœ‰ç±»ã€åŠ¨æ€ä»£ç†ç­‰ã€‚</p>
<h2><a id="q%E9%9C%80%E8%A6%81%E6%B7%BB%E5%8A%A0%E4%BB%80%E4%B9%88-maven%E4%BE%9D%E8%B5%96%EF%BC%9F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Q:éœ€è¦æ·»åŠ ä»€ä¹ˆ maven ä¾èµ–ï¼Ÿ</h2>
<h2><a id="a" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>A:</h2>
<pre class="line-numbers"><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.javassist&lt;/groupId&gt;
    &lt;artifactId&gt;javassist&lt;/artifactId&gt;
    &lt;version&gt;3.28.0-GA&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>æœ€æ–°ç‰ˆæœ¬æ˜¯ 3.29.1-GA</p>
<p>æ·»åŠ å®Œ maven ä¾èµ–åè¿è¡Œï¼Œç¡®å®åœ¨ output æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº† MyClass.class<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/16885411825562.png" alt="CleanShot2023-02-1816.57.14@2x" /></p>
<h2><a id="q%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E7%8E%B0%E6%9C%89%E7%B1%BB%EF%BC%9F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Q:å¦‚ä½•ä¿®æ”¹ç°æœ‰ç±»ï¼Ÿ</h2>
<h2><a id="a" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>A:</h2>
<p>ä½¿ç”¨Javassistä¿®æ”¹ç°æœ‰ç±»å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®Œæˆï¼š</p>
<ol>
<li>è·å–ç±»æ± ï¼ˆClassPoolï¼‰å¯¹è±¡ã€‚
<pre class="line-numbers"><code class="language-java">ClassPool pool = ClassPool.getDefault();
</code></pre>
</li>
<li>ä½¿ç”¨ç±»æ± è·å–è¦ä¿®æ”¹çš„ç±»çš„CtClasså¯¹è±¡ã€‚
<pre class="line-numbers"><code class="language-java">CtClass cc = pool.get(&quot;com.example.MyClass&quot;);
</code></pre>
</li>
<li>ä¿®æ”¹ç±»çš„å­—èŠ‚ç ï¼Œæ¯”å¦‚æ·»åŠ æ–°çš„æ–¹æ³•æˆ–å±æ€§ï¼Œä¿®æ”¹ç°æœ‰æ–¹æ³•æˆ–å±æ€§ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ·»åŠ æ–°æ–¹æ³•çš„ç¤ºä¾‹ï¼š
<pre class="line-numbers"><code class="language-java">CtMethod newMethod = CtNewMethod.make(
&quot;public void newMethod() { System.out.println(\&quot;This is a new method!\&quot;); }&quot;, cc);
cc.addMethod(newMethod);
</code></pre>
</li>
<li>å°†ä¿®æ”¹åçš„å­—èŠ‚ç å†™å…¥classæ–‡ä»¶æˆ–è€…åŠ è½½åˆ°å½“å‰JVMä¸­ã€‚
<pre class="line-numbers"><code class="language-java">cc.writeFile();
</code></pre>
æˆ–è€…
<pre class="line-numbers"><code class="language-java">cc.toClass();
</code></pre>
<code>writeFile</code>æ–¹æ³•ä¼šå°†ä¿®æ”¹åçš„å­—èŠ‚ç å†™å…¥åˆ°ç£ç›˜ä¸Šï¼Œ<code>toClass</code>æ–¹æ³•ä¼šå°†å­—èŠ‚ç åŠ è½½åˆ°å½“å‰JVMä¸­ã€‚</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå®ƒä¼šå°†ç°æœ‰ç±»&quot;com.example.MyClass&quot;ä¸­çš„æ–¹æ³•&quot;oldMethod&quot;ä¿®æ”¹ä¸ºè¾“å‡ºä¸€æ¡æ–°çš„ä¿¡æ¯ï¼š</p>
<pre class="line-numbers"><code class="language-java">import javassist.*;

public class JavassistExample {
    public static void main(String[] args) throws Exception {
        ClassPool pool = ClassPool.getDefault();
        CtClass cc = pool.get(&quot;com.example.MyClass&quot;);

        CtMethod oldMethod = cc.getDeclaredMethod(&quot;oldMethod&quot;);
        oldMethod.setBody(&quot;System.out.println(\&quot;This is a modified old method!\&quot;);&quot;);

        cc.writeFile();
    }
}
</code></pre>
<p>æ³¨æ„ï¼Œä¸ºäº†æ‰§è¡Œè¿™ä¸ªç¤ºä¾‹ï¼Œä½ éœ€è¦å°†&quot;com.example.MyClass&quot;è¿™ä¸ªç±»çš„å­—èŠ‚ç æ–‡ä»¶æ”¾åœ¨ç±»è·¯å¾„ä¸‹ã€‚</p>
<hr />
<p>æ‰§è¡Œå‰ï¼Œæˆ‘çš„ TestClassç±»ï¼Œé‡Œé¢ test æ–¹æ³•ï¼Œè¾“å‡º1<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/16885411825576.png" alt="CleanShot2023-02-1817.07.50@2x" /></p>
<p>æ‰§è¡Œå<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/16885411825589.png" alt="CleanShot2023-02-1817.08.29@2x" /></p>
<p>æ‰§è¡Œåçš„è¿™ä¸ªæ˜¯æ–°ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯è¦†ç›–æ‰åŸæ¥çš„æ–‡ä»¶ã€‚</p>
<h2><a id="q-cc-toclass%E5%92%8C-cc-writefile%E7%9A%84%E5%8C%BA%E5%88%AB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Q:cc.toClass() å’Œ cc.writeFile() çš„åŒºåˆ«</h2>
<h2><a id="a" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>A:</h2>
<p><code>toClass()</code> æ–¹æ³•ä¼šå°† <code>Javassist</code> ä¿®æ”¹åçš„ç±»ç›´æ¥è½¬æ¢ä¸º <code>java.lang.Class</code> å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¯¹è±¡åŠ è½½åˆ° JVM ä¸­ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ä¿®æ”¹åçš„ç±»ã€‚å¦‚æœä½ è°ƒç”¨äº† <code>toClass()</code> æ–¹æ³•ï¼Œ<code>Javassist</code> ä¼šå°è¯•åœ¨ JVM ä¸­åŠ è½½ä¿®æ”¹åçš„ç±»ï¼Œå¦‚æœåŠ è½½æˆåŠŸï¼Œåˆ™è¿”å›ä¸€ä¸ª <code>java.lang.Class</code> å¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p>
<p><code>writeFile()</code> æ–¹æ³•ä¼šå°† <code>Javassist</code> ä¿®æ”¹åçš„ç±»å†™å…¥åˆ°ç£ç›˜ä¸Šçš„ä¸€ä¸ª .class æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥ç”¨æ¥æ›¿æ¢åŸæ¥çš„ç±»æ–‡ä»¶ï¼Œæˆ–è€…åœ¨ä»¥åçš„è¿è¡Œä¸­ä½¿ç”¨ï¼Œä»¥é¿å…æ¯æ¬¡è¿è¡Œæ—¶é‡æ–°ç”Ÿæˆä¿®æ”¹åçš„ç±»ã€‚æ³¨æ„ï¼Œ<code>writeFile()</code> æ–¹æ³•åªæ˜¯å°†ç±»ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå¹¶æ²¡æœ‰å°†å…¶åŠ è½½åˆ° JVM ä¸­ï¼Œå› æ­¤ä½ ä¸èƒ½ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨ä¿®æ”¹åçš„ç±»ï¼Œé™¤éä½ æ‰‹åŠ¨åŠ è½½å®ƒã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼Œ<code>toClass()</code> æ–¹æ³•æ¯” <code>writeFile()</code> æ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå¯ä»¥ç›´æ¥åœ¨ JVM ä¸­åŠ è½½ä¿®æ”¹åçš„ç±»ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨åŠ è½½å®ƒã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å…±äº«ä¿®æ”¹åçš„ç±»ï¼Œæˆ–è€…æƒ³è¦åœ¨ä»¥åçš„è¿è¡Œä¸­ä½¿ç”¨è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆ <code>writeFile()</code> æ–¹æ³•å¯èƒ½æ›´æœ‰ç”¨ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>toClass()</code> å’Œ <code>writeFile()</code> æ–¹æ³•å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨å°†ä¿®æ”¹åçš„ç±»åŠ è½½åˆ° JVM ä¸­ä¹‹å‰ï¼Œå…ˆå°†å®ƒä»¬ä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚è¿™æ ·åšå¯ä»¥é¿å…æ¯æ¬¡è¿è¡Œæ—¶é‡æ–°ç”Ÿæˆä¿®æ”¹åçš„ç±»ã€‚</p>
<h2><a id="q%E4%BD%BF%E7%94%A8-javassist%E4%BF%AE%E6%94%B9%E7%8E%B0%E6%9C%89%E7%B1%BB%EF%BC%8C%E5%9C%A8%E5%85%B6%E4%B8%AD%E6%AF%8F%E4%B8%AA%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E5%89%8D%E5%90%8E%E8%BE%93%E5%87%BA%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%EF%BC%8C%E4%BB%A5%E6%AD%A4%E6%9D%A5%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E7%9A%84%E6%97%B6%E9%97%B4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Q:ä½¿ç”¨Javassistä¿®æ”¹ç°æœ‰ç±»ï¼Œåœ¨å…¶ä¸­æ¯ä¸ªæ–¹æ³•æ‰§è¡Œå‰åè¾“å‡ºå½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œä»¥æ­¤æ¥è®¡ç®—æ–¹æ³•æ‰§è¡Œçš„æ—¶é—´</h2>
<h2><a id="a%EF%BC%9A" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aï¼š</h2>
<p>å›ç­”çš„æ­¥éª¤è·Ÿä¸Šä¸€ä¸ªé—®é¢˜çš„æ­¥éª¤æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡ç¤ºä¾‹ä»£ç ä¸åŒï¼Œè€Œä¸”æœ‰é”™è¯¯ï¼Œæœ€ç»ˆä¿®æ”¹å®Œæˆåçš„ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers"><code class="language-java">import javassist.*;


public class JavassistExample {
    public static void main(String[] args) throws Exception {
        modifyClass();
    }

    public static void modifyClass() throws Exception {
        ClassPool cp = ClassPool.getDefault();
        CtClass cc = cp.get(&quot;com.example.MyClass&quot;);
        System.out.println(&quot;modifyClass &quot; + cc.getName());
        CtMethod[] methods = cc.getDeclaredMethods();
        for (CtMethod method : methods) {
            String methodName = &quot;modifyClass &quot; + cc.getName() + &quot;#&quot; + method.getName();
            System.out.println(methodName);
            method.addLocalVariable(&quot;startNanos&quot;, CtClass.longType);
            method.insertBefore(&quot;{ startNanos = System.nanoTime(); }&quot;);
            method.insertAfter(&quot;System.out.println(System.nanoTime() - startNanos);&quot;);
        }
        // é‡æ–°ç”Ÿæˆå­—èŠ‚ç å¹¶è¿”å›
        cc.writeFile();
        cc.toClass();
    }
}
</code></pre>
<h2><a id="%E8%BF%90%E8%A1%8C%E7%94%9F%E6%88%90%E7%9A%84%E4%BB%A3%E7%A0%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è¿è¡Œç”Ÿæˆçš„ä»£ç </h2>
<pre class="line-numbers"><code class="language-java">public class MyApp {
    public static void main(String[] args) throws Exception {
        // åœ¨ Javassist ä¸­ä¿®æ”¹ MyClass
        JavassistExample.modifyClass();

        // å·²ç»åŠ è½½åˆ° JVM å†…å­˜ä¸­ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ä¿®æ”¹åçš„ç±»
        MyClass cc = new MyClass();
        cc.method1();
    }
}
</code></pre>
<h2><a id="%E4%BF%AE%E6%94%B9%E5%90%8E%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä¿®æ”¹åçš„å­—èŠ‚ç </h2>
<pre class="line-numbers"><code class="language-java">
public class MyClass {
    public MyClass() {
    }

    public void method1() {
        long startNanos = System.nanoTime();
        System.out.println(&quot;This is method 1&quot;);

        try {
            Thread.sleep(1000L);
        } catch (InterruptedException var6) {
            var6.printStackTrace();
        }

        Object var5 = null;
        System.out.println(System.nanoTime() - startNanos);
    }

    public void method2(String name, Integer age) {
        long startNanos = System.nanoTime();
        System.out.println(&quot;This is method 2&quot;);
        System.out.println(name);
        System.out.println(age);

        try {
            Thread.sleep(2000L);
        } catch (InterruptedException var8) {
            var8.printStackTrace();
        }

        Object var7 = null;
        System.out.println(System.nanoTime() - startNanos);
    }
}
</code></pre>
<h2><a id="q%EF%BC%9Ajavaagent%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Qï¼šjavaagent çš„ä½¿ç”¨åŸç†</h2>
<h2><a id="a" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>A:</h2>
<p>Java Agent æ˜¯ä¸€ç§åŸºäº JVM çš„åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œå®ƒå¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶é€šè¿‡å‚æ•°çš„æ–¹å¼å°†ä¸€ä¸ª Jar åŒ…åŠ è½½åˆ° JVM ä¸­ï¼Œä»è€Œå®ç°å¯¹ Java åº”ç”¨ç¨‹åºçš„åŠ¨æ€ç›‘æ§å’Œæ§åˆ¶ã€‚Java Agent çš„åŸç†æ˜¯é€šè¿‡ Java Instrumentation APIï¼Œå®ƒæä¾›äº†å¯¹ Java åº”ç”¨ç¨‹åºå­—èŠ‚ç çš„æ“ä½œèƒ½åŠ›ï¼Œå¯ä»¥åœ¨ Java åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶é€šè¿‡ Agent å°† Java ç±»è¿›è¡ŒåŠ¨æ€ä¿®æ”¹ï¼Œä»è€Œå®ç°å¯¹åº”ç”¨ç¨‹åºçš„ç›‘æ§å’Œæ§åˆ¶ã€‚</p>
<p>åœ¨ä½¿ç”¨ Java Agent æ—¶ï¼Œéœ€è¦ç¼–å†™ä¸€ä¸ªä»£ç†ç¨‹åºï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆ Jar æ–‡ä»¶ã€‚åœ¨ä»£ç†ç¨‹åºä¸­ï¼Œéœ€è¦å®ç° premain æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚åœ¨ premain æ–¹æ³•ä¸­ï¼Œå¯ä»¥é€šè¿‡ Instrumentation API è·å–åº”ç”¨ç¨‹åºçš„ç±»å®šä¹‰ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒåŠ¨æ€ä¿®æ”¹ï¼Œä»è€Œå®ç°å¯¹åº”ç”¨ç¨‹åºçš„å¢å¼ºå’Œç›‘æ§ã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼ŒJava Agent å¯ä»¥åœ¨ premain æ–¹æ³•ä¸­ä½¿ç”¨ Instrumentation API çš„ addTransformer() æ–¹æ³•æ³¨å†Œä¸€ä¸ª ClassFileTransformer å¯¹è±¡ã€‚ClassFileTransformer å¯¹è±¡å¯ä»¥åœ¨åº”ç”¨ç¨‹åºåŠ è½½ç±»æ–‡ä»¶æ—¶å¯¹ç±»å­—èŠ‚ç è¿›è¡Œè½¬æ¢ã€‚åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å­—èŠ‚ç æ“ä½œåº“ï¼Œæ¯”å¦‚ Javassistï¼ŒASM æˆ– ByteBuddy ç­‰ï¼Œæ¥ä¿®æ”¹ç±»å­—èŠ‚ç ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒJava Agent å¯ä»¥å®ç°å¯¹åº”ç”¨ç¨‹åºç±»çš„å¢å¼ºå’Œç›‘æ§ã€‚</p>
<p>åœ¨ Java Agent ä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡ Instrumentation API æä¾›çš„å…¶ä»–æ–¹æ³•è·å–å’Œä¿®æ”¹ç±»åŠ è½½å™¨ã€ç®¡ç†è¿è¡Œæ—¶ä»£ç†ã€è·å–ç±»å®šä¹‰ä¿¡æ¯ç­‰ã€‚è¿™äº›åŠŸèƒ½å¯ä»¥ç”¨äºå®ç°æ›´åŠ å¤æ‚çš„å¢å¼ºå’Œç›‘æ§æ“ä½œã€‚</p>
<p>æ€»ä¹‹ï¼ŒJava Agent æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºå®ç°å„ç§åº”ç”¨ç¨‹åºçš„å¢å¼ºå’Œç›‘æ§ï¼Œæ¯”å¦‚æ€§èƒ½ç›‘æ§ã€å®‰å…¨å®¡è®¡ã€è°ƒè¯•ç­‰ã€‚å®ƒé€šè¿‡åŠ¨æ€ä¿®æ”¹åº”ç”¨ç¨‹åºçš„å­—èŠ‚ç ï¼Œå¯ä»¥å®ç°éä¾µå…¥å¼çš„ç›‘æ§å’Œå¢å¼ºï¼Œè€Œä¸”å¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½å½±å“éå¸¸å°ã€‚</p>
<hr />
<p>ClassFileTransformer æ˜¯ Java ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒæ˜¯ç”¨äºä¿®æ”¹æˆ–å¢å¼ºå­—èŠ‚ç çš„æ ¸å¿ƒæ¥å£ä¹‹ä¸€ã€‚åœ¨ Java åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œé€šè¿‡ -javaagent å‚æ•°åŠ è½½çš„ Java ä»£ç†ä¼šè‡ªåŠ¨æ³¨å†Œä¸€ä¸ª ClassFileTransformer å®ç°ï¼Œç”¨äºå¯¹ JVM ä¸­åŠ è½½çš„ç±»è¿›è¡Œå­—èŠ‚ç ä¿®æ”¹æˆ–å¢å¼ºæ“ä½œã€‚</p>
<p>ClassFileTransformer æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• transformï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šåŸå§‹ç±»åã€ç±»åŠ è½½å™¨ã€åŸå§‹ç±»å­—èŠ‚ç ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œè¡¨ç¤ºç»è¿‡ä¿®æ”¹åçš„æ–°çš„å­—èŠ‚ç ã€‚ClassFileTransformer å¯ä»¥åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µè¿›è¡Œå­—èŠ‚ç çš„ä¿®æ”¹ï¼Œä¾‹å¦‚åœ¨ç±»åŠ è½½ä¹‹å‰ï¼Œç±»åŠ è½½æ—¶ï¼Œç±»è¢«é‡æ–°è½¬æ¢æ—¶ç­‰ã€‚</p>
<hr />
<h2><a id="javassist" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Javassist</h2>
<p>Javassistæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æã€ç¼–è¾‘å’Œåˆ›å»ºJavaå­—èŠ‚ç çš„ç±»åº“ï¼›</p>
<p>ç›¸æ¯”ASMï¼ŒJavassistæä¾›äº†æ›´åŠ ç®€å•ä¾¿æ·çš„APIï¼Œä½¿ç”¨Javassistæˆ‘ä»¬å¯ä»¥åƒå†™Javaä»£ç ä¸€æ ·ç›´æ¥æ’å…¥Javaä»£ç ç‰‡æ®µï¼Œè®©æˆ‘ä»¬ä¸å†éœ€è¦å…³æ³¨Javaåº•å±‚çš„å­—èŠ‚ç çš„å’Œæ ˆæ“ä½œï¼Œä»…éœ€è¦å­¦ä¼šå¦‚ä½•ä½¿ç”¨Javassistçš„APIå³å¯å®ç°å­—èŠ‚ç ç¼–è¾‘ã€‚</p>
<p>å­¦ä¹ Javassistå¯ä»¥é˜…è¯»å®˜æ–¹çš„å…¥é—¨æ•™ç¨‹ï¼š<a href="http://www.javassist.org/tutorial/tutorial.html">Getting Started with Javassist</a>ã€‚</p>
<h3><a id="api" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>API</h3>
<table>
<thead>
<tr>
<th>ç±»</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ClassPool</td>
<td>ClassPoolæ˜¯ä¸€ä¸ªå­˜å‚¨CtClassçš„å®¹å™¨ï¼Œå¦‚æœè°ƒç”¨getæ–¹æ³•ä¼šæœç´¢å¹¶åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¯¥ç±»çš„CtClasså¯¹è±¡</td>
</tr>
<tr>
<td>CtClass</td>
<td>CtClassè¡¨ç¤ºçš„æ˜¯ä»ClassPoolè·å–çš„ç±»å¯¹è±¡ï¼Œå¯å¯¹è¯¥ç±»å°±è¡Œè¯»å†™ç¼–è¾‘ç­‰æ“ä½œ</td>
</tr>
<tr>
<td>CtMethod</td>
<td>å¯è¯»å†™çš„ç±»æ–¹æ³•å¯¹è±¡</td>
</tr>
<tr>
<td>CtConstructor</td>
<td>å¯è¯»å†™çš„ç±»æ„é€ æ–¹æ³•å¯¹è±¡</td>
</tr>
<tr>
<td>CtField</td>
<td>å¯è¯»å†™çš„ç±»æˆå‘˜å˜é‡å¯¹è±¡</td>
</tr>
</tbody>
</table>
<h3><a id="%E6%A0%87%E8%AF%86%E7%AC%A6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ ‡è¯†ç¬¦</h3>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$0, $1, $2, ...</code></td>
<td>thiså’Œæ–¹æ³•å‚æ•°</td>
</tr>
<tr>
<td><code>$args</code></td>
<td>Object[]ç±»å‹çš„å‚æ•°æ•°ç»„</td>
</tr>
<tr>
<td><code>$$</code></td>
<td>æ‰€æœ‰çš„å‚æ•°ï¼Œå¦‚<code>m($$)</code>ç­‰ä»·äº<code>m($1,$2,...)</code></td>
</tr>
<tr>
<td><code>$cflow(...)</code></td>
<td>cflowå˜é‡</td>
</tr>
<tr>
<td><code>$r</code></td>
<td>è¿”å›ç±»å‹ï¼Œç”¨äºç±»å‹è½¬æ¢</td>
</tr>
<tr>
<td><code>$w</code></td>
<td>åŒ…è£…ç±»å‹ï¼Œç”¨äºç±»å‹è½¬æ¢</td>
</tr>
<tr>
<td><code>$_</code></td>
<td>æ–¹æ³•è¿”å›å€¼</td>
</tr>
<tr>
<td><code>$sig</code></td>
<td>æ–¹æ³•ç­¾åï¼Œè¿”å›java.lang.Class[]æ•°ç»„ç±»å‹</td>
</tr>
<tr>
<td><code>$type</code></td>
<td>è¿”å›å€¼ç±»å‹ï¼Œjava.lang.Classç±»å‹</td>
</tr>
<tr>
<td><code>$class</code></td>
<td>å½“å‰ç±»ï¼Œjava.lang.Classç±»å‹</td>
</tr>
</tbody>
</table>
<h2><a id="agent" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Agent</h2>
<p>JDK1.5å¼€å§‹ï¼ŒJavaæ–°å¢äº†Instrumentation(Java Agent API)å’ŒJVMTI(JVM Tool Interface)åŠŸèƒ½ï¼Œå…è®¸JVMåœ¨åŠ è½½æŸä¸ªclassæ–‡ä»¶ä¹‹å‰å¯¹å…¶å­—èŠ‚ç è¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¯¹å·²åŠ è½½çš„class(ç±»å­—èŠ‚ç )è¿›è¡Œé‡æ–°åŠ è½½(Retransform)ã€‚</p>
<p>åˆ©ç”¨Java Agentè¿™ä¸€ç‰¹æ€§è¡ç”Ÿå‡ºäº†APM(Application Performance Managementï¼Œåº”ç”¨æ€§èƒ½ç®¡ç†)ã€RASP(Runtime application self-protectionï¼Œè¿è¡Œæ—¶åº”ç”¨è‡ªæˆ‘ä¿æŠ¤)ã€IAST(Interactive Application Security Testingï¼Œäº¤äº’å¼åº”ç”¨ç¨‹åºå®‰å…¨æµ‹è¯•)ç­‰ç›¸å…³äº§å“ï¼Œå®ƒä»¬éƒ½æ— ä¸€ä¾‹å¤–çš„ä½¿ç”¨äº†Instrumentation/JVMTIçš„APIæ¥å®ç°åŠ¨æ€ä¿®æ”¹Javaç±»å­—èŠ‚ç å¹¶æ’å…¥ç›‘æ§æˆ–æ£€æµ‹ä»£ç ã€‚</p>
<p>Java Agentæœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š</p>
<ol>
<li>å¯åŠ¨Javaç¨‹åºæ—¶æ·»åŠ -javaagent(Instrumentation APIå®ç°æ–¹å¼)æˆ–-agentpath/-agentlib(JVMTIçš„å®ç°æ–¹å¼)å‚æ•°ï¼Œå¦‚java -javaagent:/data/XXX.jar LingXeTestã€‚</li>
<li>JDK1.6æ–°å¢äº†attach(é™„åŠ æ–¹å¼)æ–¹å¼ï¼Œå¯ä»¥å¯¹è¿è¡Œä¸­çš„Javaè¿›ç¨‹é™„åŠ Agentã€‚<br />
è¿™ä¸¤ç§è¿è¡Œæ–¹å¼çš„æœ€å¤§åŒºåˆ«åœ¨äºç¬¬ä¸€ç§æ–¹å¼åªèƒ½åœ¨ç¨‹åºå¯åŠ¨æ—¶æŒ‡å®šAgentæ–‡ä»¶ï¼Œè€Œattachæ–¹å¼å¯ä»¥åœ¨Javaç¨‹åºè¿è¡Œåæ ¹æ®è¿›ç¨‹IDåŠ¨æ€æ³¨å…¥Agentåˆ°JVMã€‚</li>
</ol>
<p>Java Agentå’Œæ™®é€šçš„Javaç±»å¹¶æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œæ™®é€šçš„Javaç¨‹åºä¸­è§„å®šäº†mainæ–¹æ³•ä¸ºç¨‹åºå…¥å£ï¼Œè€ŒJava Agentåˆ™å°†premainï¼ˆAgentæ¨¡å¼ï¼‰å’Œagentmainï¼ˆAttachæ¨¡å¼ï¼‰ä½œä¸ºäº†Agentç¨‹åºçš„å…¥å£ï¼Œä¸¤è€…æ‰€æ¥å—çš„å‚æ•°æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers"><code class="language-java">public static void premain(String args, Instrumentation inst) {}
public static void agentmain(String args, Instrumentation inst) {}
</code></pre>
<p>Java Agentè¿˜é™åˆ¶äº†æˆ‘ä»¬å¿…é¡»ä»¥jaråŒ…çš„å½¢å¼è¿è¡Œæˆ–åŠ è½½ï¼Œæˆ‘ä»¬å¿…é¡»å°†ç¼–å†™å¥½çš„Agentç¨‹åºæ‰“åŒ…æˆä¸€ä¸ªjaræ–‡ä»¶ã€‚</p>
<p>ä½¿ç”¨å‘½ä»¤ï¼š</p>
<pre class="line-numbers"><code class="language-plain_text">java -javaagent:/path/to/agent.jar -jar yourapp.jar
</code></pre>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒJava Agentè¿˜å¼ºåˆ¶è¦æ±‚äº†æ‰€æœ‰çš„jaræ–‡ä»¶ä¸­å¿…é¡»åŒ…å«/META-INF/MANIFEST.MFæ–‡ä»¶ï¼Œä¸”è¯¥æ–‡ä»¶ä¸­å¿…é¡»å®šä¹‰å¥½Premain-Classï¼ˆAgentæ¨¡å¼ï¼‰æˆ–Agent-Class:ï¼ˆAgentæ¨¡å¼ï¼‰é…ç½®ï¼Œå¯ä»¥é€šè¿‡ maven æ’ä»¶å®ç°:</p>
<pre class="line-numbers"><code class="language-xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
    &lt;version&gt;3.2.0&lt;/version&gt;
    &lt;configuration&gt;
        &lt;archive&gt;
            &lt;addMavenDescriptor&gt;true&lt;/addMavenDescriptor&gt;
            &lt;index&gt;true&lt;/index&gt;
            &lt;manifest&gt;
                &lt;addDefaultSpecificationEntries&gt;true&lt;/addDefaultSpecificationEntries&gt;
                &lt;addDefaultImplementationEntries&gt;true&lt;/addDefaultImplementationEntries&gt;
            &lt;/manifest&gt;
            &lt;manifestEntries&gt;
                &lt;Premain-Class&gt;com.example.PreMain&lt;/Premain-Class&gt;
                &lt;Specification-Version&gt;${project.version}&lt;/Specification-Version&gt;
                &lt;Implementation-Version&gt;${project.version}&lt;/Implementation-Version&gt;
            &lt;/manifestEntries&gt;
        &lt;/archive&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>
<h2><a id="%E5%B0%86%E7%9B%91%E6%8E%A7%E4%BF%A1%E6%81%AF%E8%BE%93%E5%87%BA%E5%88%B0%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å°†ç›‘æ§ä¿¡æ¯è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶</h2>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­å·²ç»å®ç°äº†ï¼Œåœ¨æ–¹æ³•è¿è¡Œå‰åè®°å½•æ—¶é—´æˆ³æ¥ç›‘æ§æ–¹æ³•æ‰§è¡Œæ—¶é—´ã€‚<br />
ä¸‹ä¸€æ­¥è®¡åˆ’ï¼Œå°†æ‰§è¡Œæ—¶é—´è®°å½•ä¸‹æ¥ã€‚<br />
åœ¨ä¸‹ä¸€æ­¥ï¼Œè®°å½•åˆ°æ—¶åºæ•°æ®åº“ä¸­ï¼ŒåŠ è½½åˆ° Prometheus</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rust å¿«é€Ÿå…¥é—¨æŒ‡å—]]></title>
    <link href="http://blog.hitol.top/16748079623338.html"/>
    <updated>2023-01-27T16:26:02+08:00</updated>
    <id>http://blog.hitol.top/16748079623338.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F">å®šä¹‰å˜é‡</a></li>
<li><a href="#%E5%B8%B8%E9%87%8F">å¸¸é‡</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2">å­—ç¬¦ä¸²</a></li>
<li><a href="#u64%E3%80%81i64%E3%80%81f64">u64ã€i64ã€f64</a></li>
<li><a href="#if">if</a></li>
<li><a href="#match">match</a></li>
<li><a href="#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6">è¯»å–æ–‡ä»¶</a></li>
<li><a href="#%E8%A7%A3%E6%9E%90json">è§£æ json</a></li>
<li><a href="#%E5%BE%AA%E7%8E%AF">å¾ªç¯</a></li>
<li><a href="#iter">iter</a></li>
<li><a href="#while">while</a></li>
<li><a href="#loop">loop</a></li>
<li><a href="#%E5%87%BD%E6%95%B0">å‡½æ•°</a>
<ul>
<li><a href="#%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC">å‡½æ•°è¿”å›å€¼ -&gt;</a></li>
<li><a href="#%E5%8F%82%E6%95%B0%E5%80%BC%E4%BC%A0%E9%80%92">å‚æ•°-å€¼ä¼ é€’</a></li>
<li><a href="#%E5%8F%82%E6%95%B0%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92">å‚æ•°-å¼•ç”¨ä¼ é€’</a></li>
</ul>
</li>
<li><a href="#%E5%85%83%E7%BB%84tuple">å…ƒç»„ tuple</a>
<ul>
<li><a href="#%E5%AE%9A%E4%B9%89">å®šä¹‰</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93">ç»“æ„ä½“</a>
<ul>
<li><a href="#%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E4%BD%93">å®šä¹‰ç»“æ„ä½“</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9E%E4%BE%8B">åˆ›å»ºç»“æ„ä½“å®ä¾‹</a></li>
<li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0">ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°</a></li>
<li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93%E4%BD%9C%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%80%BC">ç»“æ„ä½“ä½œä¸ºè¿”å›å€¼</a></li>
<li><a href="#%E6%96%B9%E6%B3%95">æ–¹æ³•</a></li>
<li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95">ç»“æ„ä½“é™æ€æ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#%E6%9E%9A%E4%B8%BE">æšä¸¾</a>
<ul>
<li><a href="#option%E6%9E%9A%E4%B8%BE">Optionæšä¸¾</a></li>
</ul>
</li>
<li><a href="#%E9%9B%86%E5%90%88">é›†åˆ</a>
<ul>
<li><a href="#vec">Vec</a>
<ul>
<li><a href="#vec%E5%A6%82%E4%BD%95%E9%81%8D%E5%8E%86">vec å¦‚ä½•éå†</a></li>
</ul>
</li>
<li><a href="#hashmap">HashMap</a></li>
<li><a href="#hashset">HashSet</a></li>
<li><a href="#btreemap%E3%80%81linkedhashmap">BTreeMapã€LinkedHashMap</a></li>
</ul>
</li>
<li><a href="#%E6%B3%9B%E5%9E%8B">æ³›å‹</a></li>
<li><a href="#trait">Trait</a></li>
<li><a href="#%E8%BF%AD%E4%BB%A3%E5%99%A8">è¿­ä»£å™¨</a></li>
<li><a href="#%E9%97%AD%E5%8C%85">é—­åŒ…</a></li>
<li><a href="#%E9%97%AD%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8">é—­åŒ…çš„ä½¿ç”¨</a></li>
<li><a href="#%E7%BA%BF%E7%A8%8B">çº¿ç¨‹</a>
<ul>
<li><a href="#join">join</a></li>
</ul>
</li>
<li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">é”™è¯¯å¤„ç†</a>
<ul>
<li><a href="#panic%E4%B8%8D%E5%8F%AF%E6%81%A2%E5%A4%8D%E9%94%99%E8%AF%AF">panic!() ä¸å¯æ¢å¤é”™è¯¯</a></li>
<li><a href="#result%E6%9E%9A%E4%B8%BE%E5%92%8C%E5%8F%AF%E6%81%A2%E5%A4%8D%E9%94%99%E8%AF%AF">Result æšä¸¾å’Œå¯æ¢å¤é”™è¯¯</a></li>
<li><a href="#unwrap%E5%92%8C-expect">unwrap() å’Œ expect()</a></li>
</ul>
</li>
<li><a href="#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88">æ™ºèƒ½æŒ‡é’ˆ</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8box-t%E5%9C%A8%E5%A0%86%E4%B8%8A%E5%88%86%E9%85%8D%E6%95%B0%E6%8D%AE">ä½¿ç”¨ Box<T> åœ¨å †ä¸Šåˆ†é…æ•°æ®</a></li>
<li><a href="#%E9%80%9A%E8%BF%87deref-trait%E5%B0%86%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E8%A7%86%E4%BD%9C%E5%B8%B8%E8%A7%84%E5%BC%95%E7%94%A8">é€šè¿‡ Deref trait å°†æ™ºèƒ½æŒ‡é’ˆè§†ä½œå¸¸è§„å¼•ç”¨</a></li>
</ul>
</li>
<li><a href="#rc-t%E5%9F%BA%E4%BA%8E%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%9A%84%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88">Rc<T> åŸºäºå¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆ</a></li>
<li><a href="#refcell-t%E4%BD%BF%E7%94%A8%E4%BA%86%E5%86%85%E9%83%A8%E5%8F%AF%E5%8F%98%E6%80%A7%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%B1%BB%E5%9E%8B">RefCell<T>: ä½¿ç”¨äº†å†…éƒ¨å¯å˜æ€§æ¨¡å¼çš„ç±»å‹</a></li>
<li><a href="#refcell%E5%92%8C-box%E7%9A%84%E5%8C%BA%E5%88%AB">RefCell å’Œ Box çš„åŒºåˆ«</a></li>
<li><a href="#%E5%8C%85%E7%AE%A1%E7%90%86">åŒ…ç®¡ç†</a></li>
<li><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">å•å…ƒæµ‹è¯•</a></li>
<li><a href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95">é›†æˆæµ‹è¯•</a></li>
<li><a href="#bench">bench</a></li>
<li><a href="#arc">Arc</a></li>
<li><a href="#mutex">Mutex</a></li>
<li><a href="#rwlock">RwLock</a></li>
<li><a href="#%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F">æ—¶é—´æ ¼å¼</a></li>
<li><a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F">ç­–ç•¥æ¨¡å¼</a></li>
<li><a href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1">å¤šçº¿ç¨‹ä¸å®šæ—¶ä»»åŠ¡</a></li>
<li><a href="#channel">channel</a></li>
<li><a href="#rayon">rayon</a></li>
<li><a href="#%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%8C%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8">&lt;'_&gt; æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä»€ä¹ˆä½œç”¨</a></li>
<li><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">ç”Ÿå‘½å‘¨æœŸ</a></li>
<li><a href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88">å‡½æ•°æŒ‡é’ˆ</a></li>
<li><a href="#%E9%97%AD%E5%8C%85%E4%B8%8Efn%E3%80%81fnmut%E3%80%81fnonce">é—­åŒ…ä¸Fnã€FnMutã€FnOnce</a></li>
<li><a href="#%E5%AE%8F">å®</a>
<ul>
<li><a href="#macro-rules%E5%A3%B0%E6%98%8E%E5%AE%8F">macro_rules! å£°æ˜å®</a></li>
<li><a href="#%E5%B1%9E%E6%80%A7%E5%AE%8F">å±æ€§å®</a></li>
<li><a href="#%E5%87%BD%E6%95%B0%E5%AE%8F">å‡½æ•°å®</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E7%8E%B0kafka%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8C%85%EF%BC%8C%E5%8F%91%E5%B8%83%E5%88%B0-crate-io">å®ç° kafka çš„å·¥å…·åŒ…ï¼Œå‘å¸ƒåˆ° crate.io</a></li>
</ul>
</div>
<h2><a id="%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®šä¹‰å˜é‡</h2>
<pre class="line-numbers"><code class="language-rust">let å˜é‡å = å€¼;           // ä¸æŒ‡å®šå˜é‡ç±»å‹
let å˜é‡å:æ•°æ®ç±»å‹ = å€¼;   // æŒ‡å®šå˜é‡ç±»å‹
</code></pre>
<p>å¯ä»¥åŒ…å« å­—æ¯ã€æ•°å­— å’Œ ä¸‹åˆ’çº¿ ã€‚</p>
<p>å˜é‡åå¿…é¡»ä»¥ å­—æ¯ æˆ– ä¸‹åˆ’çº¿ å¼€å¤´ã€‚ä¸èƒ½ä»¥ æ•°å­— å¼€å¤´ã€‚</p>
<p>å˜é‡åæ˜¯ åŒºåˆ†å¤§å° å†™çš„ã€‚ä¹Ÿå°±æ˜¯å¤§å†™çš„ Study å’Œå°å†™çš„ study æ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡ã€‚</p>
<p>let å…³é”®å­—å®šä¹‰çš„å˜é‡æ˜¯ä¸å¯å˜å˜é‡<br />
mut è¡¨ç¤ºå¯å˜ï¼Œåœ¨å˜é‡å‰è¾¹åŠ </p>
<h2><a id="%E5%B8%B8%E9%87%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¸¸é‡</h2>
<pre class="line-numbers"><code class="language-rust">const å¸¸é‡åç§°:æ•°æ®ç±»å‹=å€¼;
</code></pre>
<p>Rust ä¸­ï¼Œå¸¸é‡ä¸èƒ½è¢«éšè—ï¼Œä¹Ÿä¸èƒ½è¢«é‡å¤å®šä¹‰ã€‚</p>
<h2><a id="%E5%AD%97%E7%AC%A6%E4%B8%B2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å­—ç¬¦ä¸²</h2>
<p>Rust è¯­è¨€æä¾›äº†ä¸¤ç§å­—ç¬¦ä¸²</p>
<ol>
<li>Rust æ ¸å¿ƒå†…ç½®çš„æ•°æ®ç±»å‹&amp;strï¼Œå­—ç¬¦ä¸²å­—é¢é‡ ã€‚</li>
<li>Rust æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ª å…¬å¼€ pub ç»“æ„ä½“ã€‚å­—ç¬¦ä¸²å¯¹è±¡ Stringã€‚</li>
</ol>
<pre class="line-numbers"><code class="language-rust">String::new() //åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå­—ç¬¦ä¸²,å®ƒæ˜¯é™æ€æ–¹æ³•ã€‚
String::from() //ä»å…·ä½“çš„å­—ç¬¦ä¸²å­—é¢é‡åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ã€‚


let mut s3 = String::new();


s3.push('O');
s3.push('K');
println!(&quot;{}&quot;,s3);//è¾“å‡º Goè¯­è¨€æç®€ä¸€æœ¬é€šOK

replace()

len()

to_string()

as_str()

trim()

split()

chars()

</code></pre>
<h2><a id="u64%E3%80%81i64%E3%80%81f64" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>u64ã€i64ã€f64</h2>
<p>u64 æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 64 ä½æ•´æ•°ï¼Œè¡¨ç¤ºèŒƒå›´ä¸ºä» 0 åˆ° 18,446,744,073,709,551,615ï¼Œå¯ç”¨äºè¡¨ç¤ºä¸éœ€è¦å°æ•°çš„æ­£æ•´æ•°å€¼ã€‚</p>
<p>i64 æ˜¯ä¸€ä¸ªå¸¦ç¬¦å·çš„ 64 ä½æ•´æ•°ï¼Œè¡¨ç¤ºèŒƒå›´ä¸º -9,223,372,036,854,775,808 åˆ° 9,223,372,036,854,775,807ï¼Œå¯ä»¥è¡¨ç¤ºæ­£æ•°å’Œè´Ÿæ•°ï¼Œé€‚ç”¨äºéœ€è¦ä¿å­˜æœ‰ç¬¦å·æ•´æ•°çš„åœºæ™¯ã€‚</p>
<p>f64 æ˜¯ä¸€ä¸ª 64 ä½æµ®ç‚¹æ•°ï¼Œå¯ä»¥è¡¨ç¤ºå¸¦å°æ•°ç‚¹çš„æµ®ç‚¹å€¼ï¼Œå¹¶ä¸”å¯ä»¥è¡¨ç¤ºéå¸¸å°æˆ–éå¸¸å¤§çš„æ•°å­—ï¼Œå¯ä»¥åœ¨ä¸€å®šçš„ç²¾åº¦èŒƒå›´å†…è¡¨ç¤ºå‡ ä¹æ‰€æœ‰å®æ•°ã€‚ä½†æ˜¯ç”±äºç²¾åº¦é™åˆ¶ï¼Œæµ®ç‚¹æ•°åœ¨è¿›è¡Œæ•°å€¼è®¡ç®—æ—¶å®¹æ˜“å‡ºç°è¯¯å·®ï¼Œæ‰€ä»¥éœ€è¦è°¨æ…ä½¿ç”¨ã€‚</p>
<p>åœ¨ Rust ä¸­ï¼Œæ‚¨éœ€è¦æ ¹æ®å®é™…çš„åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹ã€‚å¦‚æœæ‚¨éœ€è¦ä¿å­˜çš„æ•´æ•°æ˜¯æ­£æ•°ä¸”ä¸éœ€è¦è¶…è¿‡ u64 çš„å–å€¼èŒƒå›´ï¼Œé‚£ä¹ˆä½¿ç”¨ u64 å¯èƒ½ä¼šæ›´åˆé€‚ï¼Œè€Œå¦‚æœæ‚¨éœ€è¦ä¿å­˜çš„æ•´æ•°å¯ä»¥æ˜¯æ­£æ•°æˆ–è€…è´Ÿæ•°ï¼Œä½¿ç”¨ i64 å¯èƒ½æ›´åˆé€‚ã€‚å¦‚æœæ‚¨éœ€è¦è¿›è¡Œå°æ•°æ•°å€¼è®¡ç®—ï¼Œä¸éœ€è¦éå¸¸é«˜çš„ç²¾åº¦ï¼Œé‚£ä¹ˆé€‰æ‹© f64 å¯èƒ½æ›´ç®€å•ã€‚ä½†æ˜¯å¦‚æœæ‚¨éœ€è¦è¿›è¡Œé«˜ç²¾åº¦è´§å¸è®¡ç®—ç­‰ç²¾ç¡®è®¡ç®—ï¼Œå»ºè®®ä½¿ç”¨ Decimal ç­‰ç¬¬ä¸‰æ–¹åº“ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Rust ä¸­ï¼Œè¿™ä¸‰ç§ç±»å‹ä¹‹é—´çš„è½¬æ¢éœ€è¦è°¨æ…ï¼Œå› ä¸ºå®ƒä»¬çš„ç±»å‹ä¸å…¼å®¹ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œè½¬æ¢æ—¶ï¼Œå¯èƒ½å‘ç”Ÿæ•°æ®ç²¾åº¦ä¸¢å¤±ç­‰é—®é¢˜ã€‚å¯¹äº i64 åˆ° f64 æˆ–è€… u64 åˆ° f64 çš„è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨ as è¿ç®—ç¬¦ã€‚è€Œå¯¹äº f64 åˆ° i64 æˆ–è€… f64 åˆ° u64 çš„è½¬æ¢ï¼Œéœ€è¦ä½¿ç”¨ .round() ç­‰å‡½æ•°å°†æµ®ç‚¹æ•°å‘ä¸Šæˆ–å‘ä¸‹å–æ•´ï¼Œå¹¶å¤„ç†æº¢å‡ºçš„æƒ…å†µã€‚</p>
<h2><a id="if" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>if</h2>
<pre class="line-numbers"><code class="language-rust">if æ¡ä»¶è¡¨è¾¾å¼1 {
   // å½“ æ¡ä»¶è¡¨è¾¾å¼1 ä¸º true æ—¶è¦æ‰§è¡Œçš„è¯­å¥
} else if æ¡ä»¶è¡¨è¾¾å¼2 {
   // å½“ æ¡ä»¶è¡¨è¾¾å¼2 ä¸º true æ—¶è¦æ‰§è¡Œçš„è¯­å¥
} else {
   // å¦‚æœ æ¡ä»¶è¡¨è¾¾å¼1 å’Œ æ¡ä»¶è¡¨è¾¾å¼2 éƒ½ä¸º false æ—¶è¦æ‰§è¡Œçš„è¯­å¥
}

let total:f32=366.00;
if total&gt;200.00 &amp;&amp; total&lt;500.00{
   println!(&quot;æ‰“9æŠ˜,{}&quot;,total*0.9)
}else if total&gt;500.00{
   println!(&quot;æ‰“8æŠ˜,{}&quot;,total*0.9)
} else{
   println!(&quot;æ— æŠ˜æ‰£ä¼˜æƒ ,{}&quot;,total)
}
//è¾“å‡º æ‰“9æŠ˜,329.4
</code></pre>
<h2><a id="match" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>match</h2>
<pre class="line-numbers"><code class="language-rust">match variable_expression {
   constant_expr1 =&gt; {
      // è¯­å¥;
   },
   constant_expr2 =&gt; {
      // è¯­å¥;
   },
   _ =&gt; {
      // é»˜è®¤
      // å…¶å®ƒè¯­å¥
   }
};

let code = &quot;10010&quot;;
let choose = match code {
   &quot;10010&quot; =&gt; &quot;è”é€š&quot;,
   &quot;10086&quot; =&gt; &quot;ç§»åŠ¨&quot;,
   _ =&gt; &quot;Unknown&quot;
};
println!(&quot;é€‰æ‹© {}&quot;, choose);
//è¾“å‡º é€‰æ‹© è”é€š


let code = &quot;80010&quot;;
let choose = match code {
   &quot;10010&quot; =&gt; &quot;è”é€š&quot;,
   &quot;10086&quot; =&gt; &quot;ç§»åŠ¨&quot;,
   _ =&gt; &quot;Unknown&quot;
};
println!(&quot;é€‰æ‹© {}&quot;, choose);
//è¾“å‡º é€‰æ‹© Unknown
</code></pre>
<h2><a id="%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è¯»å–æ–‡ä»¶</h2>
<pre class="line-numbers"><code class="language-rust">let content = fs::read_to_string(&quot;json.json&quot;).unwrap();
</code></pre>
<h2><a id="%E8%A7%A3%E6%9E%90json" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è§£æ json</h2>
<pre class="line-numbers"><code class="language-rust">let json = serde_json::to_string(&amp;content).unwrap();
print!(&quot;json: {}&quot;, json);
</code></pre>
<pre class="line-numbers"><code class="language-rust">let parsed:WebResponse = serde_json::from_str(raw_json).unwrap();
return pased
</code></pre>
<h2><a id="%E5%BE%AA%E7%8E%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¾ªç¯</h2>
<pre class="line-numbers"><code class="language-rust">for num in 1..5{
   println!(&quot;num is {}&quot;, num);
}
//è¾“å‡º
num is 1
num is 2
num is 3
num is 4


for num in 1..=5 {
   println!(&quot;num is {}&quot;, num);
}
è¾“å‡º
num is 1
num is 2
num is 3
num is 4
num is 5
</code></pre>
<h2><a id="iter" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>iter</h2>
<pre class="line-numbers"><code class="language-rust">let array = vec![
    &quot;1&quot;,
    &quot;2&quot;,
    &quot;3&quot;,
];
for name in array.iter() {
    match name {
        &amp;&quot;3&quot; =&gt; println!(&quot;3-{}!&quot;, name),
        _ =&gt; println!(&quot;{}&quot;, name),
    }
}

//è¾“å‡º
1
2
3-3!
</code></pre>
<p>iter åœ¨æ¯æ¬¡è¿­ä»£çš„æ—¶å€™ä¼šä»é›†åˆä¸­å€Ÿç”¨å…ƒç´ ï¼Œè¿™æ ·é›†åˆæœ¬èº«ä¸ä¼šè¢«æ”¹å˜ï¼Œå¾ªç¯ç»“æŸåï¼Œé›†åˆä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>into_iterä¼šæ¶ˆè€—é›†åˆï¼Œä¼šremove é›†åˆä¸­çš„å…ƒç´ ã€‚</p>
<pre class="line-numbers"><code class="language-rust">let array = vec![
    &quot;1&quot;,
    &quot;2&quot;,
    &quot;3&quot;,
];
for name in array.into_iter() { // `array` moved due to this method call
    match name {
        &quot;3&quot; =&gt; println!(&quot;3-{}!&quot;, name),
        _ =&gt; println!(&quot;{}&quot;, name),
    }
}
println!(&quot;{:?}&quot;,array) // value  borrowed here after move
</code></pre>
<h2><a id="while" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>while</h2>
<pre class="line-numbers"><code class="language-rust">while ( æ¡ä»¶è¡¨è¾¾å¼ ) {
    // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
}
</code></pre>
<pre class="line-numbers"><code class="language-rust">let mut num = 1;
while num &lt; 20 {
    num = num + 1;
    println!(&quot;{}&quot;,num)
}

while å†…éƒ¨ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ breakï¼›
</code></pre>
<h2><a id="loop" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>loop</h2>
<pre class="line-numbers"><code class="language-rust">let mut num = 1;
loop {
    num = num + 1;
    if num &gt; 20{
        break;
    }
    println!(&quot;{}&quot;,num)
}
</code></pre>
<h2><a id="%E5%87%BD%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‡½æ•°</h2>
<pre class="line-numbers"><code class="language-rust">fn å‡½æ•°åç§°([å‚æ•°:æ•°æ®ç±»å‹]) -&gt; è¿”å›å€¼ {
   // å‡½æ•°ä»£ç 
}

fn hello(){
    println!(&quot;Hello, rust!&quot;);
}

fn main() {
    hello();
}

//è¾“å‡º Hello, rust!
</code></pre>
<p>ä¸€ä¸ª â€œä¸â€ è¿”å›å€¼çš„å‡½æ•°ã€‚å®é™…ä¸Šä¼šè¿”å›ä¸€ä¸ªå•å…ƒç±»å‹ ()</p>
<h3><a id="%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‡½æ•°è¿”å›å€¼ -&gt;</h3>
<p>å¦‚æœå‡½æ•°æœ€åæ²¡æœ‰ returnï¼Œé‚£ä¹ˆå‡½æ•°ä¼šä½¿ç”¨æœ€åä¸€æ¡è¯­å¥çš„æ‰§è¡Œç»“æœå½“åšè¿”å›å€¼è¿”å›ï¼Œæ²¡æœ‰åˆ†å·ã€‚</p>
<h3><a id="%E5%8F%82%E6%95%B0%E5%80%BC%E4%BC%A0%E9%80%92" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‚æ•°-å€¼ä¼ é€’</h3>
<p>å€¼ä¼ é€’ æ˜¯æŠŠä¼ é€’çš„å˜é‡çš„å€¼ä¼ é€’ç»™å‡½æ•°çš„ å½¢å‚ï¼Œæ‰€ä»¥ï¼Œå‡½æ•°ä½“å¤–çš„å˜é‡å€¼å’Œå‡½æ•°å‚æ•°æ˜¯å„è‡ªä¿å­˜äº†ç›¸åŒçš„å€¼ï¼Œäº’ä¸å½±å“ã€‚å› æ­¤å‡½æ•°å†…éƒ¨ä¿®æ”¹å‡½æ•°å‚æ•°çš„å€¼å¹¶ä¸ä¼šå½±å“å¤–éƒ¨å˜é‡çš„å€¼ã€‚</p>
<p>å€¼ä¼ é€’å˜é‡å¯¼è‡´é‡æ–°åˆ›å»ºä¸€ä¸ªå˜é‡</p>
<pre class="line-numbers"><code class="language-rust">fn double_price(mut price:i32){
    price=price*2;
    println!(&quot;å†…éƒ¨çš„priceæ˜¯{}&quot;,price)
}

fn main() {
    let mut price=99;
    double_price(price); //è¾“å‡º å†…éƒ¨çš„priceæ˜¯198
    println!(&quot;å¤–éƒ¨çš„priceæ˜¯{}&quot;,price); //è¾“å‡º å¤–éƒ¨çš„priceæ˜¯99
}
</code></pre>
<h3><a id="%E5%8F%82%E6%95%B0%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‚æ•°-å¼•ç”¨ä¼ é€’</h3>
<p>å¼•ç”¨ä¼ é€’æŠŠå½“å‰å˜é‡çš„å†…å­˜ä½ç½®ä¼ é€’ç»™å‡½æ•°ã€‚ä¼ é€’çš„å˜é‡å’Œå‡½æ•°å‚æ•°éƒ½å…±åŒæŒ‡å‘äº†åŒä¸€ä¸ªå†…å­˜ä½ç½®ã€‚å¼•ç”¨ä¼ é€’åœ¨å‚æ•°ç±»å‹çš„å‰é¢åŠ ä¸Š &amp; ç¬¦å·ã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn å‡½æ•°åç§°(å‚æ•°: &amp;æ•°æ®ç±»å‹) {
   // æ‰§è¡Œé€»è¾‘ä»£ç 
}

fn double_price2(price:&amp;mut i32){
    *price=*price*2;
    println!(&quot;å†…éƒ¨çš„priceæ˜¯{}&quot;,price)
}

fn main() {
    let mut price=88;
    double_price2(&amp;mut price); //è¾“å‡º å†…éƒ¨çš„priceæ˜¯176
    println!(&quot;å¤–éƒ¨çš„priceæ˜¯{}&quot;,price);//è¾“å‡º å¤–éƒ¨çš„priceæ˜¯176
}
</code></pre>
<h2><a id="%E5%85%83%E7%BB%84tuple" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å…ƒç»„ tuple</h2>
<p>Tuple å…ƒç»„æ˜¯ä¸€ä¸ª å¤åˆç±»å‹ ï¼Œå¯ä»¥å­˜å‚¨å¤šä¸ªä¸åŒç±»å‹çš„æ•°æ®ã€‚ Rust æ”¯æŒå…ƒç»„ tuple ç±»å‹ã€‚å…ƒç»„ä½¿ç”¨æ‹¬å· () æ¥æ„é€ ï¼ˆconstructï¼‰ã€‚å‡½æ•°å¯ä»¥ä½¿ç”¨å…ƒç»„æ¥è¿”å›å¤šä¸ªå€¼ï¼Œå› ä¸ºå…ƒç»„å¯ä»¥æ‹¥æœ‰ä»»æ„å¤šä¸ªå€¼ã€‚</p>
<p>å…ƒç»„ä¸€æ—¦å®šä¹‰ï¼Œå°±ä¸èƒ½å†å¢é•¿æˆ–ç¼©å°ï¼Œé•¿åº¦æ˜¯å›ºå®šçš„ã€‚å…ƒç»„çš„ä¸‹æ ‡ä» 0 å¼€å§‹ã€‚</p>
<h3><a id="%E5%AE%9A%E4%B9%89" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®šä¹‰</h3>
<pre class="line-numbers"><code class="language-rust">let tupleå˜é‡åç§°:(æ•°æ®ç±»å‹1,æ•°æ®ç±»å‹2,...) = (æ•°æ®1ï¼Œæ•°æ®2ï¼Œ...);
let tupleå˜é‡åç§° = (æ•°æ®1ï¼Œæ•°æ®2ï¼Œ...);
</code></pre>
<p>tuple ä½¿ç”¨ä¸€å¯¹å°æ‹¬å· () æŠŠæ‰€æœ‰å…ƒç´ æ”¾åœ¨ä¸€èµ·ï¼Œå…ƒç´ ä¹‹é—´ä½¿ç”¨é€—å· , åˆ†éš”ã€‚å¦‚æœæ˜¾å¼æŒ‡å®šäº†å…ƒç»„çš„æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆæ•°æ®ç±»å‹çš„ä¸ªæ•°å¿…é¡»å’Œå…ƒç»„çš„ä¸ªæ•°ç›¸åŒï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let t:(&amp;str,&amp;str) = (&quot;GO&quot;,&quot;rust&quot;);
    println!(&quot;{:?}&quot;,t);
    println!(&quot;{}&quot;,t.0);
    println!(&quot;{}&quot;,t.1);
    
    // è§£æ„ï¼Œå°†2ä¸ªå…ƒç´ çš„å…ƒç»„ï¼Œèµ‹å€¼ç»™ä¸¤ä¸ªå˜é‡
    let (go,rust) = t;
    println!(&quot;{}&quot;,go);
    println!(&quot;{}&quot;,rust)
}
</code></pre>
<h2><a id="%E7%BB%93%E6%9E%84%E4%BD%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç»“æ„ä½“</h2>
<h3><a id="%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E4%BD%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®šä¹‰ç»“æ„ä½“</h3>
<pre class="line-numbers"><code class="language-rust">struct ç»“æ„ä½“åç§° {
    å­—æ®µ1:æ•°æ®ç±»å‹,
    å­—æ®µ2:æ•°æ®ç±»å‹,
    ...
}
</code></pre>
<h3><a id="%E5%88%9B%E5%BB%BA%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9E%E4%BE%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>åˆ›å»ºç»“æ„ä½“å®ä¾‹</h3>
<pre class="line-numbers"><code class="language-rust">let å®ä¾‹åç§° = ç»“æ„ä½“åç§°{
    field1:value1,
    field2:value2
    ...
};

-------

#[derive(Debug)]
struct Study {
    name: String,
    target: String,
    spend: i32,
}

fn main() {
    let s = Study {
        name: String::from(&quot;GO&quot;),
        target: String::from(&quot;GOGOGO&quot;),
        spend: 3,
    };
    println!(&quot;{:?}&quot;, s);
    println!(&quot;{:?}&quot;, s.name);
}

</code></pre>
<h3><a id="%E7%BB%93%E6%9E%84%E4%BD%93%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°</h3>
<pre class="line-numbers"><code class="language-rust">fn show(s: Study) {
    println!(
        &quot;name is :{} target is {} spend is{}&quot;,
        s.name, s.target, s.spend
    );
}
</code></pre>
<h3><a id="%E7%BB%93%E6%9E%84%E4%BD%93%E4%BD%9C%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%80%BC" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç»“æ„ä½“ä½œä¸ºè¿”å›å€¼</h3>
<pre class="line-numbers"><code class="language-rust">fn get_instance(name: String, target: String, spend: i32) -&gt; Study {
    return Study {
        name,
        target,
        spend,
    };
}
</code></pre>
<h3><a id="%E6%96%B9%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ–¹æ³•</h3>
<p>æ–¹æ³•æ˜¯ä¾é™„äºå¯¹è±¡çš„å‡½æ•°ã€‚<br />
è¿™äº›æ–¹æ³•é€šè¿‡å…³é”®å­— self æ¥è®¿é—®å¯¹è±¡ä¸­çš„æ•°æ®å’Œå…¶ä»–ã€‚æ–¹æ³•åœ¨ impl ä»£ç å—ä¸­å®šä¹‰ã€‚</p>
<blockquote>
<p>ä¸å‡½æ•°çš„åŒºåˆ«<br />
å‡½æ•°ï¼šå¯ä»¥ç›´æ¥è°ƒç”¨ï¼ŒåŒä¸€ä¸ªç¨‹åºä¸èƒ½å‡ºç° 2 ä¸ªç›¸åŒçš„å‡½æ•°ç­¾åçš„å‡½æ•°ï¼Œåº”ä¸ºå‡½æ•°ä¸å½’å±ä»»ä½• ownerã€‚<br />
æ–¹æ³•ï¼šå½’å±æŸä¸€ä¸ª ownerï¼Œä¸åŒçš„ owner å¯ä»¥æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾åã€‚</p>
</blockquote>
<pre class="line-numbers"><code class="language-rust">impl ç»“æ„ä½“{
    fn æ–¹æ³•å(&amp;self,å‚æ•°åˆ—è¡¨) è¿”å›å€¼ {
        //æ–¹æ³•ä½“
    }
}
</code></pre>
<pre class="line-numbers"><code class="language-rust">struct User{
    name:String,
    age:u32
}

impl User{
    fn get_name(&amp;self) -&gt; String {
        return String::from(self.name.to_string())
    }
}

fn main() {
    let user = User{
        name:&quot;zhangsan&quot;.to_string(),
        age:1
    };
    println!(&quot;{}&quot;,user.get_name());
}
</code></pre>
<h3><a id="%E7%BB%93%E6%9E%84%E4%BD%93%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç»“æ„ä½“é™æ€æ–¹æ³•</h3>
<pre class="line-numbers"><code class="language-rust">fn æ–¹æ³•å(å‚æ•°: æ•°æ®ç±»å‹,...) -&gt; è¿”å›å€¼ç±»å‹ {
      // æ–¹æ³•ä½“
   }

è°ƒç”¨æ–¹å¼
ç»“æ„ä½“åç§°::æ–¹æ³•å(å‚æ•°åˆ—è¡¨)


impl Study {
    fn get_instance_another(name: String, target: String, spend: i32) -&gt; Study {
        return Study {
            name,
            target,
            spend,
        };
    }
}
fn main() {
    let s = Study::get_instance_another(&quot;GO&quot;.to_string(),&quot;GOGOGO&quot;.to_string(),3);
    println!(&quot;{:?}&quot;, s);
    println!(&quot;{:?}&quot;, s.name);
}
</code></pre>
<h2><a id="%E6%9E%9A%E4%B8%BE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æšä¸¾</h2>
<pre class="line-numbers"><code class="language-rust">enum æšä¸¾åç§°{
 variant1,
 variant2,
 ...
}

ä½¿ç”¨ï¼š
æšä¸¾åç§°::variant
</code></pre>
<h3><a id="option%E6%9E%9A%E4%B8%BE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optionæšä¸¾</h3>
<pre class="line-numbers"><code class="language-rust">enum Option&lt;T&gt; {
   Some(T),      // ç”¨äºè¿”å›ä¸€ä¸ªå€¼
   None          // ç”¨äºè¿”å› null,ç”¨Noneæ¥ä»£æ›¿ã€‚
}
</code></pre>
<p>Option æšä¸¾ç»å¸¸ç”¨åœ¨å‡½æ•°ä¸­çš„è¿”å›å€¼ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºæœ‰è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥ç”¨äºè¡¨ç¤ºæ²¡æœ‰è¿”å›å€¼ã€‚å¦‚æœæœ‰è¿”å›å€¼ã€‚å¯ä»¥ä½¿ç”¨è¿”å› Some(data)ï¼Œå¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥è¿”å› Noneã€‚</p>
<h2><a id="%E9%9B%86%E5%90%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é›†åˆ</h2>
<p>Rust è¯­è¨€æ ‡å‡†åº“æä¾›äº†é€šç”¨çš„æ•°æ®ç»“æ„çš„å®ç°ã€‚åŒ…æ‹¬ å‘é‡ ï¼ˆVectorï¼‰ã€å“ˆå¸Œè¡¨ï¼ˆ HashMap ï¼‰ã€å“ˆå¸Œé›†åˆï¼ˆ HashSet ï¼‰ ã€‚</p>
<h3><a id="vec" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vec</h3>
<p>Rust åœ¨æ ‡å‡†åº“ä¸­å®šä¹‰äº†ç»“æ„ä½“ Vec ç”¨äºè¡¨ç¤ºä¸€ä¸ªå‘é‡ã€‚å‘é‡å’Œæ•°ç»„å¾ˆç›¸ä¼¼ï¼Œåªæ˜¯æ•°ç»„é•¿åº¦æ˜¯ç¼–è¯‘æ—¶å°±ç¡®å®šäº†ï¼Œå®šä¹‰åå°±ä¸èƒ½æ”¹å˜äº†ï¼Œé‚£è¦ä¹ˆæ”¹æ•°ç»„ï¼Œè®©ä»–æ”¯æŒå¯å˜é•¿åº¦ï¼Œæ˜¾ç„¶ Rust æ²¡æœ‰è¿™ä¹ˆåšï¼Œå®ƒç”¨å‘é‡è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œä¹Ÿæ˜¯åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨å…ƒç´ ã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ol>
<li>å‘é‡ä¸­çš„å…ƒç´ éƒ½æ˜¯ç›¸åŒç±»å‹å…ƒç´ çš„é›†åˆã€‚</li>
<li>é•¿åº¦å¯å˜ï¼Œè¿è¡Œæ—¶å¯ä»¥å¢åŠ å’Œå‡å°‘ã€‚</li>
<li>ä½¿ç”¨ç´¢å¼•æŸ¥æ‰¾å…ƒç´ ã€‚ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰</li>
<li>æ·»åŠ å…ƒç´ æ—¶ï¼Œæ·»åŠ åˆ°å‘é‡å°¾éƒ¨ã€‚</li>
<li>å‘é‡çš„å†…å­˜åœ¨å †ä¸Šï¼Œé•¿åº¦å¯åŠ¨æ€å˜åŒ–ã€‚</li>
</ol>
<pre class="line-numbers"><code class="language-rust">let mut å‘é‡çš„å˜é‡åç§° = Vec::new();
// ä½¿ç”¨ vecå®ç®€åŒ–
let å‘é‡çš„å˜é‡åç§° = vec![val1,val2,...]
</code></pre>
<p>å¸¸ç”¨æ–¹æ³•</p>
<ol>
<li>new():åˆ›å»ºä¸€ä¸ªç©ºçš„å‘é‡å®ä¾‹</li>
<li>push():æ·»åŠ åˆ°å‘é‡æœ«å°¾</li>
<li>remove():åˆ é™¤å¹¶è¿”å›æŒ‡å®šçš„ä¸‹è¡¨å…ƒç´ </li>
<li>contains():åˆ¤æ–­å‘é‡ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå€¼</li>
<li>len():è¿”å›å‘é‡ä¸­å…ƒç´ ä¸ªæ•°</li>
</ol>
<h4><a id="vec%E5%A6%82%E4%BD%95%E9%81%8D%E5%8E%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>vec å¦‚ä½•éå†</h4>
<p>åœ¨ Rust ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨ï¼ˆiteratorï¼‰æ¥éå† <code>Vec</code> ç±»å‹çš„å‘é‡ã€‚è¿­ä»£å™¨æä¾›äº†ä¸€ç§ç®€æ´å’Œå®‰å…¨çš„æ–¹å¼æ¥éå†é›†åˆå…ƒç´ ã€‚</p>
<p>æœ‰å¤šç§æ–¹æ³•å¯ä»¥éå† <code>Vec</code> çš„å…ƒç´ ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªå¸¸ç”¨çš„ç¤ºä¾‹ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>for</code> å¾ªç¯ï¼š</li>
</ol>
<pre class="line-numbers"><code class="language-rust">let vec = vec![1, 2, 3, 4, 5];

for element in &amp;vec {
    println!(&quot;{}&quot;, element);
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>for</code> å¾ªç¯éå†äº† <code>vec</code> ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚</p>
<ol start="2">
<li>ä½¿ç”¨ <code>iter()</code> æ–¹æ³•å’Œ <code>for</code> å¾ªç¯ï¼š</li>
</ol>
<pre class="line-numbers"><code class="language-rust">let vec = vec![1, 2, 3, 4, 5];

for element in vec.iter() {
    println!(&quot;{}&quot;, element);
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬è°ƒç”¨ <code>iter()</code> æ–¹æ³•è·å–ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç„¶åä½¿ç”¨ <code>for</code> å¾ªç¯éå†è¿­ä»£å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚</p>
<ol start="3">
<li>ä½¿ç”¨ <code>iter_mut()</code> æ–¹æ³•å’Œ <code>for</code> å¾ªç¯ï¼ˆå¯å˜è¿­ä»£ï¼‰ï¼š</li>
</ol>
<pre class="line-numbers"><code class="language-rust">let mut vec = vec![1, 2, 3, 4, 5];

for element in vec.iter_mut() {
    *element *= 2; // ä¿®æ”¹å…ƒç´ çš„å€¼
}

println!(&quot;{:?}&quot;, vec); // æ‰“å°ä¿®æ”¹åçš„å‘é‡
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>iter_mut()</code> æ–¹æ³•è·å–ä¸€ä¸ªå¯å˜è¿­ä»£å™¨ï¼Œç„¶åä½¿ç”¨ <code>for</code> å¾ªç¯éå†å¯å˜è¿­ä»£å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚æˆ‘ä»¬åœ¨å¾ªç¯ä½“å†…ä¿®æ”¹äº†æ¯ä¸ªå…ƒç´ çš„å€¼ï¼Œå¹¶æ‰“å°å‡ºä¿®æ”¹åçš„å‘é‡ã€‚</p>
<pre class="line-numbers"><code class="language-rust">let vec = vec![10, 20, 30, 40, 50];

for (index, element) in vec.iter().enumerate() {
    println!(&quot;Index: {}, Element: {}&quot;, index, element);
}
</code></pre>
<p>è¿™äº›ç¤ºä¾‹å±•ç¤ºäº†å‡ ç§å¸¸ç”¨çš„éå† <code>Vec</code> çš„æ–¹æ³•ã€‚ä½ å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ–¹æ³•æ¥éå†å’Œæ“ä½œ <code>Vec</code> ä¸­çš„å…ƒç´ ã€‚</p>
<h3><a id="hashmap" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>HashMap</h3>
<pre class="line-numbers"><code class="language-rust">let mut å˜é‡åç§° = HashMap::new();


fn main() {
    let mut map = HashMap::new();
    map.insert(1,&quot;rust&quot;);
    map.insert(2,&quot;go&quot;);
    map.insert(3,&quot;java&quot;);

    println!(&quot;len = {}&quot;,map.len());

    let value = map.get(&amp;1);
    match value {
        Some(v) =&gt;{
            println!(&quot;{}&quot;,v)
        }
        None =&gt;{
            println!(&quot;none&quot;)
        }
    }

    let map2 = map.clone();
    for x in map2 {
        println!(&quot;{:?}&quot;,x)
    }

    for (k,v) in map.iter() {
        println!(&quot;k = {},v = {}&quot;,k,v);
    }
}
</code></pre>
<h3><a id="hashset" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>HashSet</h3>
<p>Hashset æ˜¯ç›¸åŒæ•°æ®ç±»å‹çš„é›†åˆï¼Œå®ƒæ˜¯æ²¡æœ‰é‡å¤å€¼çš„ã€‚å¦‚æœé›†åˆä¸­å·²ç»å­˜åœ¨ç›¸åŒçš„å€¼ï¼Œåˆ™ä¼šæ’å…¥å¤±è´¥ã€‚</p>
<pre class="line-numbers"><code class="language-rust">let mut å˜é‡åç§° = HashSet::new();

</code></pre>
<h3><a id="btreemap%E3%80%81linkedhashmap" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>BTreeMapã€LinkedHashMap</h3>
<p>HashMap æ˜¯ä¸€ä¸ªå“ˆå¸Œæ˜ å°„ï¼Œå®ƒä½¿ç”¨å“ˆå¸Œå‡½æ•°å¯¹é”®è¿›è¡Œç´¢å¼•ï¼Œå› æ­¤å®ƒä¸ä¼šæŒ‰ç…§æ’å…¥é¡ºåºä¿å­˜å…ƒç´ ã€‚</p>
<h2><a id="%E6%B3%9B%E5%9E%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ³›å‹</h2>
<p>Rust è¯­è¨€ä¸­çš„æ³›å‹ä¸»è¦åŒ…å« æ³›å‹é›†åˆã€æ³›å‹ç»“æ„ä½“ã€æ³›å‹å‡½æ•°ã€èŒƒå‹æšä¸¾ å’Œ ç‰¹è´¨ ã€‚</p>
<p>Rust ä½¿ç”¨ä½¿ç”¨ <T> è¯­æ³•æ¥å®ç°æ³›å‹, å…¶ä¸­ T å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ã€‚</p>
<pre class="line-numbers"><code class="language-rust">struct ç»“æ„ä½“åç§°&lt;T&gt; {
   å…ƒç´ :T,
}


struct Data&lt;T&gt; {
   value:T,
}

fn main() {
    let t:Data&lt;i32&gt; = Data{value:100};
    println!(&quot;å€¼:{} &quot;,t.value);//è¾“å‡º å€¼:100
    let t:Data&lt;f64&gt; = Data{value:66.00};
    println!(&quot;å€¼:{} &quot;,t.value);//è¾“å‡º å€¼:66
    let t:Data&lt;String&gt; = Data{value:&quot;123&quot;.to_string()};
    println!(&quot;å€¼:{} &quot;,t.value);//è¾“å‡º å€¼ 123
}
</code></pre>
<h2><a id="trait" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Trait</h2>
<p>å¯ä»¥æŠŠè¿™ä¸ªç‰¹è´¨ï¼ˆtraitsï¼‰å¯¹æ ‡å…¶ä»–è¯­è¨€çš„æ¥å£ï¼Œéƒ½æ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡ã€‚ä½¿ç”¨ traitå…³é”®å­—ç”¨æ¥å®šä¹‰ã€‚ç‰¹è´¨ï¼Œå¯ä»¥åŒ…å«å…·ä½“çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åŒ…å«æŠ½è±¡çš„æ–¹æ³•ã€‚</p>
<pre class="line-numbers"><code class="language-rust">trait some_trait {
   // æ²¡æœ‰ä»»ä½•å®ç°çš„è™šæ–¹æ³•
   fn method1(&amp;self);

   // æœ‰å…·ä½“å®ç°çš„æ™®é€šæ–¹æ³•
   fn method2(&amp;self){
      //æ–¹æ³•çš„å…·ä½“ä»£ç 
   }
}
</code></pre>
<p>å®ç°ç‰¹è´¨  demo</p>
<pre class="line-numbers"><code class="language-rust">struct Book {
    name: String,
    id: u32,
    author: String,
}

trait ShowBook {
    fn Show(&amp;self);
}

impl ShowBook for Book{
    fn Show(&amp;self) {
        println!(&quot;Id:{},Name:{},Author:{}&quot;,self.id,self.name,self.author);
    }
}

fn main() {
    let book = Book{
        id:1,
        name: String::from(&quot;GO&quot;),
        author: String::from(&quot;xx&quot;)
    };
    book.Show();
}
</code></pre>
<p>æ³›å‹å‡½æ•°</p>
<pre class="line-numbers"><code class="language-rust">fn æ–¹æ³•å&lt;T[:ç‰¹è´¨åç§°]&gt;(å‚æ•°1:T, ...) {

   // å‡½æ•°å®ç°ä»£ç 
}


fn show2&lt;T:Display&gt;(t:T){
    println!(&quot;{}&quot;,t);
}
impl Display for Book{
    fn fmt(&amp;self, f: &amp;mut Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        println!(&quot;Id:{},Name:{},Author:{}&quot;,self.id,self.name,self.author);
        let r=Result::Ok(());
        return r;
    }
}

show2(book);
</code></pre>
<h2><a id="%E8%BF%AD%E4%BB%A3%E5%99%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è¿­ä»£å™¨</h2>
<p>è¿­ä»£å™¨ å°±æ˜¯æŠŠé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æŒ‰ç…§é¡ºåºä¸€ä¸ªæ¥ä¸€ä¸ªçš„ä¼ é€’ç»™å¤„ç†é€»è¾‘ã€‚</p>
<p>Iterator ç‰¹è´¨æœ‰ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<ol>
<li>ä¸€ä¸ªæ˜¯ iter()ï¼Œç”¨äºè¿”å›ä¸€ä¸ª è¿­ä»£å™¨ å¯¹è±¡ï¼Œä¹Ÿç§°ä¹‹ä¸º é¡¹ ( items ) ã€‚</li>
<li>ä¸€ä¸ªæ˜¯ next()ï¼Œç”¨äºè¿”å›è¿­ä»£å™¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœå·²ç»è¿­ä»£åˆ°é›†åˆçš„æœ«å°¾ï¼ˆæœ€åä¸€ä¸ªé¡¹åé¢ï¼‰åˆ™è¿”å› Noneã€‚</li>
</ol>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let array = vec![
        &quot;1&quot;,
        &quot;2&quot;,
        &quot;3&quot;,
    ];
    let mut iter = array.iter();
    println!(&quot;{:?}&quot;,iter.next());
    println!(&quot;{:?}&quot;,iter.next());
    println!(&quot;{:?}&quot;,iter.next());

    for x in array {
        println!(&quot;{:?}&quot;,x)
    }
}
</code></pre>
<h2><a id="%E9%97%AD%E5%8C%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é—­åŒ…</h2>
<p>Rust ä¸­çš„é—­åŒ…ï¼ˆclosureï¼‰ï¼Œä¹Ÿå«åš lambda è¡¨è¾¾å¼æˆ–è€… lambdaï¼Œæ˜¯ä¸€ç±»èƒ½å¤Ÿæ•è·å‘¨å›´ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°ã€‚</p>
<p>è°ƒç”¨ä¸€ä¸ªé—­åŒ…å’Œè°ƒç”¨ä¸€ä¸ªå‡½æ•°å®Œå…¨ç›¸åŒï¼Œä¸è¿‡è°ƒç”¨é—­åŒ…æ—¶ï¼Œè¾“å…¥å’Œè¿”å›ç±»å‹ä¸¤è€…éƒ½å¯ä»¥è‡ªåŠ¨æ¨å¯¼ï¼Œè€Œè¾“å…¥å˜é‡åå¿…é¡»æŒ‡æ˜ã€‚</p>
<p>å…¶ä»–çš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>å£°æ˜æ—¶ä½¿ç”¨ || æ›¿ä»£ () å°†è¾“å…¥å‚æ•°æ‹¬èµ·æ¥ã€‚</li>
<li>å‡½æ•°ä½“å®šç•Œç¬¦ï¼ˆ{}ï¼‰å¯¹äºå•ä¸ªè¡¨è¾¾å¼æ˜¯å¯é€‰çš„ï¼Œå…¶ä»–æƒ…å†µå¿…é¡»åŠ ä¸Šã€‚</li>
<li>æœ‰èƒ½åŠ›æ•è·å¤–éƒ¨ç¯å¢ƒçš„å˜é‡ã€‚</li>
</ol>
<pre class="line-numbers"><code class="language-rust">æ™®é€šå‡½æ•°
fn å‡½æ•°å(å‚æ•°åˆ—è¡¨) -&gt; è¿”å›å€¼ {
   // ä¸šåŠ¡é€»è¾‘
}

// é—­åŒ…
|å‚æ•°åˆ—è¡¨| {
	// ä¸šåŠ¡é€»è¾‘
}
// æ— å‚æ•°é—­åŒ…
|| {
	// ä¸šåŠ¡é€»è¾‘
}

let é—­åŒ…å˜é‡ = |å‚æ•°åˆ—è¡¨| {
   // é—­åŒ…çš„å…·ä½“é€»è¾‘
}

</code></pre>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let double = |x| { x * 2 };

    let add = |a, b| { a + b };
    
    let x = add(2, 4);
    println!(&quot;{:?}&quot;, x);

    let y = double(5);
    println!(&quot;{:?}&quot;, y);

    let v = 3;
    let add2 = |x| { v + x };
    println!(&quot;{:?}&quot;, add2(4));
    
    let r = (|x| x + 1)(3); // 3 æ˜¯å‚æ•°ï¼Œç»“æœræ˜¯4
}
</code></pre>
<p>é—­åŒ…å°±æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°å†…åˆ›å»ºç«‹å³è°ƒç”¨çš„å¦ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>é—­åŒ…æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚</p>
<p>é—­åŒ…è™½ç„¶æ²¡æœ‰å‡½æ•°åï¼Œä½†å¯ä»¥æŠŠæ•´ä¸ªé—­åŒ…èµ‹å€¼ä¸€ä¸ªå˜é‡ï¼Œé€šè¿‡è°ƒç”¨è¯¥å˜é‡æ¥å®Œæˆé—­åŒ…çš„è°ƒç”¨ã€‚</p>
<p>é—­åŒ…ä¸ç”¨å£°æ˜è¿”å›å€¼ï¼Œä½†å®ƒå´å¯ä»¥æœ‰è¿”å›å€¼ã€‚å¹¶ä¸”ä½¿ç”¨æœ€åä¸€æ¡è¯­å¥çš„æ‰§è¡Œç»“æœä½œä¸ºè¿”å›å€¼ã€‚é—­åŒ…çš„è¿”å›å€¼å¯ä»¥èµ‹å€¼ç»™å˜é‡ã€‚</p>
<p>é—­åŒ…åˆç§°ä¹‹ä¸º å†…è”å‡½æ•°ã€‚å¯ä»¥è®©é—­åŒ…è®¿é—®å¤–å±‚å‡½æ•°é‡Œçš„å˜é‡ã€‚</p>
<h2><a id="%E9%97%AD%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é—­åŒ…çš„ä½¿ç”¨</h2>
<p><a href="https://www.go-edu.cn/2022/07/05/rust-39-%E9%97%AD%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/">https://www.go-edu.cn/2022/07/05/rust-39-%E9%97%AD%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/</a></p>
<pre class="line-numbers"><code class="language-rust">let add = |x, y| x + y;
let result = add(3, 4);
println!(&quot;{}&quot;, result);

------------
é—­åŒ…åƒæ™®é€šå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ã€‚
fn receives_closure&lt;F&gt;(closure: F)
    where
        F: Fn(i32, i32) -&gt; i32,
{
    let result = closure(3, 5);
    println!(&quot;é—­åŒ…ä½œä¸ºå‚æ•°æ‰§è¡Œç»“æœ =&gt; {}&quot;, result);
}

fn main() {
    let add = |x, y| x + y;
    receives_closure(add);
}

è¾“å‡º:
é—­åŒ…ä½œä¸ºå‚æ•°æ‰§è¡Œç»“æœ =&gt; 8


------------
é—­åŒ…æ•è·å˜é‡
fn receives_closure2&lt;F&gt;(closure:F)
    where
        F:Fn(i32)-&gt;i32{
    let result = closure(1);
    println!(&quot;closure(1) =&gt; {}&quot;, result);
}

fn main() {
    let y = 2;
    receives_closure2(|x| x + y);

    let y = 3;
    receives_closure2(|x| x + y);
}
è¾“å‡º:
æ•è·å˜é‡çš„ç»“æœ =&gt; 3
æ•è·å˜é‡çš„ç»“æœ =&gt; 4




-------
è¿”å›é—­åŒ…
fn returns_closure() -&gt; impl Fn(i32) -&gt; i32 {
    |x| x + 6
}

fn main() {
    let closure = returns_closure();
    println!(&quot;è¿”å›é—­åŒ… =&gt; {}&quot;, closure(1));
}
è¾“å‡º:
è¿”å›é—­åŒ… =&gt; 7



------
å‚æ•°å’Œè¿”å›å€¼éƒ½æœ‰é—­åŒ…

</code></pre>
<h2><a id="%E7%BA%BF%E7%A8%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>çº¿ç¨‹</h2>
<pre class="line-numbers"><code class="language-rust">åˆ›å»ºçº¿ç¨‹
std::thread::spawn()

//spawn() å‡½æ•°çš„åŸå‹
pub fn spawn&lt;F, T&gt;(f: F) -&gt; JoinHandle&lt;T&gt;
</code></pre>
<pre class="line-numbers"><code class="language-rust">fn main() {
    //å­çº¿ç¨‹
    thread::spawn(|| {
        for i in 1..10 {
            println!(&quot;å­çº¿ç¨‹ {}&quot;, i);
            thread::sleep(Duration::from_millis(1));
        }
    });
    // ä¸»çº¿ç¨‹
    for i in 1..5 {
        println!(&quot;ä¸»çº¿ç¨‹ {}&quot;, i);
        thread::sleep(Duration::from_millis(1));
    }
}

|| æ˜¯é—­åŒ…ï¼ŒåŒ¿åå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤–éƒ¨å‡½æ•°

fn a(){
    for i in 1..10 {
        println!(&quot;å­çº¿ç¨‹ {}&quot;, i);
        thread::sleep(Duration::from_millis(1));
    }
}

fn main() {

    thread::spawn(a);
    // ä¸»çº¿ç¨‹
    for i in 1..5 {
        println!(&quot;ä¸»çº¿ç¨‹ {}&quot;, i);
        thread::sleep(Duration::from_millis(1));
    }
}
</code></pre>
<h3><a id="join" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>join</h3>
<p>ä¸Šé¢çš„ä¾‹å­ä¸»çº¿ç¨‹ç»“æŸåï¼Œå­çº¿ç¨‹è¿˜æ²¡æœ‰è¿è¡Œå®Œï¼Œä½†æ˜¯å­çº¿ç¨‹ä¹Ÿç»“æŸäº†ã€‚å¦‚æœæƒ³è®©å­çº¿ç¨‹ç»“æŸåï¼Œä¸»çº¿ç¨‹å†ç»“æŸï¼Œæˆ‘ä»¬å°±è¦ä½¿ç”¨Join æ–¹æ³•ï¼ŒæŠŠå­çº¿ç¨‹åŠ å…¥ä¸»çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn a(){
    for i in 1..10 {
        println!(&quot;å­çº¿ç¨‹ {}&quot;, i);
        thread::sleep(Duration::from_millis(1));
    }
}

fn main() {

   let handler = thread::spawn(a);
    // ä¸»çº¿ç¨‹
    for i in 1..5 {
        println!(&quot;ä¸»çº¿ç¨‹ {}&quot;, i);
        thread::sleep(Duration::from_millis(1));
    }
    handler.join().unwrap();

}
</code></pre>
<h2><a id="%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é”™è¯¯å¤„ç†</h2>
<h3><a id="panic%E4%B8%8D%E5%8F%AF%E6%81%A2%E5%A4%8D%E9%94%99%E8%AF%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>panic!() ä¸å¯æ¢å¤é”™è¯¯</h3>
<p>panic!() ç¨‹åºç«‹å³é€€å‡ºï¼Œé€€å‡ºæ—¶è°ƒç”¨è€…æŠ›å‡ºé€€å‡ºåŸå› ã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn main() {
    panic!(&quot;å‡ºé”™å•¦&quot;);
    println!(&quot;Hello Rust&quot;); // ä¸å¯èƒ½æ‰§è¡Œçš„è¯­å¥
}
//è¾“å‡º
thread 'main' panicked at 'å‡ºé”™å•¦', src/main.rs:2:5

</code></pre>
<h3><a id="result%E6%9E%9A%E4%B8%BE%E5%92%8C%E5%8F%AF%E6%81%A2%E5%A4%8D%E9%94%99%E8%AF%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Result æšä¸¾å’Œå¯æ¢å¤é”™è¯¯</h3>
<p>æšä¸¾çš„å®šä¹‰</p>
<pre class="line-numbers"><code class="language-rust">enum Result&lt;T,E&gt; {
   OK(T),
   Err(E)
}
OK(T) T OK æ—¶ä½œä¸ºæ­£å¸¸è¿”å›çš„å€¼çš„æ•°æ®ç±»å‹ã€‚
Err(E) E Err æ—¶ä½œä¸ºé”™è¯¯è¿”å›çš„é”™è¯¯çš„ç±»å‹ã€‚
</code></pre>
<h3><a id="unwrap%E5%92%8C-expect" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>unwrap() å’Œ expect()</h3>
<p>unwrapæ˜¯ Result&lt;T, E&gt;çš„æ–¹æ³•ï¼Œåœ¨å®ä¾‹ä¸Šè°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œå¦‚æœæ˜¯ Ok æšä¸¾å€¼ï¼Œå°±ä¼šè¿”å› Ok ä¸­çš„å¯¹è±¡ï¼Œå¦‚æœæ˜¯ Err æšä¸¾å€¼ï¼Œåœ¨è¿è¡Œæ—¶ä¼š panicï¼ŒæŠ¥é”™ä¿¡æ¯æ˜¯ format!(â€œ{}â€, error)ã€‚å…¶ç¼ºç‚¹æ˜¯ï¼Œå¦‚æœåœ¨ä¸åŒåœ°æ–¹éƒ½ä½¿ç”¨ unwrapï¼Œè¿è¡Œæ—¶å‡ºç° panic çš„æ—¶å€™ã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn is_even(no:i32)-&gt;Result&lt;bool,String&gt; {
    return if no % 2 == 0 {
        Ok(true)
    } else {
        Err(&quot;è¾“å…¥å€¼ï¼Œä¸æ˜¯å¶æ•°&quot;.to_string())
    }
}

let result = is_even(6).unwrap();
println!(&quot;ç»“æœ {}&quot;,result);
//è¾“å‡º ç»“æœ true

let result = is_even(11).unwrap();
println!(&quot;ç»“æœ {}&quot;,result);
//è¾“å‡º thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: &quot;è¾“å…¥å€¼ï¼Œä¸æ˜¯å¶æ•°&quot;'
</code></pre>
<p>expectæ–¹æ³•çš„ä½œç”¨å’Œunwrapç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼Œexpectæ–¹æ³•æ¥å—msg: &amp;strä½œä¸ºå‚æ•°ï¼Œå®ƒåœ¨è¿è¡Œæ—¶çš„panicä¿¡æ¯ä¸ºformat!(&quot;{}: {}&quot;, msg, error)ï¼Œä½¿ç”¨expectæ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰æŠ¥é”™ä¿¡æ¯ï¼Œå› æ­¤å‡ºç°panicæ—¶æ¯”è¾ƒå®¹æ˜“å®šä½ã€‚</p>
<pre class="line-numbers"><code class="language-rust">let f = File::open(&quot;abc.txt&quot;).expect(&quot;æ— æ³•æ‰“å¼€è¯¥æ–‡ä»¶&quot;); // æ–‡ä»¶ä¸å­˜åœ¨
//è¾“å‡º thread 'main' panicked at 'æ— æ³•æ‰“å¼€è¯¥æ–‡ä»¶: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }'
</code></pre>
<h2><a id="%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ™ºèƒ½æŒ‡é’ˆ</h2>
<p>æŒ‡é’ˆï¼ŒæŒ‡ä»£é‚£äº›åŒ…å«å†…å­˜åœ°å€çš„å˜é‡ã€‚è¿™ä¸ªåœ°å€è¢«ç”¨äºç´¢å¼•ï¼Œæˆ–è€…è¯´ç”¨äºæŒ‡å‘å†…å­˜ä¸­çš„å…¶ä»–æ•°æ®ã€‚<br />
rust ä¸­æœ€å¸¸ç”¨çš„æŒ‡é’ˆå°±æ˜¯ å¼•ç”¨ã€‚</p>
<p>è€Œæ™ºèƒ½æŒ‡é’ˆåˆ™æ˜¯ä¸€äº›æ•°æ®ç»“æ„ï¼Œä»–ä»¬çš„è¡Œä¸ºç±»ä¼¼äºæŒ‡é’ˆä½†æ‹¥æœ‰é¢å¤–çš„å…ƒæ•°æ®å’Œé™„åŠ åŠŸèƒ½ã€‚<br />
å¼•ç”¨æ˜¯åªå€Ÿç”¨æ•°æ®çš„æŒ‡é’ˆï¼Œè€Œå¤§å¤šæ•°æ™ºèƒ½æŒ‡é’ˆæœ¬èº«å°±æ‹¥æœ‰å®ƒä»¬æŒ‡å‘çš„æ•°æ®ã€‚</p>
<p><code>String</code> å’Œ <code>Vec&lt;T&gt;</code> ä¹Ÿæ˜¯æ™ºèƒ½æŒ‡é’ˆã€‚å› ä¸ºä»–ä»¬æ‹¥æœ‰ä¸€ç‰‡å†…å­˜åŒºåŸŸå¹¶å…è®¸ç”¨æˆ·å¯¹å…¶è¿›è¡Œæ“ä½œã€‚ä»–ä»¬è¿˜æ‹¥æœ‰å…ƒæ•°æ®ï¼Œä¾‹å¦‚å®¹é‡ï¼Œå¹¶æä¾›é¢å¤–çš„åŠŸèƒ½æˆ–ä¿éšœã€‚</p>
<p>ä¸€èˆ¬ç”¨ç»“æ„ä½“å®ç°æ™ºèƒ½æŒ‡é’ˆï¼Œé€šå¸¸ä¼šå®ç° Deref å’Œ Drop è¿™ä¸¤ä¸ª traitã€‚<br />
Deref ä½¿å¾—æ™ºèƒ½æŒ‡é’ˆç»“æ„ä½“çš„å®ä¾‹æ‹¥æœ‰ä¸å¼•ç”¨ä¸€è‡´çš„è¡Œä¸ºï¼Œå¯ä»¥ç¼–å†™å‡ºèƒ½å¤ŸåŒæ—¶ç”¨äºå¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„ä»£ç </p>
<p>Drop å¯ä»¥è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆç¦»å¼€ä½œç”¨åŸŸæ—¶è¿è¡Œçš„ä»£ç ã€‚</p>
<p>å¸¸è§çš„æ™ºèƒ½æŒ‡é’ˆï¼š</p>
<ul>
<li><code>Box&lt;T&gt;</code>:å¯ç”¨äºåœ¨å †ä¸Šåˆ†é…å€¼ã€‚</li>
<li><code>Rc&lt;T&gt;</code>:å…è®¸å¤šé‡æ‰€æœ‰æƒçš„å¼•ç”¨è®¡æ•°ç±»å‹ã€‚</li>
<li><code>Ref&lt;T&gt;</code>å’Œ <code>RefMut&lt;T&gt;</code>ï¼šå¯ä»¥é€šè¿‡ <code>RefCell&lt;T&gt;</code> è®¿é—®ï¼Œæ˜¯ä¸€ç§å¯ä»¥åœ¨è¿è¡Œæ—¶è€Œä¸æ˜¯ç¼–è¯‘æ—¶æ‰§è¡Œå€Ÿç”¨è§„åˆ™çš„ç±»å‹ã€‚</li>
</ul>
<p>å†…éƒ¨å¯å˜æ€§æ¨¡å¼ï¼Œä½¿ç”¨äº†è¿™ä¸€æ¨¡å¼çš„ä¸å¯å˜ç±»å‹ä¼šæš´éœ²å‡ºèƒ½å¤Ÿæ”¹å˜è‡ªå·±å†…éƒ¨å€¼çš„ APIã€‚</p>
<h3><a id="%E4%BD%BF%E7%94%A8box-t%E5%9C%A8%E5%A0%86%E4%B8%8A%E5%88%86%E9%85%8D%E6%95%B0%E6%8D%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä½¿ç”¨ Box<T> åœ¨å †ä¸Šåˆ†é…æ•°æ®</h3>
<p><code>Box&lt;T&gt;</code> è£…ç®±ï¼Œæ˜¯æœ€ç®€å•ç›´æ¥çš„ä¸€ç§æ™ºèƒ½æŒ‡é’ˆã€‚å°†æ•°æ®ä¿å­˜åœ¨å †ä¸Šï¼Œå¹¶åœ¨æ ˆä¸­ä¿ç•™ä¸€ä¸ªæŒ‡å‘å †æ•°æ®çš„æŒ‡é’ˆã€‚<br />
è£…ç®±ä½¿ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>å½“æ‹¥æœ‰ä¸€ä¸ªæ— æ³•ç¼–è¯‘æ—¶ç¡®å®šå¤§å°çš„ç±»å‹ï¼Œä½†åˆæƒ³åœ¨ä¸€ä¸ªè¦æ±‚å›ºå®šå°ºå¯¸çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ä½¿ç”¨è¿™ä¸ªç±»å‹çš„å€¼æ—¶</li>
<li>å½“å¸Œæœ›æ‹¥æœ‰ä¸€ä¸ªå®ç°äº†æŒ‡å®š trait çš„ç±»å‹å€¼ï¼Œä½†åˆä¸å…³å¿ƒå…·ä½“çš„ç±»å‹æ—¶</li>
</ol>
<h3><a id="%E9%80%9A%E8%BF%87deref-trait%E5%B0%86%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E8%A7%86%E4%BD%9C%E5%B8%B8%E8%A7%84%E5%BC%95%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é€šè¿‡ Deref trait å°†æ™ºèƒ½æŒ‡é’ˆè§†ä½œå¸¸è§„å¼•ç”¨</h3>
<p>å®ç°è¿™ä¸ª trait å¯ä»¥è‡ªå®šä¹‰è§£å¼•ç”¨è¿ç®—ç¬¦çš„è¡Œä¸º</p>
<pre class="line-numbers"><code class="language-rust">use std::ops::Deref;

/// å®šä¹‰ä¸€ä¸ª åä¸º MyBox çš„ç»“æ„ä½“ã€‚ç»“æ„ä½“çš„å®šä¹‰ä¸­é™„å¸¦äº†æ³›å‹å‚æ•° Tï¼Œå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å€¼ã€‚
/// MyBox æ˜¯ä¸€ä¸ªæ‹¥æœ‰ T ç±»å‹å•å…ƒç´ çš„å…ƒç»„ç»“æ„ä½“ã€‚
struct MyBox&lt;T&gt;(T);

impl&lt;T&gt; MyBox&lt;T&gt; {
    fn new(x: T) -&gt; MyBox&lt;T&gt; {
        MyBox(x)
    }
}

impl&lt;T&gt; Deref for MyBox&lt;T&gt; {
    // å®šä¹‰äº† Deref trait çš„ä¸€ä¸ªå…³è”ç±»å‹ã€
    // å…³è”ç±»å‹æ˜¯ä¸€ç§ç¨å¾®æœ‰äº›ä¸åŒçš„æ³›å‹å‚æ•°å®šä¹‰æ–¹å¼ã€‚
    type Target = T;

    // è¿”å›ä¸€ä¸ªæŒ‡å‘å€¼çš„å¼•ç”¨ã€‚è¿›è€Œå…è®¸é€šè¿‡ * è®¿é—®ã€‚
    // * -&gt; *(y.deref())
    fn deref(&amp;self) -&gt; &amp;Self::Target {
        &amp;self.0
    }
}

fn main() {
    let x = 5;
    let y = MyBox::new(x);

    assert_eq!(5, x);
    assert_eq!(5, *y);
}
</code></pre>
<p>Rust è¯­è¨€æŠŠæŒ‡é’ˆå°è£…åœ¨å¦‚ä¸‹ä¸¤ä¸ªç‰¹è´¨Traitä¸­ã€‚<br />
Deref	std::ops::Deref	ç”¨äºåˆ›å»ºä¸€ä¸ªåªè¯»æ™ºèƒ½æŒ‡é’ˆï¼Œä¾‹å¦‚ *v<br />
Drop	std::ops::Drop	æ™ºèƒ½æŒ‡é’ˆè¶…å‡ºå®ƒçš„ä½œç”¨åŸŸèŒƒå›´æ—¶ä¼šå›è°ƒè¯¥ç‰¹è´¨çš„ drop() æ–¹æ³•ã€‚ ç±»ä¼¼äºå…¶å®ƒè¯­è¨€çš„ ææ„å‡½æ•°ã€‚</p>
<p>å½“ä¸€ä¸ªç»“æ„ä½“å®ç°äº†ä»¥ä¸Šçš„æ¥å£åï¼Œå®ƒä»¬å°±æ˜¯æ™ºèƒ½æŒ‡é’ˆã€‚</p>
<p>Rust æä¾›äº†åœ¨ å † ä¸Šå­˜å‚¨æ•°æ®çš„èƒ½åŠ›å¹¶æŠŠè¿™ä¸ªèƒ½åŠ›å°è£…åˆ°äº† Box ä¸­ã€‚</p>
<p>è¿™ç§æŠŠ æ ˆ ä¸Šæ•°æ®æ¬åˆ° å † ä¸Šçš„èƒ½åŠ›ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º è£…ç®±ã€‚<br />
Box æŒ‡é’ˆå¯ä»¥æŠŠæ•°æ®å­˜å‚¨åœ¨å †ï¼ˆheapï¼‰ä¸Šï¼Œè€Œä¸æ˜¯æ ˆï¼ˆstackï¼‰ä¸Šã€‚è¿™å°±æ˜¯è£…ç®±ï¼ˆboxï¼‰ï¼Œæ ˆï¼ˆstackï¼‰è¿˜æ˜¯åŒ…å«æŒ‡å‘ å †ï¼ˆheapï¼‰ ä¸Šæ•°æ®çš„æŒ‡é’ˆã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let a = 6;           // é»˜è®¤ä¿å­˜åœ¨ æ ˆ ä¸Š
    let b = Box::new(a); // ä½¿ç”¨ Box åæ•°æ®ä¼šå­˜å‚¨åœ¨å †ä¸Š
    println!(&quot;b = {}&quot;, b);// è¾“å‡º b = 6
}
</code></pre>
<h2><a id="rc-t%E5%9F%BA%E4%BA%8E%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%9A%84%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rc<T> åŸºäºå¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆ</h2>
<p>æŸäº›åœºæ™¯ä¸‹ï¼Œå•ä¸ªå€¼å¯èƒ½åŒæ—¶è¢«å¤šä¸ªæ‰€æœ‰è€…æŒæœ‰ï¼ŒRust æä¾›äº†ä¸€ä¸ªåä¸º <code>Rc&lt;T&gt;</code>çš„ç±»å‹æ¥æ”¯æŒå¤šé‡æ‰€æœ‰æƒï¼ŒRC æ˜¯ Reference counting ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰çš„ç¼©å†™ã€‚<br />
<code>Rc&lt;T&gt;</code> ç±»å‹çš„å®ä¾‹ä¼šåœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªç”¨äºè®°å½•å€¼å¼•ç”¨æ¬¡æ•°çš„è®¡æ•°å™¨ï¼Œä»è€Œç¡®å®šè¿™ä¸ªå€¼æ˜¯å¦ä»åœ¨ä½¿ç”¨ã€‚</p>
<p>å°†å †ä¸Šçš„ä¸€äº›æ•°æ®åˆ†äº«ç»™ç¨‹åºçš„é”å“¥éƒ¨åˆ†åŒæ—¶ä½¿ç”¨ï¼Œè€Œåˆæ— æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šå“ªä¸ªéƒ¨åˆ†ä¼šæœ€åé‡Šæ”¾è¿™äº›æ•°æ®æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>Rc&lt;T&gt;</code> ç±»å‹ã€Rc ä»…é€‚ç”¨äºå•çº¿ç¨‹åœºæ™¯ã€‚</p>
<p>clone Rc ä¼šå¢åŠ å¼•ç”¨è®¡æ•°</p>
<h2><a id="refcell-t%E4%BD%BF%E7%94%A8%E4%BA%86%E5%86%85%E9%83%A8%E5%8F%AF%E5%8F%98%E6%80%A7%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%B1%BB%E5%9E%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>RefCell<T>: ä½¿ç”¨äº†å†…éƒ¨å¯å˜æ€§æ¨¡å¼çš„ç±»å‹</h2>
<p>RefCell ä»£è¡¨äº†å…¶æŒæœ‰æ•°æ®çš„å”¯ä¸€æ‰€æœ‰æƒã€‚</p>
<p>å†…éƒ¨å¯å˜æ€§ï¼Œæ˜¯ Rust çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒå…è®¸ä½ åœ¨åªæŒæœ‰ä¸å¯å˜å¼•ç”¨çš„å‰æä¸‹å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼›é€šå¸¸è€Œè¨€ï¼Œç±»ä¼¼çš„è¡Œä¸ºä¼šè¢«å€Ÿç”¨è§„åˆ™æ‰€ç¦æ­¢ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿæ”¹å˜æ•°æ®ï¼Œå†…éƒ¨å¯å˜æ€§æ¨¡å¼åœ¨å®ƒçš„æ•°æ®ç»“æ„ä¸­ä½¿ç”¨äº† unsafe ä»£ç æ¥ç»•è¿‡ Rust æ­£å¸¸çš„å¯å˜æ€§å’Œå€Ÿç”¨è§„åˆ™ã€‚</p>
<h2><a id="refcell%E5%92%8C-box%E7%9A%84%E5%8C%BA%E5%88%AB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>RefCell å’Œ Box çš„åŒºåˆ«</h2>
<p>å€Ÿç”¨è§„åˆ™ï¼š</p>
<ol>
<li>åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´é‡Œï¼Œä½ è¦ä¹ˆåªèƒ½æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆåªèƒ½æ‹¥æœ‰ä»»æ„æ•°é‡çš„ä¸å¯å˜å¼•ç”¨</li>
<li>å¼•ç”¨æ€»æ˜¯æœ‰æ•ˆçš„ã€‚</li>
</ol>
<p>Box ä¼šéµå¾ªè¿™ä¸ªå€Ÿç”¨è§„åˆ™ï¼Œåœ¨ä½¿ç”¨ RefCell æ—¶ï¼ŒRust åªä¼šåœ¨è¿è¡Œæ—¶æ£€æŸ¥è¿™äº›è§„åˆ™ï¼Œå¹¶åœ¨å‡ºç°è¿åå€Ÿç”¨è§„åˆ™çš„æƒ…å†µä¸‹ panic</p>
<h2><a id="%E5%8C%85%E7%AE%A1%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>åŒ…ç®¡ç†</h2>
<p><a href="https://blog.hitol.top/16727524082529.html">https://blog.hitol.top/16727524082529.html</a></p>
<h2><a id="%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å•å…ƒæµ‹è¯•</h2>
<pre class="line-numbers"><code class="language-rust">#[test]
fn it_works(){
    let result = 2 + 2;
    assert_eq!(result,4);
}
</code></pre>
<h2><a id="%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é›†æˆæµ‹è¯•</h2>
<p>cargo åœ¨ä¸ src åŒçº§åˆ«çš„ tests ç›®å½•å¯»æ‰¾é›†æˆæµ‹è¯•ã€‚</p>
<p>tests/xxx.rs</p>
<pre class="line-numbers"><code class="language-rust">#[test]
fn it_works(){
    let result = 2 + 2;
    assert_eq!(result,4);
}
</code></pre>
<p>tests ç›®å½•ä¸­çš„æ¯ä¸€ä¸ª Rust æºæ–‡ä»¶éƒ½è¢«ç¼–è¯‘æˆä¸€ä¸ªå•ç‹¬çš„ crateã€‚</p>
<h2><a id="bench" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>bench</h2>
<p>é’ˆå¯¹æ€§èƒ½æµ‹è¯•ï¼Œèƒ½å¤Ÿè¿”å›è¯¥ test æ‰§è¡Œçš„æ—¶é—´ã€‚ns çº§åˆ«ã€‚</p>
<h2><a id="arc" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Arc</h2>
<p>Arcï¼ˆAtomic Reference Countedï¼‰æ˜¯ Rust æ ‡å‡†åº“ä¸­çš„ä¸€ç§ç±»å‹ï¼Œå®ƒå®ç°äº†åŸå­å¼•ç”¨è®¡æ•°ï¼ˆAtomic Reference Countingï¼‰ã€‚Arc å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«æ•°æ®ï¼Œè€Œä¸å¿…æ‹…å¿ƒæ•°æ®å®‰å…¨ã€‚</p>
<p>Arc ä½¿ç”¨äº†ä¸€ä¸ªå†…éƒ¨è®¡æ•°å™¨ï¼Œæ¥è®°å½•æœ‰å¤šå°‘ä¸ªå¼•ç”¨æŒ‡å‘è¯¥æ•°æ®ã€‚å½“æœ€åä¸€ä¸ªå¼•ç”¨è¢«é”€æ¯æ—¶ï¼ŒArc ä¼šè‡ªåŠ¨é”€æ¯æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers"><code class="language-rust">use std::sync::Arc;
use std::thread;

fn main() {
    let data = Arc::new(vec![1, 2, 3, 4, 5]);

    for i in 0..5 {
        let data = data.clone();
        thread::spawn(move || {
            println!(&quot;Thread {}: {:?}&quot;, i, data);
        });
    }
}

</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç”¨äºå­˜å‚¨æ•´æ•°çš„ vectorï¼Œå¹¶ç”¨ Arc åŒ…è£…å®ƒã€‚ç„¶ååœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†äº”ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯¹è¯¥ vector çš„å¼•ç”¨ã€‚å½“æœ€åä¸€ä¸ªå¼•ç”¨è¢«é”€æ¯æ—¶ï¼ŒArc ä¼šè‡ªåŠ¨é”€æ¯ vectorã€‚</p>
<p>Arc æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«æ•°æ®æ—¶ï¼Œå¯ä»¥æ›¿ä»£æ‰‹å†™çš„è®¡æ•°å™¨ã€‚</p>
<h2><a id="mutex" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mutex</h2>
<h2><a id="rwlock" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>RwLock</h2>
<p>RwLock æ˜¯ Rust æ ‡å‡†åº“ä¸­çš„ä¸€ç§ç±»å‹ï¼Œç”¨äºå®ç°è¯»å†™é”ã€‚è¯»å†™é”æ˜¯ä¸€ç§çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œå®ƒå¯ä»¥åŒæ—¶å…è®¸å¤šä¸ªè¯»çº¿ç¨‹è¯»å–å…±äº«æ•°æ®ï¼Œä½†æ˜¯åªå…è®¸ä¸€ä¸ªå†™çº¿ç¨‹å¯¹å…±äº«æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚</p>
<pre class="line-numbers"><code class="language-rust">use std::sync::{Arc, RwLock};
use std::thread;

fn main() {
    let data = Arc::new(RwLock::new(vec![1, 2, 3, 4, 5]));

    for i in 0..5 {
        let data = data.clone();
        thread::spawn(move || {
            let mut data = data.write().unwrap();
            data[i] += 1;
        });
    }

    thread::sleep_ms(50);

    let data = data.read().unwrap();
    println!(&quot;{:?}&quot;, data);
}

</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç”¨äºå­˜å‚¨æ•´æ•°çš„ vectorï¼Œå¹¶ç”¨ RwLock åŒ…è£…å®ƒã€‚ç„¶ååœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†äº”ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è¯•å›¾å¯¹è¯¥ vector è¿›è¡Œä¿®æ”¹ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†è¯»å†™é”ï¼Œå› æ­¤åœ¨ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿä¿®æ”¹ vectorï¼Œä»è€Œé¿å…äº†ç«äº‰æ¡ä»¶çš„äº§ç”Ÿã€‚</p>
<p>RwLock æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦ä¿æŠ¤å…±äº«æ•°æ®ä¸è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥ä¿è¯æ•°æ®å®‰å…¨ã€‚</p>
<h2><a id="%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ—¶é—´æ ¼å¼</h2>
<pre class="line-numbers"><code class="language-rust">use chrono::{DateTime, Utc};

fn main() {
    let now: DateTime&lt;Utc&gt; = Utc::now();

    println!(&quot;UTC now is: {}&quot;, now);
    println!(&quot;UTC now in RFC 2822 is: {}&quot;, now.to_rfc2822());
    println!(&quot;UTC now in RFC 3339 is: {}&quot;, now.to_rfc3339());
    println!(&quot;UTC now in a custom format is: {}&quot;, now.format(&quot;%a %b %e %T %Y&quot;));
}

</code></pre>
<h2><a id="%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç­–ç•¥æ¨¡å¼</h2>
<p>åœ¨ Rust ä¸­ï¼Œç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†ç®—æ³•ä¸å…¶å®ç°åˆ†ç¦»å¼€æ¥ï¼Œå¹¶åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©ä¸åŒçš„ç®—æ³•å®ç°ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å®ç°å¯¹ä¸¤ä¸ªæ•´æ•°è¿›è¡ŒåŠ æ³•ã€å‡æ³•å’Œä¹˜æ³•è®¡ç®—ï¼š</p>
<pre class="line-numbers"><code class="language-rust">trait Calculator {
    fn calculate(&amp;self, a: i32, b: i32) -&gt; i32;
}

struct AddCalculator;

impl Calculator for AddCalculator {
    fn calculate(&amp;self, a: i32, b: i32) -&gt; i32 {
        a + b
    }
}

struct SubtractCalculator;

impl Calculator for SubtractCalculator {
    fn calculate(&amp;self, a: i32, b: i32) -&gt; i32 {
        a - b
    }
}

struct MultiplyCalculator;

impl Calculator for MultiplyCalculator {
    fn calculate(&amp;self, a: i32, b: i32) -&gt; i32 {
        a * b
    }
}

struct Context&lt;'a&gt; {
    calculator: Box&lt;dyn Calculator + 'a&gt;,
}

impl&lt;'a&gt; Context&lt;'a&gt; {
    fn new(calculator: Box&lt;dyn Calculator + 'a&gt;) -&gt; Self {
        Self { calculator }
    }

    fn set_calculator(&amp;mut self, calculator: Box&lt;dyn Calculator + 'a&gt;) {
        self.calculator = calculator;
    }

    fn execute(&amp;self, a: i32, b: i32) -&gt; i32 {
        self.calculator.calculate(a, b)
    }
}

fn main() {
    let mut context = Context::new(Box::new(AddCalculator));
    println!(&quot;1 + 2 = {}&quot;, context.execute(1, 2));

    context.set_calculator(Box::new(SubtractCalculator));
    println!(&quot;3 - 1 = {}&quot;, context.execute(3, 1));

    context.set_calculator(Box::new(MultiplyCalculator));
    println!(&quot;2 * 4 = {}&quot;, context.execute(2, 4));
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª Calculator traitï¼Œè¯¥ trait åŒ…å«ä¸€ä¸ªç”¨äºè®¡ç®—ä¸¤ä¸ªæ•´æ•°çš„ calculate() æ–¹æ³•ã€‚ç„¶åï¼Œåˆ†åˆ«å®ç°äº† AddCalculatorã€SubtractCalculator å’Œ MultiplyCalculator ä¸‰ç§ä¸åŒçš„è®¡ç®—æ–¹æ³•ï¼Œå¹¶è®©å®ƒä»¬éƒ½å®ç°äº† Calculator traitã€‚</p>
<p>æ¥ç€ï¼Œå®šä¹‰äº†ä¸€ä¸ª Context ç»“æ„ä½“ï¼ŒåŒ…å«ä¸€ä¸ª Box<dyn Calculator> ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œç”¨äºä¿å­˜å½“å‰é€‰å®šçš„è®¡ç®—æ–¹æ³•ã€‚å®šä¹‰äº† new() æ–¹æ³•ç”¨äºåˆ›å»ºæ–°çš„ Context å¯¹è±¡å¹¶è®¾ç½®é»˜è®¤çš„è®¡ç®—æ–¹æ³•ï¼›å®šä¹‰äº† set_calculator() æ–¹æ³•ç”¨äºåˆ‡æ¢è®¡ç®—æ–¹æ³•ï¼›å®šä¹‰äº† execute() æ–¹æ³•ç”¨äºæ‰§è¡Œå…·ä½“çš„è®¡ç®—æ“ä½œã€‚</p>
<p>æœ€åï¼Œåœ¨ main() å‡½æ•°ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª Context å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ execute() æ–¹æ³•åˆ†åˆ«æ‰§è¡ŒåŠ æ³•ã€å‡æ³•å’Œä¹˜æ³•è®¡ç®—ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‡‡ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥è§£é™¤ç®—æ³•ä¸å…¶å®ç°ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œå¹¶æé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©ä¸åŒçš„è®¡ç®—æ–¹æ³•ï¼Œä»è€Œçµæ´»åœ°åº”å¯¹å„ç§è®¡ç®—åœºæ™¯ã€‚</p>
<pre class="line-numbers"><code class="language-rust">#[derive(Clone, Copy)]
struct TaskRecord {
    code: u32,
}

 trait TaskStepService {
     fn do_task_step(task_record: &amp;TaskRecord);
     fn retry_task_step(task_record: &amp;TaskRecord);
}


pub struct StepA;

impl TaskStepService for StepA {
     fn do_task_step(task_record: &amp;TaskRecord) {
        println!(&quot;Do task step A with code {}&quot;, task_record.code);
    }

     fn retry_task_step(task_record: &amp;TaskRecord) {
        println!(&quot;Retry task step A with code {}&quot;, task_record.code);
    }
}

pub struct StepB;

impl TaskStepService for StepB {
     fn do_task_step(task_record: &amp;TaskRecord) {
        println!(&quot;Do task step B with code {}&quot;, task_record.code);
    }

     fn retry_task_step(task_record: &amp;TaskRecord) {
        println!(&quot;Retry task step B with code {}&quot;, task_record.code);
    }
}

enum TaskStep {
    A(StepA),
    B(StepB),
}

impl TaskStep {
    fn from_code(code: u32) -&gt; Option&lt;Self&gt; {
        match code {
            1 =&gt; Some(Self::A(StepA)),
            2 =&gt; Some(Self::B(StepB)),
            _ =&gt; None,
        }
    }
}

 fn process_task_step(task_record: TaskRecord) {
    if let Some(step) = TaskStep::from_code(task_record.code) {
        match step {
            TaskStep::A(service) =&gt; service.do_task_step(&amp;task_record),
            TaskStep::B(service) =&gt; service.do_task_step(&amp;task_record),
        }
    } else {
        println!(&quot;Invalid task code: {}&quot;, task_record.code);
    }
}

 fn retry_task_step(task_record: TaskRecord) {
    if let Some(step) = TaskStep::from_code(task_record.code) {
        match step {
            TaskStep::A(service) =&gt; service.retry_task_step(&amp;task_record),
            TaskStep::B(service) =&gt; service.retry_task_step(&amp;task_record),
        }
    } else {
        println!(&quot;Invalid task code: {}&quot;, task_record.code);
    }
}

pub fn main() {
    let task_record1 = TaskRecord { code: 1 };
    let task_record2 = TaskRecord { code: 2 };
    let task_record3 = TaskRecord { code: 3 };

    process_task_step(task_record1);
    process_task_step(task_record2);
    process_task_step(task_record3);

    retry_task_step(task_record1);
    retry_task_step(task_record2);
    retry_task_step(task_record3);
}
æŠ¥é”™è¿˜æœªè§£å†³
</code></pre>
<pre class="line-numbers"><code class="language-rust">struct TaskRecord {
    code: u32,
}

trait TaskStepService {
    fn do_task_step(&amp;self, task_record: &amp;TaskRecord) {
        println!(&quot;default do_task_step implementation for code {}&quot;, task_record.code);
    }
    fn retry_task_step(&amp;self, task_record: &amp;TaskRecord) {
        println!(&quot;default retry_task_step implementation for code {}&quot;, task_record.code);
    }
}

struct TaskStepServiceImpl1;
impl TaskStepService for TaskStepServiceImpl1 {
    fn do_task_step(&amp;self, task_record: &amp;TaskRecord) {
        println!(&quot;TaskStepServiceImpl1 do_task_step implementation for code {}&quot;, task_record.code);
    }
    fn retry_task_step(&amp;self, task_record: &amp;TaskRecord) {
        println!(&quot;TaskStepServiceImpl1 retry_task_step implementation for code {}&quot;, task_record.code);
    }
}

struct TaskStepServiceImpl2;
impl TaskStepService for TaskStepServiceImpl2 {
    fn do_task_step(&amp;self, task_record: &amp;TaskRecord) {
        println!(&quot;TaskStepServiceImpl2 do_task_step implementation for code {}&quot;, task_record.code);
    }
    fn retry_task_step(&amp;self, task_record: &amp;TaskRecord) {
        println!(&quot;TaskStepServiceImpl2 retry_task_step implementation for code {}&quot;, task_record.code);
    }
}


fn main() {
    let task_record = TaskRecord { code: 1 };

    match task_record.code {
        1 =&gt; {
            let service = TaskStepServiceImpl1 {};
            service.do_task_step(&amp;task_record);
            service.retry_task_step(&amp;task_record);
        },
        2 =&gt; {
            let service = TaskStepServiceImpl2 {};
            service.do_task_step(&amp;task_record);
            service.retry_task_step(&amp;task_record);
        },
        _ =&gt; println!(&quot;unsupported code {}&quot;, task_record.code),
    }
}

</code></pre>
<h2><a id="%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¤šçº¿ç¨‹ä¸å®šæ—¶ä»»åŠ¡</h2>
<pre class="line-numbers"><code class="language-rust">
use std::future::Future;
use std::pin::Pin;
use tokio::time::{sleep, Duration};

pub async fn do_task() -&gt; Result&lt;(), Box&lt;dyn std::error::Error + Send + Sync&gt;&gt; {
    loop {
        println!(&quot;Running scheduled task...&quot;);
        // æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„ä»£ç ...
        println!(&quot;hello &quot;);

        sleep(Duration::from_secs(2)).await;
    }
}

pub fn spawn_task() -&gt; Pin&lt;Box&lt;dyn Future&lt;Output = ()&gt; + Send + Sync&gt;&gt; {
    let fut = async move {
        if let Err(err) = do_task().await {
            eprintln!(&quot;Scheduled task failed: {:?}&quot;, err);
        }
    };
    Box::pin(fut)
}

---


mod job;

use std::collections::HashMap;

use std::time::Duration;
use tokio::time::{interval, Instant, sleep};

#[actix_web::main]
async fn main() {
    let task = job::do_task();
    tokio::spawn(task);

    sleep(Duration::from_secs(60)).await;
}
</code></pre>
<h2><a id="channel" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>channel</h2>
<pre class="line-numbers"><code class="language-rust">use std::thread;
use std::sync::mpsc;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let val = String::from(&quot;hi&quot;);
        tx.send(val).unwrap();
    });

    let received = rx.recv().unwrap();
    println!(&quot;Got: {}&quot;, received);
}

</code></pre>
<h2><a id="rayon" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>rayon</h2>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16819109466507.jpg" alt="" /><br />
å·¥ä½œçªƒå–ã€‚</p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16819110812309.jpg" alt="" /></p>
<h2><a id="%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%8C%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>&lt;'_&gt; æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä»€ä¹ˆä½œç”¨</h2>
<p>åœ¨ Rust ä¸­ï¼Œ<code>&lt;'_&gt;</code> ç”¨äºå®šä¹‰åŒ¿åç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>ç”Ÿå‘½å‘¨æœŸæ˜¯ Rust ä¸­ç®¡ç†å†…å­˜å’Œå¼•ç”¨çš„æœºåˆ¶ï¼Œå®ƒç”¨äºç¡®ä¿ç¨‹åºä¸­çš„å¼•ç”¨å®‰å…¨æœ‰æ•ˆã€‚é€šå¸¸ï¼Œç”Ÿå‘½å‘¨æœŸæ ‡è®°ä½¿ç”¨å•å¼•å· <code>'</code> æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers"><code class="language-rust">fn foo&lt;'a&gt;(x: &amp;'a i32) -&gt; &amp;'a i32 {
    x
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>&lt;'a&gt;</code> è¡¨ç¤º <code>foo()</code> å‡½æ•°ä½¿ç”¨ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ <code>a</code>ï¼Œè¯¥ç”Ÿå‘½å‘¨æœŸç¡®ä¿è¿”å›å€¼ <code>&amp;'a i32</code> çš„å¼•ç”¨ä¸å‚æ•° <code>x: &amp;'a i32</code> çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒã€‚</p>
<p><code>&lt;'_&gt;</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªåŒ¿åç”Ÿå‘½å‘¨æœŸã€‚è¿™æ„å‘³ç€ï¼ŒRust ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç¡®å®šåŒ¿åç”Ÿå‘½å‘¨æœŸçš„å®é™…ç”Ÿå‘½å‘¨æœŸï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ä¸­çš„ <code>&lt;'_&gt;</code> æ ‡è®°å¯ä»¥è‡ªåŠ¨ç¡®å®š <code>s</code> å’Œ <code>s2</code> çš„å®é™…ç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ— éœ€æŒ‡å®šå…·ä½“çš„ç”Ÿå‘½å‘¨æœŸåç§°ï¼š</p>
<pre class="line-numbers"><code class="language-rust">fn print_str(s: &amp;str) {
    println!(&quot;{}&quot;, s);
}

fn main() {
    let s = String::from(&quot;Hello, world!&quot;);
    let s2: &amp;str = &amp;s;
    print_str(s2);
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° <code>print_str()</code>ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å¼•ç”¨ï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸Šæ‰“å°å‡ºå®ƒã€‚åœ¨ <code>main()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œç„¶åè·å–å®ƒçš„å¼•ç”¨ <code>s2</code>ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ <code>print_str()</code> å‡½æ•°ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°†å‚æ•°è½¬æ¢ä¸º <code>&amp;str</code> ç±»å‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>&lt;'_&gt;</code> æ ‡è®°æ¥è¡¨ç¤ºä¸€ä¸ªåŒ¿åç”Ÿå‘½å‘¨æœŸï¼Œæ­¤æ—¶ Rust ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç¡®å®š <code>s</code> å’Œ <code>s2</code> çš„å®é™…ç”Ÿå‘½å‘¨æœŸï¼Œä»è€Œä½¿å¾—è¯¥ä»£ç æ›´ç®€æ´ï¼Œæ›´æ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚</p>
<p>æ€»ä¹‹ï¼Œ <code>&lt;'_&gt;</code> é€‚ç”¨äºåŒ¿åç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥è®©ä»£ç æ›´ç®€æ´ï¼Œå¹¶ä¸”è®© Rust ç¼–è¯‘å™¨è‡ªåŠ¨ç¡®å®šå®é™…ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœæ‚¨ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™ç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œå¹¶ä¸”å¯ä»¥è®©ç¼–è¯‘å™¨è‡ªåŠ¨ç¡®å®šç”Ÿå‘½å‘¨æœŸï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>&lt;'_&gt;</code> æ¥ä»£æ›¿å…·ä½“çš„ç”Ÿå‘½å‘¨æœŸåç§°ã€‚</p>
<h2><a id="%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç”Ÿå‘½å‘¨æœŸ</h2>
<p>åœ¨Rustä¸­ï¼Œç”Ÿå‘½å‘¨æœŸï¼ˆlifetimesï¼‰æ˜¯ä¸€ç§ç”¨äºç®¡ç†å¼•ç”¨çš„æœºåˆ¶ï¼Œç¡®ä¿å¼•ç”¨åœ¨å…¶æ‰€å¼•ç”¨çš„æ•°æ®æœ‰æ•ˆæ—¶æ‰è¢«ä½¿ç”¨ã€‚ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼ˆlifetimes annotationsï¼‰æ˜¯Rustè¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæ˜ç¡®æŒ‡å®šå¼•ç”¨çš„æœ‰æ•ˆèŒƒå›´ï¼Œä»¥é¿å…æ‚¬å‚å¼•ç”¨ï¼ˆdangling referencesï¼‰å’Œä½¿ç”¨å·²ç»è¢«é‡Šæ”¾çš„æ•°æ®çš„é”™è¯¯ã€‚</p>
<p>ç”Ÿå‘½å‘¨æœŸæ³¨è§£é€šå¸¸ä»¥æ’‡å·ï¼ˆ'ï¼‰åè·Ÿä¸€ä¸ªæ ‡è¯†ç¬¦çš„å½¢å¼è¡¨ç¤ºï¼Œä¾‹å¦‚<code>'a</code>ã€‚è¿™äº›æ ‡è¯†ç¬¦å¯ä»¥æ˜¯ä»»æ„åç§°ï¼Œä½†é€šå¸¸ä½¿ç”¨å•ä¸ªå­—æ¯æ¥è¡¨ç¤ºç”Ÿå‘½å‘¨æœŸçš„åç§°ã€‚åœ¨å‡½æ•°ç­¾åã€ç»“æ„ä½“å®šä¹‰å’Œtraitå®ç°ç­‰åœ°æ–¹ï¼Œå¯ä»¥ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ³¨è§£æ¥æŒ‡å®šå¼•ç”¨çš„æœ‰æ•ˆèŒƒå›´ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£ç”¨æ³•ï¼š</p>
<ol>
<li>å‡½æ•°ç­¾åä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼š</li>
</ol>
<pre class="line-numbers"><code class="language-rust">fn foo&lt;'a&gt;(x: &amp;'a i32) -&gt; &amp;'a i32 {
    // å‡½æ•°ä½“
    x
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>'a</code>æ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Œç”¨äºæŒ‡å®šå‚æ•°<code>x</code>å’Œè¿”å›å€¼ä¹‹é—´çš„å…³ç³»ã€‚å®ƒè¡¨ç¤ºè¿”å›çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸å‚æ•°<code>x</code>çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒã€‚</p>
<ol start="2">
<li>ç»“æ„ä½“ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼š</li>
</ol>
<pre class="line-numbers"><code class="language-rust">struct Foo&lt;'a&gt; {
    x: &amp;'a i32,
    y: &amp;'a i32,
}

impl&lt;'a&gt; Foo&lt;'a&gt; {
    fn new(x: &amp;'a i32, y: &amp;'a i32) -&gt; Foo&lt;'a&gt; {
        Foo { x, y }
    }
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>'a</code>æ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Œç”¨äºæŒ‡å®šç»“æ„ä½“<code>Foo</code>ä¸­ä¸¤ä¸ªå¼•ç”¨å­—æ®µ<code>x</code>å’Œ<code>y</code>çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<ol start="3">
<li>Traitä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼š</li>
</ol>
<pre class="line-numbers"><code class="language-rust">trait Bar&lt;'a&gt; {
    fn baz(&amp;'a self);
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>'a</code>æ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Œç”¨äºæŒ‡å®šå®ç°<code>Bar</code> traitçš„ç±»å‹ä¸­<code>self</code>å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”Ÿå‘½å‘¨æœŸæ³¨è§£å¹¶ä¸ä¼šåˆ›å»ºæ–°çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ˜¯ç”¨äºæŒ‡å®šå¼•ç”¨ä¹‹é—´çš„å…³ç³»ã€‚å®ƒä»¬å¸®åŠ©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé™æ€æ£€æŸ¥ï¼Œä»¥ç¡®ä¿å¼•ç”¨çš„æœ‰æ•ˆæ€§ã€‚ç”Ÿå‘½å‘¨æœŸæ³¨è§£çš„å…·ä½“ä½¿ç”¨æ–¹å¼å–å†³äºä»£ç çš„ä¸Šä¸‹æ–‡å’Œéœ€æ±‚ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°å‡ºç°åœ¨å¦ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°ä¹‹å‰ï¼Œé‚£ä¹ˆå‰è€…çš„ç”Ÿå‘½å‘¨æœŸæ¯”åè€…æ›´é•¿ã€‚è¿™ç§å…³ç³»å¯ä»¥é€šè¿‡'a: 'bçš„è¯­æ³•æ¥è¡¨ç¤ºï¼Œå…¶ä¸­'aæ˜¯è¾ƒé•¿çš„ç”Ÿå‘½å‘¨æœŸï¼Œ'bæ˜¯è¾ƒçŸ­çš„ç”Ÿå‘½å‘¨æœŸã€‚<br />
ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹æ¥è¯´æ˜ç”Ÿå‘½å‘¨æœŸå¤§å°å…³ç³»çš„è¡¨ç¤ºæ–¹æ³•ï¼š</p>
<pre class="line-numbers"><code class="language-rust">fn foo&lt;'a, 'b&gt;(x: &amp;'a i32, y: &amp;'b i32) {
    // ...
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ'aå’Œ'bæ˜¯ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‚æ•°ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¡¨ç¤º'aæ¯”'bæ›´é•¿çš„å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨'a: 'bï¼š</p>
<pre class="line-numbers"><code class="language-rust">fn foo&lt;'a, 'b&gt;(x: &amp;'a i32, y: &amp;'b i32) {
    // 'a: 'b è¡¨ç¤º 'a æ¯” 'b æ›´é•¿
    // ...
}
</code></pre>
<p>è¿™è¡¨ç¤ºxçš„ç”Ÿå‘½å‘¨æœŸ'aæ¯”yçš„ç”Ÿå‘½å‘¨æœŸ'bæ›´é•¿ã€‚æ¢å¥è¯è¯´ï¼Œxçš„å¼•ç”¨å¯ä»¥å­˜åœ¨äºyçš„å¼•ç”¨ä¹‹å¤–ã€‚</p>
<p><code>'a:'b</code> è¡¨ç¤º a çš„ç”Ÿå‘½å‘¨æœŸ &gt;= b çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<h2><a id="%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‡½æ•°æŒ‡é’ˆ</h2>
<p>å°†æ™®é€šå‡½æ•°ä¼ é€’è‡³å…¶ä»–å‡½æ•°<br />
å‡½æ•°åœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­ä¼šè¢«å¼ºåˆ¶è½¬æ¢æˆ fn ç±»å‹ï¼Œfn å°±æ˜¯å‡½æ•°æŒ‡é’ˆã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn add_one(x: i32) -&gt; i32 {
    x + 1
}

fn do_twice(f: fn(i32) -&gt; i32, arg: i32) -&gt; i32 {
    f(arg) + f(arg)
}

fn main() {
    let answer = do_twice(add_one, 5);
    println!(&quot;The answer is: {}&quot;, answer);
}
</code></pre>
<p>fn æ˜¯ä¸€ä¸ªç±»å‹è€Œä¸æ˜¯ä¸€ä¸ª traitã€‚<br />
å‡½æ•°æŒ‡é’ˆå®ç°äº†å…¨éƒ¨ 3 ä¸­é—­åŒ… trait(Fnã€FnMutã€FnOnce)ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå‡½æ•°æŒ‡é’ˆ<br />
ç”¨ä½œå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªæ¥æ”¶é—­åŒ…çš„å‡½æ•°ã€‚<br />
å€¾å‘äºä½¿ç”¨æ­é…é—­åŒ… trait çš„æ³›å‹æ¥ç¼–å†™å‡½æ•°ï¼Œè¿™æ ·çš„å‡½æ•°å¯ä»¥åŒæ—¶å¤„ç†é—­åŒ…ä¸æ™®é€šå‡½æ•°ã€‚</p>
<h2><a id="%E9%97%AD%E5%8C%85%E4%B8%8Efn%E3%80%81fnmut%E3%80%81fnonce" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é—­åŒ…ä¸Fnã€FnMutã€FnOnce</h2>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let s = String::from(&quot;closure test&quot;);

    let f1 = || println!(&quot;{}&quot;, s); // ä¸å¯å˜å€Ÿç”¨ï¼Œè¿™é‡Œ é—­åŒ…å°±ç›¸å½“äº Fn

    f1();

    let mut s = String::from(&quot;closure test mut&quot;);
    // æ³¨æ„ç”±äºè¿™é‡Œæ˜¯ä½¿ç”¨å¯å˜å€Ÿç”¨ï¼Œå› æ­¤ï¼Œé—­åŒ…å‡½æ•°çš„æ¥æ”¶è€…ä¹Ÿå¿…é¡»å£°æ˜ä¸ºå¯å˜å€Ÿç”¨ç±»å‹
    let mut f2 = || {
        s.push_str(&quot;, hello!&quot;);
        println!(&quot;{}&quot;, s);
    };// å¯å˜å€Ÿç”¨ -&gt; FnMut

    f2();

    let s = String::from(&quot;closure test value&quot;);

    let f3 = move || println!(&quot;{}&quot;, s); // moveè¯­å¥ä½¿ç”¨ç›¸å½“äºæŠŠsçš„æ‰€æœ‰æƒç§»åˆ°çš„é—­åŒ…å†…éƒ¨ï¼Œé—­åŒ…å¤–éƒ¨ä¸èƒ½å†ä½¿ç”¨è¯¥å€¼ -&gt; FnOnce

    f3();
}
</code></pre>
<p>é—­åŒ…åº•å±‚å®ç°æœºåˆ¶ã€‚<br />
Fn ä¸å¯å˜å¼•ç”¨<br />
FnMut å¯å˜å¼•ç”¨<br />
FnOnce ï¼ˆmoveï¼‰</p>
<p>Fn ç»§æ‰¿äº† FnMutï¼ŒFnMut ç»§æ‰¿äº† FnOnceã€‚</p>
<h2><a id="%E5%AE%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®</h2>
<p>ä¸€ç»„ç›¸å…³åŠŸèƒ½çš„é›†åˆç§°è°“ã€‚<br />
macro_rules! æ„é€ çš„å£°æ˜å®(declarative macro) ä»¥åŠ3ä¸­è¿‡ç¨‹å®(procedural macro):</p>
<ol>
<li>ç”¨äºç»“æ„ä½“æˆ–æšä¸¾çš„è‡ªå®šä¹‰ #[derive] å®ï¼Œå¯ä»¥æŒ‡å®šéš derive å±æ€§è‡ªåŠ¨æ·»åŠ çš„ä»£ç </li>
<li>ç”¨äºä¸ºä»»æ„æ¡ç›®æ·»åŠ è‡ªå®šä¹‰å±æ€§çš„å±æ€§å®</li>
<li>çœ‹èµ·æ¥ç±»ä¼¼äºå‡½æ•°çš„å‡½æ•°å®ï¼Œå¯ä»¥æ¥æ”¶å¹¶å¤„ç†ä¸€æ®µæ ‡è®°åºåˆ—</li>
</ol>
<p>å®æ˜¯ä¸€ç§ç”¨äºç¼–å†™å…¶ä»–ä»£ç çš„ä»£ç ç¼–å†™æ–¹å¼ï¼Œå…ƒç¼–ç¨‹èŒƒå¼ã€‚ç›¸å½“äºè‡ªå®šä¹‰æ³¨è§£ï¼Ÿ</p>
<p>deriveå±æ€§æ˜¯ä¸€ç§å®ï¼Œè‡ªåŠ¨ç”Ÿæˆå„ç§ trait çš„å®ç°ã€‚</p>
<p>å®å°å†Œï¼š<a href="https://zjp-cn.github.io/tlborm/introduction.html">https://zjp-cn.github.io/tlborm/introduction.html</a></p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16843984175104.jpg" alt="" /><br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/16843997515972.jpg" alt="" /></p>
<h3><a id="macro-rules%E5%A3%B0%E6%98%8E%E5%AE%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>macro_rules! å£°æ˜å®</h3>
<pre class="line-numbers"><code class="language-rust">macro_rules! my_macro {
    ($($arg: expr), *) =&gt; {
        // å®çš„å®ç°é€»è¾‘
        println!(&quot;Hello, {}&quot;, $($arg), *);
    }
}

fn main() {
    my_macro!(&quot;World!&quot;);
}

</code></pre>
<h3><a id="%E5%B1%9E%E6%80%A7%E5%AE%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å±æ€§å®</h3>
<p>å…è®¸åˆ›å»ºæ–°çš„å±æ€§ï¼Œè€Œä¸æ˜¯ä¸º derive å±æ€§ç”Ÿæˆä»£ç ã€‚<br />
derive åªèƒ½è¢«ç”¨äºç»“æ„ä½“å’Œæšä¸¾ï¼Œè€Œå±æ€§åˆ™å¯ä»¥åŒæ—¶è¢«ç”¨äºå…¶ä»–æ¡ç›®ï¼Œæ¯”å¦‚å‡½æ•°ç­‰ã€‚</p>
<h3><a id="%E5%87%BD%E6%95%B0%E5%AE%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‡½æ•°å®</h3>
<!--## è‡ªå®šä¹‰ä¸€ä¸ª derive å®
å®ç°ä¸€ä¸ªå®ï¼Œè¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼Œåœ¨ä»»æ„ç±»å‹ä¸Šæ ‡æ³¨ #[derive(HelloMacro)]ï¼Œå¾—åˆ° hello_macro å‡½æ•°çš„é»˜è®¤å®ç°
```rust
use hello_macro::HelloMacro;
use hello_macro_derive::HelloMacro;

#[derive(HelloMacro)]
struct Pancakes;

fn main() {
    Pancakes::hello_macro();
}

æ‰“å°å‡º â€œHello, Macro! My name is Pancakes!â€
```

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ä»£ç åŒ…-->
<h2><a id="%E5%AE%9E%E7%8E%B0kafka%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8C%85%EF%BC%8C%E5%8F%91%E5%B8%83%E5%88%B0-crate-io" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®ç° kafka çš„å·¥å…·åŒ…ï¼Œå‘å¸ƒåˆ° crate.io</h2>
<p><a href="https://crates.io/crates/simple-kafka">https://crates.io/crates/simple-kafka</a></p>
<p><a href="media/16748079623338/Rust%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF%E5%9B%BE.pdf">Rustå­¦ä¹ è·¯çº¿å›¾.pdf</a></p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16854298066353.jpg" alt="" /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rust åŒ…ç®¡ç†ä¸å·¥ä½œç©ºé—´]]></title>
    <link href="http://blog.hitol.top/16727524082529.html"/>
    <updated>2023-01-03T21:26:48+08:00</updated>
    <id>http://blog.hitol.top/16727524082529.html</id>
    <content type="html"><![CDATA[
<p>åœ¨ç¼–å†™è¾ƒä¸ºå¤æ‚çš„é¡¹ç›®æ—¶ï¼Œåˆç†çš„å¯¹ä»£ç è¿›è¡Œç»„ç»‡ä¸ç®¡ç†å¾ˆé‡è¦ã€‚</p>
<p>åªæœ‰æŒ‰ç…§ä¸åŒçš„ç‰¹æ€§æ¥ç»„ç»‡æˆ–åˆ†éš”ç›¸å…³åŠŸèƒ½çš„ä»£ç ï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿæ¸…æ™°åœ°æ‰¾åˆ°å®ç°æŒ‡å®šåŠŸèƒ½çš„ä»£ç ç‰‡æ®µï¼Œæˆ–è€…ç¡®å®šå“ªäº›åœ°æ–¹éœ€è¦ä¿®æ”¹ã€‚</p>
<p>Rust æä¾›äº†ä¸€ç³»åˆ—çš„åŠŸèƒ½æ¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†ä»£ç ï¼ŒåŒ…æ‹¬å†³å®šå“ªäº›ç»†èŠ‚æ˜¯æš´éœ²çš„ï¼Œå“ªäº›ç»†èŠ‚æ˜¯ç§æœ‰çš„ï¼Œä»¥åŠä¸åŒçš„ä½œç”¨åŸŸå†…å­˜åœ¨å“ªäº›åç§°ã€‚è¿™äº›åŠŸèƒ½æœ‰æ—¶è¢«ç§°ä¸ºæ¨¡å—ç³»ç»Ÿï¼Œä»–ä»¬åŒ…æ‹¬</p>
<ul>
<li>
<p>åŒ…ï¼ˆpackageï¼‰ï¼šä¸€ä¸ªç”¨äºæ„å»ºã€æµ‹è¯•å¹¶åˆ†äº«å•å…ƒåŒ…çš„ Cargo åŠŸèƒ½ã€</p>
</li>
<li>
<p>å•å…ƒåŒ…ï¼ˆcrateï¼‰ï¼šä¸€ä¸ªç”¨äºç”Ÿæˆåº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„æ ‘å½¢æ¨¡å—ç»“æ„<br />
å¯¹äº Rust è€Œè¨€ï¼ŒåŒ…æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯ç¼–è¯‘å•å…ƒï¼Œå®ƒç¼–è¯‘åä¼šç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…ä¸€ä¸ªåº“ã€‚</p>
</li>
<li>
<p>æ¨¡å—ï¼ˆmoduleï¼‰åŠ use å…³é”®å­—ï¼šä»–ä»¬è¢«ç”¨äºæ§åˆ¶æ–‡ä»¶ç»“æ„ã€ä½œç”¨åŸŸåŠè·¯å¾„çš„ç§æœ‰æ€§ã€‚</p>
</li>
<li>
<p>è·¯å¾„ï¼ˆpathï¼‰ï¼šä¸€ç§ç”¨äºå‘½åæ¡ç›®çš„æ–¹æ³•ï¼Œè¿™äº›æ¡ç›®åŒ…æ‹¬ç»“æ„ä½“ã€å‡½æ•°å’Œæ¨¡å—ç­‰ã€‚</p>
</li>
</ul>
<p>rust ä¸­åŒ…ä¸€èˆ¬æŒ‡çš„æ˜¯ crateã€‚</p>
<h2><a id="%E5%8C%85%E4%B8%8E%E5%8D%95%E5%85%83%E5%8C%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>åŒ…ä¸å•å…ƒåŒ…</h2>
<p>åŒ…ï¼ˆpackageï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºé¡¹ç›®ã€å·¥ç¨‹ã€‚<br />
ç”±äº Package å°±æ˜¯ä¸€ä¸ªé¡¹ç›®ï¼Œå› æ­¤å®ƒåŒ…å«æœ‰ç‹¬ç«‹çš„ Cargo.toml æ–‡ä»¶ï¼Œä»¥åŠå› ä¸ºåŠŸèƒ½æ€§è¢«ç»„ç»‡åœ¨ä¸€èµ·çš„ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…ã€‚ä¸€ä¸ª Package åªèƒ½åŒ…å«ä¸€ä¸ªåº“(library)ç±»å‹çš„åŒ…ï¼Œä½†æ˜¯å¯ä»¥åŒ…å«å¤šä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œç±»å‹çš„åŒ…ã€‚</p>
<ul>
<li>ä¸€ä¸ªåŒ…ä¸­åªèƒ½æ‹¥æœ‰æœ€å¤šä¸€ä¸ªåº“å•å…ƒåŒ…ã€‚</li>
<li>åŒ…å¯ä»¥æ‹¥æœ‰ä»»æ„å¤šçš„äºŒè¿›åˆ¶å•å…ƒåŒ…ã€‚</li>
<li>åŒ…å†…å¿…é¡»å­˜åœ¨è‡³å°‘ä¸€ä¸ªå•å…ƒåŒ…ï¼ˆåº“å•å…ƒåŒ…æˆ–äºŒè¿›åˆ¶å•å…ƒåŒ…ï¼‰ã€‚</li>
</ul>
<p>Cargo ä¼šé»˜è®¤å°† src/main.rs è§†ä½œä¸€ä¸ªäºŒè¿›åˆ¶å•å…ƒåŒ…çš„æ ¹èŠ‚ç‚¹è€Œæ— éœ€æŒ‡å®šï¼Œè¿™ä¸ªäºŒè¿›åˆ¶å•å…ƒåŒ…ä¸åŒ…æ‹¥æœ‰ç›¸åŒçš„åç§°ã€‚</p>
<p>å‡è®¾åŒ…çš„ç›®å½•ä¸­åŒ…å« src/lib.rsï¼ŒCargo ä¹Ÿä¼šè‡ªåŠ¨å°†å…¶è§†ä½œä¸åŒ…åŒåçš„åº“å•å…ƒåŒ…çš„æ ¹èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>main.rs æ‰€åœ¨åŒ…æ˜¯äºŒè¿›åˆ¶å•å…ƒåŒ…ï¼Œlib.rs æ‰€åœ¨åŒ…æ˜¯åº“å•å…ƒåŒ…ã€‚</p>
</blockquote>
<ul>
<li>åˆ›å»ºäºŒè¿›åˆ¶åŒ…</li>
</ul>
<pre class="line-numbers"><code class="language-plain_text">cargo new my-project
</code></pre>
<ul>
<li>åˆ›å»º lib åŒ…</li>
</ul>
<pre class="line-numbers"><code class="language-plain_text">cargo new my-lib --lib
</code></pre>
<p>åº“å•å…ƒåŒ…ï¼ˆlibï¼‰åªèƒ½è¢«å…¶ä»–äºŒè¿›åˆ¶å•å…ƒåŒ…å¼•ç”¨è€Œä¸èƒ½ç‹¬ç«‹è¿è¡Œã€‚</p>
<h2><a id="%E5%85%B8%E5%9E%8B%E7%9A%84%E5%8C%85%E7%BB%93%E6%9E%84" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å…¸å‹çš„åŒ…ç»“æ„</h2>
<pre class="line-numbers"><code class="language-plain_text">.
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ main.rs
â”‚   â”œâ”€â”€ lib.rs
â”‚   â””â”€â”€ bin
â”‚       â””â”€â”€ main1.rs
â”‚       â””â”€â”€ main2.rs
â”œâ”€â”€ tests
â”‚   â””â”€â”€ some_integration_tests.rs
â”œâ”€â”€ benches
â”‚   â””â”€â”€ simple_bench.rs
â””â”€â”€ examples
    â””â”€â”€ simple_example.rs

</code></pre>
<ul>
<li>å”¯ä¸€åº“åŒ…ï¼šsrc/lib.rs</li>
<li>é»˜è®¤äºŒè¿›åˆ¶åŒ…ï¼šsrc/main.rsï¼Œç¼–è¯‘åç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸ Package åŒå</li>
<li>å…¶ä½™äºŒè¿›åˆ¶åŒ…ï¼šsrc/bin/main1.rs å’Œ src/bin/main2.rsï¼Œå®ƒä»¬ä¼šåˆ†åˆ«ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åŒåçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>é›†æˆæµ‹è¯•æ–‡ä»¶ï¼štests ç›®å½•ä¸‹</li>
<li>åŸºå‡†æ€§èƒ½æµ‹è¯• benchmark æ–‡ä»¶ï¼šbenches ç›®å½•ä¸‹</li>
<li>é¡¹ç›®ç¤ºä¾‹ï¼šexamples ç›®å½•ä¸‹</li>
</ul>
<h2><a id="%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E5%8C%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä½¿ç”¨å¤–éƒ¨åŒ…</h2>
<p>Cargo.toml æ–‡ä»¶ä¸­çš„ [dependencies]<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/2023-01-05-07.36.08.png" alt="2023-01-05-07.36.08" /></p>
<h2><a id="workspace" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>workspace</h2>
<p>å¦‚ä½•ä½¿ç”¨å·¥ä½œç©ºé—´æ¥ç®¡ç†ä»£ç ç›®å½•ç»“æ„ï¼Œé€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ã€‚<br />
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª add å·¥ä½œç©ºé—´ï¼Œè¿™ä¸ªç©ºé—´ä¸­æœ‰ä¸€ä¸ªäºŒè¿›åˆ¶åŒ… adderï¼Œæœ‰ä¸€ä¸ª lib åŒ… add-oneï¼Œadder ä¾èµ– add-oneã€‚</p>
<p>workspace é€šè¿‡ members ç»„ç»‡èµ·æ¥ï¼Œç±»ä¼¼äºçˆ¶ pom ä¸­çš„ moduleã€‚</p>
<p>ä¸‹é¢æ˜¯æ“ä½œæ­¥éª¤</p>
<ol>
<li>
<p>åˆ›å»ºä¸€ä¸ªå·¥ä½œç©ºé—´ç›®å½•ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ã€‚</p>
<pre class="line-numbers"><code class="language-bash">mkdir add
</code></pre>
</li>
<li>
<p>æ–°åˆ›å»ºçš„ç›®å½•ä¸­æ·»åŠ  Cargo.toml</p>
<pre class="line-numbers"><code class="language-bash">cd add
touch Cargo.toml
</code></pre>
</li>
<li>
<p>ç¼–è¾‘ Cargo.toml</p>
<pre class="line-numbers"><code class="language-toml">[workspace]
members = [
    &quot;adder&quot;,
    &quot;add-one&quot;
]
</code></pre>
</li>
<li>
<p>åœ¨ add ç›®å½•ä¸‹ï¼Œåˆ›å»º adder äºŒè¿›åˆ¶åŒ…</p>
<pre class="line-numbers"><code class="language-plain_text">cargo new adder
</code></pre>
<p>è¾“å‡º</p>
<pre class="line-numbers"><code class="language-plain_text">Created binary (application) `adder` project
</code></pre>
<p>ç°åœ¨çš„ç›®å½•ç»“æ„:</p>
<pre class="line-numbers"><code class="language-plain_text">â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ adder
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main.rs
â””â”€â”€ target
</code></pre>
</li>
<li>
<p>åˆ›å»ºæ–°çš„ lib åŒ… add-one</p>
<pre class="line-numbers"><code class="language-plain_text">cargo new add-one --lib
</code></pre>
<p>è¾“å‡º</p>
<pre class="line-numbers"><code class="language-plain_text">Created library `add-one` project
</code></pre>
<p>æ­¤æ—¶çš„ç›®å½•ç»“æ„:</p>
<pre class="line-numbers"><code class="language-plain_text">â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ add-one
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ lib.rs
â”œâ”€â”€ adder
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main.rs
â””â”€â”€ target
</code></pre>
</li>
<li>
<p>add-one/src/lib.rs</p>
<p>lib æ–‡ä»¶ä¸­è‡ªåŠ¨ç”Ÿæˆäº†ä»£ç ï¼Œä¸€ä¸ª add æ–¹æ³•ï¼Œä¸€ä¸ª test æ–¹æ³•</p>
<pre class="line-numbers"><code class="language-rust">pub fn add(left: usize, right: usize) -&gt; usize {
    left + right
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn it_works() {
        let result = add(2, 2);
        assert_eq!(result, 4);
    }
}
</code></pre>
</li>
<li>
<p>è®©äºŒè¿›åˆ¶åŒ… adder ä¾èµ– add-one è¿™ä¸ª lib<br />
éœ€è¦åœ¨ adder çš„ Cargo.toml æ–‡ä»¶ä¸­æ·»åŠ  add-one çš„è·¯å¾„ä½œä¸ºä¾èµ–ã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">[dependencies]
add-one = {path = &quot;../add-one&quot;}
</code></pre>
</li>
<li>
<p>åœ¨ adder åŒ…ä¸­ä½¿ç”¨ add-one ä¸­çš„ add æ–¹æ³•<br />
adder/src/main.rs</p>
<pre class="line-numbers"><code class="language-rust">use add_one;
fn main() {
    println!(&quot;Hello, world!&quot;);
    let x = add_one::add(1, 2);
    assert_eq!(x,3);
    println!(&quot;Hello, world!&quot;);
}
</code></pre>
</li>
<li>
<p>åœ¨ add ç›®å½•ä¸‹æ„å»ºæ•´ä¸ªå·¥ä½œç©ºé—´</p>
</li>
<li>
<p>ä¸ºäº†èƒ½å¤Ÿåœ¨å·¥ä½œç©ºé—´çš„ç›®å½•ä¸‹è¿è¡ŒäºŒè¿›åˆ¶åŒ…ï¼Œåœ¨æ‰§è¡Œ cargo run å‘½ä»¤æ—¶éœ€è¦æŒ‡å®š -p å‚æ•°</p>
<pre class="line-numbers"><code class="language-plain_text">cargo run -p adder
</code></pre>
</li>
</ol>
<p>ä»¥ä¸Š10ä¸ªæ­¥éª¤å°±æ˜¯ä½¿ç”¨å·¥ä½œç©ºé—´çš„æ“ä½œæ­¥éª¤äº†ã€‚<br />
lib åŒ…ç›¸å½“äºå·¥å…·åŒ…ï¼Œä¸€èˆ¬ç”¨æ¥å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒæ—¶è¿˜å¯ä»¥ç»™åˆ«çš„æ¨¡å—æä¾›ä¾èµ–ï¼Œ<br />
äºŒè¿›åˆ¶åŒ…ç›¸å½“äºå¯åŠ¨åŒ…ï¼Œå¯ä»¥è¿è¡Œã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rust actix-diesel-mysql demo]]></title>
    <link href="http://blog.hitol.top/16669473309292.html"/>
    <updated>2022-10-28T16:55:30+08:00</updated>
    <id>http://blog.hitol.top/16669473309292.html</id>
    <content type="html"><![CDATA[
<p>rust ä½¿ç”¨ actix-webã€dieselã€mysql çš„ demoã€‚</p>
<ol>
<li>
<p>åˆ›å»ºå·¥ç¨‹</p>
<pre class="line-numbers"><code class="language-plain_text">cargo new rust_diesel_mysql_demo
</code></pre>
</li>
<li>
<p>æ·»åŠ  diesel ä¾èµ–</p>
<pre class="line-numbers"><code class="language-plain_text">diesel = { version = &quot;2.0.0&quot;, features = [&quot;mysql&quot;] }
dotenvy = &quot;0.15&quot;
</code></pre>
</li>
<li>
<p>mysql è¿æ¥ä¿¡æ¯å†™å…¥åˆ° env æ–‡ä»¶</p>
<pre class="line-numbers"><code class="language-plain_text">echo DATABASE_URL=mysql://root:123456@localhost:3306/diesel_demo &gt;.env
</code></pre>
</li>
<li>
<p><code>cargo install diesel_cli --no-default-features --features mysql</code></p>
</li>
<li>
<p><code>diesel setup</code></p>
<ol>
<li>ç”Ÿæˆ migrations å­˜æ”¾åˆå§‹åŒ– sql æ–‡ä»¶çš„ç›®å½•ã€‚</li>
<li>ç”Ÿæˆ diesel.tomlï¼Œå­˜æ”¾ç”Ÿæˆæ–‡ä»¶çš„ç›®å½•
<pre class="line-numbers"><code class="language-plain_text">[print_schema]
file = &quot;src/schema.rs&quot;

[migrations_directory]
dir = &quot;migrations&quot;
</code></pre>
</li>
</ol>
</li>
<li>
<p>diesel migration generate create_posts<br />
ç”Ÿæˆåˆå§‹åŒ– sql æ–‡ä»¶ã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">Creating migrations/2022-11-22-085601_create_posts/up.sql
Creating migrations/2022-11-22-085601_create_posts/down.sql
</code></pre>
<p>å°†åˆå§‹åŒ– sql å†™åˆ° up.sql ä¸­ã€‚</p>
<pre class="line-numbers"><code class="language-sql">CREATE TABLE `posts` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `title` varchar(256) NOT NULL COMMENT 'æ ‡é¢˜',
  `body` text NOT NULL COMMENT 'å†…å®¹',
  `published` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'æ˜¯å¦å‘å¸ƒ',
  PRIMARY KEY (`id`)
) ;
</code></pre>
</li>
<li>
<p>diesel migration run</p>
<ol>
<li>è¯»å–ä¸Šä¸€æ­¥ç”Ÿæˆçš„ migrations æ–‡ä»¶å¤¹çš„ up.sqlï¼Œç”Ÿæˆå¯¹åº”çš„å®ä½“ï¼Œç”Ÿæˆåˆ° print_schema æŒ‡å®šçš„æ–‡ä»¶</li>
<li>å¦‚æœä¸Šä¸€æ­¥æ²¡æœ‰æ‰§è¡Œï¼Œmigrations é‡Œæ˜¯ç©ºçš„ï¼Œé»˜è®¤ä¼šç”Ÿæˆæ•°æ®åº“é‡Œæ‰€æœ‰è¡¨çš„å®ä½“</li>
</ol>
</li>
</ol>
<hr />
<p>ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ diesel çš„å‡†å¤‡å·¥ä½œï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¼–ç å·¥ä½œ</p>
<ol>
<li>
<p>åœ¨ src ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹ apiã€databaseã€modelsã€service</p>
<pre class="line-numbers"><code class="language-plain_text">â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ api
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mod.rs
â”‚Â Â  â”‚Â Â  â””â”€â”€ test_api.rs
â”‚Â Â  â”œâ”€â”€ database
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mod.rs
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mysql.rs
â”‚Â Â  â”‚Â Â  â””â”€â”€ schema.rs
â”‚Â Â  â”œâ”€â”€ main.rs
â”‚Â Â  â”œâ”€â”€ models
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mod.rs
â”‚Â Â  â”‚Â Â  â””â”€â”€ models.rs
â”‚Â Â  â”œâ”€â”€ service
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ mod.rs
â”‚Â Â  â”‚Â Â  â””â”€â”€ test_service.rs
â”‚Â Â  â””â”€â”€ settings.rs
</code></pre>
<ol>
<li>rust çš„ç›®å½•ç»“æ„è¿˜åœ¨æ‘¸ç´¢ä¸­ï¼Œè¿™é‡Œè¿˜æ˜¯ mvc çš„æ–¹å¼</li>
<li>api æä¾›æœåŠ¡çš„æ¥å£ï¼Œç±»ä¼¼äº controller</li>
<li>database æ•°æ®åº“ç›¸å…³ï¼Œåˆå§‹åŒ–æ•°æ®åº“è¿æ¥ä»¥åŠå­˜æ”¾ç”Ÿæˆçš„ schema</li>
<li>models ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­çš„ struct</li>
<li>service æœåŠ¡é€»è¾‘å¤„ç†</li>
</ol>
</li>
</ol>
<p>æ¯ä¸ªæ–‡ä»¶å¤¹é‡Œéƒ½æœ‰ä¸ª mod.rsï¼Œé‡Œè¾¹æœ‰å£°æ˜ mod çš„è¯­å¥ï¼Œè€Œå£°æ˜çš„ mod åœ¨åŒçº§åˆ«çš„ç›®å½•ä¸‹æœ‰å¯¹åº”åå­—çš„æ–‡ä»¶å­˜åœ¨ã€‚<br />
ä¾‹å¦‚ database æ–‡ä»¶å¤¹é‡Œçš„ mod.rs:</p>
<pre class="line-numbers"><code class="language-plain_text">pub mod mysql;
pub mod schema;
</code></pre>
<p>database æ–‡ä»¶å¤¹é‡Œè¿˜æœ‰ mysql.rsã€schema.rs ä¸¤ä¸ªæ–‡ä»¶ã€‚</p>
<p>è¿™ä¸ªå¥½åƒæ˜¯ rust çš„ä¸€ä¸ªè§„åˆ™ã€‚å½“ä¸€ä¸ªç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º mod.rs çš„æºæ–‡ä»¶æ—¶ï¼Œæ¨¡å—çš„æ–‡ä»¶åä¹Ÿå¯ä»¥å’Œè¿™ä¸ªç›®å½•äº’ç›¸æ˜ å°„ã€‚<br />
ä¸è¿‡è¿™ä¸ª mod.rs æ–‡ä»¶æœ‰ç‚¹å¤ªå¤šäº†ã€‚ã€‚ã€‚</p>
<h2><a id="diesel-crud" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>diesel crud</h2>
<p><a href="https://docs.diesel.rs/diesel/query_dsl/trait.QueryDsl.html">https://docs.diesel.rs/diesel/query_dsl/trait.QueryDsl.html</a></p>
<p>insert</p>
<pre class="line-numbers"><code class="language-rust">diesel::insert_into(posts::table)
        .values(&amp;new_post)
        .execute(connection)
        .expect(&quot;Error saving new post&quot;);
</code></pre>
<p>select<br />
ä¸€ä¸ª selectById éƒ½èƒ½æœ‰å¥½å‡ ä¸­å†™æ³•</p>
<pre class="line-numbers"><code class="language-rust">posts::table.filter(posts::id.eq(id)).first(connection).unwrap()
posts::dsl::posts.find(id).first(connection).unwrap()
posts::table.find(id).first(connection).unwrap()
</code></pre>
<p>delete</p>
<pre class="line-numbers"><code class="language-rust">diesel::delete(posts::table).filter(posts::id.eq(id))
    .execute(connection).unwrap();
</code></pre>
<p>update</p>
<pre class="line-numbers"><code class="language-rust">diesel::update(posts::table).filter(posts::id.eq(id))
    .set(posts::published.eq(true))
    .execute(connection).unwrap();
</code></pre>
<p>github åœ°å€ï¼š<br />
<a href="https://github.com/hitolz/rust_actix_diesel_mysql_demo">https://github.com/hitolz/rust_actix_diesel_mysql_demo</a></p>
<hr />
<p><a href="https://diesel.rs/guides/getting-started">https://diesel.rs/guides/getting-started</a><br />
<a href="https://www.rectcircle.cn/posts/rust-diesel/">https://www.rectcircle.cn/posts/rust-diesel/</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rust web å¼€å‘-1.web æ¡†æ¶]]></title>
    <link href="http://blog.hitol.top/16689222220789.html"/>
    <updated>2022-11-20T13:30:22+08:00</updated>
    <id>http://blog.hitol.top/16689222220789.html</id>
    <content type="html"><![CDATA[
<p>æœ¬ç³»åˆ—æ–‡ç« ä»ä»¥ä¸‹ 9 ä¸ªæ–¹é¢å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Rust è¿›è¡Œ web å¼€å‘ã€‚</p>
<ol>
<li>web æ¡†æ¶</li>
<li>æ•°æ®åº“/orm</li>
<li>config</li>
<li>log</li>
<li>çº¿ç¨‹æ± </li>
<li>kafka</li>
<li>redis</li>
<li>æ‰“åŒ…æˆ docker é•œåƒ</li>
<li>gracefully shutdown</li>
</ol>
<hr />
<p>æœ¬æ–‡ä»‹ç»ç¬¬ä¸€éƒ¨åˆ†ï¼Œweb æ¡†æ¶ã€‚<br />
ç›®å‰æ¯”è¾ƒå‡ºåçš„ web æ¡†æ¶æœ‰</p>
<ol>
<li><a href="https://github.com/tokio-rs/axum">axum</a></li>
<li><a href="https://github.com/SergioBenitez/Rocket">Rocket</a></li>
<li><a href="https://github.com/actix/actix-web">actix-web</a></li>
<li><a href="https://github.com/hyperium/hyper">Hyper</a></li>
<li><a href="https://github.com/http-rs/tide">Tide</a></li>
<li><a href="https://github.com/seanmonstar/warp">Warp</a></li>
</ol>
<p>æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»ä¸€ä¸‹ actix-webï¼Œå…¶ä»–æ¡†æ¶å¾…åé¢æœ‰æ—¶é—´å†ä»‹ç»ã€‚</p>
<h2><a id="actix-web" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>actix-web</h2>
<p>actix-web æœåŠ¡ç«¯çš„é€»è¾‘éƒ½æ˜¯å»ºç«‹åœ¨ App å®ä¾‹ä¸Šçš„ï¼Œé€šè¿‡ App å®ä¾‹ä¸ºæ‰€æœ‰èµ„æºå’Œä¸­é—´ä»¶æ³¨å†Œè·¯ç”±ï¼Œå­˜å‚¨åŒä¸€èŒƒå›´å†…æ‰€æœ‰çº¿ç¨‹å…±äº«çš„çŠ¶æ€ã€‚<br />
æ¥ä¸‹æ¥ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ª actix-web ç¤ºä¾‹ã€‚</p>
<ol>
<li>åˆ›å»ºrust å·¥ç¨‹</li>
</ol>
<pre class="line-numbers"><code class="language-rust">cargo new hello-world
</code></pre>
<ol start="2">
<li>Cargo.toml æ·»åŠ ä¾èµ–</li>
</ol>
<pre class="line-numbers"><code class="language-rust">[dependencies]
actix-web=&quot;4&quot;
</code></pre>
<ol start="3">
<li>ä½¿ç”¨ actix-web<br />
åœ¨ src/main.rs ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç </li>
</ol>
<pre class="line-numbers"><code class="language-rust">use actix_web::{get, post, web, App, HttpResponse, HttpServer, Responder};

#[get(&quot;/&quot;)]
async fn hello() -&gt; impl Responder {
    HttpResponse::Ok().body(&quot;Hello world!&quot;)
}

#[post(&quot;/echo&quot;)]
async fn echo(req_body: String) -&gt; impl Responder {
    HttpResponse::Ok().body(req_body)
}

async fn manual_hello() -&gt; impl Responder {
    HttpResponse::Ok().body(&quot;Hey there!&quot;)
}


#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new( || {
        App::new()
            .service(hello)
            .service(echo)
            .route(&quot;/hey&quot;, web::get().to(manual_hello))
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p>HttpServer ç»‘å®šåˆ° ipã€ç«¯å£ï¼ŒåŒæ—¶ï¼Œæä¾›äº†ä¸¤ä¸ª get æ–¹æ³•(/,/hey)ï¼Œä¸€ä¸ª post æ–¹æ³•(/echo)ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® localhost:8099 å³å¯è®¿é—®ã€‚<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/2022-11-20-13.36.34.png" alt="2022-11-20-13.36.34" /></p>
<h3><a id="httpserver" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>HttpServer</h3>
<p>HttpServer æ¥å—çš„å‚æ•°ç±»å‹æ˜¯ application factoryï¼Œå®ç°äº† Send + Syncã€‚</p>
<p>bindï¼Œä¸º server ç»‘å®š ip å’Œç«¯å£ã€‚<br />
bind æˆåŠŸåï¼Œ<code>HttpServer::run()</code> è¿”å›ä¸€ä¸ª server å®ä¾‹ã€‚<br />
server å¿…é¡»ä½¿ç”¨ await æˆ–è€…åœ¨å¤šçº¿ç¨‹ä¸­æ‰èƒ½å¯åŠ¨ http æœåŠ¡å™¨ã€‚<br />
server é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°ä¸ CPU ä¸ªæ•°ç›¸ç­‰ï¼Œå¯ä»¥é€šè¿‡ <code>HttpServer::workers()</code> æ”¹å˜çº¿ç¨‹æ•°ã€‚</p>
<h3><a id="scope" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>scope</h3>
<p>scope ç›¸å½“äºè¯·æ±‚è·¯å¾„çš„å‰ç¼€</p>
<pre class="line-numbers"><code class="language-rust">#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| {
        App::new().service(
            web::scope(&quot;/app&quot;)
                .route(&quot;/hey&quot;, web::get().to(manual_hello)),
        )
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p>è¿™æ ·çš„è¯åœ¨è¯·æ±‚ localhost:8099/hey å°±è¯·æ±‚ä¸åˆ°äº†ï¼Œè¿™æ ·è¦è¯·æ±‚çš„è·¯å¾„æ˜¯ localhost:8099/app/hey</p>
<h3><a id="shared-mutable-state" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Shared Mutable State</h3>
<p>ç›¸å½“äºå…¨å±€å˜é‡ã€å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«çš„ã€‚</p>
<p><code>web::Data&lt;T&gt;</code>,T æ˜¯ Arc ç±»å‹ã€‚<br />
Arc å’Œ Mutex ç»“åˆä½¿ç”¨ï¼Œå®ç°åœ¨å¤šçº¿ç¨‹é—´å…±äº«æ•°æ®ã€‚</p>
<pre class="line-numbers"><code class="language-rust">use std::sync::Mutex;

use actix_web::{App, HttpServer, web};

struct AppStateWithCounter {
    counter: Mutex&lt;i32&gt;, // &lt;- Mutex is necessary to mutate safely across threads
}

async fn index(data: web::Data&lt;AppStateWithCounter&gt;) -&gt; String {
    let mut counter = data.counter.lock().unwrap(); // &lt;- get counter's MutexGuard
    *counter += 1; // &lt;- access counter inside MutexGuard

    format!(&quot;Request number: {counter}&quot;) // &lt;- response with count
}

#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    // Note: web::Data created _outside_ HttpServer::new closure
    let counter = web::Data::new(AppStateWithCounter {
        counter: Mutex::new(0),
    });

    HttpServer::new(move || {
        // move counter into the closure
        App::new()
            .app_data(counter.clone()) // &lt;- register the created data
            .route(&quot;/&quot;, web::get().to(index))
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p>æµè§ˆå™¨è¯·æ±‚ localhost:8099,æ¯æ¬¡åˆ·æ–° counter+1ï¼›</p>
<h3><a id="%E8%BF%94%E5%9B%9Ejson" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è¿”å› json</h3>
<p>ä¸€èˆ¬ web åº”ç”¨æœåŠ¡ç«¯æ¥å£è¿”å›çš„æ•°æ®éƒ½æ˜¯ json æ ¼å¼ï¼Œ<br />
actix-web ä¸­å¦‚ä½•å®ç°è¿”å› jsonæ ¼å¼çš„æ•°æ®:</p>
<p>cargo.tomlæ·»åŠ ä¾èµ–</p>
<pre class="line-numbers"><code class="language-rust">serde = { version = &quot;1.0&quot;, features = [&quot;derive&quot;] }
serde_json = { version = &quot;1.0.2&quot;, optional = true }
</code></pre>
<p>main.rs</p>
<pre class="line-numbers"><code class="language-rust">use actix_web::{App, get, HttpResponse, HttpServer, post, Responder, web};
use actix_web::web::Json;
use serde::{ser, Serialize};

#[derive(Serialize)]
pub struct JsonSuccess&lt;T: ser::Serialize&gt; {
    pub code: u32,
    pub data: Option&lt;T&gt;,
    pub error: Option&lt;String&gt;,
}

#[derive(Serialize)]
pub struct JsonError {
    pub code: u32,
    pub data: Option&lt;String&gt;,
    pub error: Option&lt;String&gt;,
}

pub fn success&lt;T: ser::Serialize&gt;(r: Option&lt;T&gt;) -&gt; HttpResponse {
    HttpResponse::Ok().json(JsonSuccess {
        code: 0,
        data: r,
        error: None,
    })
}

pub fn error(err: Option&lt;String&gt;) -&gt; HttpResponse {
    HttpResponse::Ok().json(JsonError {
        code: 1,
        data: None,
        error: err,
    })
}


#[get(&quot;/&quot;)]
async fn hello() -&gt; HttpResponse {
    success(Option::from(&quot;Hello&quot;))
}


#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| {
        App::new()
            .service(hello)
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}

</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/2022-11-20-14.58.01.png" alt="2022-11-20-14.58.01" /></p>
<h3><a id="%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ¥æ”¶è¯·æ±‚å‚æ•°</h3>
<h4><a id="path" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Path</h4>
<pre class="line-numbers"><code class="language-rust">use actix_web::{App, get, HttpResponse, HttpServer, post, Responder, web,Result};
use actix_web::web::Json;
use serde::{ser, Serialize};

/// extract path info from &quot;/users/{user_id}/{friend}&quot; url
/// {user_id} - deserializes to a u32
/// {friend} - deserializes to a String
#[get(&quot;/users/{user_id}/{friend}&quot;)] // &lt;- define path parameters
async fn index(path: web::Path&lt;(u32, String)&gt;) -&gt; HttpResponse {
    let (user_id, friend) = path.into_inner();
    success(Some(format!(&quot;Welcome {}, user_id {}!&quot;, friend, user_id)))
}

#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| App::new().service(index))
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/17002319375457.jpg" alt="" /></p>
<p>web::Path&lt;(u32,String)&gt; æ¥æ”¶è¿™ä¸ª get(&quot;/users/{user_id}/{friend}&quot;) è¯·æ±‚çš„ä¸¤ä¸ªå‚æ•°</p>
<p>å°†è¿™ä¸¤ä¸ªå‚æ•°å®šä¹‰ä¸º struct ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<pre class="line-numbers"><code class="language-rust">#[derive(Deserialize)]
struct Info {
    user_id: u32,
    friend: String,
}

/// extract path info using serde
#[get(&quot;/users/{user_id}/{friend}&quot;)] // &lt;- define path parameters
async fn index(path: web::Path&lt;(u32, String)&gt;) -&gt; HttpResponse {
    let (user_id, friend) = path.into_inner();
    success(Some(format!(&quot;Welcome {}, user_id {}!&quot;, friend, user_id)))
}
</code></pre>
<h4><a id="get%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>get è¯·æ±‚ï¼Œæ¥æ”¶å‚æ•°</h4>
<pre class="line-numbers"><code class="language-rust">#[derive(Deserialize)]
struct Info {
    username: String,
    age:i32
}

#[get(&quot;/&quot;)]
async fn index(info: web::Query&lt;Info&gt;) -&gt; HttpResponse {
    success(Some(format!(&quot;Welcome {}!,age = {}&quot;, info.username,info.age)))
}
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/17002323120371.jpg" alt="" /></p>
<h4><a id="post%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%8E%A5%E6%94%B6-json" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>post è¯·æ±‚ï¼Œæ¥æ”¶ json</h4>
<pre class="line-numbers"><code class="language-rust">#[derive(Deserialize)]
struct Info {
    username: String,
    age:i32
}

#[post(&quot;/&quot;)]
async fn index(info: web::Json&lt;Info&gt;) -&gt; HttpResponse {
    success(Some(format!(&quot;Welcome {}!,age = {}&quot;, info.username,info.age)))
}
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/17002325332089.jpg" alt="" /></p>
<h3><a id="middleware" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>middleware</h3>
<p>middleware ç³»ç»Ÿå¯ä»¥è®©æˆ‘ä»¬é’ˆå¯¹è¯·æ±‚æˆ–è€…å“åº”æ·»åŠ è‡ªå®šä¹‰æ“ä½œã€‚</p>
<ol>
<li>Pre-process the Requestï¼šå¯ä»¥åœ¨è¯·æ±‚æ—¶åšå‰ç½®å¤„ç†</li>
<li>Post-process a Responseï¼šåœ¨å“åº”æ—¶åšåç½®å¤„ç†</li>
<li>Modify application stateï¼šä¿®æ”¹ state</li>
<li>Access external services (redis, logging, sessions)ï¼šè®¿é—®å¤–éƒ¨æœåŠ¡</li>
</ol>
<blockquote>
<p>å¦‚æœæœ‰å¤šä¸ªä¸­é—´ä»¶ï¼Œåæ·»åŠ çš„ä¼šå…ˆæ‰§è¡Œã€‚</p>
</blockquote>
<p>ç±»ä¼¼ Java ä¸­çš„ AOPï¼Œåªä¸è¿‡è¿™ä¸ªä¸­é—´ä»¶åªæ˜¯é’ˆå¯¹ Controller çš„ã€‚</p>
<p>è‡ªå®šä¹‰ middleware è¦å®ç° Serviceå’Œ Transform ä¸¤ä¸ª traitã€‚<br />
å…ˆç”¨ wrap_fn åšä¸€ä¸ªç®€å•çš„ middlewareï¼š</p>
<p>cargo.tomlæ·»åŠ ä¾èµ–</p>
<pre class="line-numbers"><code class="language-plain_text">futures-util = &quot;0.3&quot;
</code></pre>
<p>main.rs</p>
<pre class="line-numbers"><code class="language-rust">#[get(&quot;/{name}&quot;)]
async fn hello(path:web::Path&lt;String&gt;) -&gt; HttpResponse {
    let name = path.to_owned();
    success(Option::from(format!(&quot;Hello {}&quot;,name)))
}

#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| {
        App::new()
            .wrap_fn(|req, srv| {
                // Pre-process the Request
                println!(&quot;Hi from start. You requested: {}&quot;, req.path());
                srv.call(req).map(|res| {
                    // Post-process a Response
                    println!(&quot;Hi from response&quot;);
                    res
                })
            })
            .service(hello)
    })
    .bind((&quot;127.0.0.1&quot;, 8099))?
    .run()
    .await
}
</code></pre>
<p>è¯·æ±‚ <a href="http://localhost:8099/tom">http://localhost:8099/tom</a><br />
æ§åˆ¶å°ä¼šæ‰“å°å‡º<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/17002343077452.jpg" alt="" /></p>
<p>æ¥ä¸‹æ¥ï¼Œåšä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ä¸­é—´ä»¶--é‰´æƒä¸­é—´ä»¶ã€‚</p>
<pre class="line-numbers"><code class="language-rust">impl&lt;S, B&gt; Service&lt;ServiceRequest&gt; for AuthMiddleWare&lt;S&gt;
where
    S: Service&lt;ServiceRequest, Response = ServiceResponse&lt;B&gt;, Error = Error&gt;,
    S::Future: 'static,
    B: 'static,
{
    type Response = ServiceResponse&lt;B&gt;;
    type Error = Error;
    type Future = LocalBoxFuture&lt;'static, Result&lt;Self::Response, Self::Error&gt;&gt;;

    forward_ready!(service);

    fn call(&amp;self, req: ServiceRequest) -&gt; Self::Future {
        let value = HeaderValue::from_str(&quot;&quot;).unwrap();
        let token: &amp;HeaderValue = req.headers().get(&quot;token&quot;).unwrap_or(&amp;value);
        if token.len() &gt; 0 || req.path().to_string() == &quot;/login&quot; {
            let fut: &lt;S as Service&lt;ServiceRequest&gt;&gt;::Future = self.service.call(req);
            Box::pin(async move {
                let res = fut.await;
                res
            })
        } else {
            Box::pin(async move { Err(ErrorUnauthorized(&quot;PLEASE LOGIN&quot;)) })
        }
    }
}


#[actix_web::main]
async fn main() -&gt; std::io::Result&lt;()&gt; {
    HttpServer::new(|| {
        App::new()
            .wrap(middleware::timed::Timed)
            .wrap(middleware::auth::Auth)
            .service(hello1)
            .service(hello2)
    })
        .bind((&quot;127.0.0.1&quot;, 8099))?
        .run()
        .await
}
</code></pre>
<p>è¿™é‡Œæ˜¯å†™äº†ä¸¤ä¸ª middlewareï¼Œä¸€ä¸ªæ‰“å°æ¥å£è€—æ—¶ï¼Œä¸€ä¸ªé‰´æƒï¼Œä»£ç ç¯‡å¹…è¾ƒå¤šï¼Œæ”¾åœ¨äº† <a href="https://github.com/hitolz/rust-web">github</a>ã€‚</p>
<p>æµè§ˆå™¨è®¿é—® hello1ï¼Œç”±äºæ²¡æœ‰ tokenï¼Œæ‰€ä»¥é‰´æƒä¸é€šè¿‡ï¼Œè€Œé€šè¿‡ postman è®¿é—® hello2ï¼Œheader ä¸ŠåŠ ä¸Š tokenï¼Œå°±å¯ä»¥è¯·æ±‚é€šè¿‡ã€‚<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/17003662230269.jpg" alt="" /></p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/17003658655736.jpg" alt="" /></p>
<h2><a id="%E5%B0%8F%E7%BB%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å°ç»“</h2>
<p>ç¬¬ä¸€éƒ¨åˆ†å…³äº web æ¡†æ¶å°±ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œä¸»è¦ä»‹ç»äº† actix-web çš„ä½¿ç”¨ï¼šå¦‚ä½•å†™ä¸€ä¸ªæ¥å£ã€å¦‚ä½•æ¥æ”¶å‚æ•°ã€å¦‚ä½•è¿”å› json ã€å¦‚ä½•é€šè¿‡ä¸­é—´ä»¶é‰´æƒã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rust æ‰€æœ‰æƒ]]></title>
    <link href="http://blog.hitol.top/16672061401168.html"/>
    <updated>2022-10-31T16:49:00+08:00</updated>
    <id>http://blog.hitol.top/16672061401168.html</id>
    <content type="html"><![CDATA[
<blockquote>
<p>æ‰€æœ‰æƒå¯ä»¥è¯´æ˜¯Rustä¸­æœ€ä¸ºç‹¬ç‰¹çš„ä¸€ä¸ªåŠŸèƒ½äº†ã€‚æ­£æ˜¯æ‰€æœ‰æƒæ¦‚å¿µå’Œç›¸å…³å·¥å…·çš„å¼•å…¥ï¼ŒRustæ‰èƒ½å¤Ÿåœ¨æ²¡æœ‰åƒåœ¾å›æ”¶æœºåˆ¶çš„å‰æä¸‹ä¿éšœå†…å­˜å®‰å…¨ã€‚å› æ­¤ï¼Œæ­£ç¡®åœ°äº†è§£æ‰€æœ‰æƒæ¦‚å¿µåŠå…¶åœ¨Rustä¸­çš„å®ç°æ–¹å¼ï¼Œå¯¹äºæ‰€æœ‰Rustå¼€å‘è€…æ¥è®²éƒ½æ˜¯ååˆ†é‡è¦çš„ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šè¯¦ç»†åœ°è®¨è®ºæ‰€æœ‰æƒåŠå…¶ç›¸å…³åŠŸèƒ½ï¼šå€Ÿç”¨ã€åˆ‡ç‰‡ï¼Œä»¥åŠRuståœ¨å†…å­˜ä¸­å¸ƒå±€æ•°æ®çš„æ–¹å¼ã€‚</p>
</blockquote>
<p>æ‰€æœ‰æƒå°±æ˜¯æŒ‡ä¸€ä¸ªä¸œè¥¿å½’å±è°ã€‚Rust ä¸­ä¸€ä¸ªå˜é‡å¯¹åº”ä¸€ä¸ªå€¼ï¼Œå˜é‡å°±ç§°ä¸ºè¿™ä¸ªå€¼çš„æ‰€æœ‰è€…ã€‚</p>
<pre class="line-numbers"><code class="language-rust">lex x = 5;
</code></pre>
<p>è¿™å¥è¯çš„æ„æ€å°±æ˜¯ï¼Œ5è¿™ä¸ªæ•°å­—æ‰€åœ¨çš„å†…å­˜å—çš„æ‰€æœ‰è€…æ˜¯ xã€‚</p>
<h2><a id="%E6%89%80%E6%9C%89%E6%9D%83%E8%A7%84%E5%88%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ‰€æœ‰æƒè§„åˆ™</h2>
<ol>
<li>Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å˜é‡ä½œä¸ºå®ƒçš„æ‰€æœ‰è€…</li>
<li>åœ¨åŒä¸€æ—¶é—´å†…ï¼Œå€¼æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ‰€æœ‰è€…</li>
<li>å½“æ‰€æœ‰è€…ç¦»å¼€è‡ªå·±çš„ä½œç”¨åŸŸæ—¶ï¼Œå®ƒæŒæœ‰çš„å€¼å°±ä¼šè¢«é‡Šæ”¾æ‰</li>
</ol>
<h2><a id="%E5%8F%98%E9%87%8F%E5%92%8C%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%9A%E7%A7%BB%E5%8A%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šç§»åŠ¨</h2>
<p>æŠŠä¸€ä¸ªå˜é‡èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡</p>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let x = 5;
    let y = x;
    println!(&quot;x = {}, y = {}&quot;, x, y);


    let s1 = String::from(&quot;hello&quot;);
    let s2 = s1;
    println!(&quot;s1 = {}, s2 = {}&quot;, s1, s2);
}
</code></pre>
<p>è¿™æ®µä»£ç çš„ä½œç”¨å°±æ˜¯ æŠŠä¸€ä¸ªå˜é‡èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ã€‚</p>
<p>æ•´æ•°æ˜¯å·²çŸ¥å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œx y ä¸¤ä¸ªå€¼ 5 ä¼šåŒæ—¶è¢«æ¨å…¥åˆ°å½“å‰çš„æ ˆä¸­ã€‚</p>
<p>ç„¶è€Œï¼Œå°† s1 èµ‹å€¼ç»™ s2 æ—¶ï¼Œä¾¿å¤åˆ¶äº†ä¸€æ¬¡ String çš„æ•°æ®ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¤åˆ¶äº†å®ƒå­˜å‚¨åœ¨æ ˆä¸Šçš„æŒ‡é’ˆã€é•¿åº¦åŠå®¹é‡å­—æ®µï¼Œæ²¡æœ‰å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„å †æ•°æ®ã€‚æ­¤æ—¶çš„å†…å­˜å¸ƒå±€åº”è¯¥æ˜¯è¿™æ ·ï¼š</p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/2022-10-31-16.48.47.png" alt="2022-10-31-16.48.47" /></p>
<p>ä¸ºäº†ç¡®ä¿å†…å­˜å®‰å…¨ï¼Œé¿å…å¤åˆ¶åˆ†é…çš„å†…å­˜ï¼ŒRust åœ¨è¿™ç§åœºæ™¯ä¸‹å›ç®€å•çš„å°† s1 åºŸå¼ƒï¼Œä¸å†è§†å…¶ä¸ºä¸€ä¸ªæœ‰æ•ˆçš„å˜é‡ã€‚<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/2022-10-31-17.03.02.png" alt="2022-10-31-17.03.02" /></p>
<p>ä¹Ÿå°±è§£é‡Šäº†è¿™æ®µä»£ç æ‰§è¡Œä¸ºä»€ä¹ˆæŠ¥é”™</p>
<pre class="line-numbers"><code class="language-plain_text">error[E0382]: borrow of moved value: `s1`
  --&gt; src/main.rs:11:34
   |
8  |     let s1 = String::from(&quot;hello&quot;);
   |         -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait
9  |     let s2 = s1;
   |              -- value moved here
10 |
11 |     println!(&quot;s1 = {}, s2 = {}&quot;, s1, s2);
   |                                  ^^ value borrowed here after move
   |
   = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)
</code></pre>
<p>æ€»çš„æ¥è¯´ ç§»åŠ¨(move) è¿™ç§å˜é‡å’Œæ•°æ®äº¤äº’æ–¹å¼ï¼Œä»…ä»…æ˜¯å°†æ ˆä¸Šçš„æ•°æ®ç§»åŠ¨äº†ï¼Œå †æ•°æ®è¿˜æ˜¯åŒä¸€ä¸ªï¼Œå¹¶ä¸”å°†ç§»åŠ¨å‰çš„å˜é‡ s1 è®¾ç½®ä¸ºå¤±æ•ˆï¼Œæ„å‘³ç€ s1 å’Œå †æ•°æ®ä¹‹é—´çš„ç»‘å®šå…³ç³»å·²ç»ä¸å­˜åœ¨äº†(ç›¸å½“äºä¸€ä¸ªé‡æŒ‡é’ˆ?)ã€‚æ‰€ä»¥ç§»åŠ¨ååœ¨è®¿é—® s1 æ˜¯ä¸è¢«å…è®¸çš„ã€‚</p>
<h2><a id="%E5%8F%98%E9%87%8F%E5%92%8C%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%9A%E5%85%8B%E9%9A%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šå…‹éš†</h2>
<pre class="line-numbers"><code class="language-rust">let mut s1 = String::from(&quot;hello&quot;);
// let s2 = s1;
let s2 = s1.clone();

s1.push_str(&quot;, world&quot;);
println!(&quot;s1 = {}, s2 = {}&quot;, s1, s2);
</code></pre>
<p>å…‹éš† = æ·±åº¦ copy å †ä¸Šçš„æ•°æ®ã€‚s1ã€s2 æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å˜é‡ï¼ŒæŒ‡å‘çš„å †æ•°æ®ä¹Ÿä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥åœ¨ clone åå¯¹ s1 è¿›è¡Œä¿®æ”¹ï¼Œs2 è¿˜æ˜¯ä¸å˜çš„ã€‚</p>
<p>trait ï¼šCopy ã€Drop</p>
<p>å½“ä¸€ç§ç±»å‹æ‹¥æœ‰äº† Copy è¿™ç§ traitï¼Œé‚£ä¹ˆå®ƒçš„å˜é‡å°±å¯ä»¥åœ¨èµ‹å€¼ç»™å…¶ä»–å˜é‡ä¹‹åä¿æŒå¯ç”¨æ€§ã€‚</p>
<p>å¦‚æœä¸€ç§ç±»å‹å®ç°äº† Dropï¼Œé‚£ä¹ˆ Rust å°±ä¸å…è®¸å®ƒå†å®ç° Copyã€‚</p>
<h2><a id="%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%8E%E5%87%BD%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ‰€æœ‰æƒä¸å‡½æ•°</h2>
<p>å°†å€¼ä¼ é€’ç»™å‡½æ•°åœ¨è¯­ä¹‰ä¸Šç±»ä¼¼äºå¯¹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œä¼šè§¦å‘ç§»åŠ¨æˆ–è€…å¤åˆ¶ï¼Œå°±åƒèµ‹å€¼è¯­å¥ä¸€æ ·ã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let x = 5;
    show(x);
    println!(&quot;x = {}&quot;, x);

    let s1 = String::from(&quot;hello&quot;);
    show_str(s1);
    println!(&quot;å‡½æ•°å¤–éƒ¨ s1 = {}&quot;, s1)
}

fn show(x: i32) {
    println!(&quot;å‡½æ•°å†…éƒ¨ x = {}&quot;, x)
}

fn show_str(s: String) {
    println!(&quot;å‡½æ•°å†…éƒ¨ s1 = {}&quot;, s)
}

</code></pre>
<p>string ç±»å‹å˜é‡å½“åšå‚æ•°ä¼ é€’ç»™å‡½æ•°åï¼Œå˜é‡çš„æ‰€æœ‰æƒä¼šç§»åŠ¨åˆ°å‡½æ•°çš„ä½œç”¨åŸŸå†…ï¼Œmain å‡½æ•°ä¸­å°±ä¸åœ¨æŒæœ‰å½“å‰å˜é‡çš„æ‰€æœ‰æƒäº†ï¼Œæ‰€ä»¥å½“è°ƒç”¨ show_str ä¹‹ååœ¨è®¿é—® s1å°±ä¼šæŠ¥é”™ã€‚</p>
<p>ä»å¦ä¸€ä¸ªæ–¹é¢æ¥ç†è§£ï¼Œå‡½æ•°æ‰§è¡Œç»“æŸåä¼šé”€æ¯å˜é‡å¯¹åº”çš„å†…å­˜ç©ºé—´ï¼Œç„¶ååœ¨ main å‡½æ•°ä¸­è®¿é—®ä¸€ä¸ªå·²ç»ç§»é™¤è°ƒçš„å†…å­˜ç©ºé—´æŠ¥é”™ä¹Ÿæ˜¯åˆæƒ…åˆç†çš„ã€‚</p>
<blockquote>
<p>èµ‹å€¼å¹¶ä¸æ˜¯å”¯ä¸€æ¶‰åŠç§»åŠ¨çš„æ“ä½œã€‚å€¼åœ¨ä½œä¸ºå‚æ•°ä¼ é€’æˆ–ä»å‡½æ•°è¿”å›æ—¶ä¹Ÿä¼šè¢«ç§»åŠ¨ã€‚</p>
</blockquote>
<pre class="line-numbers"><code class="language-plain_text">error[E0382]: borrow of moved value: `s1`
 --&gt; src/main.rs:8:30
  |
6 |     let s1 = String::from(&quot;hello&quot;);
  |         -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait
7 |     show_str(s1);
  |              -- value moved here
8 |     println!(&quot;å‡½æ•°å†…éƒ¨ s1 = {}&quot;, s1)
  |                                  ^^ value borrowed here after move
  |
  = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)
</code></pre>
<h2><a id="%E5%BC%95%E7%94%A8%E4%B8%8E%E5%80%9F%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¼•ç”¨ä¸å€Ÿç”¨</h2>
<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨å‡½æ•°ç»“æŸåè¿˜æƒ³è¦ä½¿ç”¨å˜é‡ï¼Œå¯ä»¥å°†å˜é‡çš„å¼•ç”¨ä¼ é€’åˆ°å‚æ•°ä¸­ã€‚</p>
<p>å¼•ç”¨å…è®¸åœ¨ä¸è·å–æ‰€æœ‰æƒçš„æƒ…å†µä¸‹ä½¿ç”¨å€¼ã€‚</p>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let x = 5;
    show(x);
    println!(&quot;x = {}&quot;, x);

    let s1 = String::from(&quot;hello&quot;);
    show_str(&amp;s1);
    println!(&quot;å‡½æ•°å¤–éƒ¨ s1 = {}&quot;, s1)
}

fn show(x: i32) {
    println!(&quot;å‡½æ•°å†…éƒ¨ x = {}&quot;, x)
}

fn show_str(s: &amp;String) {
    println!(&quot;å‡½æ•°å†…éƒ¨ s1 = {}&quot;, s)
}

</code></pre>
<p>ä¿®æ”¹ç‚¹</p>
<ol>
<li>show_str(&amp;s1);ä¼ é€’å‚æ•°ï¼Œä¼ çš„æ˜¯ s1 çš„å¼•ç”¨</li>
<li>fn show_str(s: &amp;String) ä¿®æ”¹ä¸º String çš„å¼•ç”¨ç±»å‹</li>
</ol>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/2022-10-31-17.38.00.png" alt="2022-10-31-17.38.00" /></p>
<p>&amp;s1ï¼ŒæŒ‡åœ¨ä¸è½¬ç§»æ‰€æœ‰æƒçš„å‰æä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæŒ‡å‘ s1 å€¼çš„å¼•ç”¨ï¼Œå¼•ç”¨ä¸æŒæœ‰ s1 çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥åœ¨å‡½æ•°ç»“æŸæ—¶ï¼ŒåŸ s1 ä»ç„¶å¯ç”¨ã€‚<br />
å‡½æ•°ç­¾åä¸­çš„ &amp; ç”¨æ¥è¡¨åå‚æ•° s çš„ç±»å‹æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚s å¹¶ä¸æŒæœ‰æŒ‡å‘å€¼çš„æ‰€æœ‰æƒï¼Œåœ¨å‡½æ•°ç»“æŸæ—¶ä¸ä¼šé”€æ¯æŒ‡å‘å€¼ã€‚</p>
<p><strong>é€šè¿‡å¼•ç”¨ä¼ é€’å‚æ•°ç»™å‡½æ•°çš„æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºå€Ÿç”¨ã€‚</strong></p>
<h2><a id="%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¯å˜å¼•ç”¨</h2>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let mut s1 = String::from(&quot;hello&quot;);
    show_str(&amp;mut s1);
    println!(&quot;å‡½æ•°å¤–éƒ¨ s1 = {}&quot;, s1)
}

fn show_str(s: &amp;mut String) {
    println!(&quot;å‡½æ•°å†…éƒ¨ s1 = {}&quot;, s);
    s.push_str(&quot;, world&quot;);
}
</code></pre>
<p>mut è¡¨ç¤ºå¯å˜çš„ï¼Œå˜é‡ä½¿ç”¨ mutï¼Œå¼•ç”¨ä½¿ç”¨ &amp;mutã€‚<br />
é€šè¿‡ mut å…³é”®å­—å°†å˜é‡æˆ–è€…å¼•ç”¨å£°æ˜ä¸ºå¯å˜çš„ã€‚<br />
å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å…¶å¼•ç”¨å˜é‡çš„å€¼ã€‚<br />
ä¸€ä¸ªå˜é‡å¯ä»¥æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ª<strong>å¯å˜å¼•ç”¨</strong>ã€‚<br />
ä¸€ä¸ªå˜é‡ä¸èƒ½åŒæ—¶æœ‰ä¸å¯å˜å¼•ç”¨å’Œå¯å˜å¼•ç”¨ã€‚</p>
<h2><a id="%E6%82%AC%E5%9E%82%E5%BC%95%E7%94%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ‚¬å‚å¼•ç”¨</h2>
<p>è¿™ç±»æŒ‡é’ˆæŒ‡å‘æ›¾ç»å­˜åœ¨æŸå¤„å†…å­˜åœ°å€ï¼Œä½†è¯¥å†…å­˜å·²ç»è¢«é‡Šæ”¾æ‰ç”šè‡³è¢«é‡æ–°åˆ†é…å¦ä½œä»–ç”¨äº†ã€‚</p>
<p>è¿™ä¸å°±æ˜¯é‡æŒ‡é’ˆï¼Ÿ</p>
<p>rust è¯­è¨€ä¸­ ï¼Œç¼–è¯‘å™¨ä¼š ç¡®ä¿å¼•ç”¨æ°¸è¿œä¸ä¼šè¿›å…¥è¿™ç§æ‚¬å‚çŠ¶æ€ã€‚</p>
<p>å‡å¦‚å½“å‰æŒæœ‰æŸä¸€ä¸ªæ•°æ®çš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨ä¿è¯è¿™ä¸ªæ•°æ®ä¸ä¼šåœ¨å¼•ç”¨è¢«é”€æ¯å‰ç¦»å¼€è‡ªå·±çš„ä½œç”¨åŸŸã€‚</p>
<p>åˆ›é€ ä¸€ä¸ªæ‚¬å‚å¼•ç”¨çš„ä¾‹å­ï¼š</p>
<pre class="line-numbers"><code class="language-rust">fn main() {
    let x = dangle();
    println!(&quot;x = {}&quot;, x)
}

fn dangle() -&gt; &amp;String {
    let s = String::from(&quot;hello&quot;);
    return &amp;s;
}
</code></pre>
<p>dangle å‡½æ•°ï¼Œè¿”å› String çš„å¼•ç”¨ï¼Œå‡½æ•°å†…éƒ¨ï¼Œå£°æ˜äº†ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¿”å›ç»™è°ƒç”¨è€… s çš„å¼•ç”¨ï¼Œçœ‹ç€è²Œä¼¼æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p>
<p>ç”±äºå˜é‡ s åˆ›å»ºåœ¨å‡½æ•°å†…ï¼Œæ‰€ä»¥å®ƒä¼šåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•æ—¶éšä¹‹é‡Šæ”¾ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä»£ç ä¾æ—§è¿”å›æŒ‡å‘ s çš„å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨æŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ— æ•ˆçš„å†…å­˜åœ°å€ã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">error[E0106]: missing lifetime specifier
 --&gt; src/main.rs:6:16
  |
6 | fn dangle() -&gt; &amp;String {
  |                ^ expected named lifetime parameter
  |
  = help: this function's return type contains a borrowed value, but there is no value for it to be borrowed from
help: consider using the `'static` lifetime
  |
6 | fn dangle() -&gt; &amp;'static String {
  |                 +++++++

</code></pre>
<h2><a id="%E5%88%87%E7%89%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>åˆ‡ç‰‡</h2>
<p>åˆ‡ç‰‡ä¹Ÿæ˜¯ä¸æŒæœ‰æ‰€æœ‰æƒçš„æ•°æ®ç±»å‹ã€‚<br />
åˆ‡ç‰‡ï¼šé›†åˆä¸­æŸä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸æ˜¯æ•´ä¸ªé›†åˆã€‚</p>
<p>å­—ç¬¦ä¸²å­—é¢é‡å°±æ˜¯åˆ‡ç‰‡ã€‚</p>
<h2><a id="%E6%80%BB%E7%BB%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ€»ç»“</h2>
<p>æ‰€æœ‰æƒæ˜¯ Rust åŒºåˆ«äºå…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚<br />
å˜é‡ç§°ä¸ºå…¶å¯¹åº”çš„å†…å­˜å—çš„æ‰€æœ‰è€…ï¼Œå˜é‡æ‹¥æœ‰æ‰€æœ‰æƒã€‚</p>
<p>æ‰€æœ‰æƒå‘ç”Ÿç§»åŠ¨çš„å‡ ä¸ªæ–¹å¼</p>
<ol>
<li>å˜é‡èµ‹å€¼ç»™å…¶ä»–å˜é‡</li>
<li>å˜é‡å½“åšå‚æ•°ä¼ é€’åˆ°å‡½æ•°</li>
<li>å‡½æ•°è¿”å›å€¼èµ‹å€¼ç»™å˜é‡</li>
</ol>
<p>ä½œç”¨åŸŸå¯ä»¥ç®€å•ç†è§£ä¸º{}ï¼Œå¤§æ‹¬å·å†…éƒ¨ç§°ä¸ºä¸€ä¸ªä½œç”¨åŸŸã€‚<br />
å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå˜é‡ä¼šè‡ªåŠ¨é‡Šæ”¾å…¶æ‰€æœ‰æƒã€‚</p>
<p>æ‰€æœ‰æƒåªä¼šå‘ç”Ÿåœ¨å †ä¸Šåˆ†é…çš„æ•°æ®ï¼Œæ ˆä¸Šåˆ†é…çš„æ•°æ®æ²¡æœ‰æ‰€æœ‰æƒçš„æ¦‚å¿µã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java å¤ªå·äº†è½¬ GOï¼ˆäºŒï¼‰]]></title>
    <link href="http://blog.hitol.top/16626878291486.html"/>
    <updated>2022-09-09T09:43:49+08:00</updated>
    <id>http://blog.hitol.top/16626878291486.html</id>
    <content type="html"><![CDATA[
<p>ä¸Šä¸€ç¯‡æ–‡ç« ç®€å•çš„å­¦ä¹ äº† GO çš„åŸºç¡€è¯­æ³•ï¼Œæœ¬ç¯‡æ–‡ç« ç”¨ GO çš„æ¡†æ¶å¼€å‘ä¸€ä¸ªçŸ­é“¾åº”ç”¨ã€‚</p>
<p>çŸ­é“¾åº”ç”¨åŠŸèƒ½ï¼š</p>
<ol>
<li>åˆ›å»ºçŸ­é“¾</li>
<li>æ ¹æ®çŸ­é“¾ code é‡å®šå‘åˆ°åŸå§‹é“¾æ¥</li>
</ol>
<p>ä¸»è¦ç”¨åˆ°çš„æ¡†æ¶ï¼š</p>
<ol>
<li>ORM æ¡†æ¶ gorm<br />
<a href="https://gorm.io/zh_CN/docs/index.html">https://gorm.io/zh_CN/docs/index.html</a></li>
<li>Web æ¡†æ¶ gin<br />
<a href="https://gin-gonic.com/zh-cn/docs/">https://gin-gonic.com/zh-cn/docs/</a></li>
</ol>
<h2><a id="gin" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>gin</h2>
<p>æœ€å¿«çš„ http è·¯ç”±å™¨å’Œæ¡†æ¶ã€‚</p>
<pre class="line-numbers"><code class="language-go">package main

import &quot;github.com/gin-gonic/gin&quot;

func main() {
	r := gin.Default()
	r.GET(&quot;/ping&quot;, func(c *gin.Context) {
		c.JSON(200, gin.H{
			&quot;message&quot;: &quot;pong&quot;,
		})
	})
	r.Run() // ç›‘å¬å¹¶åœ¨ 0.0.0.0:8080 ä¸Šå¯åŠ¨æœåŠ¡
}
</code></pre>
<p>ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œå¯åŠ¨åæµè§ˆå™¨è®¿é—® <a href="http://localhost:8080/ping">http://localhost:8080/ping</a></p>
<p>ä½¿ç”¨è·¯ç”±ï¼š</p>
<pre class="line-numbers"><code class="language-go">func main() {
	engine := gin.Default()
	engine.Group(&quot;/&quot;)

	engine.GET(&quot;/ping&quot;, func(context *gin.Context) {
		context.JSON(200, gin.H{
			&quot;message&quot;: &quot;pong&quot;,
		})
	})
	engine.Run()
}
</code></pre>
<p>å°†æ¥å£æ”¾åœ¨ç¨‹åºå…¥å£ main æ–¹æ³•ä¸­ä¸å¤ªåˆé€‚ï¼Œé€šå¸¸ä¼šåˆ›å»ºå¤šä¸ª handlerï¼Œç±»ä¼¼äº java ä¸­çš„ controllerã€‚</p>
<h2><a id="gorm" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>gorm</h2>
<p>è¿æ¥æ•°æ®åº“</p>
<pre class="line-numbers"><code class="language-go">// æ•°æ®åº“è¿æ¥ï¼š&quot;ç”¨æˆ·å:å¯†ç @tcp(IP:ç«¯å£)/æ•°æ®åº“?charset=utf8&quot;
sqlcon := &quot;root:123456@tcp(127.0.0.1:3306)/amc?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;


DB, err := gorm.Open(mysql.Open(sqlcon), &amp;gorm.Config{
	DisableForeignKeyConstraintWhenMigrating: true, //ç¦ç”¨ç‰©ç†å¤–é”®
})
if err != nil {
	log.Fatal(&quot;è¿æ¥å¤±è´¥ï¼&quot;)
	return nil
}
// è¿æ¥æ± è®¾ç½®
sqlDB, err := DB.DB()
// è®¾ç½®æ•°æ®åº“æœ€å¤§è¿æ¥æ•°
sqlDB.SetMaxOpenConns(500)
// è®¾ç½®æ•°æ®åº“æœ€å¤§é—²ç½®æ•°
sqlDB.SetMaxIdleConns(20)
// å…¨å±€ç¦ç”¨è¡¨åå¤æ•°
//sqlDB.SingularTable(true)
// è°ƒè¯•æ¨¡å¼ï¼Œå¯ä»¥æ‰“å°sqlè¯­å¥
//sqlDB.LogMode(true)
</code></pre>
<h3><a id="crud" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>CRUD</h3>
<h4><a id="insert" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>insert</h4>
<p>ä¿å­˜å•æ¡æ•°æ®</p>
<pre class="line-numbers"><code class="language-go">createConfig := dao.ShortLinkConfig{
	Enable:      1,
	OriginUrl:   &quot;http://localhost:8080&quot;,
	ShortCode:   &quot;test&quot;,
	CreatedTime: time.Now(),
	UpdatedTime: time.Now(),
}
mysql.Db.Save(&amp;createConfig)
</code></pre>
<p>ä¿å­˜å¤šæ¡æ•°æ®</p>
<pre class="line-numbers"><code class="language-go">shortLinkConfigs := []dao.ShortLinkConfig{
	{
		Enable:      1,
		OriginUrl:   &quot;http://localhost:8080&quot;,
		ShortCode:   &quot;test1&quot;,
		CreatedTime: time.Now(),
		UpdatedTime: time.Now()},
	{
		Enable:      1,
		OriginUrl:   &quot;http://localhost:8080&quot;,
		ShortCode:   &quot;test2&quot;,
		CreatedTime: time.Now(),
		UpdatedTime: time.Now(),
	},
	{
		Enable:      1,
		OriginUrl:   &quot;http://localhost:8080&quot;,
		ShortCode:   &quot;test3&quot;,
		CreatedTime: time.Now(),
		UpdatedTime: time.Now(),
	},
}
// æ‰¹é‡æ•°æ®ä¸€æ¬¡æ€§æ’å…¥
//mysql.Db.Create(&amp;shortLinkConfigs)
// åˆ†æ‰¹æ¬¡æ’å…¥
mysql.Db.CreateInBatches(&amp;shortLinkConfigs, 1000)
</code></pre>
<h4><a id="select" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>select</h4>
<pre class="line-numbers"><code class="language-go">config := dao.ShortLinkConfig{
	Enable: 1,
}

var shortLinkConfig = dao.ShortLinkConfig{}

//è·å–ç¬¬ä¸€æ¡è®°å½•ï¼Œä¸»é”®å‡åº select * from table ORDER BY id asc LIMIT 1
mysql.Db.Where(&amp;config).First(&amp;shortLinkConfig)
log.Printf(&quot;first config = %v&quot;, shortLinkConfig)

shortLinkConfig = dao.ShortLinkConfig{}
//è·å–æœ€åä¸€æ¡è®°å½•ï¼Œä¸»é”®é™åº select * from table ORDER BY id desc LIMIT 1
mysql.Db.Where(&amp;config).Last(&amp;shortLinkConfig)
log.Printf(&quot;last config = %v&quot;, shortLinkConfig)

shortLinkConfig = dao.ShortLinkConfig{}
// è·å–ä¸€æ¡è®°å½•ï¼Œæ²¡æœ‰æŒ‡å®šå­—æ®µæ’åº
mysql.Db.Where(&amp;config).Take(&amp;shortLinkConfig)
log.Printf(&quot;config = %v&quot;, shortLinkConfig)

shortLinkConfig = dao.ShortLinkConfig{}
mysql.Db.First(&amp;shortLinkConfig, 9)
log.Printf(&quot;id = 9,config = %v&quot;, shortLinkConfig)

// æŸ¥è¯¢å¤šæ¡è®°å½•
shortLinkConfigs := make([]dao.ShortLinkConfig, 3)
mysql.Db.Find(&amp;shortLinkConfigs, []int{8, 9, 10})
for i, linkConfig := range shortLinkConfigs {
	log.Printf(&quot;i = %d,config = %v&quot;, i, linkConfig)
}

// æŒ‡å®šå­—æ®µæŸ¥è¯¢
shortCode := &quot;acegf&quot;
shortLinkConfig = dao.ShortLinkConfig{}
mysql.Db.Where(&quot;short_code = ? and enable = 1&quot;, shortCode).First(&amp;shortLinkConfig)
log.Printf(&quot;short_code = %s,config = %v&quot;, shortCode, shortLinkConfig)

// æŒ‡å®šå­—æ®µæŸ¥è¯¢ struct,è¿™ç§æ–¹å¼è¦æ±‚ struct ä¸­çš„å­—æ®µä¸èƒ½ä¸ºé›¶å€¼ï¼Œ0ã€false è¿™ç§æ˜¯ä¸ä¼šåˆ›å»ºæŸ¥è¯¢æ¡ä»¶çš„ã€‚
shortLinkConfig = dao.ShortLinkConfig{}
mysql.Db.Where(&amp;dao.ShortLinkConfig{ShortCode: shortCode, Enable: 0}).First(&amp;shortLinkConfig)
log.Printf(&quot;short_code = %s,enable = 0,config = %v&quot;, shortCode, shortLinkConfig)

// æŒ‡å®šå­—æ®µæŸ¥è¯¢ map
shortLinkConfigs = make([]dao.ShortLinkConfig, 10)
mysql.Db.Where(map[string]interface{}{&quot;enable&quot;: 1, &quot;short_code&quot;: shortCode}).Find(&amp;shortLinkConfigs)
for i, linkConfig := range shortLinkConfigs {
	log.Printf(&quot; --- i = %d,config = %v&quot;, i, linkConfig)
}

</code></pre>
<h4><a id="update" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>update</h4>
<p>Save</p>
<pre class="line-numbers"><code class="language-go">shortCode := &quot;test3&quot;
shortLinkConfig := dao.ShortLinkConfig{}
mysql.Db.Where(&quot;short_code = ? and enable = 1&quot;, shortCode).First(&amp;shortLinkConfig)
log.Printf(&quot;short_code = %s,config = %v&quot;, shortCode, shortLinkConfig)

shortLinkConfig.ShortCode = &quot;test5&quot;
mysql.Db.Save(&amp;shortLinkConfig)
</code></pre>
<p>Update æ›´æ–°å•ä¸ªåˆ—</p>
<pre class="line-numbers"><code class="language-go">// update short_link_config set short_code = &quot;123&quot; where short_code = &quot;test5&quot; and enable = 1
mysql.Db.Model(&amp;dao.ShortLinkConfig{}).Where(&quot;short_code = ? and enable = 1&quot;, shortCode).Update(&quot;short_code&quot;, &quot;123&quot;)
</code></pre>
<p>æ›´æ–°å¤šåˆ—,struct æ–¹å¼,åªä¼šæ›´æ–°éé›¶å€¼</p>
<pre class="line-numbers"><code class="language-go">mysql.Db.Where(&amp;dao.ShortLinkConfig{
	Enable: 1,
}).Updates(dao.ShortLinkConfig{
	Enable:    0,
	OriginUrl: &quot;http://www.123.com&quot;,
})
</code></pre>
<p>æ›´æ–°å¤šåˆ—ï¼Œmap æ–¹å¼</p>
<pre class="line-numbers"><code class="language-go">mysql.Db.Model(&amp;dao.ShortLinkConfig{}).Where(&amp;dao.ShortLinkConfig{Enable: 1}).Updates(map[string]interface{}{&quot;origin_url&quot;: &quot;http://www.baidu.com&quot;})
</code></pre>
<h4><a id="delete" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>delete</h4>
<p>æ ¹æ®ä¸»é”®åˆ é™¤</p>
<pre class="line-numbers"><code class="language-go">// delete from short_link_config where id = 10
mysql.Db.Delete(&amp;dao.ShortLinkConfig{}, 10)
</code></pre>
<hr />
<p>çŸ­é“¾åº”ç”¨ï¼š<br />
github: <a href="https://github.com/hitolz/shortLink">https://github.com/hitolz/shortLink</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java å¤ªå·äº†è½¬ GOï¼ˆä¸€ï¼‰]]></title>
    <link href="http://blog.hitol.top/16625340324703.html"/>
    <updated>2022-09-07T15:00:32+08:00</updated>
    <id>http://blog.hitol.top/16625340324703.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%8F%98%E9%87%8F%E7%9A%84%E5%A3%B0%E6%98%8E">å˜é‡çš„å£°æ˜</a></li>
<li><a href="#%E5%B8%B8%E9%87%8F">å¸¸é‡</a>
<ul>
<li><a href="#%E6%9E%9A%E4%B8%BE">æšä¸¾</a></li>
<li><a href="#iota">iota</a></li>
</ul>
</li>
<li><a href="#%E5%87%BD%E6%95%B0">å‡½æ•°</a>
<ul>
<li><a href="#main%E5%87%BD%E6%95%B0">main å‡½æ•°</a></li>
<li><a href="#init%E5%87%BD%E6%95%B0">init å‡½æ•°</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F">æ‰§è¡Œé¡ºåº</a></li>
<li><a href="#%E5%80%BC%E4%BC%A0%E9%80%92">å€¼ä¼ é€’</a></li>
<li><a href="#%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%EF%BC%88%E6%8C%87%E9%92%88%E4%BC%A0%E9%80%92%EF%BC%89">å¼•ç”¨ä¼ é€’ï¼ˆæŒ‡é’ˆä¼ é€’ï¼‰</a></li>
</ul>
</li>
<li><a href="#defer">defer</a></li>
<li><a href="#%E6%95%B0%E7%BB%84">æ•°ç»„</a>
<ul>
<li><a href="#%E5%88%87%E7%89%87">åˆ‡ç‰‡</a></li>
<li><a href="#append%E5%92%8C-copy%E5%87%BD%E6%95%B0">append å’Œ copy å‡½æ•°</a></li>
</ul>
</li>
<li><a href="#map">map</a></li>
<li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93">ç»“æ„ä½“</a></li>
<li><a href="#%E7%BB%A7%E6%89%BF">ç»§æ‰¿</a>
<ul>
<li><a href="#method">method</a></li>
<li><a href="#method%E7%BB%A7%E6%89%BF">method ç»§æ‰¿</a></li>
</ul>
</li>
<li><a href="#interface">interface</a></li>
</ul>
</div>
<p>GO çš„ä¸€äº›åŸºç¡€ç”¨æ³•ï¼Œå¸®åŠ© Java ç¨‹åºå‘˜å¿«é€Ÿè½¬ GOã€‚</p>
<h2><a id="%E5%8F%98%E9%87%8F%E7%9A%84%E5%A3%B0%E6%98%8E" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å˜é‡çš„å£°æ˜</h2>
<ol>
<li>ç¬¬ä¸€ç§ï¼ŒæŒ‡å®šå˜é‡ç±»å‹ï¼Œå£°æ˜åè‹¥ä¸èµ‹å€¼ï¼Œä½¿ç”¨é»˜è®¤å€¼0ã€‚</li>
</ol>
<pre class="line-numbers"><code class="language-go">var a int
var a int = 10
</code></pre>
<ol start="2">
<li>æ ¹æ®å€¼è‡ªè¡Œåˆ¤å®šå˜é‡ç±»å‹ã€‚</li>
</ol>
<pre class="line-numbers"><code class="language-go">var a = 10
</code></pre>
<ol start="3">
<li>ç¬¬ä¸‰ç§ï¼Œçœç•¥var, æ³¨æ„ :=å·¦ä¾§çš„å˜é‡ä¸åº”è¯¥æ˜¯å·²ç»å£°æ˜è¿‡çš„ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚</li>
</ol>
<pre class="line-numbers"><code class="language-go">a := 10
</code></pre>
<h2><a id="%E5%B8%B8%E9%87%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¸¸é‡</h2>
<pre class="line-numbers"><code class="language-go">const b int = 10
const b = 10
</code></pre>
<h3><a id="%E6%9E%9A%E4%B8%BE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æšä¸¾</h3>
<p>å¸¸é‡å¯ä»¥ç”¨ä½œæšä¸¾</p>
<pre class="line-numbers"><code class="language-go">const (
    Unknown = 0
    Female = 1
    Male = 2
)
</code></pre>
<h3><a id="iota" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>iota</h3>
<p>å®ƒç®€åŒ–äº†å¸¸é‡ç”¨äºå¢é•¿æ•°å­—çš„å®šä¹‰</p>
<pre class="line-numbers"><code class="language-go">const (
    CategoryBooks = iota // 0
    CategoryHealth       // 1
    CategoryClothing     // 2
)
</code></pre>
<h2><a id="%E5%87%BD%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å‡½æ•°</h2>
<pre class="line-numbers"><code class="language-go">package main

import &quot;fmt&quot;

func main() {

	var a int = 10
	var b int = 20

	fmt.Println(&quot;1--&quot;, a, b)

	swap(a, b)
	fmt.Println(&quot;2--&quot;, a, b)
}

func swap(a int, b int) {
	var c int = a
	a = b
	b = c
}
</code></pre>
<h3><a id="main%E5%87%BD%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>main å‡½æ•°</h3>
<p>main å‡½æ•°åªèƒ½å‡ºç°åœ¨ package main ä¸­ã€‚æ˜¯ç¨‹åºçš„å…¥å£ã€‚</p>
<h3><a id="init%E5%87%BD%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>init å‡½æ•°</h3>
<p>init å‡½æ•°å¯åœ¨package mainä¸­ï¼Œå¯åœ¨å…¶ä»–packageä¸­ï¼Œå¯åœ¨åŒä¸€ä¸ªpackageä¸­å‡ºç°å¤šæ¬¡ã€‚</p>
<h3><a id="%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ‰§è¡Œé¡ºåº</h3>
<p>golangé‡Œé¢æœ‰ä¸¤ä¸ªä¿ç•™çš„å‡½æ•°ï¼šinitå‡½æ•°ï¼ˆèƒ½å¤Ÿåº”ç”¨äºæ‰€æœ‰çš„packageï¼‰å’Œmainå‡½æ•°ï¼ˆåªèƒ½åº”ç”¨äºpackage mainï¼‰ã€‚è¿™ä¸¤ä¸ªå‡½æ•°åœ¨å®šä¹‰æ—¶ä¸èƒ½æœ‰ä»»ä½•çš„å‚æ•°å’Œè¿”å›å€¼ã€‚</p>
<p>goç¨‹åºä¼šè‡ªåŠ¨è°ƒç”¨init()å’Œmain()ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ã€‚æ¯ä¸ªpackageä¸­çš„initå‡½æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œä½†package mainå°±å¿…é¡»åŒ…å«ä¸€ä¸ªmainå‡½æ•°ã€‚</p>
<p>å¦‚æœmainåŒ…è¿˜å¯¼å…¥äº†å…¶å®ƒçš„åŒ…ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ç¼–è¯‘æ—¶å°†å®ƒä»¬ä¾æ¬¡å¯¼å…¥ã€‚æœ‰æ—¶ä¸€ä¸ªåŒ…ä¼šè¢«å¤šä¸ªåŒ…åŒæ—¶å¯¼å…¥ï¼Œé‚£ä¹ˆå®ƒåªä¼šè¢«å¯¼å…¥ä¸€æ¬¡ï¼ˆä¾‹å¦‚å¾ˆå¤šåŒ…å¯èƒ½éƒ½ä¼šç”¨åˆ°fmtåŒ…ï¼Œä½†å®ƒåªä¼šè¢«å¯¼å…¥ä¸€æ¬¡ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦å¯¼å…¥å¤šæ¬¡ï¼‰ã€‚</p>
<p>å½“ä¸€ä¸ªåŒ…è¢«å¯¼å…¥æ—¶ï¼Œå¦‚æœè¯¥åŒ…è¿˜å¯¼å…¥äº†å…¶å®ƒçš„åŒ…ï¼Œé‚£ä¹ˆä¼šå…ˆå°†å…¶å®ƒåŒ…å¯¼å…¥è¿›æ¥ï¼Œç„¶åå†å¯¹è¿™äº›åŒ…ä¸­çš„åŒ…çº§å¸¸é‡å’Œå˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œæ¥ç€æ‰§è¡Œinitå‡½æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p>
<p><img src="http://hitol.blog.cdn.updev.cn/mweb/16634751307970.jpg" alt="" /></p>
<h3><a id="%E5%80%BC%E4%BC%A0%E9%80%92" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å€¼ä¼ é€’</h3>
<p>å€¼ä¼ é€’æ˜¯æŒ‡åœ¨è°ƒç”¨å‡½æ•°æ—¶å°†å®é™…å‚æ•°å¤åˆ¶ä¸€ä»½ä¼ é€’åˆ°å‡½æ•°ä¸­ï¼Œè¿™æ ·åœ¨å‡½æ•°ä¸­å¦‚æœå¯¹å‚æ•°è¿›è¡Œä¿®æ”¹ï¼Œå°†ä¸ä¼šå½±å“åˆ°å®é™…å‚æ•°ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒGo è¯­è¨€ä½¿ç”¨çš„æ˜¯å€¼ä¼ é€’ï¼Œå³åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå½±å“åˆ°å®é™…å‚æ•°ã€‚</p>
<p>swap å‡½æ•°å°±æ˜¯å€¼ä¼ é€’çš„ï¼Œäº¤æ¢ä¸¤ä¸ªæ•°çš„æ“ä½œï¼Œä½†æ˜¯ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<h3><a id="%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%EF%BC%88%E6%8C%87%E9%92%88%E4%BC%A0%E9%80%92%EF%BC%89" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¼•ç”¨ä¼ é€’ï¼ˆæŒ‡é’ˆä¼ é€’ï¼‰</h3>
<p>&amp;ï¼š å–åœ°å€<br />
*ï¼š è§£å¼•ç”¨</p>
<pre class="line-numbers"><code class="language-go">package main

import &quot;fmt&quot;

func main() {

	var a int = 10
	var b int = 20

	fmt.Println(&quot;1--&quot;, a, b)

	swap2(&amp;a, &amp;b)
	fmt.Println(&quot;2--&quot;, a, b)
}

func swap2(a *int, b *int) {
	var c = *a
	*a = *b
	*b = c
}

</code></pre>
<h2><a id="defer" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>defer</h2>
<p>defer ç›¸å½“äº java ä¸­ finally</p>
<h2><a id="%E6%95%B0%E7%BB%84" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ•°ç»„</h2>
<p>var variable_name [SIZE] variable_type</p>
<pre class="line-numbers"><code class="language-go">var nums [10]int;
</code></pre>
<p>å¦‚æœæ•°ç»„é•¿åº¦ä¸ç¡®å®šï¼Œå¯ä»¥ä½¿ç”¨ ... ä»£æ›¿æ•°ç»„çš„é•¿åº¦</p>
<pre class="line-numbers"><code class="language-go">balance := [...]float32{1000.0, 2.0, 3.4, 7.0, 50.0}
</code></pre>
<h3><a id="%E5%88%87%E7%89%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>åˆ‡ç‰‡</h3>
<p>var identifier []type<br />
æœªæŒ‡å®šå¤§å°çš„æ•°ç»„æ¥å®šä¹‰åˆ‡ç‰‡,åˆ‡ç‰‡ä¸éœ€è¦è¯´æ˜é•¿åº¦ã€‚</p>
<pre class="line-numbers"><code class="language-go">var slice1 []type = make([]type, len)

// ä¹Ÿå¯ä»¥ç®€å†™ä¸º

slice1 := make([]type, len)

// ç›´æ¥åˆå§‹åŒ–
s :=[] int {1,2,3 }

// ç›´æ¥åˆå§‹åŒ–åˆ‡ç‰‡ï¼Œ[]è¡¨ç¤ºæ˜¯åˆ‡ç‰‡ç±»å‹ï¼Œ{1,2,3}åˆå§‹åŒ–å€¼ä¾æ¬¡æ˜¯1,2,3.å…¶cap=len=3
</code></pre>
<p>len()é•¿åº¦,<br />
cap()å®¹é‡ï¼Œå½“é•¿åº¦ç­‰äºå®¹é‡æ—¶æ‰©å®¹ä¸ºå½“å‰é•¿åº¦çš„2å€ã€‚</p>
<h3><a id="append%E5%92%8C-copy%E5%87%BD%E6%95%B0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>append å’Œ copy å‡½æ•°</h3>
<p>append ç”¨äºå‘åˆ‡ç‰‡ä¸­è¿½åŠ ä¸€ä¸ªå…ƒç´ ï¼Œ</p>
<pre class="line-numbers"><code class="language-go">package main


import &quot;fmt&quot;


func main() {
   var numbers []int
   printSlice(numbers)


   /* å…è®¸è¿½åŠ ç©ºåˆ‡ç‰‡ */
   numbers = append(numbers, 0)
   printSlice(numbers)


   /* å‘åˆ‡ç‰‡æ·»åŠ ä¸€ä¸ªå…ƒç´  */
   numbers = append(numbers, 1)
   printSlice(numbers)


   /* åŒæ—¶æ·»åŠ å¤šä¸ªå…ƒç´  */
   numbers = append(numbers, 2,3,4)
   printSlice(numbers)


   /* åˆ›å»ºåˆ‡ç‰‡ numbers1 æ˜¯ä¹‹å‰åˆ‡ç‰‡çš„ä¸¤å€å®¹é‡*/
   numbers1 := make([]int, len(numbers), (cap(numbers))*2)


   /* æ‹·è´ numbers çš„å†…å®¹åˆ° numbers1 */
   copy(numbers1,numbers)
   printSlice(numbers1)   
}


func printSlice(x []int){
   fmt.Printf(&quot;len=%d cap=%d slice=%v\n&quot;,len(x),cap(x),x)
}
</code></pre>
<h2><a id="map" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>map</h2>
<p>Map æ˜¯ä¸€ç§æ— åºçš„é”®å€¼å¯¹çš„é›†åˆã€‚Map æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯é€šè¿‡ key æ¥å¿«é€Ÿæ£€ç´¢æ•°æ®ï¼Œkey ç±»ä¼¼äºç´¢å¼•ï¼ŒæŒ‡å‘æ•°æ®çš„å€¼ã€‚</p>
<p>Map æ˜¯ä¸€ç§é›†åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿­ä»£æ•°ç»„å’Œåˆ‡ç‰‡é‚£æ ·è¿­ä»£å®ƒã€‚ä¸è¿‡ï¼ŒMap æ˜¯æ— åºçš„ï¼Œæˆ‘ä»¬æ— æ³•å†³å®šå®ƒçš„è¿”å›é¡ºåºï¼Œè¿™æ˜¯å› ä¸º Map æ˜¯ä½¿ç”¨ hash è¡¨æ¥å®ç°çš„ã€‚</p>
<pre class="line-numbers"><code class="language-go">/* å£°æ˜å˜é‡ï¼Œé»˜è®¤ map æ˜¯ nil */
var map_variable map[key_data_type]value_data_type

/* ä½¿ç”¨ make å‡½æ•° */
map_variable := make(map[key_data_type]value_data_type)
</code></pre>
<h2><a id="%E7%BB%93%E6%9E%84%E4%BD%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç»“æ„ä½“</h2>
<pre class="line-numbers"><code class="language-go">package main

import &quot;fmt&quot;

// ç±»åå¤§å†™ï¼Œå…¶ä»–åŒ…ä¹Ÿå¯ä»¥å¼•ç”¨åˆ°ã€‚å°å†™å°±ä¸è¡Œ
type Books struct {
	title  string
	author string
}

// æ™®é€šå‡½æ•°ï¼Œå‚æ•°æ˜¯ç»“æ„ä½“
func printBook(book Books) {
	fmt.Printf(&quot;book = %v\n&quot;, book)
}

// æ™®é€šå‡½æ•°ï¼Œå‚æ•°æ˜¯ç»“æ„ä½“ï¼Œå€¼ä¼ é€’ï¼Œä¿®æ”¹ä¸ä¼šåœ¨ main å‡½æ•°ä¸­ç”Ÿæ•ˆ
func SetTitle(book Books) {
	book.title = &quot;Python&quot;
}
// ä½¿ç”¨æŒ‡é’ˆä¼ é€’å‚æ•°å¯ä»¥ä¿®æ”¹å…¶å±æ€§å€¼
func SetTitle2(book *Books) {
	book.title = &quot;Python&quot;
}

// è¿™ä¸ªå‡½æ•°ç›¸å½“äºç»“æ„ä½“çš„å‡½æ•°ï¼Œå¯ä»¥ book.SetAuthor() è°ƒç”¨ã€‚
// æ³¨æ„æ˜¯ä¸ªæŒ‡é’ˆä¼ é€’ï¼Œå¯ä»¥å†™æˆå€¼ä¼ é€’ï¼Œä½†ä¿®æ”¹æ²¡æœ‰æ•ˆæœ
func (t *Books) SetAuthor() {
	t.author = &quot;lisi&quot;
}

func main() {
	book := Books{&quot;GO&quot;, &quot;test&quot;}
	fmt.Println(book)
	book.title = &quot;C&quot;
	fmt.Println(book)

	java := Books{title: &quot;Java&quot;, author: &quot;22&quot;}
	printBook(java)
	SetTitle(java)
	printBook(java)

	SetTitle2(&amp;java)
	java.SetAuthor()
	printBook(java)
}

</code></pre>
<h2><a id="%E7%BB%A7%E6%89%BF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç»§æ‰¿</h2>
<h3><a id="method" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>method</h3>
<p>method é™„å±åœ¨ä¸€ä¸ªç»™å®šç±»å‹ä¸Šï¼Œè¯­æ³•å’Œå‡½æ•°çš„è¯­æ³•å‡ ä¹ä¸€æ ·ï¼Œåªæ˜¯åœ¨ func åé¢å¢åŠ äº†ä¸€ä¸ª receiver(ä¹Ÿå°±æ˜¯ method æ‰€ä¾ä»çš„ä¸»ä½“)</p>
<p>method ç»™ç”¨æˆ·å®šä¹‰çš„ç±»å‹æ·»åŠ æ–°çš„è¡Œä¸ºã€‚</p>
<p>method çš„æ¥æ”¶è€…å¯ä»¥æ˜¯æ™®é€šç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡é’ˆç±»å‹ï¼Œæ˜¯æ™®é€šç±»å‹çš„æ—¶å€™æ¥æ”¶çš„å€¼çš„å‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯å€¼ä¼ é€’ï¼Œæ˜¯æŒ‡é’ˆç±»å‹çš„æ—¶å€™æ¥æ”¶çš„æ˜¯å†…å­˜åœ°å€ï¼Œå°±æ˜¯å¼•ç”¨ä¼ é€’ã€‚</p>
<pre class="line-numbers"><code class="language-go">func (r receiverType) funcName(parameters) (results)
</code></pre>
<p>è™½ç„¶ method çš„åå­—ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯å¦‚æœæ¥æ”¶è€…ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆ method å°±ä¸ä¸€æ ·</p>
<h3><a id="method%E7%BB%A7%E6%89%BF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>method ç»§æ‰¿</h3>
<p>å¦‚æœåŒ¿åå­—æ®µå®ç°äº†ä¸€ä¸ª methodï¼Œé‚£ä¹ˆåŒ…å«è¿™ä¸ªåŒ¿åå­—æ®µçš„ struct ä¹Ÿèƒ½è°ƒç”¨è¯¥ method</p>
<pre class="line-numbers"><code class="language-go">package main

import (
	&quot;fmt&quot;
)

type Human struct {
	name string
	sex  string
}

func (t *Human) Eat() {
	fmt.Println(&quot;eat&quot;)
}

func (t *Human) Walk() {
	fmt.Println(&quot;walk&quot;)
}

type SuperHuman struct {
	// åŒ¿åå­—æ®µï¼Œä½¿å¾— SuperHuman çš„å¯¹è±¡ä¹Ÿæ‹¥æœ‰ Human çš„ method
	Human
	level int
}

// é‡å†™ SuperHuman çš„ Walk æ–¹æ³•ã€‚
func (t *SuperHuman) Walk() {
	fmt.Println(&quot;fly&quot;)
}

func main() {
	man := Human{
		name: &quot;zhangsan&quot;,
		sex:  &quot;ç”·&quot;,
	}
	man.Eat()
	man.Walk()

	// åˆ›å»ºå­ç±»å¯¹è±¡
	//superMan := SuperHuman{
	//	Human{&quot;lisi&quot;, &quot;ç”·&quot;}, 100,
	//}
	var superMan SuperHuman
	superMan.level = 100
	superMan.name = &quot;lisi&quot;
	superMan.sex = &quot;ç”·&quot;

	superMan.Eat()
	superMan.Walk()
}

</code></pre>
<h2><a id="interface" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>interface</h2>
<p>interface æœ¬è´¨ä¸Šæ˜¯ä¸ªæŒ‡é’ˆã€‚<br />
interface å®šä¹‰äº†ä¸€ç»„ methodï¼Œå¦‚æœæŸä¸ªå¯¹è±¡å®ç°äº†æŸä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œåˆ™æ­¤å¯¹è±¡å°±å®ç°äº†è¿™ä¸ªæ¥å£</p>
<p>interface æ˜¯ä¸€ç»„æŠ½è±¡æ–¹æ³•çš„é›†åˆï¼Œå¿…é¡»ç”±å…¶ä»–é interface ç±»å‹å®ç°ï¼Œè€Œä¸èƒ½è‡ªæˆ‘å®ç°ï¼Œ</p>
<pre class="line-numbers"><code class="language-go">package main

import &quot;fmt&quot;

// å®šä¹‰ä¸€ä¸ª interfaceï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³• eatã€run
type Anaimal interface {
	eat()
	run()
}

// ======
// å®šä¹‰å­ç±»ï¼Œå®ç° interface ä¸­çš„ 2ä¸ªæ–¹æ³•ï¼Œå¿…é¡»è¦å®Œå…¨å®ç° interface ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰ç®—æ˜¯ç»§æ‰¿
type Dog struct {
}

func (dog Dog) eat() {
	fmt.Println(&quot;dog eat&quot;)
}

func (dog Dog) run() {
	fmt.Println(&quot;dog run&quot;)
}

// ======

type Cat struct {
}

func (cat Cat) eat() {
	fmt.Println(&quot;cat eat&quot;)
}

func (cat Cat) run() {
	fmt.Println(&quot;cat run&quot;)
}

// ======

func main() {
	var anaimal Anaimal
	anaimal = new(Dog)
	anaimal.eat()
	anaimal.run()

	anaimal = new(Cat)
	anaimal.eat()
	anaimal.run()
}
</code></pre>
<p>ä»¥ä¸Šè¿™äº›å°±æ˜¯ GO çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚å­¦ä¼šäº†è¿™äº›ä¸‹é¢å°±èƒ½ç®€å•è¿›è¡Œå¼€å‘äº†ã€‚</p>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»ä¸‹ GO çš„æ¡†æ¶ï¼ŒORM æ¡†æ¶ï¼ŒWeb æ¡†æ¶ï¼Œä»¥åŠç”¨è¿™äº›å¼€å‘ä¸€ä¸ªå°åº”ç”¨ã€‚</p>
<hr />
<p>å‚è€ƒç½‘ç«™<br />
<a href="https://learnku.com/go/wikis">https://learnku.com/go/wikis</a><br />
<a href="https://learnku.com/docs/the-little-go-book">https://learnku.com/docs/the-little-go-book</a><br />
<a href="https://learnku.com/docs/the-way-to-go">https://learnku.com/docs/the-way-to-go</a><br />
<a href="https://www.yuque.com/aceld/mo95lb/dsk886">https://www.yuque.com/aceld/mo95lb/dsk886</a><br />
<a href="https://www.runoob.com/go/go-map.html">https://www.runoob.com/go/go-map.html</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[centos7 å®‰è£… NFS]]></title>
    <link href="http://blog.hitol.top/16587443411197.html"/>
    <updated>2022-07-25T18:19:01+08:00</updated>
    <id>http://blog.hitol.top/16587443411197.html</id>
    <content type="html"><![CDATA[
<p>æ‰€æœ‰æœºå™¨éƒ½å®‰è£… nfs-utilsã€‚åªå®‰è£… nfs-utils å³å¯ï¼Œrpcbind å±äºå®ƒçš„ä¾èµ–ï¼Œä¹Ÿä¼šå®‰è£…ä¸Šã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">sudo yum install nfs-utils
</code></pre>
<h2><a id="%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æœåŠ¡ç«¯é…ç½®</h2>
<h3><a id="%E8%AE%BE%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è®¾ç½®æœåŠ¡å¼€æœºè‡ªå¯</h3>
<pre class="line-numbers"><code class="language-plain_text">sudo systemctl enable rpcbind
sudo systemctl enable nfs
</code></pre>
<h3><a id="%E5%90%AF%E5%8A%A8nfs%E6%9C%8D%E5%8A%A1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¯åŠ¨ NFS æœåŠ¡</h3>
<pre class="line-numbers"><code class="language-plain_text">sudo systemctl start rpcbind
sudo systemctl start nfs
</code></pre>
<h3><a id="%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é…ç½®å…±äº«ç›®å½•</h3>
<p>æœåŠ¡å¯åŠ¨åï¼Œé…ç½®ä¸€ä¸ªå…±äº«ç›®å½•ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ /data ç›®å½•ä½œä¸ºå…±äº«ç›®å½•</p>
<pre class="line-numbers"><code class="language-plain_text">sudo mkdir /data
sudo chmod 755 /data
</code></pre>
<p>åœ¨ /etc/exports æ–‡ä»¶ä¸­æ·»åŠ é…ç½®ã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">/data/     192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)
</code></pre>
<ol>
<li>/data: å…±äº«ç›®å½•ä½ç½®ã€‚</li>
<li>192.168.0.0/24: å®¢æˆ·ç«¯ IP èŒƒå›´ï¼Œ* ä»£è¡¨æ‰€æœ‰ï¼Œå³æ²¡æœ‰é™åˆ¶ã€‚</li>
<li>rw: æƒé™è®¾ç½®ï¼Œå¯è¯»å¯å†™ã€‚</li>
<li>sync: åŒæ­¥å…±äº«ç›®å½•ã€‚</li>
<li>no_root_squash: å¯ä»¥ä½¿ç”¨ root æˆæƒã€‚</li>
<li>no_all_squash: å¯ä»¥ä½¿ç”¨æ™®é€šç”¨æˆ·æˆæƒã€‚</li>
</ol>
<h3><a id="%E9%87%8D%E5%90%AFnfs" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é‡å¯ NFS</h3>
<pre class="line-numbers"><code class="language-plain_text">sudo systemctl restart nfs
</code></pre>
<p>æ£€æŸ¥æœ¬åœ°ç›®å½•</p>
<pre class="line-numbers"><code class="language-plain_text">showmount -e localhost

-- è¾“å‡º
Export list for localhost:
/data 192.168.0.130/24
</code></pre>
<h2><a id="linux%E5%AE%A2%E6%88%B7%E7%AB%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Linux å®¢æˆ·ç«¯</h2>
<h3><a id="%E8%AE%BE%E7%BD%AErpcbind%E6%9C%8D%E5%8A%A1%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è®¾ç½® rpcbind æœåŠ¡å¼€æœºè‡ªå¯</h3>
<pre class="line-numbers"><code class="language-plain_text">sudo systemctl enable rpcbind
</code></pre>
<h3><a id="%E5%90%AF%E5%8A%A8nfs%E6%9C%8D%E5%8A%A1" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¯åŠ¨ NFS æœåŠ¡</h3>
<pre class="line-numbers"><code class="language-plain_text">sudo systemctl start rpcbind
</code></pre>
<h3><a id="%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æŸ¥çœ‹æœåŠ¡ç«¯å…±äº«ç›®å½•</h3>
<pre class="line-numbers"><code class="language-plain_text">showmount -e 192.168.0.130

-- è¾“å‡º
Export list for 192.168.0.130:
/data 192.168.0.130/24

</code></pre>
<h3><a id="%E6%8C%82%E8%BD%BD" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æŒ‚è½½</h3>
<p>åœ¨å®¢æˆ·ç«¯åˆ›å»ºç›®å½•</p>
<pre class="line-numbers"><code class="language-plain_text">sudo mkdir /data
</code></pre>
<p>æŒ‚è½½</p>
<pre class="line-numbers"><code class="language-plain_text">sudo mount -t nfs 192.168.0.130:/data /data
</code></pre>
<h2><a id="%E6%B5%8B%E8%AF%95" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æµ‹è¯•</h2>
<p>åœ¨éšæ„ä¸€å°æœºå™¨ä¸Š /data æ·»åŠ ç›®å½•æˆ–è€…æ–‡ä»¶ï¼Œåœ¨å¦ä¸€å°æœºå™¨ä¸Š /data é‡ŒæŸ¥çœ‹</p>
<h2><a id="%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®¢æˆ·ç«¯è‡ªåŠ¨æŒ‚è½½</h2>
<p>ç¼–è¾‘å®¢æˆ·ç«¯æ–‡ä»¶ /etc/fstab<br />
åœ¨æœ€åä¸€è¡Œæ·»åŠ </p>
<pre class="line-numbers"><code class="language-plain_text">192.168.0.130:/data     /data                   nfs     defaults        0 0
</code></pre>
<p>ç”±äºä¿®æ”¹äº† /etc/fstabï¼Œéœ€è¦é‡æ–°åŠ è½½ systemctl</p>
<pre class="line-numbers"><code class="language-plain_text">sudo systemctl daemon-reload
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Redis è¿‡æœŸé”®åˆ é™¤ç­–ç•¥]]></title>
    <link href="http://blog.hitol.top/16505304277569.html"/>
    <updated>2022-04-21T16:40:27+08:00</updated>
    <id>http://blog.hitol.top/16505304277569.html</id>
    <content type="html"><![CDATA[
<p>redis æ•°æ®åº“é”®çš„è¿‡æœŸæ—¶é—´éƒ½ä¿å­˜åœ¨è¿‡æœŸå­—å…¸ä¸­ï¼Œè¿‡æœŸå­—å…¸çš„é”®æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘é”®ç©ºé—´ä¸‹çš„ä¸€ä¸ªå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯æŸä¸ªæ•°æ®åº“é”®ï¼‰ï¼Œè¿‡æœŸå­—å…¸çš„å€¼æ˜¯ä¸€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº†æ•°æ®åº“é”®çš„è¿‡æœŸæ—¶é—´ï¼Œä¸€ä¸ªæ¯«ç§’ç²¾ç¡®åº¦çš„ UNIX æ—¶é—´æˆ³ã€‚</p>
<p>è¿‡æœŸé”®çš„åˆ¤å®š</p>
<ol>
<li>æ£€æŸ¥ç»™å®šé”®æ˜¯å¦å­˜åœ¨ä¸è¿‡æœŸå­—å…¸ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œå–å¾—é”®çš„è¿‡æœŸæ—¶é—´</li>
<li>æ£€æŸ¥å½“å‰ UNIX æ—¶é—´æˆ³æ˜¯å¦å¤§äºé”®çš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆé”®å·²ç»è¿‡æœŸ</li>
</ol>
<p>å¦‚æœä¸€ä¸ªé”®è¿‡æœŸäº†ï¼Œredis ä»€ä¹ˆæ—¶å€™åˆ é™¤å®ƒå‘¢ï¼Ÿ</p>
<h2><a id="%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>åˆ é™¤ç­–ç•¥</h2>
<h3><a id="%E5%AE%9A%E6%97%B6%E5%88%A0%E9%99%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®šæ—¶åˆ é™¤</h3>
<p>åœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œè®©å®šæ—¶å™¨åœ¨é”®çš„è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ï¼Œç«‹å³å¯¹é”®è¿›è¡Œåˆ é™¤</p>
<p>å®šæ—¶åˆ é™¤ç­–ç•¥å¯¹å†…å­˜æ˜¯æœ€å‹å¥½çš„ï¼Œé€šè¿‡å®šæ—¶å™¨å¯ä»¥ä¿è¯è¿‡æœŸçš„é”®å°½å¿«çš„è¢«åˆ é™¤ï¼Œé‡Šæ”¾å†…å­˜<br />
å¯¹ CPU æ˜¯æœ€ä¸å‹å¥½çš„ï¼Œåœ¨è¿‡æœŸé”®æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¿‡æœŸé”®è¿™ä¸€è¡Œä¸ºä¼šå ç”¨éå¸¸å¤šçš„ CPUã€‚ä¼šå¯¹æœåŠ¡å™¨çš„å“åº”æ—¶é—´å’Œååé‡é€ æˆå½±å“ã€‚</p>
<h3><a id="%E6%83%B0%E6%80%A7%E5%88%A0%E9%99%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æƒ°æ€§åˆ é™¤</h3>
<p>æ¯æ¬¡ä»æ•°æ®åº“ä¸­è·å–é”®æ—¶åˆ¤æ–­å®ƒæ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå¦‚æœæ˜¯è¿‡æœŸçš„å°±åˆ æ‰è¯¥é”®ã€‚</p>
<p>å¯¹ CPU æ—¶é—´æ¥è¯´æ˜¯æœ€å‹å¥½çš„ï¼Œ<br />
å¯¹å†…å­˜æ˜¯æœ€ä¸å‹å¥½çš„ï¼Œå¦‚æœä¸€ä¸ªé”®å·²ç»è¿‡æœŸï¼Œä¸€ç›´æ²¡æœ‰è®¿é—®çš„è¯é‚£ä¹ˆè¿™ä¸ªé”®ä¸€ç›´ä¸ä¼šè¢«åˆ æ‰ï¼Œå…¶å¯¹åº”çš„å†…å­˜ä¸€ç›´ä¸ä¼šè¢«é‡Šæ”¾ã€‚æŸç§ç¨‹åº¦ä¸Šå¯ä»¥è¯´æ˜¯å†…å­˜æ³„éœ²ã€‚</p>
<h3><a id="%E5%AE%9A%E6%9C%9F%E5%88%A0%E9%99%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®šæœŸåˆ é™¤</h3>
<p>æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œç¨‹åºå°±å¯¹æ•°æ®åº“è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œåˆ é™¤è¿‡æœŸçš„é”®ã€‚</p>
<p>å®šæœŸåˆ é™¤ç­–ç•¥æ˜¯å‰é¢ä¸¤ç§ç­–ç•¥çš„ä¸€ç§æ•´åˆå’ŒæŠ˜ä¸­ã€‚</p>
<p>å®šæœŸåˆ é™¤ç­–ç•¥æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡åˆ é™¤è¿‡æœŸé”®çš„æ“ä½œï¼Œå¹¶é€šè¿‡é™åˆ¶æ“ä½œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘æ“ä½œå¯¹ CPU å¸¦æ¥çš„å½±å“</p>
<p>æœ‰æ•ˆçš„å‡å°‘äº†å†…å­˜çš„æµªè´¹ã€‚</p>
<p>å®šæœŸåˆ é™¤ç­–ç•¥çš„éš¾ç‚¹æ˜¯ç¡®å®šåˆ é™¤æ“ä½œçš„æ—¶é•¿çš„é¢‘ç‡</p>
<h2><a id="rdb%E3%80%81aof%E5%92%8C%E5%A4%8D%E5%88%B6%E5%8A%9F%E8%83%BD%E5%AF%B9%E8%BF%87%E6%9C%9F%E9%94%AE%E7%9A%84%E5%A4%84%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>RDBã€AOF å’Œå¤åˆ¶åŠŸèƒ½å¯¹è¿‡æœŸé”®çš„å¤„ç†</h2>
<h3><a id="%E7%94%9F%E6%88%90rdb%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç”Ÿæˆ RDB æ–‡ä»¶</h3>
<p>åœ¨æ‰§è¡Œ SAVE æˆ–è€… BGSAVE å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„ RDB æ–‡ä»¶æ—¶ï¼Œç¨‹åºä¼šå¯¹æ•°æ®åº“ä¸­çš„é”®è¿›è¡Œæ£€æŸ¥ï¼Œå·²è¿‡æœŸçš„é”®ä¸ä¼šä¿å­˜åˆ° RDB æ–‡ä»¶ä¸­ã€‚</p>
<h3><a id="%E8%BD%BD%E5%85%A5rdb%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è½½å…¥ RDB æ–‡ä»¶</h3>
<p>åœ¨å¯åŠ¨ Redis æ—¶ï¼Œå¦‚æœå¯ç”¨äº† RDB åŠŸèƒ½ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†å¯¹ RDB æ–‡ä»¶è¿›è¡Œè½½å…¥ï¼š</p>
<ol>
<li>å¦‚æœæ˜¯ masterï¼Œè¿‡æœŸé”®ä¸ä¼šè½½å…¥</li>
<li>å¦‚æœæ˜¯ slaveï¼Œè½½å…¥å…¨éƒ¨çš„ï¼Œä½†ä¸»ä»æœåŠ¡å™¨åœ¨è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œä»æœåŠ¡å™¨ä¸Šçš„æ•°æ®ä¼šå…¨éƒ¨æ¸…ç©ºï¼Œ</li>
</ol>
<h3><a id="aof%E8%BF%BD%E5%8A%A0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>AOF è¿½åŠ </h3>
<p>å¦‚æœä¸€ä¸ªé”®åœ¨ AOF ä¸­å·²ç»å­˜åœ¨ï¼Œå½“å®ƒè¿‡æœŸæ—¶ä¼šå¾€ AOF æ–‡ä»¶ä¸­è¿½åŠ ä¸€æ¡åˆ é™¤å‘½ä»¤æ¥è®°å½•è¯¥é”®å·²è¢«åˆ é™¤</p>
<h3><a id="aof%E9%87%8D%E5%86%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>AOF é‡å†™</h3>
<p>åœ¨æ‰§è¡Œ AOF é‡å†™çš„è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¼šå¯¹æ•°æ®åº“é”®è¿›è¡Œæ£€æŸ¥ï¼Œå·²ç»åˆ é™¤çš„é”®ä¸ä¼šå‡ºç°åœ¨é‡å†™åçš„æ–‡ä»¶ä¸­ã€‚</p>
<h3><a id="%E5%A4%8D%E5%88%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¤åˆ¶</h3>
<p>ä»æœåŠ¡å™¨çš„åˆ é™¤æ“ä½œç”±ä¸»æœåŠ¡å™¨æ§åˆ¶<br />
å½“é”®åœ¨ä¸»æœåŠ¡å™¨ä¸Šè¢«åˆ é™¤æ—¶ï¼Œä¸»æœåŠ¡å™¨ä¼šæ˜¾ç¤ºçš„å‘ä¸€æ¡ DEL æŒ‡ä»¤åˆ°ä»æœåŠ¡å™¨ï¼Œå‘ŠçŸ¥ä»æœåŠ¡å™¨åˆ é™¤è¿™ä¸ªè¿‡æœŸé”®</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä½¿ç”¨ kubeadm æ­å»º Kubernetes é›†ç¾¤]]></title>
    <link href="http://blog.hitol.top/16466651837804.html"/>
    <updated>2022-03-07T22:59:43+08:00</updated>
    <id>http://blog.hitol.top/16466651837804.html</id>
    <content type="html"><![CDATA[
<p>minikube ä¹Ÿæ˜¯ä½¿ç”¨ kubeadm</p>
<ul>
<li>å®‰è£…è½¯ä»¶ kubeleteã€kubeadmã€kubectl
<ul>
<li>éƒ½å°†æ˜¯ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œåœ¨ Docker ä¸­</li>
</ul>
</li>
<li>åˆå§‹åŒ–é›†ç¾¤</li>
<li>æ·»åŠ  node åˆ°é›†ç¾¤ä¸­</li>
<li>è¯ä¹¦è‡ªåŠ¨ç”Ÿæˆ</li>
<li>é›†ç¾¤ç®¡ç†ç³»ç»Ÿæ˜¯ä»¥å®¹å™¨æ–¹å¼å­˜åœ¨ï¼Œå®¹å™¨è¿è¡Œåœ¨ Master</li>
<li>å®¹å™¨é•œåƒæ˜¯è°·æ­Œæä¾›ï¼Œç§‘å­¦ä¸Šç½‘
<ul>
<li>é˜¿é‡Œäº‘ä¸‹è½½å®¹å™¨é•œåƒï¼Œéœ€è¦é‡æ–°æ‰“æ ‡è®°</li>
</ul>
</li>
</ul>
<h2><a id="%E4%B8%BB%E6%9C%BA%E8%A6%81%E6%B1%82" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä¸»æœºè¦æ±‚</h2>
<p>ä¸‰å°æœºå™¨ï¼Œä¸€å° masterï¼Œ2å° worker<br />
Centos7ã€2 cpuã€ 2G å†…å­˜</p>
<h2><a id="%E4%B8%BB%E6%9C%BA%E5%87%86%E5%A4%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä¸»æœºå‡†å¤‡</h2>
<p>æ“ä½œç³»ç»Ÿå®‰è£…ï¼Œcentos æœ€å°åŒ–å®‰è£…ï¼Œç¡¬ç›˜åˆ†åŒº(/bootã€/)</p>
<h2><a id="%E8%AE%BE%E7%BD%AEhostname" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>è®¾ç½® hostname</h2>
<p><code>hostnamectl set-hostname master</code><br />
<code>hostnamectl set-hostname worker1</code><br />
<code>hostnamectl set-hostname worker2</code></p>
<h2><a id="%E9%85%8D%E7%BD%AEip-etchosts" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é…ç½® IP /etc/hosts</h2>
<pre class="line-numbers"><code class="language-plain_text">192.168.0.130 master
192.168.0.122 worker1
192.168.0.123 worker2
</code></pre>
<h2><a id="%E5%85%B3%E9%97%ADfirewalld" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å…³é—­ firewalld</h2>
<pre class="line-numbers"><code class="language-plain_text">systemctl stop firewalld
systemctl disable firewalld

&lt;!--ç¡®è®¤æ˜¯å¦è¿è¡Œ--&gt;
firewall-cmd --state
</code></pre>
<h2><a id="selinux" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>SELINUX</h2>
<pre class="line-numbers"><code class="language-plain_text"> cat /etc/selinux/config


sed -ri 's/SELINUX=enforcing/SELINUX=disable/' /etc/selinux/config
</code></pre>
<h2><a id="%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ—¶é—´åŒæ­¥</h2>
<pre class="line-numbers"><code class="language-plain_text">yum install ntpdate
ntpdate time1.aliyun.com

crontab -e 
0 */1 * * * ntpdate time1.aliyun.com
</code></pre>
<h2><a id="%E5%85%B3%E9%97%ADswap%E5%88%86%E5%8C%BA" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å…³é—­ swap åˆ†åŒº</h2>
<pre class="line-numbers"><code class="language-plain_text">vim /etc/fstab

Swap å‰åŠ  # æ³¨é‡Šæ‰

free -m æŸ¥çœ‹æœ‰ swap åˆ†åŒº
reboot
é‡å¯ä¹‹åæ²¡æœ‰
</code></pre>
<h2><a id="%E9%85%8D%E7%BD%AE%E7%BD%91%E6%A1%A5%E8%BF%87%E6%BB%A4%E5%8A%9F%E8%83%BD" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é…ç½®ç½‘æ¡¥è¿‡æ»¤åŠŸèƒ½</h2>
<pre class="line-numbers"><code class="language-plain_text">touch /etc/sysctl.d/k8s.conf
æ·»åŠ ä»¥ä¸‹å†…å®¹

net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
vm.swappiness = 0
</code></pre>
<p>åŠ è½½è¿‡æ»¤æ¨¡å— br_netfilter</p>
<pre class="line-numbers"><code class="language-plain_text">modprobe br_netfilter

æŸ¥çœ‹æ˜¯å¦
lsmod | grep br_netfilter
</code></pre>
<p>åŠ è½½ç½‘æ¡¥è¿‡æ»¤é…ç½®æ–‡ä»¶</p>
<pre class="line-numbers"><code class="language-plain_text">sysctl -p /etc/sysctl.d/k8s.conf
</code></pre>
<h2><a id="%E5%BC%80%E5%90%AFipvs" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¼€å¯ ipvs</h2>
<p>service éœ€è¦ä½¿ç”¨åˆ° iptable æˆ–è€… ipvs<br />
ipvs æ¯” iptables è½¬åŒ–æ•ˆç‡é«˜ã€‚</p>
<p>å®‰è£… ipsetã€ipvsadm</p>
<pre class="line-numbers"><code class="language-bash">yum -y install ipset ipvsadm
</code></pre>
<p>åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ</p>
<pre class="line-numbers"><code class="language-bash">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF
</code></pre>
<pre class="line-numbers"><code class="language-bash">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4
</code></pre>
<p>æ£€æŸ¥æ˜¯å¦åŠ è½½</p>
<pre class="line-numbers"><code class="language-bash">lsmod | grep -e ipvs -e nf_conntrack_ipv4
</code></pre>
<h2><a id="%E5%AE%89%E8%A3%85docker" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®‰è£… docker</h2>
<p>centos å®‰è£… docker è„šæœ¬</p>
<pre class="line-numbers"><code class="language-plain_text">curl -sSL https://get.daocloud.io/docker | sh
</code></pre>
<h3><a id="%E5%BC%80%E5%90%AF%E5%90%AF%E5%8A%A8docker" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å¼€å¯å¯åŠ¨ docker</h3>
<pre class="line-numbers"><code class="language-plain_text">systemctl enable docker
</code></pre>
<!--### ä¿®æ”¹ docker é•œåƒæºåœ°å€
sudo vim /etc/docker/daemon.json

```
{
  "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn"]
}
```-->
<h3><a id="%E4%BF%AE%E6%94%B9docker%E7%9A%84-cgroup-driver" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä¿®æ”¹ docker çš„ cgroup driver</h3>
<p>sudo vim /etc/docker/daemon.json</p>
<pre class="line-numbers"><code class="language-plain_text">{
&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]
}
</code></pre>
<h2><a id="%E5%AE%89%E8%A3%85kubeadm%E3%80%81kubectl%E3%80%81kubelet" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å®‰è£… kubeadmã€kubectlã€kubelet</h2>
<p>éœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šå®‰è£…ä»¥ä¸‹çš„è½¯ä»¶åŒ…ï¼š</p>
<p>kubeadmï¼šç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤ã€‚</p>
<p>kubeletï¼šåœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ Pod å’Œå®¹å™¨ç­‰ã€‚</p>
<p>kubectlï¼šç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<p>æ–°å»º /etc/yum.repos.d/kubernetes.repoï¼Œå†…å®¹ä¸ºï¼š</p>
<pre class="line-numbers"><code class="language-plain_text">[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=0

</code></pre>
<p>å®‰è£…æœ€æ–°ç‰ˆæœ¬</p>
<pre class="line-numbers"><code class="language-plain_text">yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes
</code></pre>
<p>å®‰è£…æŒ‡å®šç‰ˆæœ¬</p>
<pre class="line-numbers"><code class="language-plain_text">yum install -y kubelet-1.23.5 kubeadm-1.23.5 kubectl-1.23.5
</code></pre>
<h2><a id="%E9%85%8D%E7%BD%AEkubelet" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>é…ç½® kubelet</h2>
<p>ä¸ºäº†å®ç° docker ä½¿ç”¨çš„ cgroupdriver ä¸ kubelet ä½¿ç”¨çš„ cgroup ä¸€è‡´ï¼Œä¿®æ”¹å¦‚ä¸‹æ–‡ä»¶å†…å®¹</p>
<pre class="line-numbers"><code class="language-plain_text">vim /etc/sysconfig/kubelet
æ·»åŠ ä»¥ä¸‹å†…å®¹
KUBELET_EXTRA_ARGS=&quot;--cgroup-driver=systemd&quot;
</code></pre>
<h2><a id="%E4%B8%8B%E8%BD%BD%E6%89%80%E9%9C%80%E9%95%9C%E5%83%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä¸‹è½½æ‰€éœ€é•œåƒ</h2>
<pre class="line-numbers"><code class="language-plain_text">k8s.gcr.io/kube-apiserver:v1.23.5
k8s.gcr.io/kube-controller-manager:v1.23.5
k8s.gcr.io/kube-scheduler:v1.23.5
k8s.gcr.io/kube-proxy:v1.23.5
k8s.gcr.io/pause:3.6
k8s.gcr.io/etcd:3.5.1-0
k8s.gcr.io/coredns/coredns:v1.8.6
</code></pre>
<ol>
<li>
<p>docker pull ä¸‹è½½<br />
docker pull ä¸‹è½½æ‰€æœ‰é•œåƒï¼Œéœ€è¦ç§‘å­¦ä¸Šç½‘ã€‚<br />
åœ¨æœ‰ç§‘å­¦ä¸Šç½‘çš„ç”µè„‘ä¸Šä¸‹è½½é•œåƒï¼Œé€šè¿‡ docker save -o ã€ docker load -i å°†é•œåƒå¤åˆ¶åˆ°æ‰€æœ‰è™šæ‹Ÿæœºä¸­ã€‚</p>
</li>
<li>
<p>é€šè¿‡è„šæœ¬ä¸‹è½½</p>
</li>
</ol>
<pre class="line-numbers"><code class="language-bash">#!/bin/bash
url=registry.cn-hangzhou.aliyuncs.com/google_containers
version=v1.23.5
images=(`kubeadm config images list --kubernetes-version=$version|awk -F '/' '{print $2}'`)
for imagename in ${images[@]} ; do
  docker pull $url/$imagename
  docker tag $url/$imagename k8s.gcr.io/$imagename
  docker rmi -f $url/$imagename
done
</code></pre>
<h2><a id="kubeadm%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>kubeadm åˆå§‹åŒ–é›†ç¾¤</h2>
<pre class="line-numbers"><code class="language-plain_text">kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.0.130 --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
</code></pre>
<p>ç„¶åæˆåŠŸåæœ‰ä»¥ä¸‹è¾“å‡ºå†…å®¹ï¼š</p>
<pre class="line-numbers"><code class="language-plain_text">Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

  export KUBECONFIG=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 192.168.0.118:6443 --token tprabz.gefub6pvv1x2qalv \
        --discovery-token-ca-cert-hash sha256:b617b1efda2e97a3f98c624a20090c0dc711bfe2e432a31631cbe87f215c103d 

</code></pre>
<p>ä¾æ¬¡æ‰§è¡Œ</p>
<pre class="line-numbers"><code class="language-plain_text">mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<p>è¿™æ—¶å€™ kubectl get nodes åªæœ‰ masterï¼Œå¹¶ä¸”è¿˜æ²¡å¯åŠ¨ï¼ŒåŸå› æ˜¯ç¼ºäº†ç½‘ç»œæ’ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ flannel ç½‘ç»œæ’ä»¶ï¼Œæ¯”è¾ƒç®€å•ã€‚<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/CleanShot%202022-07-02%20at%2023.59.29@2x.png" alt="CleanShot 2022-07-02 at 23.59.29@2x" /></p>
<p>Flannel is an overlay network provider that can be used with Kubernetes.</p>
<pre class="line-numbers"><code class="language-plain_text">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</code></pre>
<p>æˆ–è€…ä½¿ç”¨ yml æ–‡ä»¶</p>
<details>
<summary>kube-flannel.yml</summary>
<pre class="line-numbers"><code class="language-yml">---
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: psp.flannel.unprivileged
  annotations:
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default
    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default
    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default
    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default
spec:
  privileged: false
  volumes:
  - configMap
  - secret
  - emptyDir
  - hostPath
  allowedHostPaths:
  - pathPrefix: &quot;/etc/cni/net.d&quot;
  - pathPrefix: &quot;/etc/kube-flannel&quot;
  - pathPrefix: &quot;/run/flannel&quot;
  readOnlyRootFilesystem: false
  # Users and groups
  runAsUser:
    rule: RunAsAny
  supplementalGroups:
    rule: RunAsAny
  fsGroup:
    rule: RunAsAny
  # Privilege Escalation
  allowPrivilegeEscalation: false
  defaultAllowPrivilegeEscalation: false
  # Capabilities
  allowedCapabilities: ['NET_ADMIN', 'NET_RAW']
  defaultAddCapabilities: []
  requiredDropCapabilities: []
  # Host namespaces
  hostPID: false
  hostIPC: false
  hostNetwork: true
  hostPorts:
  - min: 0
    max: 65535
  # SELinux
  seLinux:
    # SELinux is unused in CaaSP
    rule: 'RunAsAny'
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: flannel
rules:
- apiGroups: ['extensions']
  resources: ['podsecuritypolicies']
  verbs: ['use']
  resourceNames: ['psp.flannel.unprivileged']
- apiGroups:
  - &quot;&quot;
  resources:
  - pods
  verbs:
  - get
- apiGroups:
  - &quot;&quot;
  resources:
  - nodes
  verbs:
  - list
  - watch
- apiGroups:
  - &quot;&quot;
  resources:
  - nodes/status
  verbs:
  - patch
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: flannel
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: flannel
subjects:
- kind: ServiceAccount
  name: flannel
  namespace: kube-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: flannel
  namespace: kube-system
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: kube-flannel-cfg
  namespace: kube-system
  labels:
    tier: node
    app: flannel
data:
  cni-conf.json: |
    {
      &quot;name&quot;: &quot;cbr0&quot;,
      &quot;cniVersion&quot;: &quot;0.3.1&quot;,
      &quot;plugins&quot;: [
        {
          &quot;type&quot;: &quot;flannel&quot;,
          &quot;delegate&quot;: {
            &quot;hairpinMode&quot;: true,
            &quot;isDefaultGateway&quot;: true
          }
        },
        {
          &quot;type&quot;: &quot;portmap&quot;,
          &quot;capabilities&quot;: {
            &quot;portMappings&quot;: true
          }
        }
      ]
    }
  net-conf.json: |
    {
      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,
      &quot;Backend&quot;: {
        &quot;Type&quot;: &quot;vxlan&quot;
      }
    }
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: kube-flannel-ds
  namespace: kube-system
  labels:
    tier: node
    app: flannel
spec:
  selector:
    matchLabels:
      app: flannel
  template:
    metadata:
      labels:
        tier: node
        app: flannel
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/os
                operator: In
                values:
                - linux
      hostNetwork: true
      priorityClassName: system-node-critical
      tolerations:
      - operator: Exists
        effect: NoSchedule
      serviceAccountName: flannel
      initContainers:
      - name: install-cni-plugin
       #image: flannelcni/flannel-cni-plugin:v1.0.1 for ppc64le and mips64le (dockerhub limitations may apply)
        image: rancher/mirrored-flannelcni-flannel-cni-plugin:v1.0.1
        command:
        - cp
        args:
        - -f
        - /flannel
        - /opt/cni/bin/flannel
        volumeMounts:
        - name: cni-plugin
          mountPath: /opt/cni/bin
      - name: install-cni
       #image: flannelcni/flannel:v0.17.0 for ppc64le and mips64le (dockerhub limitations may apply)
        image: rancher/mirrored-flannelcni-flannel:v0.17.0
        command:
        - cp
        args:
        - -f
        - /etc/kube-flannel/cni-conf.json
        - /etc/cni/net.d/10-flannel.conflist
        volumeMounts:
        - name: cni
          mountPath: /etc/cni/net.d
        - name: flannel-cfg
          mountPath: /etc/kube-flannel/
      containers:
      - name: kube-flannel
       #image: flannelcni/flannel:v0.17.0 for ppc64le and mips64le (dockerhub limitations may apply)
        image: rancher/mirrored-flannelcni-flannel:v0.17.0
        command:
        - /opt/bin/flanneld
        args:
        - --ip-masq
        - --kube-subnet-mgr
        resources:
          requests:
            cpu: &quot;100m&quot;
            memory: &quot;50Mi&quot;
          limits:
            cpu: &quot;100m&quot;
            memory: &quot;50Mi&quot;
        securityContext:
          privileged: false
          capabilities:
            add: [&quot;NET_ADMIN&quot;, &quot;NET_RAW&quot;]
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        volumeMounts:
        - name: run
          mountPath: /run/flannel
        - name: flannel-cfg
          mountPath: /etc/kube-flannel/
        - name: xtables-lock
          mountPath: /run/xtables.lock
      volumes:
      - name: run
        hostPath:
          path: /run/flannel
      - name: cni-plugin
        hostPath:
          path: /opt/cni/bin
      - name: cni
        hostPath:
          path: /etc/cni/net.d
      - name: flannel-cfg
        configMap:
          name: kube-flannel-cfg
      - name: xtables-lock
        hostPath:
          path: /run/xtables.lock
          type: FileOrCreate
</code></pre>
</details>
<p>kubectl apply -f kube-flannel.yml</p>
<p>worker èŠ‚ç‚¹ä¸­æ‰§è¡Œä¸‹é¢å‘½ä»¤æ·»åŠ åˆ°é›†ç¾¤ä¸­ã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">kubeadm join 192.168.0.118:6443 --token tprabz.gefub6pvv1x2qalv \
        --discovery-token-ca-cert-hash sha256:b617b1efda2e97a3f98c624a20090c0dc711bfe2e432a31631cbe87f215c103d 
</code></pre>
<p>å¦‚æœå¿˜è®°äº† join éœ€è¦çš„ tokenï¼Œé‡æ–°å† master æœºå™¨ä¸Šç”Ÿæˆä¸€ä¸ª</p>
<pre class="line-numbers"><code class="language-plain_text">kubeadm token create --print-join-command
</code></pre>
<p>ç„¶åå°†è¾“å‡ºå†…å®¹ï¼Œåœ¨ worker èŠ‚ç‚¹ä¸Šè¿è¡Œå°±è¡Œã€‚</p>
<p>ä¸å‡ºæ„å¤–ï¼Œé›†ç¾¤æ­å»ºå®Œæˆã€‚<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/CleanShot%202022-07-03%20at%2000.08.44@2x.png" alt="CleanShot 2022-07-03 at 00.08.44@2x" /></p>
<p>å°†ä¸Šé¢çš„æ“ä½œæ•´ç†æˆè„šæœ¬</p>
<details>
<summary>k8s_install.sh</summary>
<pre class="line-numbers"><code class="language-shell">#!/bin/bash
# ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ ip
# ç¬¬äºŒä¸ªå‚æ•°æ˜¯ master or worker

# yum -y update

if [ $# -lt 2 ]; then 
	echo &quot;æ‰§è¡Œå‘½ä»¤å‚æ•°ç¼ºå¤± eg: ./$0 ip master&quot;
	exit;
fi


echo &quot;$1 $2&quot; &gt;&gt; /etc/hosts

hostnamectl set-hostname $2

# å…³é—­firewalld
echo &quot;å…³é—­firewalld&quot;
systemctl stop firewalld
systemctl disable firewalld

sleep 3
firewall-cmd --state

echo &quot;SELINUX&quot;
sed -ri 's/SELINUX=enforcing/SELINUX=disable/' /etc/selinux/config

echo &quot;æ—¶é—´åŒæ­¥&quot;
yum -y install ntpdate
ntpdate time1.aliyun.com
echo &quot;0 */1 * * * ntpdate time1.aliyun.com&quot; &gt; /var/spool/cron/root


modprobe br_netfilter


echo &quot;å…³é—­ swap åˆ†åŒºï¼ŒSwap å‰åŠ  # æ³¨é‡Šæ‰&quot;
read -p &quot;æŒ‰ä»»æ„é”®ç»§ç»­...&quot;

vim /etc/fstab

echo &quot;é…ç½®ç½‘æ¡¥è¿‡æ»¤åŠŸèƒ½&quot;
cat &gt;  /etc/sysctl.d/k8s.conf &lt;&lt;EOF 
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
vm.swappiness = 0
EOF

sysctl -p /etc/sysctl.d/k8s.conf


echo &quot;å®‰è£… ipsetã€ipvsadm&quot;
yum -y install ipset ipvsadm

cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF
chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4


echo &quot;å®‰è£… docker&quot;
curl -sSL https://get.daocloud.io/docker | sh

cat &gt;  /etc/docker/daemon.json &lt;&lt;EOF
{
&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]
}
EOF

systemctl daemon-reload
systemctl restart docker
systemctl enable docker

echo &quot;å®‰è£… Kubernetes v1.23.5&quot;

cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt;EOF
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=0
EOF

yum install -y kubelet-1.23.5 kubeadm-1.23.5 kubectl-1.23.5

rm -rf /etc/sysconfig/kubelet
touch /etc/sysconfig/kubelet


cat &gt; /etc/sysconfig/kubelet &lt;&lt;EOF
KUBELET_EXTRA_ARGS=&quot;--cgroup-driver=systemd&quot;
EOF


systemctl enable kubelet.service

reboot

# echo &quot;ä¸‹è½½é•œåƒ&quot;
# sh image.sh

# echo &quot;åˆå§‹åŒ– Kubernetes&quot;
# if [ $2 == 'master' ] ; then
# 	echo &quot;åˆå§‹åŒ–å¼€å§‹&quot;
# 	kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=$1 --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
# fi

# sh after_install.sh
</code></pre>
</details>
<details>
<summary>image.sh</summary>
<pre class="line-numbers"><code class="language-shell">#!/bin/bash
url=registry.cn-hangzhou.aliyuncs.com/google_containers
version=v1.23.5
images=(`kubeadm config images list --kubernetes-version=$version|awk -F '/' '{print $2}'`)
for imagename in ${images[@]} ; do
  docker pull $url/$imagename
  docker tag $url/$imagename k8s.gcr.io/$imagename
  docker rmi -f $url/$imagename
done
</code></pre>
</details>
<p>å®‰è£…</p>
<pre class="line-numbers"><code class="language-plain_text">kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.0.130 --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
</code></pre>
<details>
<summary>after_install.sh</summary>
<pre class="line-numbers"><code class="language-shell">mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

kubectl apply -f kube-flannel.yml
</code></pre>
</details>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[k8s éƒ¨ç½² redis é›†ç¾¤]]></title>
    <link href="http://blog.hitol.top/16459468152713.html"/>
    <updated>2022-02-27T15:26:55+08:00</updated>
    <id>http://blog.hitol.top/16459468152713.html</id>
    <content type="html"><![CDATA[
<h2><a id="redis-master" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>redis-master</h2>
<p>redis-master.yml</p>
<pre class="line-numbers"><code class="language-yml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis-master
  labels:
    name: redis-master

spec:
  replicas: 1
  selector:
    matchLabels:
      name: redis-master
  template:
    metadata:
      labels:
        name: redis-master
    spec:
      containers:
      - name: master
        image: redis
        ports:
        - containerPort: 6379


---
apiVersion: v1
kind: Service
metadata:
  name: redis-master
  labels:
    name: redis-master

spec:
  ports:
  - port: 6379
    targetPort: 6379
  selector:
    name: redis-master
</code></pre>
<h2><a id="redis-slave" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>redis-slave</h2>
<p>Dockerfile</p>
<pre class="line-numbers"><code class="language-plain_text">FROM redis

COPY run.sh /
RUN chmod +x /run.sh
CMD /run.sh
</code></pre>
<p>run.sh</p>
<pre class="line-numbers"><code class="language-shell">if [[ ${GET_HOSTS_FROM:-dns} == &quot;env&quot; ]]; then
  redis-server --slaveof ${REDIS_MASTER_SERVICE_HOST} 6379
else
  redis-server --slaveof redis-master 6379
fi
</code></pre>
<p>docker build ç”Ÿæˆé•œåƒ</p>
<p>redis-slave.yml</p>
<pre class="line-numbers"><code class="language-yml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis-slave
  labels:
    name: redis-slave

spec:
  replicas: 2
  selector:
    matchLabels:
      name: redis-slave
  template:
    metadata:
      labels:
        name: redis-slave
    spec:
      containers:
      - name: worker
        image: hitol/redis-slave
        env:
        - name: GET_HOSTS_FROM
          value: env
        ports:
        - containerPort: 6379


---
apiVersion: v1
kind: Service
metadata:
  name: redis-slave
  labels:
    name: redis-slave

spec:
  ports:
  - port: 6379
  selector:
    name: redis-slave
</code></pre>
<h2><a id="%E9%AA%8C%E8%AF%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>éªŒè¯</h2>
<p><code>kubectl exec -it redis-master-4m5ds redis-cli</code> å¾€ redis é‡Œå†™å‡ æ¡æ•°æ®ï¼Œç„¶ååˆ‡æ¢åˆ° slave pod é‡Œçœ‹æœ‰æ²¡æœ‰ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ—¶é—´æ ¼å¼è½¬æ¢é—®é¢˜]]></title>
    <link href="http://blog.hitol.top/16407431442346.html"/>
    <updated>2021-12-29T09:59:04+08:00</updated>
    <id>http://blog.hitol.top/16407431442346.html</id>
    <content type="html"><![CDATA[
<div class="mweb_toc"><ul>
<li><a href="#%E5%90%84%E7%A7%8D%E6%A0%87%E5%87%86%E6%97%B6%E9%97%B4">å„ç§æ ‡å‡†æ—¶é—´</a>
<ul>
<li><a href="#%E6%A0%BC%E6%9E%97%E5%A8%81%E6%B2%BB%E6%A0%87%E5%87%86%E6%97%B6%E9%97%B4gmt">æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´GMT</a></li>
<li><a href="#%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6%E9%97%B4utc">åè°ƒä¸–ç•Œæ—¶é—´UTC</a></li>
<li><a href="#iso8601">ISO8601</a></li>
<li><a href="#cst">CST</a></li>
</ul>
</li>
<li><a href="#%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96yyyymmdd%E4%B8%8E-yyyymmdd%E7%9A%84%E5%8C%BA%E5%88%AB">æ—¥æœŸæ ¼å¼åŒ– YYYYMMdd ä¸ yyyyMMdd çš„åŒºåˆ«</a></li>
<li><a href="#%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96yyyy-mm-dd-hh-mm-ss%E4%B8%8E-yyyy-mm-dd-hh-mm-ss%E7%9A%84%E5%8C%BA%E5%88%AB">æ—¥æœŸæ ¼å¼åŒ– yyyy-MM-dd HH:mm:SS ä¸ yyyy-MM-dd HH:mm:ss çš„åŒºåˆ«</a></li>
</ul>
</div>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­å…¨å±€çš„é…ç½®</p>
<pre class="line-numbers"><code class="language-properties">spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone=GMT+8
</code></pre>
<p>æ‰€æœ‰ä½¿ç”¨åˆ°æ—¶é—´æ ¼å¼çš„åœ°æ–¹éƒ½ä¼šè½¬æ¢ä¸ºè¿™ç§æ ¼å¼çš„</p>
<h2><a id="%E5%90%84%E7%A7%8D%E6%A0%87%E5%87%86%E6%97%B6%E9%97%B4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>å„ç§æ ‡å‡†æ—¶é—´</h2>
<p><a href="https://ahuigo.github.io/b/c/shell-time#/">https://ahuigo.github.io/b/c/shell-time#/</a></p>
<h3><a id="%E6%A0%BC%E6%9E%97%E5%A8%81%E6%B2%BB%E6%A0%87%E5%87%86%E6%97%B6%E9%97%B4gmt" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´GMT</h3>
<p>å«ä¹‰ï¼šã€Œæ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ã€(Greenwich Mean Timeï¼Œç®€ç§°G.M.T.)ä»¥ä¼¦æ•¦æ ¼æ—å¨æ²»çš„å­åˆçº¿ä¸ºåŸºçº¿ï¼Œä»¥åœ°çƒè‡ªè½¬ä¸ºæ ‡å‡†ï¼Œå…¨çƒéƒ½ä»¥æ­¤æ ‡å‡†è®¾å®šæ—¶é—´ã€‚<br />
ä»¥ä¸‹å‡ ä¸ªæ—¶é—´ç›¸åŒï¼Œä½†ç”¨äºä¸åŒçš„æ—¶åŒº/åœ°åŒºã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">Wed Aug 14 08:21:05 GMT 2013 //æ ‡å‡†GMTæ—¶é—´
Wed Aug 14 16:21:05 GMT+8 2013 //ä¸œ8åŒºï¼Œå³æˆ‘ä»¬çš„åŒ—äº¬æ—¶é—´
Wed Aug 14 03:21:05 GMT-5 2013 //è¥¿5åŒºï¼Œç¾å›½å’ŒåŠ æ‹¿å¤§æ—¶é—´
</code></pre>
<h3><a id="%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6%E9%97%B4utc" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>åè°ƒä¸–ç•Œæ—¶é—´UTC</h3>
<p>ç”±äºåœ°çƒæ¯å¤©çš„è‡ªè½¬æ˜¯æœ‰äº›ä¸è§„åˆ™çš„ï¼Œè€Œä¸”æ­£åœ¨ç¼“æ…¢å‡é€Ÿï¼Œå› æ­¤æ ¼æ—å¨æ²»æ—¶é—´å·²ç»ä¸å†è¢«ä½œä¸ºæ ‡å‡†æ—¶é—´ä½¿ç”¨ã€‚ç°åœ¨çš„æ ‡å‡†æ—¶é—´ï¼Œæ˜¯ç”±åŸå­é’ŸæŠ¥æ—¶çš„åè°ƒä¸–ç•Œæ—¶ï¼ˆUTC: Coordinated Universal Timeï¼‰ã€‚UTCæ¯”GMTæ›´ç²¾ç¡®ä¸¥è°¨ã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">Wed Aug 14 08:21:05 UTC 2013 //æ ‡å‡†UTCæ—¶é—´
Wed Aug 14 16:21:05 UTC+8 2013 //ä¸œ8åŒºï¼Œå³æˆ‘ä»¬çš„åŒ—äº¬æ—¶é—´
Wed Aug 14 03:21:05 UTC-5 2013 //è¥¿5åŒºï¼Œç¾å›½å’ŒåŠ æ‹¿å¤§æ—¶é—´
</code></pre>
<p>å¸¸è¯†ï¼š<br />
å›½é™…åŸå­æ—¶çš„è¯¯å·®ä¸ºæ¯æ—¥æ•°çº³ç§’<br />
å¯¹æˆ‘ä»¬æ—¥å¸¸æ‰€ä½¿ç”¨çš„æ—¶é—´å·¥å…·è€Œè¨€ï¼ŒUTCå’ŒGMTæ—¶é—´æ²¡æœ‰åŒºåˆ«ã€‚</p>
<h3><a id="iso8601" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ISO8601</h3>
<p>moment.defaultFormat is the ISO8601 format YYYY-MM-DDTHH:mm:ssZ<br />
ISO8601:</p>
<pre class="line-numbers"><code class="language-plain_text">new Date(&quot;2016-01-01 11:13:00Z&quot;);      +0åŒº
new Date(&quot;2016-01-01T11:13:00Z&quot;);      +0åŒº
new Date(&quot;2016-01-01 11:13:00+08&quot;);     +8åŒº
new Date(&quot;2016-01-01 11:13:00+0800&quot;); +8åŒº
new Date(&quot;2016-01-01T11:13:00+08:00&quot;); +8åŒº
new Date(&quot;2016-01-01T11:13:00.333+08:00&quot;); +8åŒº

new Date(&quot;2016-01-01&quot;);                 +0åŒº(é»˜è®¤)
new Date(&quot;2016-01-01 11:13:00&quot;);        +8åŒº(é»˜è®¤)
new Date(&quot;October 13, 1975 11:13:00&quot;);  +8åŒº(é»˜è®¤)
</code></pre>
<h3><a id="cst" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>CST</h3>
<p>CSTæ˜¯æ—¶åŒºç¼©å†™ï¼Œå¯ä»¥æŒ‡ä¸‹åˆ—çš„æ—¶åŒºï¼š</p>
<p>æ¾³æ´²ä¸­éƒ¨æ—¶é—´ï¼ŒCentral Standard Time (Australia)<br />
ä¸­éƒ¨æ ‡å‡†æ—¶åŒºï¼ˆåŒ—ç¾æ´²ï¼‰ï¼ŒCentral Standard Time (North America)<br />
åŒ—äº¬æ—¶é—´ï¼ŒChina Standard Time<br />
å¤å·´æ ‡å‡†æ—¶é—´ï¼ŒCuba Standard Timeï¼Œå‚è§åŒ—ç¾ä¸œéƒ¨æ—¶åŒº<br />
å»ºè®®ä¸è¦ä½¿ç”¨CSTæ—¶é—´ï¼Œå¯¹äºä»¥ä¸‹æ—¶é—´ï¼Œä½ å¯èƒ½ä¸çŸ¥é“å®ƒåˆ°åº•æ˜¯åŒ—äº¬æ—¶é—´ï¼Œè¿˜æ˜¯å…¶å®ƒæ—¶é—´ï¼š</p>
<pre class="line-numbers"><code class="language-plain_text">Wed Aug 14 08:21:05 CST 2013 //åŒ—äº¬ã€åŒ—ç¾ä¸­éƒ¨ã€å¤å·´ã€æ¾³æ´²ä¸­éƒ¨ï¼ŸWho knows?
</code></pre>
<p>CST è½¬åŒ—äº¬æ—¶é—´<br />
åœ¨éœ€è¦è½¬æ¢æ—¥æœŸæ ¼å¼çš„å­—æ®µä¸Šæ·»åŠ æ³¨è§£<code>com.fasterxml.jackson.annotation.JsonFormat</code></p>
<pre class="line-numbers"><code class="language-plain_text">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;,timezone = &quot;GMT+8&quot;)
</code></pre>
<h2><a id="%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96yyyymmdd%E4%B8%8E-yyyymmdd%E7%9A%84%E5%8C%BA%E5%88%AB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ—¥æœŸæ ¼å¼åŒ– YYYYMMdd ä¸ yyyyMMdd çš„åŒºåˆ«</h2>
<p>å¤§å†™çš„ YYYY è¡¨ç¤ºè¿™ä¸€å¤©æ‰€åœ¨çš„å‘¨ æ‰€åœ¨çš„å¹´ä»½ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå½“å‰å‘¨è·¨å¹´äº†ï¼Œè¿™ä¸ªè·å–åˆ°çš„å°±æœ‰é—®é¢˜ã€‚</p>
<h2><a id="%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96yyyy-mm-dd-hh-mm-ss%E4%B8%8E-yyyy-mm-dd-hh-mm-ss%E7%9A%84%E5%8C%BA%E5%88%AB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>æ—¥æœŸæ ¼å¼åŒ– yyyy-MM-dd HH:mm:SS ä¸ yyyy-MM-dd HH:mm:ss çš„åŒºåˆ«</h2>
<p>HH è¡¨ç¤ºæŒ‰ 24 å°æ—¶æ ¼å¼è¿”å›</p>
<p>SS è¡¨ç¤ºæ¯«ç§’ï¼Ÿ<br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/CleanShot%202022-01-10%20at%2018.04.39@2x.png" alt="CleanShot 2022-01-10 at 18.04.39@2x" /></p>
<p>ç”¨å°å†™çš„ ss è¡¨ç¤ºç§’ã€‚</p>
<pre class="line-numbers"><code class="language-sql">select d.queue,
       count(*) as total
from gbl_loan a
         join gbl_loan_type_dictionary b on a.loan_source = b.id and a.channel_id = b.channel_id
         join gbl_collection_case c on c.loan_id = a.id
         join gbl_assignment d on c.id = d.collection_id
where a.loan_source = #{loanSourceId}
  and a.active = 1
  and c.active = 1
  and b.tenant = #{tenant}
  and d.queue = #{queue}
  and d.agentId is not null
&lt;![CDATA[
  and a.created_time &gt; #{reportStartDate}
  and a.created_time &lt; #{reportEndDate}
]]&gt;
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Spring.factories]]></title>
    <link href="http://blog.hitol.top/16400068828317.html"/>
    <updated>2021-12-20T21:28:02+08:00</updated>
    <id>http://blog.hitol.top/16400068828317.html</id>
    <content type="html"><![CDATA[
<p>Spring åœ¨å¯åŠ¨åŠ è½½ bean çš„æ—¶å€™ä¼šåŠ è½½æ‰€æœ‰ jar åŒ…ä¸­çš„ <code>/resources/META-INF/spring.factories</code> æ–‡ä»¶ä¸­é…ç½®çš„ beanã€‚<br />
æ‰€ä»¥æˆ‘ä»¬åœ¨æä¾›ç»™åˆ«äººå·¥å…·åŒ…çš„æ—¶å€™å¯ä»¥åœ¨ spring.factories æ–‡ä»¶ä¸­å®šä¹‰ä¸€äº› bean è‡ªåŠ¨åŠ è½½åˆ°ä½¿ç”¨æ–¹çš„ Spring å®¹å™¨ä¸­ã€‚<br />
spring.factories ä¸­ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›é…ç½® beanï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº† @Configuration è¿™ä¸ªæ³¨è§£çš„ beanï¼Œåœ¨è¿™ä¸ªé…ç½® bean ä¸­åˆå§‹åŒ–ä¸€äº›æˆ‘ä»¬çš„å·¥å…·åŒ…éœ€è¦çš„ bean å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚</p>
<p>åœ¨<code>src/main/resources/META-INF</code>ä¸‹æ–°å»º spring.factories æ–‡ä»¶<br />
ç±»ä¼¼è¿™ç§çš„é…ç½®ï¼š</p>
<pre class="line-numbers"><code class="language-properties">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.wacai.gbl.config.LinkupSmsAutoConfiguration
</code></pre>
<h2><a id="%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E6%B3%A8%E8%A7%A3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ä¸€äº›å¸¸ç”¨çš„æ³¨è§£</h2>
<h3><a id="configuration" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>@Configuration</h3>
<p>å¼€å¯é…ç½®</p>
<h3><a id="enableconfigurationproperties-xxxproperties-class-xxxproperties-class" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>@EnableConfigurationProperties(xxxProperties.class,xxxProperties.class)</h3>
<p>è¯»å–å“ªäº›é…ç½®æ–‡ä»¶<br />
xxxProperties.class ä½¿ç”¨  <code>@ConfigurationProperties(prefix = &quot;xxx&quot;)</code> è¯»å–é…ç½®æ–‡ä»¶ä¸­å‰ç¼€ç›¸åŒçš„é…ç½®</p>
<h3><a id="bean" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>@Bean</h3>
<p>ä¸ä¸‹é¢çš„é…ç½®é…åˆä½¿ç”¨</p>
<h3><a id="conditionalonexpression" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>@ConditionalOnExpression(&quot;${} || ${}&quot;)</h3>
<p>å¯ä»¥é…ç½®å¤šä¸ªæ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶çš„å°±ä¼šåˆå§‹åŒ– bean</p>
<h3><a id="conditionalonproperty-value-xx-xx-xx-havingvalue-matchifmissing-false" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>@ConditionalOnProperty(value = &quot;xx.xx.xx&quot;,havingValue = &quot;&quot;,matchIfMissing = false)</h3>
<p>è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„ xx.xx.xxï¼ŒhavingValue çš„å€¼ä¸é…ç½®æ–‡ä»¶ä¸­çš„å€¼ç›¸ç­‰åˆ™ä¼šåˆå§‹åŒ–</p>
<h3><a id="primary" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>@Primary</h3>
<p>é»˜è®¤ï¼Œé¦–é€‰çš„ã€‚â€¨</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¸¦æœ‰å‚æ•°çš„Spring RestTemplate GET]]></title>
    <link href="http://blog.hitol.top/16394497226152.html"/>
    <updated>2021-12-14T10:42:02+08:00</updated>
    <id>http://blog.hitol.top/16394497226152.html</id>
    <content type="html"><![CDATA[
<p>ä½¿ç”¨ RestTemplate å‘é€ get è¯·æ±‚æºå¸¦å‚æ•°ï¼Œå‘ç°æœ‰é—®é¢˜ï¼Œå¯¹é¢æ”¶ä¸åˆ°æˆ‘çš„è¯·æ±‚å‚æ•°ï¼Œ</p>
<p>ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨å ä½ç¬¦å°†è¯·æ±‚çš„ url è½¬æ¢ä¸€ä¸‹ï¼Œç±»ä¼¼äºè¿™æ · <code>String url = &quot;http://api.xxx.xxx?name={name}&amp;age={age}&quot;;</code> å°†è¯·æ±‚å‚æ•°æ‹¼æ¥åœ¨é“¾æ¥åé¢ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒéº»çƒ¦ï¼Œåé¢æœ‰ä¿®æ”¹çš„è¯æ”¹åŠ¨è¾ƒå¤šã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œ	ä½¿ç”¨ UriComponentsBuilder æ‹¼æ¥è¯·æ±‚å‚æ•°</p>
<pre class="line-numbers"><code class="language-java">UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url).queryParams(params);
builder.queryParam(key,value)
</code></pre>
<p>ä¸€ä¸ªå·¥å…·ç±»çš„ get è¯·æ±‚ä»£ç </p>
<pre class="line-numbers"><code class="language-java">// æ‹¼æ¥å­—ç¬¦ä¸²
private String buildUrl(String subUrl) {
	return String.format(&quot;%s%s&quot;, volcanoUrl, subUrl);
}


// å‘é€ get è¯·æ±‚
public static &lt;T&gt; T getForEntity(String url, Class&lt;T&gt; responseType, MultiValueMap&lt;String, String&gt; headers,
		MultiValueMap&lt;String, String&gt; params, Object requestObj) {
	log.info(&quot;å¼€å§‹è¯·æ±‚è¿œç¨‹æ•°æ®,url:{},paramMap:{},headers:{},requestObj:{}&quot;, url, params, headers,requestObj);
	HttpEntity&lt;?&gt; requestEntity = new HttpEntity&lt;&gt;(headers);
	if (params == null) {
		params = new LinkedMultiValueMap&lt;&gt;();
	}
	UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url).queryParams(params);
	if (requestObj != null) {
		for (Entry&lt;String, String&gt; entry : objectToMap(requestObj).entrySet()) {
			builder.queryParam(entry.getKey(), Lists.newArrayList(entry.getValue()));
		}
	}
	ResponseEntity&lt;CommonResponse&lt;T&gt;&gt; responseEntity = restTemplate.exchange(builder.build().toUri(),
			HttpMethod.GET, requestEntity, getCommonResponseReference(responseType));
	if (responseEntity != null &amp;&amp; responseEntity.getStatusCode() == HttpStatus.OK) {
		CommonResponse&lt;T&gt; resp = responseEntity.getBody();
		if (resp.isSuccess()) {
			return resp.getData();
		} else {
			throw new BizException(&quot;æ•°æ®è¯·æ±‚å¤±è´¥,å¯¹æ–¹è¿”å›å¤±è´¥,&quot; + resp.getError());
		}
	}
	throw new BizException(&quot;æ•°æ®è¯·æ±‚å¤±è´¥,ç½‘ç»œå¼‚å¸¸,&quot; + JSON.toJSONString(responseEntity));
}



// obj è½¬ map
public static Map&lt;String, String&gt; objectToMap(Object obj) {
	if (obj == null) {
		return null;
	}
	Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();

	List&lt;Field&gt; allFields = new ArrayList&lt;&gt;();
	Class currentClass = obj.getClass();

	while (currentClass != null) {
		allFields.addAll(Arrays.asList(currentClass.getDeclaredFields()));
		currentClass = currentClass.getSuperclass();
	}

	for (Field field : allFields) {
		field.setAccessible(true);
		if (Objects.isNull(field.get(obj))) {
			continue;
		}
		if (field.isSynthetic()) {
			continue;
		}
		Object object = field.get(obj);
		if (object instanceof Map) {
			map.put(field.getName(), JSON.toJSONString(object));
		} else {
			map.put(field.getName(), String.valueOf(field.get(obj)));
		}
	}
	return map;
}



private static &lt;T&gt; ParameterizedTypeReference&lt;CommonResponse&lt;T&gt;&gt; getCommonResponseReference(Class&lt;T&gt; clazz) {
	JavaType javaType = objectMapper.getTypeFactory().constructParametricType(CommonResponse.class, clazz);
	return ParameterizedTypeReference.forType(javaType);
}


</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Graphql]]></title>
    <link href="http://blog.hitol.top/16356861657170.html"/>
    <updated>2021-10-31T21:16:05+08:00</updated>
    <id>http://blog.hitol.top/16356861657170.html</id>
    <content type="html"><![CDATA[
<h2><a id="%E7%AE%80%E4%BB%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ç®€ä»‹</h2>
<p>Graphql æ˜¯ä¸€ç§ç±»ä¼¼äº REST çš„ä¸€ç§ API æ ‡å‡†ã€‚<br />
ä¸æ˜¯ä¸€ç§æ•°æ®åº“æŠ€æœ¯ã€‚</p>
<p>æ€»çš„æ¥è¯´å°±æ˜¯ï¼Œåç«¯å¯ä»¥æ ¹æ®å‰ç«¯éœ€è¦çš„å­—æ®µè¿”å›å¯¹åº”çš„ä¿¡æ¯ï¼Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰æ¥å£ã€‚</p>
<pre class="line-numbers"><code class="language-plain_text">--- 1.å‰ç«¯è¯·æ±‚å­—æ®µ
{
  hero {
    name
  }
}

--- 2.åç«¯è¿”å›ç»“æœ
{
  &quot;data&quot;: {
    &quot;hero&quot;: {
      &quot;name&quot;: &quot;R2-D2&quot;
    }
  }
}


--- 1.å‰ç«¯è¯·æ±‚å­—æ®µ
{
  hero {
    name
    # Queries can have comments!
    friends {
      name
    }
  }
}

--- 2.åç«¯è¿”å›ç»“æœ
{
  &quot;data&quot;: {
    &quot;hero&quot;: {
      &quot;name&quot;: &quot;R2-D2&quot;,
      &quot;friends&quot;: [
        {
          &quot;name&quot;: &quot;Luke Skywalker&quot;
        },
        {
          &quot;name&quot;: &quot;Han Solo&quot;
        },
        {
          &quot;name&quot;: &quot;Leia Organa&quot;
        }
      ]
    }
  }
}
</code></pre>
<h2><a id="demo" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>demo</h2>
<p><a href="https://gitee.com/hitol/graphql-demo.git">https://gitee.com/hitol/graphql-demo.git</a></p>
<h3><a id="dependencies" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>dependencies</h3>
<pre class="line-numbers"><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
    &lt;artifactId&gt;graphql-java&lt;/artifactId&gt;
    &lt;version&gt;11.0&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
    &lt;artifactId&gt;graphiql-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;3.10.0&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
    &lt;artifactId&gt;graphql-java-spring-boot-starter-webmvc&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;
    &lt;artifactId&gt;guava&lt;/artifactId&gt;
    &lt;version&gt;26.0-jre&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3><a id="schema" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Schema</h3>
<p>åœ¨ resources æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª schema.graphqls æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹</p>
<pre class="line-numbers"><code class="language-graphql">type Query {
  bookById(id: ID): Book 
}

type Book {
  id: ID
  name: String
  pageCount: Int
  author: Author
}

type Author {
  id: ID
  firstName: String
  lastName: String
}

</code></pre>
<h2><a id="graphql%E5%8A%A0%E8%BD%BD%E5%88%B0-spring" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Graphql åŠ è½½åˆ° Spring</h2>
<pre class="line-numbers"><code class="language-java">
@Component
public class GraphQLProvider {


    @Autowired
    GraphQLDataFetchers graphQLDataFetchers;

    private GraphQL graphQL;

    @PostConstruct
    public void init() throws IOException {
        URL url = Resources.getResource(&quot;schema.graphqls&quot;);
        String sdl = Resources.toString(url, Charsets.UTF_8);
        GraphQLSchema graphQLSchema = buildSchema(sdl);
        this.graphQL = GraphQL.newGraphQL(graphQLSchema).build();
    }

    private GraphQLSchema buildSchema(String sdl) {
        TypeDefinitionRegistry typeRegistry = new SchemaParser().parse(sdl);
        RuntimeWiring runtimeWiring = buildWiring();
        SchemaGenerator schemaGenerator = new SchemaGenerator();
        return schemaGenerator.makeExecutableSchema(typeRegistry, runtimeWiring);
    }

    private RuntimeWiring buildWiring() {
        return RuntimeWiring.newRuntimeWiring()
                .type(newTypeWiring(&quot;Query&quot;)
                        .dataFetcher(&quot;bookById&quot;, graphQLDataFetchers.getBookByIdDataFetcher()))
                .type(newTypeWiring(&quot;Book&quot;)
                        .dataFetcher(&quot;author&quot;, graphQLDataFetchers.getAuthorDataFetcher()))
                .build();
    }

    @Bean
    public GraphQL graphQL() {
        return graphQL;
    }

}
</code></pre>
<p>å…¶ä¸­å¯¹äºæ–‡ä»¶çš„è§£æ æœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯ buildWiring</p>
<p>è¿™ä¸€å—å…¶å®å°±æ˜¯åç«¯æä¾›çš„å…³äº graphql çš„æ¥å£ã€‚</p>
<p>ä½¿ç”¨äº†ä¸€ä¸ªæ’ä»¶ï¼Œæ–¹ä¾¿è°ƒè¯• graphiql</p>
<p>é¡¹ç›®å¯åŠ¨ä¹‹åæµè§ˆå™¨ä¸­è®¿é—®ï¼Œ<a href="http://localhost:8080/graphiql">http://localhost:8080/graphiql</a><br />
<img src="http://hitol.blog.cdn.updev.cn/mweb/16356860055184.jpg" alt="" /></p>
<hr />
<p><a href="http://graphql.js.cool/learn/">http://graphql.js.cool/learn/</a></p>
<p><a href="https://www.graphql-java.com/tutorials/getting-started-with-spring-boot/">https://www.graphql-java.com/tutorials/getting-started-with-spring-boot/</a></p>

]]></content>
  </entry>
  
</feed>
