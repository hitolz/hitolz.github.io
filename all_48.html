<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  非著名Java程序员
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="非著名Java程序员" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
 
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:blog.hitol.top ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_self" href="about1.html">About</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 非著名Java程序员</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        
        <li><a target="_self" href="about1.html">About</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="redis.html">redis</a></li>
        
            <li><a href="dubbo.html">dubbo</a></li>
        
            <li><a href="RocketMQ.html">RocketMQ</a></li>
        
            <li><a href="kubernetes.html">kubernetes</a></li>
        
            <li><a href="Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF.html">Java并发编程的艺术</a></li>
        
            <li><a href="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.html">网络协议</a></li>
        
            <li><a href="JVM.html">JVM</a></li>
        
            <li><a href="Java.html">Java</a></li>
        
            <li><a href="MySQL.html">MySQL</a></li>
        
            <li><a href="Docker.html">Docker</a></li>
        
            <li><a href="Spring.html">Spring</a></li>
        
            <li><a href="GO.html">GO</a></li>
        
            <li><a href="rust.html">rust</a></li>
        
            <li><a href="AI.html">AI</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="16032820634281.html">
                
                  <h1>Java类文件结构</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>Class文件对应着唯一一个类或接口的定义信息，但是类或接口并不一定都得定义在文件里（也可以通过类加载器直接生成）。</p>
<p>Class文件是一组以8位字节为基础单位的二进制流。</p>
<p>Java虚拟机规范中规定 ，Class文件格式采用一种类似于C语言结构体的结构来存储数据，有两种数据类型：无符号数和表。</p>
<ul>
<li>无符号数属于基本数据类型，以u1、u2、u4、u8来分别代表1、2、4、8 个字节。</li>
<li>无符号数可以用来描述数字、索引引用、数量值或者按照UTF-8编码构成的字符串值。</li>
</ul>
<p>表是有多个无符号数或者其他表作为数据项构成的复合数据类型，所有表都习惯性的以'_info'结尾。用于描述有层次关系的符合结构的数据。</p>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15933946995102.jpg" alt="" /></p>
<p>ClassFile {<br />
u4             magic;<br />
u2             minor_version;<br />
u2             major_version;<br />
u2             constant_pool_count;<br />
cp_info        constant_pool[constant_pool_count-1];<br />
u2             access_flags;<br />
u2             this_class;<br />
u2             super_class;<br />
u2             interfaces_count;<br />
u2             interfaces[interfaces_count];<br />
u2             fields_count;<br />
field_info     fields[fields_count];<br />
u2             methods_count;<br />
method_info    methods[methods_count];<br />
u2             attributes_count;<br />
attribute_info attributes[attributes_count];<br />
}</p>
<p>第1行，u4 = 4个字节，前4个字节是魔数，CAFEBABE，每个class文件都是以这个4个字节开始的；<br />
第2行，u2 = 2个字节，代表的是次版本号；<br />
第3行，u2 = 2个字节，代表的是主版本号；<br />
第4行，u2 = 2个字节，<code>constant_pool_conunt</code> 代表的是常量池的容量，常量个数；<br />
第5行，cp_info，<code>constant_pool</code>,代表的是常量池中每个常量的信息，常量个数从1开始到<code>constant_pool_conunt</code> - 1；<br />
第6行，u2 = 2个字节，表示的是<code>access_flags</code>访问标志；<br />
第7行，2个字节，表示的是this_class，类索引；<br />
第8行，2个字节，表示的是super_class，父类索引；<br />
第9行，2个字节，接口索引个数<br />
第10行，接口索引集合<br />
第11行，fields_count，字段集合个数<br />
第12行，fields，字段集合<br />
第13行，2个字节，methods_count,方法个数<br />
第14行，方法集合<br />
第15行，属性表集合个数<br />
第16行，属性表集合信息</p>
<h3><a id="%E5%88%86%E6%9E%90%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>分析字节码文件</h3>
<p>这是一个字节码文件</p>
<pre class="line-numbers"><code class="language-plain_text">CA FE BA BE 00 00 00 34  00 1D 0A 00 05 00 18 09
00 04 00 19 09 00 04 00  1A 07 00 1B 07 00 1C 01
00 04 6E 61 6D 65 01 00  12 4C 6A 61 76 61 2F 6C
61 6E 67 2F 53 74 72 69  6E 67 3B 01 00 03 61 67
65 01 00 01 49 01 00 06  3C 69 6E 69 74 3E 01 00
03 28 29 56 01 00 04 43  6F 64 65 01 00 0F 4C 69
6E 65 4E 75 6D 62 65 72  54 61 62 6C 65 01 00 07
67 65 74 4E 61 6D 65 01  00 14 28 29 4C 6A 61 76
61 2F 6C 61 6E 67 2F 53  74 72 69 6E 67 3B 01 00
07 73 65 74 4E 61 6D 65  01 00 15 28 4C 6A 61 76
61 2F 6C 61 6E 67 2F 53  74 72 69 6E 67 3B 29 56
01 00 06 67 65 74 41 67  65 01 00 03 28 29 49 01
00 06 73 65 74 41 67 65  01 00 04 28 49 29 56 01
00 0A 53 6F 75 72 63 65  46 69 6C 65 01 00 0B 50
65 72 73 6F 6E 2E 6A 61  76 61 0C 00 0A 00 0B 0C
00 06 00 07 0C 00 08 00  09 01 00 10 63 6F 6D 2F
68 69 74 6F 6C 2F 50 65  72 73 6F 6E 01 00 10 6A
61 76 61 2F 6C 61 6E 67  2F 4F 62 6A 65 63 74 00
21 00 04 00 05 00 00 00  02 00 02 00 06 00 07 00
00 00 02 00 08 00 09 00  00 00 05 00 01 00 0A 00
0B 00 01 00 0C 00 00 00  1D 00 01 00 01 00 00 00
05 2A B7 00 01 B1 00 00  00 01 00 0D 00 00 00 06
00 01 00 00 00 03 00 01  00 0E 00 0F 00 01 00 0C
00 00 00 1D 00 01 00 01  00 00 00 05 2A B4 00 02
B0 00 00 00 01 00 0D 00  00 00 06 00 01 00 00 00
09 00 01 00 10 00 11 00  01 00 0C 00 00 00 22 00
02 00 02 00 00 00 06 2A  2B B5 00 02 B1 00 00 00
01 00 0D 00 00 00 0A 00  02 00 00 00 0D 00 05 00
0E 00 01 00 12 00 13 00  01 00 0C 00 00 00 1D 00
01 00 01 00 00 00 05 2A  B4 00 03 AC 00 00 00 01
00 0D 00 00 00 06 00 01  00 00 00 11 00 01 00 14
00 15 00 01 00 0C 00 00  00 22 00 02 00 02 00 00
00 06 2A 1B B5 00 03 B1  00 00 00 01 00 0D 00 00
00 0A 00 02 00 00 00 15  00 05 00 16 00 01 00 16
00 00 00 02 00 17 
</code></pre>
<p>每个class文件的头4个字节 CA FE BA BE 称为魔数，也就是上面的图class文件格式中第一个，u4 magic。它的唯一作用 是确定这个文件是否 为一个能被虚拟机接受的class文件。</p>
<p>下两个字节 00 00  代表的是 次版本号, 十进制数 = 0<br />
下两个字节 00 34  代表的是 主版本号，十进制数=52<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934232324208.jpg" alt="" /></p>
<p>主次版本号表示的是jdk的版本，52对应的是1.8, 51对应的是1.7</p>
<p>之前遇到的一个错误，编译SpringBoot代码的时候用的1.8，在1.7的java环境中执行的话，就会出现这个52的错误。<br />
<code>Unsupported major.minor version 52.0</code></p>
<p>--<br />
###常量池及常量</p>
<p>下两个字节 00 1D  代表的是 常量池中常量的个数，<br />
常量个数从1开始的，0x1D = 29，最终结果是28，索引是1--28<br />
第0号常量池被JVM占用，表示的是什么都不引用。</p>
<p>常量分类<br />
字面量类型，比较接近于Java语言层面的常量概念，<br />
符号引用类型，属于编译原理方面的概念<br />
类和接口的全限定名<br />
字段的名称和描述符<br />
方法的名称和描述符</p>
<p>Java代码在编译的时候，是动态链接的，也就是说在Class文件中不会保存各个方法、字段的最终内存信息，因此这些字段、方法的符号引用不经过运行期转换的话无法得到真正的内存入口地址，也就无法直接被虚拟机使用。<br />
虚拟机运行的时候，需要从常量池获得对应的符号引用，在类创建或运行时解析、翻译到具体的内存地址中。</p>
<p>常量池中每项常量都是一个表，表开始的第一位是一个u1类型的标志位，tag，代表当前这个常量属于哪种类型常量。</p>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15933947606271.jpg" alt="" /></p>
<p>每个常量的结构类似这样的</p>
<pre class="line-numbers"><code class="language-plain_text">CONSTANT_Class_info{
    u1 : tag = 7
    u2 : name_index 
}
</code></pre>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15933947692967.jpg" alt="" /></p>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15933947846799.jpg" alt="" /></p>
<hr />
<p>第一个常量<br />
第一个字节 0A<br />
0x0A = 10<br />
在常量池项目类型中，标志位为10的是CONSTANT_Method_info，表示类中 方法的符号引用<br />
后面还有4个字节，前两个字节表示是执行声明字段的类或接口描述符<code>CONSTANT_Class_info</code>的索引项<br />
后两个字节表示的是指向字段描述符<code>CONSTANT_NamaeAndType </code>的索引项。<br />
前两个字节 00 05<br />
0x00 05 = <code>CONSTANT_Fieldref_info</code>5 ,表示引用的是第5个常量<br />
后两个字节<br />
0x00 18 = 24，表示引用的是第24个常量<br />
索引为5的常量代表的是个类，索引为24的常量代表的是个方法名，也就是说这个方法引用的是  #5.#24</p>
<p>常量池中第一个常量：<br />
// #1 = Methodref #5.#24 // java/lang/Object.&quot;<init>&quot;:()V</p>
<p>()V 表示的是方法 没有入参，没有返回值</p>
<hr />
<p>第二个常量<br />
第一个字节 09<br />
0x09 = 9<br />
表示的是 <code>CONSTANT_Fieldref_info</code>，其中的结构是 u1 u2 u2<br />
第一个字节就是标志位9<br />
后面4个字节中，前两个字节表示声明字段的类或者接口描述符<code>CONSTANT_Class_info</code>的索引项<br />
后两个字节表示指向字段描述符CONSTANT_NameAndType的索引项</p>
<p>前两个字节<br />
0x00 04  = 4，表示引用常量池中第4个常量，这个常量代表的是一个类</p>
<p>后两个字节<br />
0x00 19 = 25，表示引用常量池中第25个常量，这个常量代表一个属性名。</p>
<p>常量池中第二个常量：<br />
// #2 = Fieldref #4.#25 // com/hitol/Person.name:Ljava/lang/String;</p>
<p>代表的就是 Person类中name属性。</p>
<hr />
<p>第三个常量</p>
<p>09 = <code>CONSTANT_Fieldref_info</code></p>
<p>0x00 04 = 4<br />
0x00 1A = 26</p>
<p>// #4.#26</p>
<p>// #3 = Fieldref #4.#26 // com/hitol/Person.age:I</p>
<hr />
<p>第四个常量</p>
<p>07 = <code>CONSTANT_Class_info</code><br />
0x00 1B = 27</p>
<p>// #27</p>
<p>// #4 = Class #27 // com/hitol/Person</p>
<hr />
<p>第五个常量</p>
<p>07 = <code>CONSTANT_Class_info</code></p>
<p>0x00 1C = = 28</p>
<p>// #28<br />
// #5 = Class #28 // java/lang/Object</p>
<hr />
<p>第六个常量</p>
<p>01 = <code>CONSTANT_Utf8_info </code><br />
length = 0x00 04 = 4，长度为4<br />
bytes = 长度为4的字符串，6E 61 6D 65</p>
<p><a href="http://www.ab126.com/goju/1711.html">http://www.ab126.com/goju/1711.html</a><br />
在线转换后，</p>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15933949381449.jpg" alt="" /></p>
<p>6E 61 6D 65 转换后表示的字符串是name.</p>
<p>// #6 = Utf8 name</p>
<hr />
<p>第七个常量<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 0x00 12 = 18<br />
bytes = 4C 6A 61 76 61 2F 6C 61 6E 67 2F 53 74 72 69 6E 67 3B</p>
<p>转换后是  L j a v a / l a n g / S t r i n g ;</p>
<p>顺便提一下，Java中定义的变量或方法名，最大长度就是lenght的最大值，两个字节能表示的最大值就是65535。</p>
<hr />
<p>第八个常量<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 3<br />
bytes = a g e</p>
<hr />
<p>第九个常量<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 1<br />
bytes = I</p>
<hr />
<p>第十个常量<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 6<br />
bytes = &lt; i n i t &gt;</p>
<hr />
<p>第十一个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length =3<br />
bytes = ( ) V</p>
<hr />
<p>第十二个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length =4<br />
bytes =C  o d e</p>
<hr />
<p>第十三个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 16<br />
bytes =L i n e N u m b e r  T a b l e</p>
<hr />
<p>第十四个变量<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 07<br />
bytes =67 65 74 4E 61 6D 65 = getName</p>
<hr />
<p>第十五个变量<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 20<br />
bytes = 28 29 4C 6A 61 76 61 2F 6C 61 6E 67 2F 53  74 72 69 6E 67 3B  =( ) L j a va / l a n g / S  t r i n g ;</p>
<p>--<br />
第十六个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 07<br />
bytes = 73 65 74 4E 61 6D 65 = s e t N a m e</p>
<hr />
<p>第十七个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 07<br />
bytes = 28 4C 6A 61 76<br />
61 2F 6C 61 6E 67 2F 53  74 72 69 6E 67 3B 29 56 = ( L j a v<br />
a / l a n g / S  t r i n g ; ) V</p>
<p>--<br />
第十八个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 06<br />
bytes = 67 65 74 41 67  65 = g e t A g  e</p>
<hr />
<p>第十九个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 03<br />
bytes = 28 29 49  = ( ) I</p>
<p>--<br />
第二十个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 06<br />
bytes = 73 65 74 41 67 65 = s e t A g e</p>
<p>--<br />
第二十一个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 04<br />
bytes = 28 49 29 56 = ( I ) V</p>
<p>--<br />
第二十二个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 0A =10<br />
bytes = 53 6F 75 72 63 65  46 69 6C 65 = S o u r c e  F i l e</p>
<p>--<br />
第二十三个<br />
01 = <code>CONSTANT_Utf8_info </code><br />
length = 0B = 11<br />
bytes = 50 65 72 73 6F 6E 2E 6A 61  76 61 = P e r s o n . j a  v a</p>
<p>--<br />
第二十四个<br />
tag = 12 代表的是 <code>CONSTANT_NameAndType_info</code><br />
该结构还有4个字节，前两个字节表示指向该字段或方法名称常量项的索引，后两个字节表示指向该字段或方法描述符常量项的索引。</p>
<p>前两个字节：00 0A = 10<br />
后两个字节：00 0B = 11<br />
// #24 = #10:#11</p>
<p>--<br />
第二十五个<br />
tag = 0C = 12 = <code>CONSTANT_NameAndType_info</code><br />
前两个字节：00 06 = 6<br />
后两个字节：00 07 = 7<br />
// #25 = #6:#7</p>
<p>--<br />
第二十六个<br />
tag = 0C = <code>CONSTANT_NameAndType_info</code><br />
00 08<br />
00 09<br />
// #26 = #8:#9</p>
<p>--<br />
第二十七个<br />
tag = 01 = <code>CONSTANT_Utf8_info </code><br />
length = 10 = 16<br />
bytes = 63 6F 6D 2F 68 69 74 6F 6C 2F 50 65 72 73 6F 6E = c o m / h i t o l / P e  r s o n</p>
<p>--<br />
第二十八个<br />
tag = 01 = <code>CONSTANT_Utf8_info</code><br />
length = 10 = 16<br />
bytes = 6A 61 76 61 2F 6C 61 6E 67  2F 4F 62 6A 65 63 74 = j a v a / l a n g  / O b j e c t</p>
<hr />
<h3><a id="access-flags" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>access_flags</h3>
<p>常量池中28个常量已经分析完成，根据class文件格式表中的类型，下面两个字节表示access_flags。</p>
<p>访问标志<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15933949869453.jpg" alt="" /></p>
<p>0x00 21 = ACC_PUBLIC + ACC_SUPER<br />
ACC_PUBLIC 、 ACC_SUPER转换为2进制后执行|运算，</p>
<pre class="line-numbers"><code class="language-plain_text">   000001
|  100000
----------
   100001
</code></pre>
<p>100001对应的16进制就是21。</p>
<hr />
<h3><a id="%E7%B1%BB%E7%B4%A2%E5%BC%95%E3%80%81%E7%88%B6%E7%B1%BB%E7%B4%A2%E5%BC%95%E3%80%81%E6%8E%A5%E5%8F%A3%E7%B4%A2%E5%BC%95%E9%9B%86%E5%90%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>类索引、父类索引、接口索引集合</h3>
<p>类索引用于确定本类的全限定名、<br />
父类索引用于切丁父类的全限定名。<br />
由于Java单继承的，所以父类索引只有一个。</p>
<p>类索引的结构是<code>CONSTANT_Class_info</code><br />
类索引00 04，常量池中第4个常量，<br />
父类索引00 05，常量池中第5个常量。</p>
<p>接口索引集合就是用来描述这个类实现了哪些接口，这些被实现的接口将按implements语句的接口顺序从左到右排列在接口索引集合中。<br />
接口索引集合 00 00 表示个数为0</p>
<h3><a id="%E5%AD%97%E6%AE%B5%E8%A1%A8%E9%9B%86%E5%90%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>字段表集合</h3>
<p>字段表用于描述接口或者类中声明的变量。字段包括类级变量以及实例级变量，但不包括在方法内部声明的局部变量。</p>
<p>可以包括的信息有：</p>
<ol>
<li>
<p>字段的作用域<br />
public\private\protected修饰符</p>
</li>
<li>
<p>是实例变量还是类变量<br />
static修饰符</p>
</li>
<li>
<p>可变性<br />
final</p>
</li>
<li>
<p>并发可见性<br />
volatile修饰符，是否强制从主内存读写</p>
</li>
<li>
<p>可否被序列化<br />
transient修饰符</p>
</li>
<li>
<p>字段数据类型<br />
基本类型、对象、数组</p>
</li>
<li>
<p>字段名称</p>
</li>
</ol>
<p>字段表结构<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934209197781.jpg" alt="" /><br />
字段修饰符在access_flags中，其访问标志为<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934209653843.jpg" alt="" /></p>
<p>access_flags后是两个索引，name_index 和 descriptor_index。他们都是对常量池的引用，分别代表着字段的简单名称以及字段和方法的描述符，</p>
<p>--<br />
第一个字段</p>
<p>根据图中所示，前两个字节表示access_flags。<br />
0x00 02 = ACC_PRIVATE 表示这个字段是private修饰的。</p>
<p>接下来两个字节表示name_index，代表字段的简单名称。<br />
00 06 表示常量池中第6个常量 = name。</p>
<p>接下来两个字节表示descriptior_index ,代表方法的描述符。<br />
00 07 = 常量池中第7个常量= Ljava/lang/String;</p>
<p>简单名称是指没有类型和参数修饰的方法或者字段名称<br />
描述符的作用是用来描述字段的数据类型、方法的参数列表（包括数量、类型以及顺序）和返回值。L表示是一个对象，后面跟着对象的全限定名。</p>
<p>对于数组类型，每一维度将使用一个前置的'['字符描述，<br />
例如：定义了一个String类型的二维数组<br />
String [][] 将被记录为 “[[Ljava.lang.String;”</p>
<p>第一个字段就表示为 private String name;</p>
<p>字段表都包含的固定数据项目到descriptor_index为止就结束了，不过在之后跟随着一个属性表集合用于存储一些额外的信息，字段都可以在属性表中描述零至多项的额外信息。</p>
<p>在本例中是00 00 表示没有额外信息。</p>
<hr />
<p>第二个字段<br />
00 02 = ACC_PRIVATE 表示private</p>
<p>00 08 表示常量池中第8个常量 age<br />
00 09 表示第9个常量 I<br />
00 00 表示没有额外信息</p>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934804726175.jpg" alt="" /></p>
<p>I 表示是int类型。</p>
<h3><a id="%E6%96%B9%E6%B3%95%E8%A1%A8%E9%9B%86%E5%90%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>方法表集合</h3>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934217577553.jpg" alt="" /><br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934217892309.jpg" alt="" /><br />
下面两个字节00 05 表示的是方法的个数。</p>
<hr />
<p>第一个方法</p>
<p>前两个字节 00 01 表示访问标志access_flags，表示public<br />
接下来两个字节 00 0A 表示名称索引name_index，表示常量池中第10个常量，<init><br />
接下来两个字节00 0B 表示描述符索引descriptor_index，表示常量池中第11个常量，()V<br />
00 01 属性个数<br />
00 0C = 12 Code</p>
<p>Code属性见下面属性表集合。</p>
<p>这个方法表示的是无参构造方法。</p>
<hr />
<p>第二个方法<br />
00 01 = public<br />
00 0D = 第12个常量 = Code</p>
<p>Code属性见下面属性表集合</p>
<hr />
<h3><a id="%E5%B1%9E%E6%80%A7%E8%A1%A8%E9%9B%86%E5%90%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>属性表集合</h3>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934811640606.jpg" alt="" /></p>
<p>Code属性<br />
Java程序方法中的代码经过javac编译器处理后，最终变为字节码指令存储在Code属性内。</p>
<p>Code属性出现在方法表的属性集合中，但并非所有的方法表都必须存在这个属性，接口或抽象类中的方法就不存在Code属性。<br />
如果有Code属性，其结构为</p>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934811803843.jpg" alt="" /></p>
<p>前两个字节表示的是attribute_name_index是一项指向CONSTANT_Utf8_info的常量的索引，常量值固定为“Code”，代表了该属性的属性名称，</p>
<p>接下来4个字节指示了属性值的长度，<br />
接下来2个字节，max_stack，代表了操作数栈深度的最大值<br />
接下来2个字节，max_locals，代表了局部变量表所需的存储空间。单位是Slot，Slot是虚拟机为局部变量分配内存使用的最小单位。<br />
接下来4个字节，code_length，字节码长度，虽然是4个字节，理论上最大值2^32 - 1，但是虚拟机规范中明确限制了一个方法不允许超过65535条字节码指令，即它实际上只是用了u2的长度，如果超过这个限制，javac编译器也会拒绝编译。<br />
接下来1个字节，code，用于存储字节码指令的一系列字节流，表示一个指令。字节码长度个字节，表示几条指令。<br />
接下来2个字节，exception_table_length ，异常表长度<br />
exception_info 异常表信息<br />
异常表属性结构<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934811986012.jpg" alt="" /></p>
<p>包含4个字段，这些字段的含义为：如果当字节码在第start_pc行到第end_pc（不包含end_pc）行出现了类型为catch_type或者其子类的异常，则转到第handler_pc行继续处理。当catch_type为0时，代表任何异常情况都需要转向到handler_pc处理.</p>
<p>接下来2个字节，attributes_count<br />
attributes_info</p>
<p>第一个方法中Code属性：<br />
00 0C = Code<br />
00 00 00 1D 属性值的长度为29<br />
00 01 操作数栈深度最大值为1<br />
00 01 局部变量表空间为1<br />
00 00 00 05 code_length = 5,字节码长度是5</p>
<p>2A B7 00 01 B1</p>
<p>读入2A<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934812198485.jpg" alt="" /></p>
<p>0x2A = aload_0 指令，这个指令的含义是将第0个Slot中为reference类型的本地变量推送到操作数栈顶。</p>
<p>读入B7<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934812360881.jpg" alt="" /></p>
<p>指令为<br />
invokespecial，这条指令的作用是以栈顶的reference的数据所执行的对象作为方法接受者，调用此方法的实例构造器方法、private方法或者它的父类的方法。这个方法有一个u2类型的参数说明具体调用哪一个方法，它指向常量池中的一个CONSTANT_Methodref_info类型的常量，即此方法的方法符号引用。</p>
<p>读入00 01<br />
这个是上一条指令的参数，常量池中第一个常量，表示java/lang/Object.&quot;<init>&quot;:()V，实例构造器init方法的符号引用。</p>
<p>读入B1<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934812554268.jpg" alt="" /></p>
<p>查表得对应的指令为return，含义是返回此方法，并且返回值为void，这条方法指令执行后，当前方法结束。</p>
<p>00 00 表示异常表长度为0</p>
<hr />
<p>00 01 attributes_count = 1</p>
<p>接下来两个字节<br />
00 0D = 13 = LineNumberTable</p>
<p>LineNumberTable<br />
LineNumberTable，用于描述Java源码行号与字节码行号之间的对应关系，它并不是运行时必须的属性，但 默认会生成到Class文件之中，<br />
主要应用就是，当程序抛出异常时，堆栈中显示的错误行号。<br />
<img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15933949756469.jpg" alt="" /></p>
<hr />
<p>LocalVariableTable 局部变量表<br />
JVM中，Java虚拟机栈执行的时候创建栈帧，用来存放局部变量表，就是这个东西。<br />
用于描述栈帧中局部变量表的中的变量与Java源码中定义的变量之间的关系。</p>
<hr />
<p>idea中有个插件 jclasslib ，可以直观、友好的查看class文件中的内容</p>
<p><img src="http://hitol.blog.cdn.updev.cn/2020-07-05-15934813413496.jpg" alt="" /></p>
<hr />
<p>使用javap输出常量表</p>
<p>javap -verbose XXX.class</p>
<pre class="line-numbers"><code class="language-plain_text">  Last modified 2020-6-28; size 550 bytes
  MD5 checksum 0a4eff80df81adb2a2ee5ac6206f461c
  Compiled from &quot;Person.java&quot;
public class com.hitol.Person
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   #1 = Methodref          #5.#24         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   #2 = Fieldref           #4.#25         // com/hitol/Person.name:Ljava/lang/String;
   #3 = Fieldref           #4.#26         // com/hitol/Person.age:I
   #4 = Class              #27            // com/hitol/Person
   #5 = Class              #28            // java/lang/Object
   #6 = Utf8               name
   #7 = Utf8               Ljava/lang/String;
   #8 = Utf8               age
   #9 = Utf8               I
  #10 = Utf8               &lt;init&gt;
  #11 = Utf8               ()V
  #12 = Utf8               Code
  #13 = Utf8               LineNumberTable
  #14 = Utf8               getName
  #15 = Utf8               ()Ljava/lang/String;
  #16 = Utf8               setName
  #17 = Utf8               (Ljava/lang/String;)V
  #18 = Utf8               getAge
  #19 = Utf8               ()I
  #20 = Utf8               setAge
  #21 = Utf8               (I)V
  #22 = Utf8               SourceFile
  #23 = Utf8               Person.java
  #24 = NameAndType        #10:#11        // &quot;&lt;init&gt;&quot;:()V
  #25 = NameAndType        #6:#7          // name:Ljava/lang/String;
  #26 = NameAndType        #8:#9          // age:I
  #27 = Utf8               com/hitol/Person
  #28 = Utf8               java/lang/Object
{
  public com.hitol.Person();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
         4: return
      LineNumberTable:
        line 3: 0

  public java.lang.String getName();
    descriptor: ()Ljava/lang/String;
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: getfield      #2                  // Field name:Ljava/lang/String;
         4: areturn
      LineNumberTable:
        line 9: 0

  public void setName(java.lang.String);
    descriptor: (Ljava/lang/String;)V
    flags: ACC_PUBLIC
    Code:
      stack=2, locals=2, args_size=2
         0: aload_0
         1: aload_1
         2: putfield      #2                  // Field name:Ljava/lang/String;
         5: return
      LineNumberTable:
        line 13: 0
        line 14: 5

  public int getAge();
    descriptor: ()I
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: getfield      #3                  // Field age:I
         4: ireturn
      LineNumberTable:
        line 17: 0

  public void setAge(int);
    descriptor: (I)V
    flags: ACC_PUBLIC
    Code:
      stack=2, locals=2, args_size=2
         0: aload_0
         1: iload_1
         2: putfield      #3                  // Field age:I
         5: return
      LineNumberTable:
        line 21: 0
        line 22: 5
}
SourceFile: &quot;Person.java&quot;
</code></pre>
<hr />
<p>TODO</p>
<p>类的创建和动态连接</p>
<p>--<br />
参考<br />
《深入理解Java虚拟机》</p>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se14/html/index.html">Java Virtual Machine Specification</a></p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2020/10/21 20:07 下午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='JVM.html'>JVM</a></span>
          				   
                    

                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   <a href="all_47.html">&laquo; Prev Page</a>  
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="all_49.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <h1>非著名Java程序员</h1>
                <div class="site-des"></div>
                <div class="social">











  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="redis.html"><strong>redis</strong></a>
        
            <a href="dubbo.html"><strong>dubbo</strong></a>
        
            <a href="RocketMQ.html"><strong>RocketMQ</strong></a>
        
            <a href="kubernetes.html"><strong>kubernetes</strong></a>
        
            <a href="Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF.html"><strong>Java并发编程的艺术</strong></a>
        
            <a href="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.html"><strong>网络协议</strong></a>
        
            <a href="JVM.html"><strong>JVM</strong></a>
        
            <a href="Java.html"><strong>Java</strong></a>
        
            <a href="MySQL.html"><strong>MySQL</strong></a>
        
            <a href="Docker.html"><strong>Docker</strong></a>
        
            <a href="Spring.html"><strong>Spring</strong></a>
        
            <a href="GO.html"><strong>GO</strong></a>
        
            <a href="rust.html"><strong>rust</strong></a>
        
            <a href="AI.html"><strong>AI</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="16849954851968.html">向量数据库 Vector Database</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16761949639234.html">使用 ChatGPT 学习 Javassist</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16748079623338.html">rust 快速入门指南</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16727524082529.html">rust 包管理与工作空间</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16669473309292.html">rust actix-diesel-mysql demo</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>



  














<style type="text/css">
figure{margin: 0;padding: 0;}
figcaption{text-align:center;}

/* PrismJS 1.14.0
 http://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript */
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
    color: black;
    background: none;
    text-shadow: 0 1px white;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
    
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
    
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
    text-shadow: none;
    background:#b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
    text-shadow: none;
    background: #b3d4fc;
}

@media print {
    code[class*="language-"],
    pre[class*="language-"] {
        text-shadow: none;
    }
}

/* Code blocks */
pre[class*="language-"] {
    padding: 1em;
    margin: .5em 0;
    overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
    background: #F7F7F7;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
    padding: .1em;
    border-radius: .3em;
    white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
    color: slategray;
}

.token.punctuation {
    color: #999;
}

.namespace {
    opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
    color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
    color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
    color: #9a6e3a;
    background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
    color: #07a;
}

.token.function,
.token.class-name {
    color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
    color: #e90;
}

.token.important,
.token.bold {
    font-weight: bold;
}
.token.italic {
    font-style: italic;
}

.token.entity {
    cursor: help;
}


pre[class*="language-"].line-numbers {
    position: relative;
    padding-left: 3.8em;
    counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
    position: relative;
    white-space: inherit;
}

.line-numbers .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em; /* works for line-numbers below 1000 lines */
    letter-spacing: -1px;
    border-right: 1px solid #999;

    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

}

    .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }

</style>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>



  </body>
</html>
